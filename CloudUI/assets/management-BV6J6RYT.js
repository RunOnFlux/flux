import{q as W}from"./query-parser-C3-dT-Rr.js";import{_ as oe,M as L}from"./tabView-yiP-Zt8D.js";import{_ as le,c as re,r as w}from"./index-QPPWK7xw.js";import{D as ne}from"./DaemonService-D09C4O6H.js";import{i as se,a as ie,e as pe,d as ue}from"./enterpriseCrypto-BkXqwt7M.js";import{s as ce}from"./vue-core-CU9AIURn.js";import{a as de,g as me,b as fe}from"./useSEO-5BaNf11O.js";import{V as ve,Y as ge,X as ye,n as he,d as be,Q as we,b as Ae,Z as N,x as U,_ as j}from"./vuetify-_4u1He_j.js";import{u as xe}from"./i18n-Bm8bpAAW.js";import{r as s,c as q,w as _e,o as ke,f as z,g as c,a3 as r,x as f,P as E,Q as n,j as V,T as $,U as A,y as v}from"./apexcharts-nIAyciCq.js";import"./ansi-utils-ChIB8aIv.js";import"./ConfirmCustomDialog-D5jNuL5-.js";import"./MapComponent-D1NdOhsg.js";import"./leaflet-core-jNE0Bq0j.js";import"./leaflet-cluster-0ODEUdTP.js";import"./http-BZQDkn3h.js";import"./LoadingSpinner-BLJvP0iy.js";import"./geolocation-BklMEt0S.js";import"./ExplorerService-oc3qiwdf.js";import"./useLoginSheet-e2RZXtPE.js";import"./eventBus-BZyChua5.js";import"./event-utils-DGlX1gEp.js";import"./crypto-metamask-D6vz180a.js";import"./socketio-BDGyx5_k.js";import"./uuid-B49X2dQj.js";import"./vueuse-Bid7ZbHY.js";import"./unhead-DEOrWl0D.js";import"./cookie-BfmCf_44.js";import"./unjs-utils-GcjLqAqW.js";import"./casl-DNC8KRD8.js";import"./scrollbar-CXs_Utq1.js";import"./icons-mdi-_QP0sdRJ.js";import"./sanitizer-DAUAC_Zc.js";import"./element-plus-Cr1Qs4Q_.js";import"./lodash-C_Sw0jJq.js";import"./crypto-walletconnect-Nsddz84n.js";import"./lit-Ba94Z-Zv.js";import"./crypto-viem-CJP2v0S5.js";import"./date-utils-Cx_iWJ70.js";import"./crypto-ox-C1hHNqF1.js";const Ve={class:"d-flex align-center mb-3"},Se={class:"text-h4 mb-1"},Ce={class:"text-body-2 mb-0 text-medium-emphasis"},ze={class:"text-body-1 mb-0"},Ee={key:0},$e={key:0},Be={key:0},Ie={__name:"management",setup(Re){const{t:u}=xe();de({title:"My Applications - Manage FluxCloud Apps | FluxCloud",description:"Manage your deployed applications on Flux decentralized cloud. View app status, monitor performance, update configurations, and manage your FluxCloud deployments from a unified dashboard.",url:"https://cloud.runonflux.com/apps/management",keywords:"manage apps, FluxCloud dashboard, app management, deployed apps, monitor apps, app status, flux applications, container management, cloud dashboard",structuredData:[me(),fe([{name:"Home",url:"https://cloud.runonflux.com"},{name:"My Applications",url:"https://cloud.runonflux.com/apps/management"}])]});const Q=re(),{privilege:g}=ce(Q),i=s([]),y=s([]),B=s(""),h=s(-1),o=s({active:!0,expired:!0,blockCount:!0}),I=q(()=>g.value!=="none"),b=s(!1),x=s({show:!1,message:"",color:"error"}),S=s(0),G=s(null),H=s(null);function T(e,t="error"){x.value={show:!0,message:e,color:t}}const J=q(()=>g.value==="fluxteam"?u("menu.application.activeApps"):u("menu.application.myActiveApps"));async function X(e,t=0){const a=`[${t}:${e.name}]`;if(!(e.version>=8&&e.enterprise))return e;try{const p=await w.getAppOriginalOwner(e.name);if(p.data.status!=="success")return console.warn(`${a} âš ï¸ owner fail`,p.data),e;const d=p.data.data,C=localStorage.getItem("zelidauth"),l=await w.getAppPublicKey(C,{name:e.name,owner:d});if(l.data.status!=="success")return console.warn(`${a} âš ï¸ pubkey fail`,l.data),e;if(!se())return console.warn(`${a} âš ï¸ WebCrypto not available, skipping enterprise decryption`),e;const m=l.data.data.trim().replace(/\s+/g,""),M=await ie(m),P=crypto.getRandomValues(new Uint8Array(32)),te=await pe(P,M);let _;try{_=await w.getAppEncryptedSpecifics(e.name,C,te)}catch(k){return console.warn(`${a} âš ï¸ encrypted fetch fail`,k),e}if(_.data.status!=="success")return console.warn(`${a} âš ï¸ encrypted fetch bad status`,_.data),_.data.data?.message==="Application not found"?(console.warn(`${a} Application not found - will be filtered from list`),null):e;const D=_.data.data?.enterprise;if(!D)return console.warn(`${a} âš ï¸ missing encrypted payload`),e;let F=null;try{F=await ue(D,P)}catch(k){return console.warn(`${a} âš ï¸ decrypt failed`,k),e}let O={};try{O=JSON.parse(F)}catch(k){return console.warn(`${a} âš ï¸ parse fail`,k),e}return console.log(`${a} âœ… decrypted`),{...e,...O,enterprise:null}}catch(p){return console.error(`${a} ðŸ’¥ decrypt failed`,p),e}}async function R(e){return(await Promise.all(e.map(X))).filter(a=>a!==null)}async function Y(){try{const e=await ne.getBlockCount();e.data.status==="success"?(h.value=e.data.data,console.log("Daemon block count set:",h.value)):h.value=-1}catch{h.value=-1}finally{o.value.blockCount=!1}}async function Z(){o.value.active=!0,b.value=!1;try{const e=localStorage.getItem("zelidauth"),t=W.parse(e||"");if(!t?.zelid){i.value=[],o.value.active=!1;return}const a=await w.myGlobalAppSpecifications(t.zelid),p=Array.isArray(a.data.data)?a.data.data:[];i.value=await R(p)}catch{i.value=[],b.value=!0,T(u("menu.application.failedToLoadActiveApps"))}finally{o.value.active=!1}}async function ee(){o.value.expired=!0;try{const e=localStorage.getItem("zelidauth"),t=W.parse(e||"");if(!t?.zelid){y.value=[],o.value.expired=!1;return}const p=(await w.permanentMessagesOwner(t.zelid).catch(()=>({data:{data:[]}}))).data.data||[],d=[];p.forEach(l=>{const m=d.findIndex(M=>M.appSpecifications.name===l.appSpecifications.name);m===-1?d.push(l):l.height>d[m].height&&(d[m]=l)});const C=d.filter(l=>!i.value.find(m=>m.name.toLowerCase()===l.appSpecifications.name.toLowerCase()));y.value=await R(C.map(l=>l.appSpecifications))}catch{y.value=[],T(u("menu.application.failedToLoadExpiredApps"))}finally{o.value.expired=!1}}async function ae(){o.value.active=!0,b.value=!1;try{console.time("getAllApps");const{data:e}=await w.globalAppSpecifications(),t=e?.data??[];i.value=await R(t),console.timeEnd("getAllApps")}catch{b.value=!0,i.value=[]}finally{o.value.active=!1}}async function K(){g.value==="fluxteam"?await ae():await Promise.all([Z(),ee()])}return _e(I,e=>{e&&K()}),ke(async()=>{await Y(),await K()}),(e,t)=>(c(),z("div",null,[r(ve,{class:"mb-4 management-intro-card"},{default:n(()=>[r(be,null,{default:n(()=>[V("div",Ve,[r(we,{size:"48",color:"primary",variant:"tonal",class:"mr-3"},{default:n(()=>[r(Ae,{size:"28"},{default:n(()=>[...t[3]||(t[3]=[$("mdi-cloud-check-outline",-1)])]),_:1})]),_:1}),V("div",null,[V("h2",Se,A(v(u)("myApps.fluxCloudTitle")),1),V("p",Ce,A(v(u)("myApps.fluxCloudSubtitle")),1)])]),V("p",ze,A(v(u)("myApps.fluxCloudDescription")),1)]),_:1})]),_:1}),r(ge,{modelValue:S.value,"onUpdate:modelValue":t[0]||(t[0]=a=>S.value=a),grow:"","hide-slider":"",class:"tabs-no-slider mb-4"},{default:n(()=>[r(N,{class:"tab-chip"},{default:n(()=>[$(A(J.value)+" ",1),i.value.length?(c(),E(U,{key:0,content:i.value.length,color:"success","offset-x":"-5","offset-y":"8",class:"ml-2",floating:"",rounded:"",size:"small",density:"default"},null,8,["content"])):f("",!0)]),_:1}),v(g)!=="fluxteam"?(c(),E(N,{key:0,class:"tab-chip"},{default:n(()=>[$(A(v(u)("menu.application.myExpiredApps"))+" ",1),y.value.length?(c(),E(U,{key:0,content:y.value.length,color:"error","offset-x":"-5","offset-y":"8",class:"ml-2",floating:"",rounded:"",size:"small",density:"default"},null,8,["content"])):f("",!0)]),_:1})):f("",!0)]),_:1},8,["modelValue"]),B.value?f("",!0):(c(),z("div",Ee,[r(ye,{modelValue:S.value,"onUpdate:modelValue":t[1]||(t[1]=a=>S.value=a)},{default:n(()=>[r(j,null,{default:n(()=>[o.value.blockCount?f("",!0):(c(),z("div",$e,[r(L,{ref_key:"activeAppsRef",ref:G,apps:i.value,loading:o.value.active,"logged-in":I.value,"current-block-height":h.value,"active-apps-tab":"",manage:"","api-error":b.value,privilege:v(g)},null,8,["apps","loading","logged-in","current-block-height","api-error","privilege"])]))]),_:1}),r(j,null,{default:n(()=>[o.value.blockCount?f("",!0):(c(),z("div",Be,[r(L,{ref_key:"expiredAppsRef",ref:H,apps:y.value,loading:o.value.expired,"logged-in":I.value,"current-block-height":h.value,"active-apps-tab":!1,manage:"","api-error":b.value,privilege:v(g)},null,8,["apps","loading","logged-in","current-block-height","api-error","privilege"])]))]),_:1})]),_:1},8,["modelValue"])])),B.value?(c(),E(oe,{key:1,"app-name":B.value,global:"","installed-apps":[],onBack:e.clearManagedApplication},null,8,["app-name","onBack"])):f("",!0),r(he,{modelValue:x.value.show,"onUpdate:modelValue":t[2]||(t[2]=a=>x.value.show=a),color:x.value.color,timeout:"4000"},{default:n(()=>[$(A(x.value.message),1)]),_:1},8,["modelValue","color"])]))}},wa=le(Ie,[["__scopeId","data-v-c4419b96"]]);export{wa as default};
