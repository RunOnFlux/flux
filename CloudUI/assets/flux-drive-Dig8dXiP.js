const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/monaco-T-LZewlR.js","assets/apexcharts-nIAyciCq.js"])))=>i.map(i=>d[i]);
import{a as Pa,g as Sa,b as Ca,c as Fa}from"./useSEO-5BaNf11O.js";import{e as Da}from"./vue-core-CU9AIURn.js";import{c as Do,_ as Rt}from"./index-QPPWK7xw.js";import{u as Zo}from"./useSnackbar-CwwIX0V_.js";import{u as za}from"./useLoginSheet-e2RZXtPE.js";import{u as Dt}from"./i18n-Bm8bpAAW.js";import{r as S,c as ze,f as R,g,P as N,x as Z,j as s,y as o,U as l,F as Ge,l as Ft,q as rt,a3 as e,Q as a,T as b,L as ao,w as Bt,o as po,a6 as $a,aw as co,H as eo,m as Tt,p as Gt,ay as Ta,R as Ma,ax as Ia,a2 as Ua,a as Ra}from"./apexcharts-nIAyciCq.js";import{u as Ko}from"./useAnalytics-CteLaQrD.js";import{L as Qo}from"./LoadingSpinner-BLJvP0iy.js";import{J as _t,b as k,c as B,V as be,a as it,g as Qe,d as Fe,G as kt,R as Ut,s as He,y as jt,z as It,A as De,h as ot,Q as Ea,K as uo,I as to,F as oo,D as Ae,a1 as La,o as zo,a0 as jo,r as Fo,f as Mt,U as Bo,a5 as Aa,ak as Va,al as Oa,q as ea,n as Na,p as Ht,u as ja,Y as Ba,Z as Go,X as Ga,_ as Ho,L as Ha,M as qa,N as Ja,O as Xa}from"./vuetify-_4u1He_j.js";import{_ as Wa}from"./crypto-metamask-D6vz180a.js";import{C as $o}from"./clipboard-DDQOmope.js";import{q as qo}from"./query-parser-C3-dT-Rr.js";import{c as Jo,p as Xo}from"./walletService-ARo4SzYC.js";import{s as Ya,a as Za,f as Ka}from"./ssp-logo-white-BYX0TNEU.js";import{F as Qa,T as en}from"./FeatureShowcase-6HuVXhQu.js";/* empty css                                                                     */import{H as tn}from"./HeroSection-C2d3qMIS.js";import"./BreadcrumbNav.vue_vue_type_style_index_0_scoped_fe4b2e69_lang-l0sNRNKZ.js";import"./unhead-DEOrWl0D.js";import"./vueuse-Bid7ZbHY.js";import"./cookie-BfmCf_44.js";import"./unjs-utils-GcjLqAqW.js";import"./http-BZQDkn3h.js";import"./ansi-utils-ChIB8aIv.js";import"./casl-DNC8KRD8.js";import"./scrollbar-CXs_Utq1.js";import"./icons-mdi-_QP0sdRJ.js";import"./sanitizer-DAUAC_Zc.js";import"./element-plus-Cr1Qs4Q_.js";import"./lodash-C_Sw0jJq.js";import"./socketio-BDGyx5_k.js";import"./uuid-B49X2dQj.js";const So=S(0),Wo=1e3,Ct=G=>{if(!G||typeof G!="object")return G;const T={...G};return T.zelid&&(T.zelid=T.zelid.substring(0,8)+"..."),T.signature&&(T.signature="***hidden***"),T.loginPhrase&&(T.loginPhrase="***hidden***"),T},C={files:S([]),loading:S(!1),loadingStorage:S(!1),loadingFiles:S(!1),hasActiveSubscription:S(!1),subscriptionChecked:S(!1),subscriptionPeriodEnd:S(null),paymentGateway:S(""),storageInfoFetched:S(!1),filesLoaded:S(!1),usedStorage:S(0),totalStorage:S(10737418240),currentFolder:S("/"),currentFolderUuid:S(""),folderHierarchy:S([]),breadcrumbs:S([{title:"Home",path:"/"}]),errorState:S({hasError:!1,message:"",type:"error",timestamp:null,persistent:!1}),activeXHRs:S([])};function qt(){const{t:G}=Dt(),{showSnackbar:T}=Zo(),Ve=Do(),u=Da(),se="https://jetpack2_38080.app.runonflux.io",c="https://jetpackbridge.runonflux.io",fe=S(!1),z=C.currentFolder,$e=C.breadcrumbs,ye=()=>{const r=localStorage.getItem("zelidauth");if(r)try{return(r.includes("zelid=")?Object.fromEntries(new URLSearchParams(r)):JSON.parse(r)).zelid||Ve.zelid}catch{return Ve.zelid}return Ve.zelid},Ce=ze(()=>{const r=localStorage.getItem("zelidauth"),p=ye();return!!(r&&p)}),ne=C.hasActiveSubscription,v=C.subscriptionPeriodEnd,Ie=ze(()=>{if(!ne.value)return null;const r=Math.round(M.value/1024**3);return r<=10?"starter":r<=50?"standard":r<=100?"pro":"enterprise"}),me=r=>{const p=ft.value.find(d=>d.id===r);return p?parseInt(p.storage.replace(/[^\d]/g,"")):0},he=r=>{if(r==="enterprise")return"upgrade";if(!ne.value&&v.value===null&&ce.value===0)return"signup";const d=Math.round(M.value/1024**3),y=me(r),w=d<=10?"starter":d<=50?"standard":d<=100?"pro":"enterprise",x=Ie.value||w;return r===x?ne.value?"current":"renew":y>d?"upgrade":ce.value/1073741824>y?"downgrade-blocked":"downgrade"},$=async()=>{if(C.loadingStorage.value||C.storageInfoFetched.value){console.log("â­ï¸ Storage info already loading or fetched, skipping duplicate call");return}try{C.loadingStorage.value=!0;const r=localStorage.getItem("zelidauth"),p=r?r.includes("zelid=")?Object.fromEntries(new URLSearchParams(r)):JSON.parse(r):{},y=await(await fetch(`${c}/api/v1/ipfs/storage`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({zelid:p.zelid||ye(),signature:p.signature||"",loginPhrase:p.loginPhrase})})).json();!y.error&&!y.warning&&(y.capacity!==void 0?M.value=y.capacity:y.capacityGB!==void 0?M.value=y.capacityGB*1024**3:y.storage!==void 0&&(M.value=y.storage*1024**3),y.storageUsed!==void 0?ce.value=y.storageUsed:y.storage_used!==void 0&&(ce.value=y.storage_used),C.storageInfoFetched.value=!0,console.log("ğŸ“Š Storage info fetched:",{used:ce.value,usedMB:(ce.value/(1024*1024)).toFixed(2)+" MB",usedGB:(ce.value/1024**3).toFixed(2)+" GB",totalGB:(M.value/1024**3).toFixed(2)+" GB",percentage:Math.round(ce.value/M.value*100)+"%"}))}catch(r){console.error("Failed to fetch storage info:",r)}finally{C.loadingStorage.value=!1}},le=async()=>{if(!Ce.value)return ne.value=!1,F.value=!0,!1;const r=Date.now();try{C.loadingStorage.value=!0;const p=localStorage.getItem("zelidauth"),d=ye();if(!d)return console.error("No zelid found"),ne.value=!1,!1;const y=p?p.includes("zelid=")?Object.fromEntries(new URLSearchParams(p)):JSON.parse(p):{},x=await(await fetch(`${c}/api/v1/ipfs/storage`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({zelid:y.zelid||d,signature:y.signature||"",loginPhrase:y.loginPhrase})})).json();if(console.log("ğŸ” IPFS storage response:",x),x.active===!0){console.log("âœ… Active subscription detected (from /storage: active: true)");let P=null;try{if(P=await(await fetch(`${c}/api/v1/ipfs/read`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({zelid:y.zelid||d,signature:y.signature||"",loginPhrase:y.loginPhrase,page:"1",size:"0"})})).json(),console.log("ğŸ” IPFS read response for subscription verification:",P),P.error&&(P.error.indexOf("Subscription Expired")>-1||P.error.indexOf("Subscription Canceled")>-1)){console.log("âš ï¸ Subscription canceled/expired detected in /read - overriding /storage result"),ne.value=!1,P.period_end&&(v.value=P.period_end,console.log("ğŸ“… Subscription period end captured:",P.period_end)),x.capacity!==void 0?(M.value=x.capacity,console.log("ğŸ“Š Storage capacity updated from expired subscription:",x.capacity)):x.capacityGB!==void 0&&(M.value=x.capacityGB*1024**3,console.log("ğŸ“Š Storage capacity updated from expired subscription:",x.capacityGB,"GB"));try{const Xe=await(await fetch("https://jetpackbridge.runonflux.io/api/v1/subscriptions.php",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({action:"READ",action_type:"current",zelid:y.zelid||d,signature:y.signature||"",loginPhrase:y.loginPhrase})})).json();Xe&&Xe.gateway&&(C.paymentGateway.value=Xe.gateway,console.log("ğŸ’³ Payment gateway captured from subscription API:",Xe.gateway),localStorage.setItem("fluxdrive_gateway",Xe.gateway))}catch(re){console.warn("âš ï¸ Could not fetch subscription gateway:",re)}F.value=!0;const V=Date.now()-r,ee=1500;return V<ee&&await new Promise(re=>setTimeout(re,ee-V)),!1}}catch(m){console.warn("âš ï¸ Could not verify subscription with /read endpoint:",m)}if(ne.value=!0,x.gateway)C.paymentGateway.value=x.gateway,console.log("ğŸ’³ Payment gateway captured from API:",x.gateway);else if(P&&P.gateway)C.paymentGateway.value=P.gateway,console.log("ğŸ’³ Payment gateway captured from read API:",P.gateway);else{const m=localStorage.getItem("fluxdrive_gateway");m&&(C.paymentGateway.value=m,console.log("ğŸ’³ Payment gateway retrieved from localStorage:",m))}x.period_end?(v.value=x.period_end,console.log("ğŸ“… Subscription period end:",x.period_end)):x.periodEnd&&(v.value=x.periodEnd,console.log("ğŸ“… Subscription period end:",x.periodEnd)),x.capacity!==void 0?M.value=x.capacity:x.capacityGB!==void 0&&(M.value=x.capacityGB*1024**3),x.storageUsed!==void 0?ce.value=x.storageUsed:x.storage_used!==void 0&&(ce.value=x.storage_used),C.storageInfoFetched.value=!0,console.log("ğŸ“Š Storage updated from /storage endpoint:",{used:ce.value,total:M.value,percentage:Math.round(ce.value/M.value*100)+"%"});const q=Date.now()-r,D=1500;return q<D&&await new Promise(m=>setTimeout(m,D-q)),F.value=!0,!0}else if(x.error||x.warning){const P=x.error||x.warning;console.log("âŒ No active subscription:",P),ne.value=!1;const q=Date.now()-r,D=1500;return q<D&&await new Promise(m=>setTimeout(m,D-q)),F.value=!0,!1}else{console.log("âŒ No active subscription found"),ne.value=!1;const P=Date.now()-r,q=1500;return P<q&&await new Promise(D=>setTimeout(D,q-P)),F.value=!0,!1}}catch(p){console.error("Subscription check error:",p),ne.value=!1;const d=Date.now()-r,y=1500;return d<y&&await new Promise(w=>setTimeout(w,y-d)),F.value=!0,!1}finally{C.loadingStorage.value=!1}},K=C.loading,Q=C.files,ce=C.usedStorage,M=C.totalStorage,F=C.subscriptionChecked,O=C.loadingStorage,te=S(!1),oe=S(!1),we=S(""),ue=S(null),X=S(""),de=S(1),Ye=S(5),Pe=S(0),Ke=S(!1),Oe=S(!1),E=S(0),W=S(!1),Ue=S(null),pe=S(""),xe=S("Drag and drop files here or click to upload"),{openLoginBottomSheet:pt,closeLoginBottomSheet:zt}=za(),ft=ze(()=>[{id:"starter",name:G("components.fluxDrive.pricingPlans.plans.starter"),storage:"10 GB",price:"$0.50",pricePerMonth:"$0.50 / Month",originalPrice:null,popular:!1,badge:null,features:[G("components.fluxDrive.pricingPlans.features.web3Infrastructure"),G("components.fluxDrive.pricingPlans.features.decentralizedStorage"),G("components.fluxDrive.pricingPlans.features.globalDistribution"),G("components.fluxDrive.pricingPlans.features.unlimitedBandwidth")]},{id:"standard",name:G("components.fluxDrive.pricingPlans.plans.standard"),storage:"50 GB",price:"$2.50",pricePerMonth:"$2.50 / Month",originalPrice:null,popular:!0,badge:G("components.fluxDrive.pricingPlans.badges.mostPopular"),features:[G("components.fluxDrive.pricingPlans.features.web3Infrastructure"),G("components.fluxDrive.pricingPlans.features.decentralizedStorage"),G("components.fluxDrive.pricingPlans.features.globalDistribution"),G("components.fluxDrive.pricingPlans.features.unlimitedBandwidth")]},{id:"pro",name:G("components.fluxDrive.pricingPlans.plans.elite"),storage:"100 GB",price:"$5.00",pricePerMonth:"$5.00 / Month",originalPrice:null,popular:!1,badge:G("components.fluxDrive.pricingPlans.badges.bestValue"),features:[G("components.fluxDrive.pricingPlans.features.web3Infrastructure"),G("components.fluxDrive.pricingPlans.features.decentralizedStorage"),G("components.fluxDrive.pricingPlans.features.globalDistribution"),G("components.fluxDrive.pricingPlans.features.unlimitedBandwidth")]},{id:"enterprise",name:G("components.fluxDrive.pricingPlans.plans.fluxDrivePro"),storage:G("components.fluxDrive.pricingPlans.customizable"),price:"",pricePerMonth:"",originalPrice:null,popular:!1,badge:G("components.fluxDrive.pricingPlans.badges.enterprise"),features:[G("components.fluxDrive.pricingPlans.features.web3Infrastructure"),G("components.fluxDrive.pricingPlans.features.decentralizedStorage"),G("components.fluxDrive.pricingPlans.features.globalDistribution"),G("components.fluxDrive.pricingPlans.features.unlimitedBandwidth")]}]),Et=S([{title:"",key:"preview",sortable:!1,width:60},{title:"Name",key:"name",sortable:!0},{title:"Updated",key:"timestamp",sortable:!0,width:160},{title:"Size",key:"size",sortable:!0,width:90},{title:"",key:"actions",sortable:!1,width:40}]),Lt=ze(()=>M.value===0?0:Math.round(ce.value/M.value*100)),wt=()=>{const r=Date.now();if(r-So.value<Wo){const p=Math.ceil((Wo-(r-So.value))/1e3);throw new Error(`Please wait ${p} second${p>1?"s":""} before making another request.`)}So.value=r},ct=(r,p="error",d=!1)=>{const y=Date.now();C.errorState.value={hasError:!0,message:r,type:p,timestamp:y,persistent:d},d||setTimeout(()=>{C.errorState.value.timestamp===y&&at()},4e3)},at=()=>{C.errorState.value={hasError:!1,message:"",type:"error",timestamp:null,persistent:!1},pe.value="",console.log("âœ… All errors cleared")},je=ze(()=>C.errorState.value.hasError),gt=ze(()=>C.errorState.value.message),mt=ze(()=>C.errorState.value.type),ut=r=>r.includes("alert-success")?"success":r.includes("alert-danger")?"error":r.includes("alert-warning")?"warning":(r.includes("alert-info"),"info"),We=async r=>{if(r==="enterprise"){window.open("https://support.runonflux.io","_blank","noopener,noreferrer");return}if(!Ce.value){ue.value=r,pt();return}u.push({path:"/fluxdrive-checkout",query:{plan:r,gateway:"fluxpay"}})},xt=async()=>{if(console.log("ğŸ”§ COMPREHENSIVE FILE SEARCH: Searching all folders recursively"),!ne.value)return console.log("âŒ No active subscription"),[];const r=localStorage.getItem("zelidauth"),p=r?r.includes("zelid=")?Object.fromEntries(new URLSearchParams(r)):JSON.parse(r):{};console.log("ğŸ” Auth data:",{hasZelid:!!p.zelid,hasSignature:!!p.signature,hasLoginPhrase:!!p.loginPhrase,bridgeURL:c});let d=[];const y=["/"],w=async(x,P="")=>{try{console.log(`ğŸ” Checking folder: ${x}`);const q={zelid:p.zelid||ye(),signature:p.signature||"",loginPhrase:p.loginPhrase,page:"1",size:"100"};x==="/"?q.currentFolder="/":P?q.currentFolder=P:q.currentFolder=x,console.log(`ğŸ”— API Request to: ${c}/api/v1/ipfs/read`),console.log("ğŸ“‹ Request params:",Ct(q));const m=await(await fetch(`${c}/api/v1/ipfs/read`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams(q)})).json();if(console.log(`ğŸ“ ${x} API Response:`,m),console.log(`ğŸ“ ${x}: ${m?.files?.length||0} items`),m.files&&m.files.length>0)for(const Y of m.files)if(Y.foundInFolder=x,Y.type==="folder"){const V=`${x}${x.endsWith("/")?"":"/"}${Y.name}`;y.push({path:V,uuid:Y.uuid}),console.log(`ğŸ“‚ Found subfolder: ${V}`)}else d.push(Y),console.log(`ğŸ“„ Found file: ${Y.name} (${Y.size} bytes) in ${x}`)}catch(q){console.log(`âŒ Error checking ${x}:`,q)}};await w("/");for(let x=1;x<y.length;x++){const P=y[x];typeof P=="string"?await w(P):await w(P.path,P.uuid)}if(console.log(`ğŸ‰ COMPREHENSIVE SEARCH COMPLETE: Found ${d.length} files total`),d.length>0){console.log("ğŸ“Š File breakdown:"),d.forEach(P=>{console.log(`  ğŸ“„ ${P.name} (${(P.size/1024/1024).toFixed(2)} MB) in ${P.foundInFolder}`)});const x=d.reduce((P,q)=>P+(q.size||0),0)/1024/1024;console.log(`ğŸ“Š Total file size found: ${x.toFixed(2)} MB`)}else{console.log("âŒ No files found despite storage usage. Trying alternative approaches...");try{console.log("ğŸ”„ Trying alternative API call without folder filter...");const P={zelid:p.zelid||ye(),signature:p.signature||"",loginPhrase:p.loginPhrase,page:"1",size:"1000"},D=await(await fetch(`${c}/api/v1/ipfs/read`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams(P)})).json();console.log("ğŸ”„ Alternative API response:",D),D.files&&D.files.length>0&&(console.log(`ğŸ‰ Alternative method found ${D.files.length} files!`),d=D.files)}catch(P){console.log("âŒ Alternative API call failed:",P)}try{console.log("ğŸ”„ Trying folders endpoint from FluxCloud...");const q=await(await fetch(`${c}/api/v1/ipfs/folders`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({zelid:p.zelid||ye(),signature:p.signature||"",loginPhrase:p.loginPhrase})})).json();if(console.log("ğŸ”„ Folders API response:",q),q.folders&&q.folders.length>0){console.log(`ğŸ“ Found ${q.folders.length} folders, checking each for files...`);for(const D of q.folders)try{console.log(`ğŸ” Checking folder: ${D.name} (UUID: ${D.uuid})`);const Y=await(await fetch(`${c}/api/v1/ipfs/read`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({zelid:p.zelid||ye(),signature:p.signature||"",loginPhrase:p.loginPhrase,currentFolder:D.uuid||D.name,page:"1",size:"1000",includeFolders:!0})})).json();console.log(`ğŸ“ Folder ${D.name} contains:`,Y),Y.files&&Y.files.length>0&&(console.log(`ğŸ‰ Found ${Y.files.length} files in folder ${D.name}!`),Y.files.forEach(V=>{console.log(`ğŸ“„ Examining file in ${D.name}:`,V),V.foundInFolder=D.name,V.type!=="folder"?(console.log(`âœ… Adding file to results: ${V.name}`),d.push(V)):console.log(`ğŸ“ Skipping folder: ${V.name}`)}))}catch(m){console.log(`âŒ Error checking folder ${D.name}:`,m)}}}catch(P){console.log("âŒ Folders API call failed:",P)}const x=["",".","a","e","i","o","u","1","2","3","7","z","exe"];for(const P of x)try{console.log(`ğŸ”„ Trying search with term: "${P}"`);const D=await(await fetch(`${c}/api/v1/ipfs/search`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({zelid:p.zelid||ye(),signature:p.signature||"",loginPhrase:p.loginPhrase,q:P})})).json();Array.isArray(D)&&D.length>0&&(console.log(`ğŸ‰ Search "${P}" found ${D.length} files!`),D.forEach(m=>{d.some(V=>V.hash===m.hash)||(m.foundInFolder=`Search: "${P}"`,d.push(m),console.log(`âœ… Added new file from search: ${m.name}`))}))}catch(q){console.log(`âŒ Search "${P}" failed:`,q)}}return d},nt=async(r,p="fluxpay")=>{try{const d=localStorage.getItem("zelidauth"),y=d?d.includes("zelid=")?Object.fromEntries(new URLSearchParams(d)):JSON.parse(d):{},w={action:"READ",zelid:y.zelid||ye(),signature:y.signature||"",loginPhrase:y.loginPhrase,gateway:p,plan_name:r};console.log("ğŸ”„ Renewing subscription:",Ct(w));const P=await(await fetch(`${c}/api/v1/subscriptions.php`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams(w)})).json();if(console.log("ğŸ“‹ Subscription renewal response:",P),console.log("ğŸ“‹ Response keys:",Object.keys(P)),console.log("ğŸ“‹ Response type:",typeof P),P.error)throw console.error("âŒ API returned error:",P.error),new Error(P.error);return P.checkout_url&&console.log("ğŸ›’ Checkout URL found:",P.checkout_url),P.new_plan&&console.log("ğŸ“‹ New plan found:",P.new_plan),P.subscription&&console.log("ğŸ“‹ Subscription found:",P.subscription),P}catch(d){throw console.error("âŒ Subscription renewal failed:",d),d}},Pt=async(r,p="fluxpay")=>{try{const d=localStorage.getItem("zelidauth"),y=d?d.includes("zelid=")?Object.fromEntries(new URLSearchParams(d)):JSON.parse(d):{},w={action:"READ",zelid:y.zelid||ye(),signature:y.signature||"",loginPhrase:y.loginPhrase,gateway:p,plan_name:r};console.log("ğŸ”„ Upgrading subscription:",Ct(w));const P=await(await fetch(`${c}/api/v1/subscriptions.php`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams(w)})).json();if(console.log("ğŸ“‹ Subscription upgrade response:",P),console.log("ğŸ“‹ Response keys:",Object.keys(P)),console.log("ğŸ“‹ Response type:",typeof P),P.error)throw console.error("âŒ API returned error:",P.error),new Error(P.error);return P.checkout_url&&console.log("ğŸ›’ Checkout URL found:",P.checkout_url),P.new_plan&&console.log("ğŸ“‹ New plan found:",P.new_plan),P.subscription&&console.log("ğŸ“‹ Subscription found:",P.subscription),P}catch(d){throw console.error("âŒ Subscription upgrade failed:",d),d}},ie=async()=>{try{const r=localStorage.getItem("zelidauth"),p=r?r.includes("zelid=")?Object.fromEntries(new URLSearchParams(r)):JSON.parse(r):{},d={action:"CANCEL",zelid:p.zelid||ye(),signature:p.signature||"",loginPhrase:p.loginPhrase};console.log("ğŸš« Canceling subscription:",Ct(d));const w=await(await fetch(`${c}/api/v1/subscriptions.php`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams(d)})).json();if(console.log("ğŸ“‹ Subscription cancel response:",w),w.error)throw console.error("âŒ API returned error:",w.error),new Error(w.error);return C.paymentGateway.value="",localStorage.removeItem("fluxdrive_gateway"),w}catch(r){throw console.error("âŒ Subscription cancellation failed:",r),r}},Ne=async(r=!1,p=!1)=>{if(ne.value){if(p||(fe.value=!1),C.loadingFiles.value){console.log("â­ï¸ Files already being loaded, skipping duplicate call");return}if(C.loadingFiles.value=!0,K.value=!0,r&&(at(),pe.value=""),console.log("ğŸ“‚ Loading files for folder:",z.value),p){console.log("ğŸ”§ RECOVERY MODE: Loading ALL files to find orphaned items");const d=await xt();if(d.length>0){console.log("ğŸ‰ Found",d.length,"files via comprehensive search!"),console.log("ğŸ“„ Files to process:",d);const y=d.map(w=>(console.log("ğŸ”§ Processing file:",w),{id:w.hash||w.uuid||Date.now(),name:w.name||"Orphaned File",name_abbr:w.name_abbr||w.name,size:w.size||0,hash:w.hash||"",hash_abbr:w.hash_abbr||(w.hash?w.hash.substring(0,8)+"...":""),added_date:w.timestamp?new Date(w.timestamp).toLocaleString():new Date().toLocaleString(),timestamp:w.timestamp||0,mimetype:w.mimetype||"",type:w.type||"file",icon:At(w.type||"file"),thumbnail:w.thumbnail,width:w.width||0,deleting:!1,isFolder:w.type==="folder",owner:w.owner,parent:"ORPHANED"}));fe.value=!0,console.log("ğŸ”§ Setting files.value to:",y),Q.value=y,C.loadingFiles.value=!1,K.value=!1,console.log("âœ… Recovery mode completed with",y.length,"files"),console.log("ğŸ”§ Final files.value:",Q.value);return}}C.folderHierarchy.value.length===0&&(C.folderHierarchy.value=[{path:"/",uuid:""}]),Je(z.value);try{await $(),wt();const d=localStorage.getItem("zelidauth"),y=d?d.includes("zelid=")?Object.fromEntries(new URLSearchParams(d)):JSON.parse(d):{};let w;z.value==="/"?w="/":C.currentFolderUuid.value?w=C.currentFolderUuid.value:w=z.value.replace(/^\//,""),console.log("ğŸ“‚ API Request details:",{currentFolder:z.value,folderParam:w,page:de.value,size:Ye.value,url:`${c}/api/v1/ipfs/read`});const x={zelid:y.zelid||ye(),signature:y.signature||"",loginPhrase:y.loginPhrase,page:"1",size:"100",includeVersions:!0,includeFolders:!0};p?(console.log("ğŸ”§ RECOVERY MODE: Attempting to show ALL files using different approaches"),x.showAllFiles="true",x.includeOrphaned="true",x.currentFolder=""):(x.currentFolder=w,x.includeFolders=!0);const P=new URLSearchParams(x);console.log("ğŸ“‚ Request body:",Ct(Object.fromEntries(P)));let q=`${c}/api/v1/ipfs/read`;const m=await(await fetch(q,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:P})).json();console.log("ğŸ”§ API Response from",q,":",m),console.log("ğŸ” Checking subscription status - result.error:",m.error);const Y=m.error&&(m.error.indexOf("Subscription Expired")>-1||m.error.indexOf("Subscription Canceled")>-1);if(console.log("ğŸ” isSubscriptionInactive:",Y),Y)console.log("âš ï¸ Subscription expired/canceled detected in API response - updating subscription status"),ne.value=!1,F.value=!0,m.period_end?(v.value=m.period_end,console.log("ğŸ“… Subscription period end captured:",m.period_end)):m.periodEnd&&(v.value=m.periodEnd,console.log("ğŸ“… Subscription period end captured:",m.periodEnd)),console.log("ğŸ“Š Updated values - hasActiveSubscription:",ne.value,"subscriptionChecked:",F.value,"periodEnd:",v.value);else if(m.error)if(m.error.indexOf("No active subscription.")>-1){pe.value=`<div class="alert alert-danger">${m.error}</div>`,ne.value=!1;return}else if(m.error.indexOf("Session expired")>-1){pe.value=`<div class="alert alert-danger">${m.error}</div>`;return}else{pe.value=`<div class="alert alert-danger">${m.error}</div>`;return}if(console.log("ğŸ” Complete API response:",m),console.log("ğŸ“‚ Response for folder:",z.value,"got",m.files?.length||0,"files"),m.files&&Array.isArray(m.files)){console.log("ğŸ“‚ Raw API response files:",m.files),console.log("ğŸ“Š Files array length:",m.files.length),console.log("ğŸ“‚ Current folder for filtering:",z.value);let V=m.files;z.value!=="/"&&m.files.length>0&&(console.log("ğŸ” Checking if API supports folder filtering..."),C.currentFolderUuid.value?console.log("âœ… Using UUID-based loading - API filtering should work correctly"):m.files.some(tt=>tt.folder===w||tt.path?.includes(z.value))||(console.log("âš ï¸ Path-based API does not support folder filtering, simulating empty folder"),V=[]));const ee={};V.forEach(j=>{if(j.type!=="folder"){const tt=j.name||j.fileName||"Unnamed File";ee[tt]||(ee[tt]=[]),ee[tt].push(j)}});const re=[];Object.entries(ee).forEach(([j,tt])=>{if(tt.length===1)re.push(tt[0]);else{const Yt=tt.sort((ht,Kt)=>(Kt.timestamp||0)-(ht.timestamp||0)),Zt=Yt[0];Zt.versions=Yt.slice(1).map((ht,Kt)=>({comment:`Version ${Yt.length-Kt-1}`,timestamp:ht.timestamp||0,hash:ht.hash||"",size:ht.size||0,filename:j,type:ht.type||"file",icon:ht.icon,thumbnail:ht.thumbnail,mimetype:ht.mimetype||""})),re.push(Zt)}});const Xe=V.filter(j=>j.type==="folder");let Te=[...re,...Xe].map(j=>(console.log("Processing item:",j,"item.folder:",j.folder,"item.path:",j.path),j.type==="folder"?{id:j.uuid||Date.now(),name:j.name||"Unnamed Folder",name_abbr:j.name_abbr||j.name,size:0,hash:"",hash_abbr:"Folder",added_date:j.timestamp?new Date(j.timestamp).toLocaleString():new Date().toLocaleString(),timestamp:j.timestamp||0,mimetype:"folder",type:"folder",icon:j.icon||"mdi-folder",thumbnail:null,width:0,deleting:!1,isFolder:!0,uuid:j.uuid,owner:j.owner,parent:z.value}:{id:j.hash||j.uuid||Date.now(),name:j.name||j.fileName||"Unnamed File",name_abbr:j.name_abbr||j.name,size:j.size||0,hash:j.hash||"",hash_abbr:j.hash_abbr||(j.hash?j.hash.substring(0,8)+"...":""),added_date:j.timestamp?new Date(j.timestamp).toLocaleString():new Date().toLocaleString(),timestamp:j.timestamp||0,added_date_raw:j.added_date,mimetype:j.mimetype||"",type:j.type||"file",icon:j.icon||At(j.type||"file"),thumbnail:j.thumbnail,width:j.width||0,deleting:!1,isFolder:!1,owner:j.owner,parent:j.parent||z.value,versions:j.versions||[]}));if(z.value!=="/"){const j={id:"go-back",name:"..",name_abbr:"..",size:0,hash:"",hash_abbr:"",added_date:"-",timestamp:0,mimetype:"go-back",type:"go-back",icon:"mdi-arrow-left",thumbnail:null,width:0,deleting:!1,isFolder:!0,isGoBack:!0,parent:z.value};Te.unshift(j)}Q.value=Te,console.log("Parsed files:",Q.value),Pe.value=m.total_files||m.totalFiles||Q.value.length,m.storage_used!==void 0?(ce.value=m.storage_used,console.log("ğŸ“Š Storage used updated from file list:",m.storage_used)):m.storageUsed!==void 0&&(ce.value=m.storageUsed,console.log("ğŸ“Š Storage used updated from file list:",m.storageUsed)),m.storage!==void 0&&(M.value=m.storage*1024**3,console.log("ğŸ“Š Total storage updated from file list:",m.storage,"GB")),pe.value="",console.log(`ğŸ“ Loaded ${Q.value.length} files`)}else console.log("âš ï¸ No files array in response or not an array:",{hasFiles:"files"in m,filesType:typeof m.files,isArray:Array.isArray(m.files),fullResponse:m}),Q.value=[],m.error?pe.value=`<div class="alert alert-danger">${m.error}</div>`:m.warning?pe.value=`<div class="alert alert-warning">${m.warning}</div>`:pe.value=""}catch(d){console.error("Load files error:",d),d.message.includes("wait")&&d.message.includes("second")?(console.log("ğŸš« Setting rate limit error:",d.message),ct(d.message,"warning",!1),pe.value=`<div class="alert alert-warning">${d.message}</div>`):(console.log("âŒ Setting general error:",d.message),ct("Failed to load files. Please try again.","error",!1),pe.value='<div class="alert alert-danger">Failed to load files</div>')}finally{K.value=!1,C.loadingFiles.value=!1,Q.value.length>0&&(C.filesLoaded.value=!0),console.log("âœ… loadFiles completed - Final state:",{loading:K.value,hasActiveSubscription:ne.value,subscriptionChecked:F.value,filesCount:Q.value.length})}}},f=async()=>{if(!X.value?.trim()){pe.value='<div class="alert alert-warning">Please enter a search term</div>';return}te.value=!0,K.value=!0,Q.value=[];try{wt();const r=localStorage.getItem("zelidauth"),p=r?r.includes("zelid=")?Object.fromEntries(new URLSearchParams(r)):JSON.parse(r):{},y=await(await fetch(`${c}/api/v1/ipfs/search`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({zelid:p.zelid||ye(),signature:p.signature||"",loginPhrase:p.loginPhrase,q:X.value})})).json();y.info?(Q.value=[],pe.value=`<div class="alert alert-info">${y.info}</div>`):y.error?pe.value=`<div class="alert alert-danger">${y.error}</div>`:Array.isArray(y)?(Q.value=y.map(w=>w.type==="folder"?null:{id:w.hash,name:w.name||w.fileName||w.filename,size:w.size||0,hash:w.hash,hash_abbr:w.hash?w.hash.substring(0,8)+"...":"",added_date:w.timestamp?new Date(w.timestamp*1e3).toLocaleString():new Date().toLocaleString(),mimetype:w.mimetype||"",type:w.type||"file",thumbnail:w.thumbnail,width:0,deleting:!1,versions:w.versions||[]}).filter(w=>w!==null),pe.value=`<div class="alert alert-success">Found ${Q.value.length} files</div>`):(Q.value=[],pe.value='<div class="alert alert-warning">No files found</div>')}catch(r){r.message.includes("Rate limit")?pe.value=`<div class="alert alert-warning">${r.message}</div>`:pe.value='<div class="alert alert-danger">Search failed</div>',console.error("Search error:",r)}finally{te.value=!1,K.value=!1}},_=async r=>{Ke.value=!1;const p=Array.from(r.dataTransfer.files);console.log(`ğŸ“¤ Dropped ${p.length} file(s) for upload`);for(const d of p){if(d.size>1e8){T(`File "${d.name}" too large! Upload limit is 100MB`,"error");continue}await ge(d)}},U=async r=>{const p=Array.from(r.target.files);console.log(`ğŸ“¤ Selected ${p.length} file(s) for upload`);for(const d of p){if(d.size>1e8){T(`File "${d.name}" too large! Upload limit is 100MB`,"error");continue}await ge(d)}r.target.value=""},L=async r=>{r.preventDefault(),r.stopPropagation(),console.log("ğŸš€ handleFolderSelect STARTED - no alerts should appear yet");const p=window.alert;window.alert=x=>{console.error("ğŸš¨ ALERT BLOCKED:",x),console.trace("Alert called from:")};const d=Array.from(r.target.files);if(console.log(`ğŸ“ Selected folder with ${d.length} file(s) for upload`),console.log("ğŸš€ Files array created - checking for alert..."),d.length===0){T("No files found in the selected folder","warning");return}const y={};for(const x of d){const q=x.webkitRelativePath.split("/")[0];y[q]||(y[q]=[]),y[q].push(x)}const w=z.value;try{Oe.value=!0,E.value=0;for(const[x,P]of Object.entries(y)){console.log(`ğŸ“‚ Processing folder: ${x} with ${P.length} files`);try{if(d.value?.some(V=>V.isFolder&&V.name===x)||!1){T(`A folder named '${x}' already exists`,"error");continue}console.log(`ğŸ“ Creating main folder: ${x}`);const D=await ve(z.value==="/"?"/":z.value,x);console.log("ğŸ“ Created main folder:",D);const m=new Map,Y=new Map;for(let V=0;V<P.length;V++){const ee=P[V],re=ee.webkitRelativePath.split("/");re.shift();const Xe=re.pop();if(re.length>0){let Me=D.uuid||D.id,Te="";for(const j of re)if(Te&&(Te+="/"),Te+=j,m.has(Te))Me=m.get(Te).uuid||m.get(Te).id;else{console.log(`ğŸ“ Creating subfolder: ${j}`),pe.value=`<div class="alert alert-info">Creating folder '${j}'...</div>`;const tt=await ve(Me,j);m.set(Te,tt),Me=tt.uuid||tt.id}Y.set(ee,m.get(Te))}else Y.set(ee,D)}for(let V=0;V<P.length;V++){const ee=P[V];if(ee.size>1e8){T(`File "${ee.name}" too large! Upload limit is 100MB`,"error");continue}const re=Y.get(ee)||D;console.log(`ğŸ“¤ Uploading file ${V+1}/${P.length} to folder UUID: ${re.uuid||re.id}`),pe.value=`<div class="alert alert-info">Uploading "${ee.name}" (${V+1}/${P.length})...</div>`,E.value=0;const Xe=ee.webkitRelativePath.split("/"),Me=Xe[Xe.length-1];console.log(`ğŸ“‹ File ${V+1} details:`),console.log(`   - Original path: ${ee.webkitRelativePath}`),console.log(`   - Clean filename: ${Me}`),console.log(`   - File size: ${ee.size} bytes`),console.log(`   - File type: ${ee.type}`),console.log(`   - Target folder UUID: ${re.uuid||re.id}`);try{const Te=await ae(re.uuid||re.id,Me,ee);console.log(`âœ… Upload complete for: ${Me}`),console.log(`ğŸ“„ Full server response for "${Me}":`,JSON.stringify(Te,null,2)),Te.hash&&console.log(`ğŸ”— File hash: ${Te.hash}`),(Te.id||Te.uuid)&&console.log(`ğŸ†” File ID/UUID: ${Te.id||Te.uuid}`),Te.message&&console.log(`ğŸ“ Server message: ${Te.message}`)}catch(Te){console.error(`âŒ Upload failed for: ${Me}`,Te)}}pe.value=`<div class="alert alert-success">Folder "${x}" uploaded successfully with ${P.length} files</div>`}catch(q){console.error(`âŒ Error uploading folder ${x}:`,q),T(`Failed to upload folder "${x}": ${q.message}`,"error")}}z.value!==w&&(console.log(`ğŸ”„ Returning to original folder: ${w}`),await vt({path:w})),console.log("ğŸ”„ Refreshing files after folder upload"),await Ne()}catch(x){console.error("âŒ Folder upload failed:",x),T("Folder upload failed: "+x.message,"error")}finally{Oe.value=!1,E.value=0,r.target.value="",window.alert=p}},ve=async(r,p)=>{try{const d=localStorage.getItem("zelidauth"),y=d?d.includes("zelid=")?Object.fromEntries(new URLSearchParams(d)):JSON.parse(d):{},x=await(await fetch(`${c}/api/v1/ipfs/createfolder`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({zelid:y.zelid,signature:y.signature,loginPhrase:y.loginPhrase,currentFolder:r.isEmpty||r===""?"/":r,name:p})})).json();if(console.log("FluxCloud createFolder response:",x),x.warning||x.error)throw new Error(x.error||x.warning);return x}catch(d){throw console.error("âŒ FluxCloud createFolder error:",d),d}},ae=async(r,p,d)=>{try{const y=localStorage.getItem("zelidauth"),w=y?y.includes("zelid=")?Object.fromEntries(new URLSearchParams(y)):JSON.parse(y):{},x=new File([d],p,{type:d.type}),P=new FormData;return P.append("file",x),P.append("zelid",w.zelid),P.append("signature",w.signature),P.append("loginPhrase",w.loginPhrase),P.append("currentFolder",r),await new Promise((D,m)=>{const Y=new XMLHttpRequest;C.activeXHRs.value.push(Y);const V=()=>{const ee=C.activeXHRs.value.indexOf(Y);ee>-1&&C.activeXHRs.value.splice(ee,1)};Y.upload.onprogress=ee=>{ee.lengthComputable&&(E.value=Math.round(ee.loaded/ee.total*100))},Y.onload=()=>{if(V(),Y.status>=200&&Y.status<300)try{const ee=JSON.parse(Y.responseText);D(ee)}catch{D(Y.responseText)}else m(new Error(`Upload failed with status ${Y.status}`))},Y.onerror=()=>{V(),m(new Error("Upload failed"))},Y.open("POST",`${c}/api/v1/ipfs/write`),Y.send(P)})}catch(y){throw console.error("âŒ FluxCloud uploadFile error:",y),y}},A=async r=>{try{const p=localStorage.getItem("zelidauth"),d=p?p.includes("zelid=")?Object.fromEntries(new URLSearchParams(p)):JSON.parse(p):{};if(!d.zelid||!d.loginPhrase||!d.signature)throw new Error("Authentication required. Please log in again.");const y=new FormData;y.append("file",r),y.append("zelid",d.zelid),y.append("signature",d.signature),y.append("loginPhrase",d.loginPhrase);const w=z.value==="/"?"":z.value.replace(/^\//,"");return z.value==="/"?y.append("currentFolder","/"):C.currentFolderUuid.value?y.append("currentFolder",C.currentFolderUuid.value):w&&y.append("currentFolder",w),await new Promise((P,q)=>{const D=new XMLHttpRequest;D.upload.onprogress=m=>{m.lengthComputable&&(E.value=Math.round(m.loaded/m.total*100))},D.onload=()=>{if(D.status>=200&&D.status<300)try{const m=JSON.parse(D.responseText);P(m)}catch{P(D.responseText)}else q(new Error(`Upload failed with status ${D.status}`))},D.onerror=()=>q(new Error("Upload failed")),D.open("POST",`${c}/api/v1/ipfs/write`),D.send(y)})}catch(p){throw console.error("âŒ Upload error:",p),p}},Se=async(r,p,d,y="")=>{try{const w=localStorage.getItem("zelidauth"),x=w?w.includes("zelid=")?Object.fromEntries(new URLSearchParams(w)):JSON.parse(w):{};if(!x.zelid||!x.loginPhrase||!x.signature)throw new Error("Authentication required. Please log in again.");console.log("ğŸ“¤ Uploading version using FluxCloud API (existingFile parameter):"),console.log("   - Existing file hash:",r),console.log("   - New file name:",p),console.log("   - Actual file:",d.name),console.log("   - Comment:",y);const P=new File([d],p,{type:d.type}),q=new FormData;q.append("file",P),q.append("zelid",x.zelid),q.append("signature",x.signature),q.append("loginPhrase",x.loginPhrase),q.append("currentFolder",C.currentFolderUuid.value||z.value),q.append("existingFile",r),q.append("comment",y),console.log("ğŸ” FormData contents:");for(let[m,Y]of q.entries())m==="zelid"||m==="signature"||m==="loginPhrase"?console.log(`   ${m}:`,"***hidden***"):console.log(`   ${m}:`,typeof Y=="string"?Y:Y.constructor.name);return await new Promise((m,Y)=>{const V=new XMLHttpRequest;V.upload.onprogress=ee=>{ee.lengthComputable&&(E.value=Math.round(ee.loaded/ee.total*100))},V.onload=()=>{if(V.status>=200&&V.status<300)try{const ee=JSON.parse(V.responseText);console.log("ğŸ“¤ Version uploaded successfully, will be grouped by filename:",ee),m(ee)}catch{m(V.responseText)}else Y(new Error(`Version upload failed with status ${V.status}`))},V.onerror=()=>Y(new Error("Version upload failed")),V.open("POST",`${c}/api/v1/ipfs/write`),V.send(q)})}catch(w){throw console.error("âŒ Version upload error:",w),w}},ge=async(r,p=null,d=!1)=>{Oe.value=!0,E.value=0;try{const y=localStorage.getItem("zelidauth"),w=y?y.includes("zelid=")?Object.fromEntries(new URLSearchParams(y)):JSON.parse(y):{};if(!w.zelid||!w.loginPhrase||!w.signature)throw new Error("Authentication required. Please log in again.");const x=new FormData;x.append("file",r),x.append("zelid",w.zelid),x.append("signature",w.signature),x.append("loginPhrase",w.loginPhrase);const P=z.value==="/"?"":z.value.replace(/^\//,"");z.value==="/"?(x.append("currentFolder","/"),console.log("ğŸ“¤ Uploading to root folder (FluxCloud format)")):C.currentFolderUuid.value?(x.append("currentFolder",C.currentFolderUuid.value),console.log("ğŸ“¤ Uploading to subfolder using parent UUID as currentFolder:",C.currentFolderUuid.value)):P&&(x.append("currentFolder",P),console.log("ğŸ“¤ Uploading to subfolder using folder path:",P)),console.log("ğŸ“¤ Uploading file:",{fileName:r.name,fileSize:r.size,folder:P||"root",currentFolder:z.value,currentFolderUuid:C.currentFolderUuid.value,zelid:w.zelid?w.zelid.substring(0,8)+"...":"none"});const D=await new Promise((m,Y)=>{const V=new XMLHttpRequest;V.upload.onprogress=ee=>{ee.lengthComputable&&(E.value=Math.round(ee.loaded/ee.total*100))},V.onload=()=>{if(V.status>=200&&V.status<300)try{const ee=JSON.parse(V.responseText);m(ee)}catch{m(V.responseText)}else Y(new Error(`Upload failed with status ${V.status}`))},V.onerror=()=>{Y(new Error("Upload failed due to network error"))},V.open("POST",`${c}/api/v1/ipfs/write`),V.send(x)});if(console.log("ğŸ“¤ Upload API response:",D),D&&!D.error&&!D.warning){const m={id:D.hash||Date.now(),name:D.name||D.fileName||r.name,size:D.size||r.size,hash:D.hash,hash_abbr:D.hash?D.hash.substring(0,8)+"...":"",added_date:D.timestamp?new Date(D.timestamp*1e3).toLocaleString():new Date().toLocaleString(),mimetype:D.mimetype||r.type,type:D.type||"file",thumbnail:D.thumbnail||null,width:0,deleting:!1};de.value===1&&Q.value.unshift(m),pe.value=`<div class="alert alert-success">File "${r.name}" uploaded successfully!</div>`,d||(console.log("ğŸ“¤ Upload successful, reloading files after delay..."),setTimeout(async()=>{await Ne()},5e3)),await $()}else{const m=D.error||D.warning||"Upload failed - invalid response";throw console.error("ğŸ“¤ Upload API error:",m),z.value!=="/"&&(m.includes("Invalid parent folder")||m.includes("folder")||m.includes("login")||m.includes("choose a plan"))?new Error("FluxDrive may not support uploading files to subfolders. Try uploading to the root directory."):new Error(m)}}catch(y){console.error("Upload error:",y);const w=y.message||"Upload failed. Please try again.";pe.value=`<div class="alert alert-danger">Upload failed: ${w}</div>`,T(`Upload failed: ${w}`,"error")}finally{Oe.value=!1,E.value=0}},H=r=>{const p=`${se}/ipfs/${r.hash}`;navigator.clipboard.writeText(p),T("Link copied to clipboard","success")},Re=r=>{Ue.value=r,W.value=!0},qe=()=>{W.value=!1,Ue.value=null},lt=async r=>{if(console.log("Opening folder:",r),r.isFolder){let p,d="";if(r.isGoBack)if(C.folderHierarchy.value.length>1){C.folderHierarchy.value.pop();const y=C.folderHierarchy.value[C.folderHierarchy.value.length-1];p=y.path,d=y.uuid}else p="/",d="",C.folderHierarchy.value=[{path:"/",uuid:""}];else p=z.value==="/"?`/${r.name}`:`${z.value}/${r.name}`,d=r.uuid||"",C.folderHierarchy.value.push({path:p,uuid:d,name:r.name});console.log("ğŸ“ Navigating from",z.value,"to",p),console.log("ğŸ“ Folder hierarchy:",C.folderHierarchy.value),console.log("ğŸ“ New folder UUID:",d),z.value=p,C.currentFolderUuid.value=d,Je(p),Q.value=[],await Ne(!0),Q.value.length===0&&p!=="/"&&console.log("ğŸ“ No files in folder:",p)}},Je=r=>{if(r==="/")C.breadcrumbs.value=[{title:"Home",path:"/",disabled:!1}];else{const p=r.split("/").filter(w=>w),d=[{title:"Home",path:"/",disabled:!1}];let y="";p.forEach((w,x)=>{y+="/"+w,d.push({title:w,path:y,disabled:!1})}),C.breadcrumbs.value=d}},vt=async r=>{if(console.log("ğŸ“ Navigating to breadcrumb:",r),z.value=r.path,Q.value=[],r.path==="/")C.folderHierarchy.value=[{path:"/",uuid:""}],C.currentFolderUuid.value="";else{const p=C.folderHierarchy.value;let d=-1;for(let y=0;y<p.length;y++)if(p[y].path===r.path){d=y;break}if(d!==-1){C.folderHierarchy.value=p.slice(0,d+1);const y=p[d];C.currentFolderUuid.value=y.uuid||"",console.log("ğŸ“ Restored hierarchy to:",C.folderHierarchy.value),console.log("ğŸ“ Restored UUID to:",C.currentFolderUuid.value)}else console.log("âš ï¸ Could not find path in hierarchy, rebuilding without UUID context"),r.path.split("/").filter(y=>y),C.folderHierarchy.value=[{path:"/",uuid:""}],C.currentFolderUuid.value=""}Je(r.path),await Ne(!0)},st=async(r=null)=>{if(!r){const p=prompt("Enter folder name:");if(!p)return;r=p}try{const p=localStorage.getItem("zelidauth"),d=p?p.includes("zelid=")?Object.fromEntries(new URLSearchParams(p)):JSON.parse(p):{},y=C.files.value.find(m=>m.isFolder&&m.name===z.value.split("/").pop());if(console.log("ğŸ” Create folder debug:",{folderName:r,currentFolder:z.value,currentFolderUuid:C.currentFolderUuid.value,parentFolderData:y,breadcrumbs:$e.value,currentFiles:C.files.value.map(m=>({name:m.name,isFolder:m.isFolder,uuid:m.uuid,hash:m.hash,id:m.id,type:m.type})),authData:{zelid:d.zelid?d.zelid.substring(0,8)+"...":"none",signature:"[HIDDEN]",loginPhrase:"[HIDDEN]"}}),!d.zelid||!d.loginPhrase||!d.signature){T("Authentication required. Please log in again.","error");return}const w={withSlash:z.value,withoutSlash:z.value==="/"?"":z.value.replace(/^\//,""),withoutLeadingSlash:z.value==="/"?"/":z.value.replace(/^\//,""),empty:z.value==="/"?"":z.value};console.log("ğŸš€ Creating folder - trying different path formats:",w);let x={zelid:d.zelid,signature:d.signature,loginPhrase:d.loginPhrase,name:r};z.value==="/"?(x.currentFolder="/",console.log("ğŸš€ Using root folder (FluxCloud format): /")):C.currentFolderUuid.value?(x.currentFolder=C.currentFolderUuid.value,console.log("ğŸš€ Using parent UUID as currentFolder (FluxCloud format):",C.currentFolderUuid.value)):(x.currentFolder=w.withoutSlash,console.log("ğŸš€ Using folder path (no UUID available):",w.withoutSlash));const P=await fetch(`${c}/api/v1/ipfs/createfolder`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams(x)});console.log("ğŸ“¡ Create folder API call params:",Ct(x)),console.log("ğŸ“¡ Create folder response status:",P.status);const q=await P.text();console.log("ğŸ“¡ Create folder response text:",q);let D;try{D=JSON.parse(q)}catch(m){console.error("âŒ Failed to parse JSON response:",m),T("Invalid response from server","error");return}if(console.log("ğŸ“¡ Create folder result:",D),!D.error&&!D.warning&&P.ok)return pe.value=`<div class="alert alert-success">Folder "${r}" created successfully</div>`,console.log("âœ… Folder created successfully, refreshing file list..."),console.log("ğŸ“‚ Current folder before refresh:",z.value),console.log("ğŸ“‚ Current UUID before refresh:",C.currentFolderUuid.value),console.log("âœ… Folder created successfully - component will handle refresh"),console.log("ğŸ“‚ Files after refresh:",C.files.value.length),console.log("ğŸ“‚ File names after refresh:",C.files.value.map(m=>m.name)),D.folder||D;if(D.error==="Invalid parent folder"){console.log("ğŸ”„ Trying alternative folder creation methods...");let m={zelid:d.zelid,signature:d.signature,loginPhrase:d.loginPhrase,name:r};z.value==="/"?m.currentFolder="":C.currentFolderUuid.value?(m.currentFolder=w.withSlash,console.log("ğŸ”„ Alternative: using path instead of UUID:",w.withSlash)):(m.currentFolder=z.value,console.log("ğŸ”„ No UUID available, using path:",z.value)),console.log("ğŸ”„ Alternative params:",Ct(m));const Y=await fetch(`${c}/api/v1/ipfs/createfolder`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams(m)}),V=await Y.json();if(console.log("ğŸ“¡ Alternative result:",V),!V.error&&!V.warning&&Y.ok)return pe.value=`<div class="alert alert-success">Folder "${r}" created successfully</div>`,setTimeout(async()=>{await Ne()},4e3),V.folder||V;{const ee=V.error||V.warning||V.message||"Failed to create folder";console.error("âŒ Alternative create folder also failed:",ee),console.log("ğŸ”„ Trying third approach - path only...");const re={zelid:d.zelid,signature:d.signature,loginPhrase:d.loginPhrase,name:r,currentFolder:w.withSlash};console.log("ğŸ”„ Third attempt params:",Ct(re));try{const Xe=await fetch(`${c}/api/v1/ipfs/createfolder`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams(re)}),Me=await Xe.json();console.log("ğŸ“¡ Third attempt result:",Me),!Me.error&&!Me.warning&&Xe.ok?(pe.value=`<div class="alert alert-success">Folder "${r}" created successfully</div>`,setTimeout(async()=>{await Ne()},4e3)):(console.error("âŒ All create folder attempts failed"),T("Unable to create folder inside this folder. Please check if you have the correct permissions or try creating in the root directory.","warning"))}catch(Xe){console.error("âŒ Third attempt error:",Xe),T(ee,"error")}}}else{const m=D.error||D.warning||D.message||"Failed to create folder";console.error("âŒ Create folder failed:",m),T(m,"error")}}catch(p){console.error("âŒ Create folder error:",p),p.name==="TypeError"&&p.message.includes("fetch")?T("Network error - could not connect to server","error"):T("Failed to create folder: "+p.message,"error")}},Jt=async(r,p=!1)=>{const d=r.isFolder?"folder":"file";if(!(!p&&!confirm(`Are you sure you want to delete this ${d}: ${r.name}?`))){r.deleting=!0;try{const y=localStorage.getItem("zelidauth"),w=y?y.includes("zelid=")?Object.fromEntries(new URLSearchParams(y)):JSON.parse(y):{};if(!w.zelid||!w.loginPhrase||!w.signature)throw new Error("Authentication required. Please log in again.");const x=r.isFolder?"/api/v1/ipfs/removefolder":"/api/v1/ipfs/remove",P=r.isFolder?{zelid:w.zelid,signature:w.signature,loginPhrase:w.loginPhrase,uuid:r.uuid}:{zelid:w.zelid,signature:w.signature,loginPhrase:w.loginPhrase,hash:r.hash},D=await(await fetch(`${c}${x}`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams(P)})).json();if(!D.error&&!D.warning){const m=Q.value.findIndex(Y=>Y.id===r.id);m>-1&&(Q.value.splice(m,1),pe.value=`<div class="alert alert-success">File "${r.name}" deleted successfully</div>`,await $(),setTimeout(()=>{pe.value=""},4e3))}else throw new Error(D.error||D.warning||"Failed to delete file")}catch(y){console.error("Delete error:",y);const w=y.message||"Failed to delete file";pe.value=`<div class="alert alert-danger">Delete failed: ${w}</div>`,T(`Delete failed: ${w}`,"error"),r.deleting=!1}}},At=r=>({pdf:"mdi-file-pdf-box",png:"mdi-file-image",jpg:"mdi-file-image",jpeg:"mdi-file-image",gif:"mdi-file-image",bmp:"mdi-file-image",webp:"mdi-file-image",doc:"mdi-file-document",docx:"mdi-file-document",xls:"mdi-file-excel",xlsx:"mdi-file-excel",ppt:"mdi-file-powerpoint",pptx:"mdi-file-powerpoint",zip:"mdi-folder-zip",mp4:"mdi-file-video",webm:"mdi-file-video",ogg:"mdi-file-video",mov:"mdi-file-video",avi:"mdi-file-video",mkv:"mdi-file-video",m4v:"mdi-file-video",flv:"mdi-file-video",wmv:"mdi-file-video",mp3:"mdi-music",txt:"mdi-file-document-outline"})[r?.toLowerCase()]||"mdi-file",Xt=r=>["image/jpeg","image/jpg","image/bmp","image/png","image/webp","image/gif"].includes(r),bt=(r,p)=>{if(r&&["text/plain","text/html","text/css","text/javascript","text/markdown","text/xml","application/json","application/javascript","application/xml","application/x-yaml","application/yaml"].includes(r))return!0;if(p){const y=p.split(".").pop().toLowerCase();return["txt","md","json","js","jsx","ts","tsx","html","htm","css","scss","sass","less","xml","yaml","yml","toml","ini","conf","sh","bash","bat","cmd","ps1","py","rb","php","java","c","cpp","h","hpp","go","rs","swift","kt","scala","sql","graphql","vue","svelte","log","env","gitignore","dockerignore"].includes(y)}return!1},$t=r=>{const p=["Bytes","KB","MB","GB","TB"];if(r==0)return"0";const d=parseInt(Math.floor(Math.log(r)/Math.log(1024)));return(r/Math.pow(1024,d)).toFixed(1)+" "+p[d]},Wt=r=>r<=0?"0":r<=99999999?(r/1024**2).toFixed(1)+" MB":(r/1024**3).toFixed(1)+" GB",fo=r=>{if(!r||r===null||r===void 0||r===0||isNaN(r))return"-";try{const p=new Date(r);return isNaN(p.getTime())?"-":p.toLocaleString()}catch(p){return console.warn("Error formatting date:",r,p),"-"}},go=async()=>{if(console.log("ğŸ”„ initializeFluxDrive called"),console.log("ğŸ” isLoggedIn.value:",Ce.value),F.value=!1,z.value="/",C.breadcrumbs.value=[{title:"Home",path:"/",disabled:!1}],ue.value=null,console.log("ğŸ§¹ Cleared stale pendingPlanSelection"),Ce.value){console.log("âœ… User is logged in, checking subscription status...");const r=await le();console.log("ğŸ“Š Subscription check result:",r)}else console.log("âŒ User not logged in, setting subscription to false"),ne.value=!1,F.value=!0;console.log("ğŸ” Final hasActiveSubscription.value:",ne.value)},mo=async()=>{console.log("ğŸš€ handlePostLogin started"),zt(),console.log("ğŸ” Checking subscription status...");const r=await le();if(console.log("ğŸ“Š Subscription check result:",r),console.log("ğŸ“Š hasActiveSubscription.value:",ne.value),ue.value&&!ne.value){console.log("ğŸ“ Processing pending plan selection:",ue.value);const p=ue.value;ue.value=null,await We(p)}else ne.value?(console.log("âœ… User has active subscription, loading files..."),await Ne()):console.log("ğŸ“‹ User sees pricing plans")},et=ze(()=>{if(!v.value)return null;const r=new Date(v.value*1e3),p={year:"numeric",month:"long",day:"numeric"};return r.toLocaleDateString(void 0,p)}),vo=ze(()=>{if(!v.value)return null;const r=new Date(v.value*1e3),p={year:"numeric",month:"long",day:"numeric"},d={hour:"2-digit",minute:"2-digit",hour12:!1};return r.toLocaleDateString(void 0,p)+", "+r.toLocaleTimeString(void 0,d)}),St=()=>{console.log("ğŸ§¹ Resetting FluxDrive state..."),C.files.value=[],C.loading.value=!1,C.loadingStorage.value=!1,C.loadingFiles.value=!1,C.hasActiveSubscription.value=!1,C.subscriptionChecked.value=!1,C.subscriptionPeriodEnd.value=null,C.paymentGateway.value="",C.storageInfoFetched.value=!1,C.filesLoaded.value=!1,C.usedStorage.value=0,C.totalStorage.value=10737418240,C.currentFolder.value="/",C.currentFolderUuid.value="",C.folderHierarchy.value=[],C.breadcrumbs.value=[{title:"Home",path:"/"}],C.errorState.value={hasError:!1,message:"",type:"error",timestamp:null,persistent:!1},console.log("âœ… FluxDrive state reset complete")};return{isLoggedIn:Ce,hasActiveSubscription:ne,subscriptionChecked:F,subscriptionPeriodEnd:v,paymentGateway:C.paymentGateway,activeXHRs:C.activeXHRs,loading:K,currentFolder:z,breadcrumbs:$e,loadingStorage:O,searching:te,subscribing:oe,selectedPlan:we,files:Q,searchQuery:X,currentPage:de,filesPerPage:Ye,totalFiles:Pe,isDragOver:Ke,uploading:Oe,uploadProgress:E,showFileModal:W,previewingFile:Ue,resultMessage:pe,uploadMessage:xe,openLoginBottomSheet:pt,pendingPlanSelection:ue,usedStorage:ce,totalStorage:M,fluxDrivePlans:ft,fileHeaders:Et,storagePercentage:Lt,formattedSubscriptionEndDate:et,formattedSubscriptionEndDateTime:vo,getAlertType:ut,selectPlan:We,fetchStorageInfo:$,loadFiles:Ne,checkSubscriptionStatus:le,initializeFluxDrive:go,handlePostLogin:mo,searchFile:f,handleDrop:_,handleFileSelect:U,handleFolderSelect:L,uploadData:ge,uploadDataWithoutStateManagement:A,uploadVersionToFluxCloud:Se,copyLink:H,previewFile:Re,closeModal:qe,openFolder:lt,navigateToFolder:vt,createFolder:st,deleteFile:Jt,getFileIcon:At,isImageFile:Xt,isTextFile:bt,convertSize:$t,bytesConversion:Wt,formatDate:fo,currentPlan:Ie,getPlanStatus:he,getPlanStorageGB:me,hasError:je,errorMessage:gt,errorType:mt,setError:ct,clearError:at,isRecoveryMode:fe,renewSubscription:nt,upgradeSubscription:Pt,cancelSubscription:ie,resetFluxDriveState:St,ipfsHost:se,bridgeURL:c}}const on={class:"pricing-plans-container"},an={class:"plans-section"},nn={class:"section-title"},ln={class:"section-subtitle"},sn={class:"plans-grid"},rn={key:0,class:"recommended-badge"},cn={class:"plan-price-badge"},un={key:0,class:"price-amount"},dn={key:1,class:"price-amount"},pn={class:"price-period"},fn={class:"plan-header"},gn={class:"plan-name"},mn={class:"plan-resources"},vn={class:"resource-row"},hn={class:"resource-label"},yn={class:"resource-value"},wn={key:0,class:"resource-row"},xn={class:"resource-label"},bn={class:"resource-value"},_n={class:"resource-label",style:{"grid-column":"2 / 4"}},kn={__name:"PricingPlans",emits:["select-plan","selectPlan","cancelSubscription"],setup(G,{emit:T}){const Ve=T,{t:u}=Dt(),{isLoggedIn:se,subscribing:c,selectedPlan:fe,fluxDrivePlans:z,resultMessage:$e,getAlertType:ye,hasActiveSubscription:Ce,getPlanStatus:ne,paymentGateway:v}=qt(),Ie=$=>{if($.id==="enterprise")return{text:u("components.fluxDrive.pricingPlans.contactUs"),color:"primary",variant:"flat",disabled:!1,action:"contact"};if(!se.value)return{text:u("components.fluxDrive.pricingPlans.signIn"),color:"primary",variant:"flat",disabled:!1,action:"signin"};switch(ne($.id)){case"current":return{text:u("components.fluxDrive.pricingPlans.current"),color:"success",variant:"flat",disabled:!0,action:"current"};case"renew":return{text:u("components.fluxDrive.pricingPlans.renew"),color:"error",variant:"flat",disabled:!1,action:"renew"};case"upgrade":return{text:u("components.fluxDrive.pricingPlans.upgrade"),color:"primary",variant:"flat",disabled:!1,action:"upgrade"};case"downgrade":return{text:u("components.fluxDrive.pricingPlans.downgrade"),color:"warning",variant:"outlined",disabled:Ce.value,action:"downgrade"};case"downgrade-blocked":return{text:u("components.fluxDrive.pricingPlans.downgradeBlocked"),color:"error",variant:"outlined",disabled:!0,action:"downgrade-blocked"};default:return{text:u("components.fluxDrive.pricingPlans.getStarted"),color:"primary",variant:"flat",disabled:!1,action:"subscribe"}}},me=$=>{if($.id==="enterprise")return"mdi-email";if(!se.value)return"mdi-login";switch(ne($.id)){case"current":return"mdi-check";case"renew":return"mdi-refresh";case"upgrade":return"mdi-arrow-up-bold";case"downgrade":return"mdi-arrow-down-bold";default:return"mdi-cart"}},he=$=>{const le=z.value.find(ce=>ce.id===$);if(!le)return;const K=Ie(le);if(K.action==="contact"){window.location.href="mailto:support@runonflux.io?subject=FluxDrive%20Enterprise%20Plan%20Inquiry";return}if(K.action==="signin"){Ve("selectPlan",$,"subscribe");return}const Q=K.action==="subscribe"?"subscribe":K.action;Ve("selectPlan",$,Q)};return($,le)=>(g(),R("div",on,[o($e)?(g(),N(_t,{key:0,type:o(ye)(o($e)),class:"mb-6",innerHTML:o($e)},null,8,["type","innerHTML"])):Z("",!0),s("div",an,[s("h2",nn,l(o(u)("components.fluxDrive.pricingPlans.title")),1),s("p",ln,l(o(u)("components.fluxDrive.pricingPlans.subtitle")),1),s("div",sn,[(g(!0),R(Ge,null,Ft(o(z),K=>(g(),R("div",{key:K.id,class:rt(["plan-card",{recommended:K.popular,"current-plan":o(ne)(K.id)==="current","disabled-plan":o(ne)(K.id)==="downgrade"&&o(Ce)||o(ne)(K.id)==="downgrade-blocked"}])},[K.popular?(g(),R("div",rn,l(K.badge||o(u)("components.fluxDrive.pricingPlans.popular")),1)):Z("",!0),s("div",cn,[K.price&&K.price.trim()?(g(),R("span",un,l(K.price),1)):(g(),R("span",dn,l(o(u)("components.fluxDrive.pricingPlans.customPricing")),1)),s("span",pn,l(K.price?o(u)("components.fluxDrive.pricingPlans.perMonth"):o(u)("components.fluxDrive.pricingPlans.pricing")),1)]),s("div",fn,[s("h3",gn,l(K.name),1)]),s("div",mn,[s("div",vn,[e(k,{class:"resource-icon storage-icon"},{default:a(()=>[...le[1]||(le[1]=[b("mdi-database",-1)])]),_:1}),s("span",hn,l(o(u)("components.fluxDrive.pricingPlans.storage")),1),s("span",yn,l(K.storage),1)]),K.price&&K.price.trim()?(g(),R("div",wn,[e(k,{class:"resource-icon cost-icon"},{default:a(()=>[...le[2]||(le[2]=[b("mdi-calendar-today",-1)])]),_:1}),s("span",xn,l(o(u)("components.fluxDrive.pricingPlans.dailyCost")),1),s("span",bn,l(o(u)("components.fluxDrive.pricingPlans.dailyCostValue")),1)])):Z("",!0),(g(!0),R(Ge,null,Ft(K.features.slice(0,3),(Q,ce)=>(g(),R("div",{key:ce,class:"resource-row"},[e(k,{class:"resource-icon feature-icon"},{default:a(()=>[...le[3]||(le[3]=[b("mdi-check-circle",-1)])]),_:1}),s("span",_n,l(Q),1)]))),128))]),o(ne)(K.id)==="current"&&o(v)==="cryptocom"?(g(),N(B,{key:1,block:"",color:"error",variant:"outlined",size:"large",class:"plan-btn",onClick:le[0]||(le[0]=Q=>$.$emit("cancelSubscription"))},{default:a(()=>[e(k,{start:""},{default:a(()=>[...le[4]||(le[4]=[b("mdi-cancel",-1)])]),_:1}),b(" "+l(o(u)("pages.fluxDrive.cancel")),1)]),_:1})):o(ne)(K.id)==="current"?(g(),N(B,{key:2,block:"",color:"success",variant:"flat",size:"large",class:"plan-btn",disabled:""},{default:a(()=>[e(k,{start:""},{default:a(()=>[...le[5]||(le[5]=[b("mdi-check",-1)])]),_:1}),b(" "+l(o(u)("components.fluxDrive.pricingPlans.current")),1)]),_:1})):(g(),N(B,{key:3,block:"",color:Ie(K).color,variant:Ie(K).variant,loading:o(c)&&o(fe)===K.id,disabled:o(c)||Ie(K).disabled,size:"large",class:"plan-btn",onClick:Q=>he(K.id)},{default:a(()=>[e(k,{start:""},{default:a(()=>[b(l(me(K)),1)]),_:2},1024),b(" "+l(Ie(K).text),1)]),_:2},1032,["color","variant","loading","disabled","onClick"]))],2))),128))])])]))}},ta=Rt(kn,[["__scopeId","data-v-2899e5b5"]]),Pn={class:"text-subtitle-1 text-white"},Sn={key:0,class:"d-flex justify-center align-center",style:{height:"400px"}},Cn={key:1},Fn={class:"d-flex align-center",style:{"min-height":"80px"}},Dn={class:"mr-4 d-flex align-center justify-center",style:{width:"64px",height:"64px"}},zn={class:"flex-grow-1"},$n={class:"d-flex align-center mb-1"},Tn={class:"text-h6 me-2"},Mn={class:"text-body-2 text-medium-emphasis mb-1"},In={key:0,class:"text-body-2 text-medium-emphasis mb-1"},Un={class:"text-caption text-medium-emphasis"},Rn={class:"d-flex align-center",style:{"min-height":"80px"}},En={class:"mr-4 d-flex align-center justify-center",style:{width:"64px",height:"64px"}},Ln={class:"flex-grow-1"},An={class:"d-flex align-center mb-1"},Vn={class:"text-h6 me-2"},On={class:"text-body-2 text-medium-emphasis mb-1"},Nn={class:"text-caption text-medium-emphasis"},jn={key:0,class:"text-center text-medium-emphasis py-8"},Bn={class:"text-h6"},Gn={class:"text-body-2"},Hn={key:2,class:"text-center text-medium-emphasis py-8"},qn={class:"text-h6"},Jn={class:"text-body-2"},Xn={class:"text-subtitle-1 text-white"},Wn={class:"d-flex align-center mb-4"},Yn={class:"flex-grow-1"},Zn={class:"text-subtitle-1 font-weight-medium mb-1"},Kn={class:"text-body-2 text-medium-emphasis"},Qn={class:"progress-section"},el={class:"d-flex justify-space-between align-center mb-2"},tl={class:"text-body-2 text-medium-emphasis"},ol={class:"text-body-2 font-weight-medium"},al={__name:"VersionsDialog",props:{modelValue:{type:Boolean,default:!1},file:{type:Object,default:()=>({})}},emits:["update:modelValue","show-message","preview-file"],setup(G,{emit:T}){const Ve=G,u=T,{t:se}=Dt(),{bytesConversion:c}=qt(),fe=(M,F="success")=>{u("showMessage",{message:M,type:F})};localStorage.getItem("bridgeURL");const z=localStorage.getItem("ipfsHost")||"https://jetpack2_38080.app.runonflux.io",$e=S(!1),ye=S(!1),Ce=S(0),ne=S(""),v=S(0),Ie=ze({get:()=>Ve.modelValue,set:M=>u("update:modelValue",M)}),me=M=>new Date(typeof M=="number"?M:new Date(M).getTime()).toLocaleString(),he=M=>{if(M===0)return"0 Bytes";const F=1024,O=["Bytes","KB","MB","GB","TB"],te=Math.floor(Math.log(M)/Math.log(F));return parseFloat((M/Math.pow(F,te)).toFixed(2))+" "+O[te]},$=M=>{console.log("ğŸ” Opening file for preview:",M.name,M.hash),console.log("ğŸ” File object:",JSON.stringify(M,null,2)),u("previewFile",M),console.log("ğŸ” Emitted previewFile event, closing versions dialog"),Ie.value=!1},le=M=>{const F={...Ve.file,hash:M.hash,name:M.filename||Ve.file.name,size:M.size,thumbnail:M.thumbnail,timestamp:M.timestamp};console.log("ğŸ” Opening version for preview:",F.name,F.hash),console.log("ğŸ” Version file object:",JSON.stringify(F,null,2)),u("previewFile",F),console.log("ğŸ” Emitted previewFile event for version, closing versions dialog"),Ie.value=!1},K=async M=>{console.log("ğŸ“¥ Starting download:",M.name,"from hash:",M.hash);try{const F=M.name||M.name_abbr||`file_${M.hash}`;ye.value=!0,Ce.value=0,ne.value=F,v.value=M.size||0;const O=await fetch(`${z}/ipfs/${M.hash}`,{method:"GET",headers:{Accept:"*/*"}});if(!O.ok)throw new Error(`HTTP error! status: ${O.status}`);const te=O.headers.get("content-length"),oe=te?parseInt(te,10):0,we=O.body.getReader(),ue=[];let X=0;for(;;){const{done:E,value:W}=await we.read();if(E)break;ue.push(W),X+=W.length,oe>0&&(Ce.value=Math.round(X/oe*100))}const de=new Uint8Array(X);let Ye=0;for(const E of ue)de.set(E,Ye),Ye+=E.length;const Pe=new Blob([de]),Ke=window.URL.createObjectURL(Pe),Oe=document.createElement("a");Oe.href=Ke,Oe.download=F,document.body.appendChild(Oe),Oe.click(),document.body.removeChild(Oe),window.URL.revokeObjectURL(Ke),ye.value=!1,fe(se("components.fluxDrive.versionsDialog.downloadSuccess",{name:F}),"success")}catch(F){console.error("ğŸ“¥ Download error:",F),ye.value=!1,fe(se("components.fluxDrive.versionsDialog.downloadFailed",{name:M.name,error:F.message}),"error")}},Q=async M=>{const F=M.filename||Ve.file.name;console.log("ğŸ“¥ Starting version download:",F,"from hash:",M.hash);try{ye.value=!0,Ce.value=0,ne.value=F,v.value=M.size||0;const O=await fetch(`${z}/ipfs/${M.hash}`,{method:"GET",headers:{Accept:"*/*"}});if(!O.ok)throw new Error(`HTTP error! status: ${O.status}`);const te=O.headers.get("content-length"),oe=te?parseInt(te,10):0,we=O.body.getReader(),ue=[];let X=0;for(;;){const{done:E,value:W}=await we.read();if(E)break;ue.push(W),X+=W.length,oe>0&&(Ce.value=Math.round(X/oe*100))}const de=new Uint8Array(X);let Ye=0;for(const E of ue)de.set(E,Ye),Ye+=E.length;const Pe=new Blob([de]),Ke=window.URL.createObjectURL(Pe),Oe=document.createElement("a");Oe.href=Ke,Oe.download=F,document.body.appendChild(Oe),Oe.click(),document.body.removeChild(Oe),window.URL.revokeObjectURL(Ke),ye.value=!1,fe(se("components.fluxDrive.versionsDialog.downloadSuccess",{name:F}),"success")}catch(O){console.error("ğŸ“¥ Version download error:",O),ye.value=!1,fe(se("components.fluxDrive.versionsDialog.downloadFailed",{name:F,error:O.message}),"error")}},ce=M=>{const F=`https://ipfs.runonflux.io/ipfs/${M}`;console.log("ğŸ“‹ Copying link to clipboard:",F);try{const O=document.createElement("button");O.setAttribute("data-clipboard-text",F),document.body.appendChild(O);const te=new $o(O);te.on("success",()=>{console.log("âœ… Link copied successfully"),fe(se("components.fluxDrive.versionsDialog.linkCopied"),"success"),te.destroy(),document.body.removeChild(O)}),te.on("error",oe=>{console.error("âŒ ClipboardJS error:",oe),fe(se("components.fluxDrive.versionsDialog.linkCopyFailed"),"error"),te.destroy(),document.body.removeChild(O)}),O.click()}catch(O){console.error("âŒ Copy link error:",O),fe(se("components.fluxDrive.versionsDialog.linkCopyFailed"),"error")}};return(M,F)=>(g(),R(Ge,null,[e(ot,{modelValue:Ie.value,"onUpdate:modelValue":F[4]||(F[4]=O=>Ie.value=O),"max-width":750,persistent:"",scrollable:""},{default:a(()=>[e(be,null,{default:a(()=>[e(it,{class:"d-flex align-center px-3 py-1 bg-primary text-white"},{default:a(()=>[e(k,{icon:"mdi-history",class:"me-2",style:{color:"rgba(255,255,255,0.9)"}}),s("h3",Pn,l(o(se)("components.fluxDrive.versionsDialog.title")),1),e(Qe),e(B,{icon:"mdi-close",variant:"text",color:"white",onClick:F[0]||(F[0]=O=>Ie.value=!1)})]),_:1}),e(Fe,{class:"pa-6 pt-4",style:{height:"500px","overflow-y":"auto"}},{default:a(()=>[s("div",null,[$e.value?(g(),R("div",Sn,[e(kt,{indeterminate:"",color:"primary",size:60,width:4})])):G.file&&G.file.name?(g(),R("div",Cn,[e(be,{variant:"elevated",class:"mb-4 bg-grey-lighten-5",elevation:"6"},{default:a(()=>[e(Fe,null,{default:a(()=>[s("div",Fn,[s("div",Dn,[G.file.thumbnail?(g(),N(Ut,{key:0,src:G.file.thumbnail,width:64,height:64,class:"rounded"},null,8,["src"])):(g(),N(k,{key:1,icon:"mdi-file-check",size:64,color:"green"}))]),s("div",zn,[s("div",$n,[s("div",Tn,l(G.file.name),1),e(He,{size:"small",color:"green",variant:"tonal","prepend-icon":"mdi-check-circle"},{default:a(()=>[b(l(o(se)("components.fluxDrive.versionsDialog.current")),1)]),_:1})]),s("div",Mn,[e(k,{icon:"mdi-account",size:"18",class:"me-1"}),b(" "+l(o(se)("components.fluxDrive.versionsDialog.currentVersion")),1)]),G.file.comment?(g(),R("div",In,[e(k,{icon:"mdi-comment-text",size:"18",class:"me-1"}),b(" "+l(G.file.comment),1)])):Z("",!0),s("div",Un,[e(k,{icon:"mdi-calendar",size:"18",class:"me-1"}),b(" "+l(me(G.file.timestamp))+" ",1),e(k,{icon:"mdi-database",size:"18",class:"ms-2 me-1"}),b(" "+l(o(c)(G.file.size)),1)])]),e(jt,null,{activator:a(({props:O})=>[e(B,ao({icon:"mdi-dots-vertical",variant:"text",color:"grey"},O),null,16)]),default:a(()=>[e(It,null,{default:a(()=>[e(De,{"prepend-icon":"mdi-eye",title:o(se)("components.fluxDrive.versionsDialog.preview"),onClick:F[1]||(F[1]=O=>$(G.file))},null,8,["title"]),e(De,{"prepend-icon":"mdi-download",title:o(se)("components.fluxDrive.versionsDialog.download"),onClick:F[2]||(F[2]=O=>K(G.file))},null,8,["title"]),e(De,{"prepend-icon":"mdi-link",title:o(se)("components.fluxDrive.versionsDialog.copyLink"),onClick:F[3]||(F[3]=O=>ce(G.file.hash))},null,8,["title"])]),_:1})]),_:1})])]),_:1})]),_:1}),(g(!0),R(Ge,null,Ft(G.file.versions||[],(O,te)=>(g(),N(be,{key:O.hash,variant:"elevated",class:"mb-4 bg-grey-lighten-5",elevation:"5"},{default:a(()=>[e(Fe,null,{default:a(()=>[s("div",Rn,[s("div",En,[O.thumbnail?(g(),N(Ut,{key:0,src:O.thumbnail,width:64,height:64,class:"rounded"},null,8,["src"])):te===0?(g(),N(k,{key:1,icon:"mdi-file-restore",size:64,color:"blue"})):te===G.file.versions.length-1?(g(),N(k,{key:2,icon:"mdi-file-clock",size:64,color:"amber"})):(g(),N(k,{key:3,icon:"mdi-file-document-multiple",size:64,color:"grey"}))]),s("div",Ln,[s("div",An,[s("div",Vn,l(O.filename||G.file.name),1),e(He,{size:"small",color:"grey",variant:"tonal","prepend-icon":"mdi-history"},{default:a(()=>[b(" v"+l(G.file.versions.length-te),1)]),_:2},1024),te===0?(g(),N(He,{key:0,size:"small",color:"grey",variant:"tonal",class:"ms-1","prepend-icon":"mdi-backup-restore"},{default:a(()=>[b(l(o(se)("components.fluxDrive.versionsDialog.previous")),1)]),_:1})):te===G.file.versions.length-1?(g(),N(He,{key:1,size:"small",color:"amber",variant:"tonal",class:"ms-1","prepend-icon":"mdi-source-commit-start"},{default:a(()=>[b(l(o(se)("components.fluxDrive.versionsDialog.original")),1)]),_:1})):Z("",!0)]),s("div",On,[e(k,{icon:"mdi-comment-text",size:"18",class:"me-1"}),b(" "+l(O.comment||o(se)("components.fluxDrive.versionsDialog.versionNumber",{number:G.file.versions.length-te})),1)]),s("div",Nn,[e(k,{icon:"mdi-calendar-clock",size:"18",class:"me-1"}),b(" "+l(me(O.timestamp))+" ",1),e(k,{icon:"mdi-file-outline",size:"18",class:"ms-2 me-1"}),b(" "+l(o(c)(O.size))+" ",1),e(k,{icon:"mdi-identifier",size:"18",class:"ms-2 me-1"}),b(" "+l(O.hash.substring(0,8))+"... ",1)])]),e(jt,null,{activator:a(({props:oe})=>[e(B,ao({icon:"mdi-dots-vertical",variant:"text",color:"grey"},{ref_for:!0},oe),null,16)]),default:a(()=>[e(It,null,{default:a(()=>[e(De,{"prepend-icon":"mdi-eye",title:o(se)("components.fluxDrive.versionsDialog.preview"),onClick:oe=>le(O)},null,8,["title","onClick"]),e(De,{"prepend-icon":"mdi-download",title:o(se)("components.fluxDrive.versionsDialog.download"),onClick:oe=>Q(O)},null,8,["title","onClick"]),e(De,{"prepend-icon":"mdi-link",title:o(se)("components.fluxDrive.versionsDialog.copyLink"),onClick:oe=>ce(O.hash)},null,8,["title","onClick"])]),_:2},1024)]),_:2},1024)])]),_:2},1024)]),_:2},1024))),128)),!G.file.versions||G.file.versions.length===0?(g(),R("div",jn,[e(k,{icon:"mdi-history",size:"64",class:"mb-4"}),s("div",Bn,l(o(se)("components.fluxDrive.versionsDialog.noPreviousVersions")),1),s("div",Gn,l(o(se)("components.fluxDrive.versionsDialog.noPreviousVersionsMessage")),1)])):Z("",!0)])):(g(),R("div",Hn,[e(k,{icon:"mdi-file-question",size:"64",class:"mb-4"}),s("div",qn,l(o(se)("components.fluxDrive.versionsDialog.noFileSelected")),1),s("div",Jn,l(o(se)("components.fluxDrive.versionsDialog.noFileSelectedMessage")),1)]))])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(ot,{modelValue:ye.value,"onUpdate:modelValue":F[5]||(F[5]=O=>ye.value=O),persistent:"","max-width":480},{default:a(()=>[e(be,{class:"download-dialog",elevation:"12"},{default:a(()=>[e(it,{class:"d-flex align-center px-3 py-1 bg-gradient-primary"},{default:a(()=>[e(k,{icon:"mdi-download",class:"me-2",color:"white",style:{color:"rgba(255,255,255,0.9)"}}),s("span",Xn,l(o(se)("components.fluxDrive.versionsDialog.downloadProgress")),1)]),_:1}),e(Fe,{class:"pa-6"},{default:a(()=>[s("div",Wn,[e(Ea,{class:"me-4",color:"primary",variant:"tonal",size:"48"},{default:a(()=>[e(k,{icon:"mdi-file-download",size:"24"})]),_:1}),s("div",Yn,[s("div",Zn,l(ne.value),1),s("div",Kn,l(he(v.value)),1)])]),s("div",Qn,[s("div",el,[s("span",tl,l(o(se)("components.fluxDrive.versionsDialog.progress")),1),s("span",ol,l(Ce.value)+"%",1)]),e(uo,{"model-value":Ce.value,color:"primary",height:"6",rounded:""},null,8,["model-value"])])]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}},nl=Rt(al,[["__scopeId","data-v-a7343fc2"]]),ll={class:"mb-6"},sl={class:"d-flex align-center mb-4"},il={class:"d-flex align-center"},rl={class:"text-h5 font-weight-bold text-primary mb-0"},cl={class:"text-caption text-medium-emphasis"},ul={class:"flex-grow-1"},dl={class:"text-subtitle-2 font-weight-bold"},pl={class:"text-caption"},fl={key:0,class:"text-caption text-error mt-1"},gl={class:"text-subtitle-2 font-weight-bold mb-2"},ml={class:"text-caption mb-3"},vl={class:"d-flex gap-2 flex-wrap"},hl={class:"d-flex align-center justify-space-between flex-wrap ga-3"},yl={class:"flex-grow-1",style:{"min-width":"280px","max-width":"400px"}},wl={class:"d-flex align-center ga-3 flex-shrink-0"},xl={class:"view-toggle-modern"},bl={class:"modern-breadcrumb mb-4"},_l={class:"breadcrumb-container d-flex align-center"},kl={class:"text-medium-emphasis"},Pl={key:0,class:"d-flex justify-center mb-4"},Sl={class:"text-caption"},Cl={key:4,class:"d-flex justify-center align-center",style:{"min-height":"300px"}},Fl={class:"text-h6 mb-2"},Dl={class:"text-body-2 text-medium-emphasis mb-4"},zl={key:0,class:"loading-overlay"},$l={key:1},Tl={class:"d-flex align-center justify-center",style:{width:"60px"}},Ml=["title","onClick"],Il={class:"text-no-wrap"},Ul={class:"text-no-wrap"},Rl={key:2,class:"pa-2"},El={class:"mb-2"},Ll={class:"video-thumbnail-overlay"},Al=["title"],Vl={class:"text-caption text-medium-emphasis mb-1",style:{"font-size":"13px !important"}},Ol={class:"text-caption text-medium-emphasis",style:{"font-size":"12px !important"}},Nl={key:2,class:"text-caption text-medium-emphasis",style:{"font-size":"12px !important"}},jl={key:3,class:"position-absolute version-badge",style:{top:"8px",right:"8px"}},Bl={key:3,class:"modern-pagination mt-4"},Gl={key:0,class:"d-flex align-center justify-space-between w-100"},Hl={class:"d-flex align-center justify-center ga-1"},ql={class:"d-flex align-center ga-1"},Jl={key:1,class:"pagination-dots"},Xl={class:"d-flex align-center pagination-selector-container"},Wl={class:"text-caption font-weight-medium"},Yl={key:1,class:"d-flex align-center justify-end w-100"},Zl={class:"d-flex align-center pagination-selector-container"},Kl={class:"text-caption font-weight-medium"},Ql={class:"preview-header d-flex align-center pa-2 flex-shrink-0"},es={class:"flex-grow-1 text-center px-4"},ts={class:"text-body-1 text-truncate d-inline-block",style:{"max-width":"400px"}},os={class:"d-flex gap-1"},as={key:0,class:"preview-container flex-grow-1 d-flex align-center justify-center bg-black"},ns={key:1,class:"preview-container flex-grow-1 d-flex align-center justify-center bg-black"},ls=["src","poster"],ss={key:2,class:"preview-container d-flex align-center justify-center",style:{"min-height":"300px"}},is={class:"text-center"},rs=["src"],cs={key:3,class:"preview-container flex-grow-1 d-flex flex-column bg-black"},us=["src"],ds={key:4,class:"preview-container d-flex align-center justify-center",style:{"min-height":"400px"}},ps={class:"text-center"},fs={class:"text-body-1 text-medium-emphasis"},gs={class:"d-flex flex-column align-center"},ms={class:"upload-icon-container mb-4"},vs={class:"text-center mb-4"},hs={class:"text-h6 font-weight-bold text-primary mb-1"},ys={class:"text-body-2 text-medium-emphasis mb-1"},ws={key:0,class:"text-caption text-medium-emphasis mb-2"},xs={class:"upload-progress-container"},bs={class:"text-center"},_s={class:"text-caption text-medium-emphasis"},ks={key:0},Ps={class:"text-h5 mb-2"},Ss={class:"text-body-1 mb-3"},Cs={class:"text-body-2"},Fs={class:"text-subtitle-1 text-white"},Ds={class:"text-body-1 mb-4"},zs={class:"d-flex align-center"},$s={class:"text-subtitle-1 font-weight-medium"},Ts={class:"text-h6 text-white"},Ms={class:"text-body-1 mb-4"},Is={class:"text-caption"},Us={class:"text-h5 text-white"},Rs={class:"text-subtitle-1 text-white"},Es={class:"text-subtitle-1 text-white"},Ls={class:"d-flex align-center"},As={class:"text-subtitle-1 font-weight-medium"},Vs={class:"text-subtitle-1 text-white"},Os={key:0},Ns={class:"text-body-2 mb-4"},js={key:0},Bs={key:1},Gs={class:"text-body-1"},Hs={class:"text-subtitle-1 text-white"},qs={class:"text-subtitle-1 text-white"},Js={class:"text-caption text-medium-emphasis mt-2"},Xs={class:"d-flex align-center"},Ws={class:"fluxdrive-editor-loader"},Ys={class:"d-flex align-center"},Zs={__name:"FileManager",emits:["select-plan","selectPlan"],setup(G,{expose:T,emit:Ve}){const u=Ve,se=Ia(()=>Wa(()=>import("./monaco-T-LZewlR.js"),__vite__mapDeps([0,1])).then(i=>i.VueMonacoEditor)),{t:c}=Dt(),fe=S(localStorage.getItem("fluxdrive-view-type")||"list");Bt(fe,i=>{localStorage.setItem("fluxdrive-view-type",i),console.log("ğŸ”„ View type changed to:",i)});const{paymentGateway:z,cancelSubscription:$e}=qt(),ye=ze(()=>z.value==="cryptocom"),Ce=S(!1),ne=S(!1),v=S(0),Ie=S(""),me=S(!1),he=S(null),$=S(!1),le=S(null),K=S(!1),Q=S(!1),ce=S(!1),M=S(null),F=S(!1),O=S(null),te=S(""),oe=S(""),we=S(!1),ue=S(null),X=S(""),de=S(""),Ye=S(!1),Pe=S(!1),Ke=S(!1),Oe=ze(()=>X.value!==de.value),E=S(0),W=S(0),Ue=S(""),pe=S(0),xe=S(0),pt=S([]),zt=S(!1),ft=S(""),Et=S("success"),Lt=S("mdi-check-circle"),wt=S(5e3),ct=ze(()=>oe.value?.trim()?le.value&&oe.value.trim()===le.value.name?{isValid:!1,hint:"Name is the same as current name"}:{isValid:!0,hint:""}:{isValid:!1,hint:"Please enter a name"}),at=S(!1),je=S(null),gt=S(""),mt=S(!1),ut=S("");S([]);const We=ze(()=>Ee.value||[]),xt=S(""),nt=S("success"),Pt=S("mdi-check-circle"),ie=(i,n="success",t="mdi-check-circle",h=5e3)=>{xt.value=i,nt.value=n,Pt.value=t,setTimeout(()=>{xt.value=""},h)},Ne=(i,n="success",t="mdi-check-circle",h=5e3)=>{ft.value=i,Et.value=n,Lt.value=t,wt.value=h,zt.value=!0},f=({message:i,type:n})=>{Ne(i,n,{success:"mdi-check-circle",error:"mdi-alert-circle",warning:"mdi-alert",info:"mdi-information"}[n]||"mdi-check-circle")},_=i=>{console.log("ğŸ” FileManager received preview-file event:",i.name,i.hash),Qt(i)},U=i=>{try{let n="";if(i.link)n=i.link;else if(i.hash)n=`${Me}/ipfs/${i.hash}`;else throw new Error("No link or hash available for this file");const t=document.createElement("button");t.setAttribute("data-clipboard-text",n),document.body.appendChild(t);const h=new $o(t);h.on("success",()=>{ie(`Link for "${i.name}" copied to clipboard`,"success","mdi-link"),h.destroy(),document.body.removeChild(t)}),h.on("error",I=>{console.error("ClipboardJS error:",I),ie(`Failed to copy link for "${i.name}"`,"error","mdi-link-off"),h.destroy(),document.body.removeChild(t)}),t.click()}catch(n){console.error("Copy link error:",n),ie(`Failed to copy link for "${i.name}": ${n.message}`,"error","mdi-link-off")}},L=i=>{console.log("ğŸ” Viewing versions for:",i.name),console.log("ğŸ” File data:",JSON.stringify(i,null,2)),console.log("ğŸ” File versions array:",i.versions),console.log("ğŸ” Versions length:",i.versions?.length||0),M.value=i,K.value=!0},ve=i=>{console.log("â• Adding version for:",i.name),O.value=i,te.value="",ae.value=null,F.value=!0},ae=S(null),A=i=>{const n=i.target.files;n&&n.length>0?(ae.value=n[0],console.log("ğŸ“ Version file selected:",ae.value.name)):ae.value=null},Se=async()=>{if(!ae.value||!O.value){ie("Please select a file first","error");return}const i=H(ae.value.size);if(ae.value.size/(1024*1024)>100){Ne(`File too large! Upload limit is 100.00 MB (${i} provided)`,"error","mdi-file-alert");return}try{Y.value=!0,Ue.value=ae.value.name,pe.value=ae.value.size,xe.value=0,F.value=!1;const t=O.value.hash,h=te.value||`Version created on ${new Date().toLocaleDateString()}`,I=setInterval(()=>{xe.value=V.value},100);pt.value.push(I);try{await Io(t,O.value.name,ae.value,h)}finally{clearInterval(I);const J=pt.value.indexOf(I);J>-1&&pt.value.splice(J,1)}F.value=!1,ae.value=null,te.value="",await j(!1),ie(`New version of "${O.value.name}" added successfully`,"success","mdi-upload")}catch(t){console.error("Failed to upload version:",t),ie(`Failed to add version: ${t.message}`,"error","mdi-upload-off")}finally{Y.value=!1,Ue.value="",pe.value=0,xe.value=0}},ge=async i=>{try{const n=localStorage.getItem("zelidauth"),t=n?n.includes("zelid=")?Object.fromEntries(new URLSearchParams(n)):JSON.parse(n):{};if(!t.zelid||!t.loginPhrase||!t.signature)throw new Error("Authentication required. Please log in again.");const h=new FormData;h.append("file",i),h.append("zelid",t.zelid),h.append("signature",t.signature),h.append("loginPhrase",t.loginPhrase);const I=y.value==="/"?"":y.value.replace(/^\//,"");return y.value==="/"?h.append("currentFolder","/"):sharedState.currentFolderUuid.value?h.append("currentFolder",sharedState.currentFolderUuid.value):I&&h.append("currentFolder",I),new Promise((J,_e)=>{const ke=new XMLHttpRequest;ke.upload.onprogress=Le=>{Le.lengthComputable&&(xe.value=Math.round(Le.loaded/Le.total*100))},ke.onload=()=>{if(ke.status>=200&&ke.status<300)try{const Le=JSON.parse(ke.responseText);J(Le)}catch{J(ke.responseText)}else _e(new Error(`Upload failed with status ${ke.status}`))},ke.onerror=()=>_e(new Error("Upload failed"));const dt=localStorage.getItem("bridgeURL")||"https://jetpackbridge.runonflux.io";ke.open("POST",`${dt}/api/v1/ipfs/write`),ke.send(h)})}catch(n){throw console.error("âŒ Upload error:",n),n}},H=i=>{if(i===0)return"0 Bytes";const n=1024,t=["Bytes","KB","MB","GB","TB"],h=Math.floor(Math.log(i)/Math.log(n)),I=i/Math.pow(n,h);return h===0?Math.round(I)+" "+t[h]:parseFloat(I.toFixed(2))+" "+t[h]},Re=async i=>{const n=Array.from(i.target.files);console.log(`ğŸ“¤ Selected ${n.length} file(s) for upload`),Y.value=!0,W.value=n.length,E.value=0;const t=[];try{for(let h=0;h<n.length;h++){const I=n[h];E.value=h,Ue.value=I.name,pe.value=I.size,xe.value=0;const J=H(I.size);if(I.size/(1024*1024)>100){Ne(`File "${I.name}" is too large! Upload limit is 100.00 MB (${J} provided)`,"error","mdi-file-alert");continue}try{await ge(I),t.push({file:I.name,success:!0})}catch(ke){console.error("Upload error:",ke),t.push({file:I.name,success:!1,error:ke.message})}}}finally{Y.value=!1,Ue.value="",pe.value=0,xe.value=0,await j(!1);const h=t.filter(J=>J.success).length,I=t.filter(J=>!J.success).length;t.length===1?t[0].success?ie(`File "${t[0].file}" uploaded successfully`,"success","mdi-upload"):ie(`Failed to upload "${t[0].file}": ${t[0].error}`,"error","mdi-upload-off"):t.length>1&&(I===0?ie(`All ${h} files uploaded successfully`,"success","mdi-upload-multiple"):h===0?ie(`Failed to upload all ${I} files`,"error","mdi-upload-off"):ie(`Uploaded ${h} of ${t.length} files (${I} failed)`,"warning","mdi-upload-multiple")),console.log(`ğŸ“¤ Upload batch completed: ${h}/${t.length} successful`)}},qe=async i=>{const n=Array.from(i.dataTransfer.files);console.log(`ğŸ“¤ Dropped ${n.length} file(s) for upload`),Y.value=!0,W.value=n.length,E.value=0;const t=[];try{for(let h=0;h<n.length;h++){const I=n[h];E.value=h,Ue.value=I.name,pe.value=I.size,xe.value=0;const J=H(I.size);if(I.size/(1024*1024)>100){Ne(`File "${I.name}" is too large! Upload limit is 100.00 MB (${J} provided)`,"error","mdi-file-alert");continue}try{await ge(I),t.push({file:I.name,success:!0})}catch(ke){console.error("Upload error:",ke),t.push({file:I.name,success:!1,error:ke.message})}}}finally{Y.value=!1,Ue.value="",pe.value=0,xe.value=0,await j(!1);const h=t.filter(J=>J.success).length,I=t.filter(J=>!J.success).length;t.length===1?t[0].success?ie(`File "${t[0].file}" uploaded successfully`,"success","mdi-upload"):ie(`Failed to upload "${t[0].file}": ${t[0].error}`,"error","mdi-upload-off"):t.length>1&&(I===0?ie(`All ${h} files uploaded successfully`,"success","mdi-upload-multiple"):h===0?ie(`Failed to upload all ${I} files`,"error","mdi-upload-off"):ie(`Uploaded ${h} of ${t.length} files (${I} failed)`,"warning","mdi-upload-multiple")),console.log(`ğŸ“¤ Drop upload completed: ${h}/${t.length} successful`)}},lt=()=>{vt.value=!1,st.value=null},Je=i=>{if(!st.value){console.warn("No context menu item selected");return}const n=st.value;switch(console.log("Context menu action:",i,"for item:",n.name),lt(),i){case"preview":Qt(n);break;case"download":bo(n);break;case"addVersion":ve(n);break;case"versions":L(n);break;case"rename":console.log("Calling renameItem with:",n),_o(n);break;case"move":ko(n);break;case"copy":U(n);break;case"delete":Po(n);break;default:console.warn("Unknown context menu action:",i)}},vt=S(!1),st=S(null),Jt=S(0),At=S(0),Xt=(i,n)=>{console.log("Right-click context menu for:",n.name),i.preventDefault(),st.value=n,Jt.value=i.clientX,At.value=i.clientY,vt.value=!0};let bt=null,$t={x:0,y:0},Wt=!1;const fo=(i,n)=>{if(!i.touches||i.touches.length!==1)return;const t=i.touches[0];$t={x:t.clientX,y:t.clientY},Wt=!1,bt=setTimeout(()=>{if(!Wt){const h={clientX:$t.x,clientY:$t.y,preventDefault:()=>{}};Xt(h,n),navigator.vibrate&&navigator.vibrate(50)}},500)},go=i=>{if(!i.touches||i.touches.length!==1)return;const n=i.touches[0],t=Math.abs(n.clientX-$t.x),h=Math.abs(n.clientY-$t.y);(t>10||h>10)&&(Wt=!0,bt&&(clearTimeout(bt),bt=null))},mo=(i,n)=>{bt&&(clearTimeout(bt),bt=null)},{loading:et,searching:vo,files:St,searchQuery:r,currentPage:p,filesPerPage:d,currentFolder:y,breadcrumbs:w,hasActiveSubscription:x,subscriptionChecked:P,formattedSubscriptionEndDateTime:q,subscriptionPeriodEnd:D,isDragOver:m,uploading:Y,uploadProgress:V,showFileModal:ee,previewingFile:re,resultMessage:Xe,ipfsHost:Me,bridgeURL:Te,loadFiles:j,searchFile:tt,getPlanStatus:Yt,handleFolderSelect:Zt,previewFile:ht,closeModal:Kt,openFolder:oa,navigateToFolder:To,createFolder:aa,deleteFile:na,getFileIcon:no,isImageFile:ho,isTextFile:Mo,convertSize:lo,formatDate:yo,hasError:so,errorMessage:la,errorType:sa,clearError:ia,uploadVersionToFluxCloud:Io,activeXHRs:io}=qt(),yt=ze(()=>{if(!D.value)return 0;const i=Date.now(),n=D.value*1e3;if(i>=n)return-1;const t=new Date(n),h=new Date(i);h.setHours(0,0,0,0);const I=new Date(t);I.setHours(0,0,0,0);const J=I-h;return Math.ceil(J/(1e3*60*60*24))}),ra=ze(()=>{if(!D.value)return"Subscription inactive";const i=yt.value;return i===0||i<0?q.value:i===1?`1 day remaining â€¢ Expires ${q.value}`:`${i} days remaining â€¢ Expires ${q.value}`}),ca=ze(()=>[{title:"",key:"preview",sortable:!1,width:60},{title:c("components.fluxDrive.fileManager.columnName"),key:"name",sortable:!0},{title:c("components.fluxDrive.fileManager.columnUpdated"),key:"timestamp",sortable:!0,width:160},{title:c("components.fluxDrive.fileManager.columnSize"),key:"size",sortable:!0,width:90},{title:"",key:"actions",sortable:!1,width:40}]),Qt=i=>{Mo(i.mimetype,i.name)?Ro(i):ht(i)},Ee=ze(()=>{if(!r.value||r.value.trim()==="")return St.value;const i=r.value.toLowerCase().trim();return St.value.filter(n=>n.name.toLowerCase().includes(i)||n.type&&n.type.toLowerCase().includes(i))}),Uo=ze(()=>{const i=(p.value-1)*d.value,n=i+d.value,t=We.value.slice(i,n);return We.value.length>0&&t.length===0&&console.warn("ğŸ› Empty pagination result:",{currentPage:p.value,filesPerPage:d.value,totalFiles:We.value.length,start:i,end:n,stableFilesLength:We.value.length}),t}),ua=ze(()=>{const i=Math.ceil(We.value.length/d.value),n=p.value,t=2,h=[],I=[];let J;for(let _e=1;_e<=i;_e++)(_e===1||_e===i||_e>=n-t&&_e<=n+t)&&h.push(_e);return h.forEach(_e=>{J&&(_e-J===2?I.push(J+1):_e-J!==1&&I.push("...")),I.push(_e),J=_e}),I}),Vt=S({}),wo=i=>{const n=["mp4","webm","ogg","mov","avi","mkv","m4v","flv","wmv"],t=["video/mp4","video/webm","video/ogg","video/quicktime","video/x-msvideo","video/x-matroska","video/x-flv","video/x-ms-wmv"];if(i.name){const h=i.name.split(".").pop()?.toLowerCase();if(h&&n.includes(h))return!0}return!!(i.mimetype&&t.some(h=>i.mimetype.startsWith(h))||i.type&&i.type.toLowerCase().includes("video"))},da=async i=>!i.hash||Vt.value[i.hash]?Vt.value[i.hash]:new Promise(n=>{const t=document.createElement("video");t.crossOrigin="anonymous",t.src=`${Me}/ipfs/${i.hash}`,t.currentTime=1;const h=()=>{const J=document.createElement("canvas");J.width=48,J.height=48;const _e=J.getContext("2d"),ke=Math.max(J.width/t.videoWidth,J.height/t.videoHeight),dt=J.width/2-t.videoWidth/2*ke,Le=J.height/2-t.videoHeight/2*ke;_e.drawImage(t,dt,Le,t.videoWidth*ke,t.videoHeight*ke);const Be=J.toDataURL("image/jpeg",.7);Vt.value[i.hash]=Be,n(Be),t.removeEventListener("loadeddata",h),t.removeEventListener("error",I),t.remove()},I=()=>{n(null),t.removeEventListener("loadeddata",h),t.removeEventListener("error",I),t.remove()};t.addEventListener("loadeddata",h),t.addEventListener("error",I)}),pa=i=>{const n=["pdf"],t=["application/pdf"];if(i.name){const h=i.name.split(".").pop()?.toLowerCase();if(h&&n.includes(h))return!0}return!!(i.mimetype&&t.includes(i.mimetype)||i.type&&i.type.toLowerCase()==="pdf")},fa=i=>{const n=["mp3","wav","ogg","m4a","flac","aac","wma"],t=["audio/mpeg","audio/wav","audio/ogg","audio/mp4","audio/flac","audio/aac","audio/x-ms-wma"];if(i.name){const h=i.name.split(".").pop()?.toLowerCase();if(h&&n.includes(h))return!0}return!!(i.mimetype&&t.some(h=>i.mimetype.startsWith(h))||i.type&&i.type.toLowerCase().includes("audio"))};Bt(Ee,i=>{console.log("ğŸ” FileManager: Files changed:",{length:i?.length||0,files:i?.slice(0,5),isArray:Array.isArray(i),allFiles:i}),console.log("ğŸ” FileManager: View type:",fe.value),console.log("ğŸ” FileManager: Has active subscription:",x.value),fe.value==="grid"&&Array.isArray(i)&&i.forEach(n=>{wo(n)&&n.hash&&!Vt.value[n.hash]&&da(n)})},{immediate:!0,deep:!0});const ga=()=>{p.value=1,To({path:"/"})},xo=i=>{p.value=1,oa(i)},ma=i=>{p.value=1,To(i)},bo=async i=>{console.log("ğŸ“¥ Starting download:",i.name,"from hash:",i.hash);try{const n=i.name||i.name_abbr||`file_${i.hash}`;ne.value=!0,v.value=0,Ie.value=n;const t=await fetch(`${Me}/ipfs/${i.hash}`,{method:"GET",headers:{Accept:"*/*"}});if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const h=t.headers.get("content-length"),I=h?parseInt(h,10):0,J=t.body?.getReader();let _e=0;const ke=[];if(J)for(;;){const{done:Ze,value:No}=await J.read();if(Ze)break;ke.push(No),_e+=No.length,I>0&&(v.value=Math.round(_e/I*100))}const dt=new Blob(ke),Le=window.URL.createObjectURL(dt),Be=document.createElement("a");Be.href=Le,Be.download=n,document.body.appendChild(Be),Be.click(),document.body.removeChild(Be),window.URL.revokeObjectURL(Le),ne.value=!1,ie(`${n} downloaded successfully`,"success","mdi-download")}catch(n){console.error("ğŸ“¥ Download error:",n),ne.value=!1,ie(`Failed to download ${i.name}: ${n.message}`,"error","mdi-download-off")}},Ro=async i=>{console.log("ğŸ“ Opening editor for:",i.name),ue.value=i,Ye.value=!0,Ke.value=!1,we.value=!0;try{const n=await fetch(`${Me}/ipfs/${i.hash}`);if(!n.ok)throw new Error(`Failed to fetch file: ${n.status}`);const t=await n.text();X.value=t,de.value=t,console.log("âœ… File content loaded, length:",t.length)}catch(n){console.error("âŒ Error loading file content:",n),Ne(`Failed to load file: ${n.message}`,"error","mdi-file-alert"),we.value=!1}finally{Ye.value=!1}},va=i=>{if(!i)return"plaintext";const n=i.split(".").pop()?.toLowerCase();return{js:"javascript",jsx:"javascript",ts:"typescript",tsx:"typescript",json:"json",html:"html",css:"css",scss:"scss",sass:"sass",less:"less",md:"markdown",py:"python",java:"java",cpp:"cpp",c:"c",cs:"csharp",php:"php",rb:"ruby",go:"go",rs:"rust",sql:"sql",xml:"xml",yaml:"yaml",yml:"yaml",sh:"shell",bash:"shell",vue:"html",txt:"plaintext"}[n]||"plaintext"},ha=async()=>{if(!(!ue.value||!X.value)){console.log("ğŸ’¾ Saving edited file as new version:",ue.value.name),Pe.value=!0;try{const i=new Blob([X.value],{type:ue.value.mimetype||"text/plain"}),n=new File([i],ue.value.name,{type:ue.value.mimetype||"text/plain"}),t=ue.value.hash,h=`Edited via FluxDrive editor on ${new Date().toLocaleString()}`;await Io(t,ue.value.name,n,h),Ne(`${ue.value.name} saved as new version`,"success","mdi-content-save"),we.value=!1,ue.value=null,X.value="",de.value="",await j(!1)}catch(i){console.error("âŒ Error saving file:",i),Ne(`Failed to save file: ${i.message}`,"error","mdi-content-save-alert")}finally{Pe.value=!1}}},_o=i=>{console.log("ğŸ·ï¸ renameItem called with:",i),console.log("ğŸ·ï¸ Setting up rename dialog..."),le.value=i,oe.value=i.name,$.value=!0,console.log("ğŸ·ï¸ Rename dialog should be visible now:",{showRenameDialog:$.value,itemToRename:le.value?.name,renameText:oe.value})},Eo=async()=>{if(!ct.value.isValid)return;const i=le.value.name,n=oe.value.trim(),t=le.value.isFolder;$.value=!1;const h=le.value;le.value=null,oe.value="";try{const I=localStorage.getItem("zelidauth");if(!I){ie("Authentication required. Please log in.","error","mdi-account-alert");return}const J=I.includes("zelid=")?Object.fromEntries(new URLSearchParams(I)):JSON.parse(I);if(console.log("ğŸ” Auth data check:",{hasZelid:!!J.zelid,hasSignature:!!J.signature,hasLoginPhrase:!!J.loginPhrase}),!J.zelid||!J.signature||!J.loginPhrase){ie("Authentication incomplete. Please log in again.","error","mdi-account-alert");return}const _e=t?`${Te}/api/v1/ipfs/renamefolder`:`${Te}/api/v1/ipfs/rename`,ke={zelid:J.zelid,signature:J.signature,loginPhrase:J.loginPhrase};t?(ke.uuid=h.uuid,ke.filename=n):(ke.hash=h.hash,ke.filename=n),console.log(`ğŸ”„ Renaming ${t?"folder":"file"}:`,i,"â†’",n);const dt=await fetch(_e,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams(ke)});console.log("ğŸ“¡ Rename API response status:",dt.status);const Le=await dt.text();console.log("ğŸ“¡ Rename API response text:",Le);let Be;try{Be=JSON.parse(Le)}catch(Ze){throw console.error("âŒ Failed to parse rename response JSON:",Ze),new Error("Invalid response from server")}if(console.log("ğŸ“¡ Rename API parsed result:",Be),dt.ok&&(Be.status==="success"||Be.name))console.log(`âœ… ${t?"Folder":"File"} renamed successfully`),St?.value&&St.value.forEach(Ze=>{(Ze.hash===h.hash||Ze.uuid===h.uuid)&&(Ze.name=n,Ze.name_abbr=n)}),await j(!1),ie(`${t?"Folder":"File"} "${n}" renamed successfully`,"success","mdi-rename-box");else{const Ze=Be.error||Be.message||"Failed to rename item";console.error("âŒ Rename failed:",Ze),ie(`Failed to rename: ${Ze}`,"error","mdi-rename-box-off")}}catch(I){console.error("âŒ Rename error:",I),ie(`Failed to rename: ${I.message}`,"error","mdi-rename-box-off")}},ko=i=>{je.value=i,gt.value="",at.value=!0},Lo=async()=>{if(gt.value!==null){let i,n=null;const t=gt.value;if(!t||t.trim()==="")i="/",n="";else{i=t.trim().startsWith("/")?t.trim():`/${t.trim()}`;const h=t.trim().replace(/^\/+/,""),I=Ee.value.find(J=>J.isFolder&&J.name===h);I?(n=I.uuid||I.id,console.log("ğŸ“ Found destination folder UUID:",n,"for",i)):(console.warn("âš ï¸ Could not find UUID for destination folder:",h),console.log("Available folders:",Ee.value.filter(J=>J.isFolder).map(J=>({name:J.name,uuid:J.uuid}))))}try{const h=localStorage.getItem("zelidauth"),I=h?h.includes("zelid=")?Object.fromEntries(new URLSearchParams(h)):JSON.parse(h):{};if(console.log("ğŸ” Move item debug:",{item:je.value,rawDestination:t,normalizedDestination:i,currentFolder:y.value,authData:{...I,signature:"[HIDDEN]",loginPhrase:"[HIDDEN]"}}),!I.zelid||!I.loginPhrase||!I.signature){ie("Authentication required. Please log in again.","error","mdi-account-alert");return}console.log("ğŸš€ Attempting move API call (FluxCloud format)...");let J,_e;je.value.isFolder?(J=`${Te}/api/v1/ipfs/movefolder`,_e={zelid:I.zelid,signature:I.signature,loginPhrase:I.loginPhrase,uuid:je.value.uuid,destination:n||i}):(J=`${Te}/api/v1/ipfs/move`,_e={zelid:I.zelid,signature:I.signature,loginPhrase:I.loginPhrase,hash:je.value.hash,destination:n||i}),console.log("ğŸ“¡ Move API details:",{endpoint:J,itemType:je.value.isFolder?"folder":"file",identifier:je.value.isFolder?je.value.uuid:je.value.hash,destination:i,destinationUuid:n,actualDestinationSent:n||i});const ke=await fetch(J,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams(_e)});console.log("ğŸ“¡ Move API response status:",ke.status);const dt=await ke.text();console.log("ğŸ“¡ Move API response text:",dt);let Le;try{Le=JSON.parse(dt)}catch(Be){console.error("âŒ Failed to parse JSON response:",Be),ie("Invalid response from server","error","mdi-server-network-off");return}if(console.log("ğŸ“¡ Move API result:",Le),ke.status===404){ie("Move functionality is not available on this server","warning","mdi-folder-move-outline");return}if(!Le.error&&!Le.warning&&ke.ok){const Be=i==="/"?"root folder":`${i} folder`,Ze=je.value.name;await j(!1),ie(`"${Ze}" moved successfully to ${Be}`,"success","mdi-folder-move"),console.log(`âœ… Move successful: ${Ze} â†’ ${i}`),console.log("ğŸ“‚ User should navigate to",i,"to see the moved file"),setTimeout(i==="/"?()=>{ie(`${Ze} is now in the root folder. Click "Home" to view it.`,"info","mdi-information")}:()=>{ie(`${Ze} is now in "${i}". Navigate to that folder to view it.`,"info","mdi-information")},2e3),at.value=!1,je.value=null,gt.value=""}else if(Le.warning&&Le.warning.includes("login"))console.error("âŒ Move API authentication error despite valid login"),ie("Move functionality may not be available in your current plan or the API endpoint may not exist","warning","mdi-folder-move-outline");else{const Be=Le.error||Le.warning||Le.message||"Failed to move item";console.error("âŒ Move failed:",Be);const Ze=Be.replace(/<[^>]*>/g,"");ie(Ze,"error","mdi-folder-move-outline")}}catch(h){console.error("âŒ Move error:",h),h.name==="TypeError"&&h.message.includes("fetch")?ie("Network error - could not connect to server","error","mdi-server-network-off"):ie("Failed to move item: "+h.message,"error","mdi-folder-move-outline")}at.value=!1,je.value=null,gt.value=""}},ro=(i,n)=>{console.log("ğŸ“‹ Preview menu action:",i,"for item:",n.name),ee.value=!1,setTimeout(()=>{switch(i){case"rename":_o(n);break;case"move":ko(n);break;case"copy":U(n);break;case"delete":Po(n);break;default:console.warn("Unknown preview menu action:",i)}},100)},Ao=async i=>{const n=i.hash||i.id,t=i.name||M.value?.name||"file";if(!n){ie("Cannot download: No hash available for this version","error","mdi-download-off");return}console.log("ğŸ“¥ Downloading version:",t,"from hash:",n);try{const h=await fetch(`${Me}/ipfs/${n}`);if(!h.ok)throw new Error("Failed to fetch file");const I=await h.blob(),J=window.URL.createObjectURL(I),_e=document.createElement("a");_e.href=J,_e.download=t,document.body.appendChild(_e),_e.click(),document.body.removeChild(_e),window.URL.revokeObjectURL(J),ie(`${t} downloaded successfully`,"success","mdi-download")}catch(h){console.error("Download error:",h),ie(`Failed to download ${t}: ${h.message}`,"error","mdi-download-off")}},Vo=i=>{const n=i.hash||i.id;if(!n){ie("Cannot open: No hash available for this version","error","mdi-open-in-new");return}window.open(`${Me}/ipfs/${n}`,"_blank")},ya=()=>{ut.value="",mt.value=!0},Oo=async()=>{if(ut.value?.trim()){const i=ut.value.trim();if(St.value.find(t=>t.isFolder&&t.name.toLowerCase()===i.toLowerCase())){mt.value=!1,ie(`Folder "${i}" already exists`,"error","mdi-folder-alert",5e3),ut.value="";return}mt.value=!1;try{await aa(i),await j(!1),ie(`Folder "${i}" created successfully`,"success","mdi-folder-plus")}catch(t){console.error("Create folder error:",t),ie(`Failed to create folder "${i}": ${t.message}`,"error","mdi-folder-alert")}ut.value=""}},Po=i=>{he.value=i,me.value=!0},wa=async()=>{if(he.value){const i=he.value.name,n=he.value.isFolder;me.value=!1;try{await na(he.value,!0),await j(!1);const t=Math.ceil(St.value.length/d.value);p.value>t&&t>0&&(p.value=t),ie(`${n?"Folder":"File"} "${i}" deleted successfully`,"success","mdi-delete")}catch(t){console.error("Delete error:",t),ie(`Failed to delete "${i}": ${t.message}`,"error","mdi-delete-alert")}he.value=null}},xa=()=>{me.value=!1,he.value=null};po(()=>{console.log("ğŸ“‚ FileManager mounted"),console.log("ğŸ“‚ hasActiveSubscription:",x.value),console.log("ğŸ“‚ Initial files:",Ee.value),console.log("ğŸ“‚ loading:",et.value),x.value&&Ee.value.length===0&&!et.value?(console.log("ğŸ“‚ Calling loadFiles from FileManager..."),j()):et.value?console.log("ğŸ“‚ Files are already being loaded, skipping loadFiles call"):x.value&&Ee.value.length>0&&console.log("ğŸ“‚ Files already loaded, skipping loadFiles call")}),$a(()=>{console.log("ğŸ“‚ FileManager unmounting, cleaning up intervals and XHR requests"),pt.value.forEach(i=>{clearInterval(i)}),pt.value=[],io?.value?.length>0&&(console.log(`ğŸ“‚ Aborting ${io.value.length} active upload(s)`),io.value.forEach(i=>{try{i.abort()}catch{}}),io.value=[])});const Ot=S(!1),Nt=S(""),ba=()=>{Ot.value=!1,Nt.value=""},_a=async()=>{ce.value=!0;try{console.log("ğŸš« Canceling subscription...");const i=await $e();console.log("âœ… Subscription canceled:",i),Q.value=!1,await checkSubscriptionStatus(),alert(c("components.fluxDrive.fileManager.cancelSubscriptionSuccess"))}catch(i){console.error("âŒ Failed to cancel subscription:",i),alert(c("components.fluxDrive.fileManager.cancelSubscriptionError")+": "+i.message)}finally{ce.value=!1}};T({clearRenewalState:ba});const ka=i=>{console.log("ğŸ”„ FileManager plan selection:",i),Ce.value=!1;const n=Yt(i);let t="upgrade";n==="current"?(t="renew",Ot.value=!0,Nt.value="Renewing your current plan"):n==="renew"?(t="renew",Ot.value=!0,Nt.value="Renewing your expired subscription"):n==="upgrade"?(t="upgrade",Ot.value=!0,Nt.value="Upgrading your plan"):n==="downgrade"?(t="downgrade",Ot.value=!0,Nt.value="Downgrading your plan"):t="signup",console.log("ğŸ” Plan status:",n,"â†’ Action type:",t),u("selectPlan",i,t)};return(i,n)=>(g(),R(Ge,null,[e(ea,null,{default:a(()=>[s("div",ll,[s("div",sl,[s("div",il,[e(k,{icon:"mdi-cloud-outline",size:"28",color:"primary",class:"me-2"}),s("div",null,[s("h1",rl,l(o(c)("components.fluxDrive.fileManager.title")),1),s("div",cl,l(o(c)("components.fluxDrive.fileManager.subtitle")),1)])]),e(Qe),o(x)?(g(),N(B,{key:0,color:"success",variant:"flat",size:"small","prepend-icon":"mdi-cog",onClick:n[0]||(n[0]=t=>Ce.value=!0)},{default:a(()=>[b(l(o(c)("components.fluxDrive.fileManager.manageSubscription")),1)]),_:1})):Z("",!0)]),o(P)&&!o(x)?(g(),N(be,{key:0,color:yt.value<=0?"error":"warning",variant:"tonal",class:"mb-4"},{default:a(()=>[e(Fe,{class:"d-flex align-center pa-3"},{default:a(()=>[e(k,{icon:yt.value<=0?"mdi-alert-circle":yt.value<=7?"mdi-clock-alert":"mdi-check-circle",size:"32",class:"me-3"},null,8,["icon"]),s("div",ul,[s("div",dl,[yt.value<0?(g(),R(Ge,{key:0},[b(l(o(c)("components.fluxDrive.fileManager.subscriptionExpired")),1)],64)):yt.value===0?(g(),R(Ge,{key:1},[b(l(o(c)("components.fluxDrive.fileManager.subscriptionExpiresToday")),1)],64)):yt.value<=7?(g(),R(Ge,{key:2},[b(l(o(c)("components.fluxDrive.fileManager.subscriptionExpiringSoon")),1)],64)):(g(),R(Ge,{key:3},[b(l(o(c)("components.fluxDrive.fileManager.subscriptionActive")),1)],64))]),s("div",pl,l(ra.value),1),yt.value<=0?(g(),R("div",fl,l(o(c)("components.fluxDrive.fileManager.filesDeleteWarning")),1)):Z("",!0)]),yt.value<=0?(g(),N(B,{key:0,color:"error",variant:"flat",size:"small",onClick:n[1]||(n[1]=t=>Ce.value=!0)},{default:a(()=>[b(l(o(c)("components.fluxDrive.fileManager.renewNow")),1)]),_:1})):yt.value<=7?(g(),N(B,{key:1,color:"warning",variant:"flat",size:"small",onClick:n[2]||(n[2]=t=>Ce.value=!0)},{default:a(()=>[b(l(o(c)("components.fluxDrive.fileManager.extend")),1)]),_:1})):Z("",!0)]),_:1})]),_:1},8,["color"])):Z("",!0),o(P)&&o(x)&&ye.value?(g(),N(be,{key:1,variant:"outlined",class:"mb-4"},{default:a(()=>[e(Fe,{class:"pa-3"},{default:a(()=>[s("div",gl,[e(k,{icon:"mdi-information",size:"20",class:"me-1"}),b(" "+l(o(c)("components.fluxDrive.fileManager.manageSubscriptionTitle")),1)]),s("div",ml,l(o(c)("components.fluxDrive.fileManager.manageSubscriptionInfo")),1),s("div",vl,[e(B,{color:"error",variant:"outlined",size:"small",onClick:n[3]||(n[3]=t=>Q.value=!0)},{default:a(()=>[e(k,{icon:"mdi-cancel",class:"me-1",size:"18"}),b(" "+l(o(c)("components.fluxDrive.fileManager.cancelSubscription")),1)]),_:1}),e(B,{color:"primary",variant:"outlined",size:"small",href:"https://crypto.com/settings/subscriptions",target:"_blank",rel:"noopener noreferrer"},{default:a(()=>[e(k,{icon:"mdi-open-in-new",class:"me-1",size:"18"}),b(" "+l(o(c)("components.fluxDrive.fileManager.manageCryptoCom")),1)]),_:1})])]),_:1})]),_:1})):Z("",!0),e(be,{variant:"outlined",class:"pa-3"},{default:a(()=>[s("div",hl,[s("div",yl,[e(to,{modelValue:o(r),"onUpdate:modelValue":n[4]||(n[4]=t=>eo(r)?r.value=t:null),placeholder:o(c)("components.fluxDrive.fileManager.searchPlaceholder"),"prepend-inner-icon":"mdi-magnify",variant:"outlined",density:"compact",clearable:"","hide-details":"",loading:o(vo),disabled:!o(x),onKeyup:co(o(tt),["enter"])},null,8,["modelValue","placeholder","loading","disabled","onKeyup"])]),s("div",wl,[s("div",xl,[e(B,{variant:fe.value==="list"?"flat":"text",color:fe.value==="list"?"primary":void 0,size:"x-small",height:"24",width:"24",class:"view-toggle-btn",onClick:n[5]||(n[5]=t=>fe.value="list")},{default:a(()=>[e(k,{icon:"mdi-view-list",size:"18"}),e(oo,{activator:"parent",location:"bottom"},{default:a(()=>[b(l(o(c)("components.fluxDrive.fileManager.listView")),1)]),_:1})]),_:1},8,["variant","color"]),e(B,{variant:fe.value==="grid"?"flat":"text",color:fe.value==="grid"?"primary":void 0,size:"x-small",height:"24",width:"24",class:"view-toggle-btn",onClick:n[6]||(n[6]=t=>fe.value="grid")},{default:a(()=>[e(k,{icon:"mdi-view-grid",size:"18"}),e(oo,{activator:"parent",location:"bottom"},{default:a(()=>[b(l(o(c)("components.fluxDrive.fileManager.gridView")),1)]),_:1})]),_:1},8,["variant","color"])]),e(B,{color:"primary",variant:"flat",size:"small",height:"32","prepend-icon":"mdi-folder-plus",disabled:!o(x),onClick:ya},{default:a(()=>[b(l(o(c)("components.fluxDrive.fileManager.newFolder")),1)]),_:1},8,["disabled"]),e(jt,{disabled:!o(x)},{activator:a(({props:t})=>[e(B,ao({color:"primary",size:"small",height:"32","prepend-icon":"mdi-upload","append-icon":"mdi-chevron-down",disabled:!o(x)},t),{default:a(()=>[b(l(o(c)("components.fluxDrive.fileManager.upload")),1)]),_:1},16,["disabled"])]),default:a(()=>[e(It,null,{default:a(()=>[e(De,{onClick:n[7]||(n[7]=t=>i.$refs.fileInput?.click())},{prepend:a(()=>[e(k,{icon:"mdi-file-upload",size:"20"})]),default:a(()=>[e(Ae,null,{default:a(()=>[b(l(o(c)("components.fluxDrive.fileManager.uploadFiles")),1)]),_:1})]),_:1}),e(De,{onClick:n[8]||(n[8]=t=>i.$refs.folderInput?.click())},{prepend:a(()=>[e(k,{icon:"mdi-folder-upload",size:"20"})]),default:a(()=>[e(Ae,null,{default:a(()=>[b(l(o(c)("components.fluxDrive.fileManager.uploadFolder")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["disabled"])])])]),_:1})]),e(be,{disabled:!o(x)},{default:a(()=>[e(Fe,{class:"pa-6"},{default:a(()=>[s("input",{ref:"fileInput",type:"file",multiple:"",style:{display:"none"},onChange:Re},null,544),s("input",{ref:"folderInput",type:"file",webkitdirectory:"",multiple:"",style:{display:"none"},onChange:n[9]||(n[9]=(...t)=>o(Zt)&&o(Zt)(...t)),onClick:n[10]||(n[10]=Tt(()=>{},["stop"]))},null,544),s("div",bl,[s("div",_l,[e(B,{icon:"",variant:"text",size:"x-small",onClick:ga,class:"breadcrumb-home"},{default:a(()=>[e(k,{icon:"mdi-home",size:"18",class:"text-medium-emphasis"}),e(oo,{activator:"parent",location:"bottom"},{default:a(()=>[b(l(o(c)("components.fluxDrive.fileManager.goToRoot")),1)]),_:1})]),_:1}),(g(!0),R(Ge,null,Ft(o(w),(t,h)=>(g(),R(Ge,{key:t.path},[h>0||t.path!=="/"?(g(),N(k,{key:0,icon:"mdi-chevron-right",size:"18",class:"mx-1 text-medium-emphasis"})):Z("",!0),t.path!=="/"?(g(),N(B,{key:1,variant:"text",size:"x-small",class:rt(["breadcrumb-item",{"breadcrumb-current":h===o(w).length-1}]),onClick:I=>ma(t)},{default:a(()=>[h===o(w).length-1?(g(),N(k,{key:0,icon:"mdi-folder-open",size:"16",class:"me-1 text-medium-emphasis"})):Z("",!0),s("span",kl,l(t.title),1)]),_:2},1032,["class","onClick"])):Z("",!0)],64))),128))])]),Ot.value?(g(),R("div",Pl,[e(He,{color:"primary",variant:"flat",size:"large",class:"renewal-chip d-flex align-center"},{default:a(()=>[e(k,{icon:"mdi-loading",class:"mr-2 rotating-icon",size:"18"}),b(" "+l(Nt.value),1)]),_:1})])):Z("",!0),i.$route.query.debug?(g(),N(_t,{key:1,type:"info",variant:"tonal",class:"my-4"},{default:a(()=>[s("div",Sl,[s("div",null,[s("strong",null,l(o(c)("components.fluxDrive.fileManager.debugInfo")),1)]),s("div",null,"Files array length: "+l(Ee.value.length),1),s("div",null,"Loading: "+l(o(et)),1),s("div",null,"Current folder: "+l(o(y)),1),s("div",null,"Has active subscription: "+l(o(x)),1),s("div",null,"View type: "+l(fe.value),1),s("div",null,"Files array: "+l(JSON.stringify(Ee.value.slice(0,1),null,2)),1),s("div",null,"Files type: "+l(typeof Ee.value),1),s("div",null,"Files is array: "+l(Array.isArray(Ee.value)),1),s("div",null,"Show loading condition: "+l(o(et)&&Ee.value.length===0),1),s("div",null,"Show empty condition: "+l(!o(et)&&Ee.value.length===0),1),s("div",null,"Show files condition: "+l(!o(et)&&Ee.value.length>0),1),s("div",null,"Show list condition: "+l(fe.value==="list"),1)])]),_:1})):Z("",!0),xt.value?(g(),N(_t,{key:2,type:nt.value,variant:"tonal",density:"compact",class:"my-4 local-message-alert"},{prepend:a(()=>[e(k,{icon:Pt.value},null,8,["icon"])]),default:a(()=>[b(" "+l(xt.value),1)]),_:1},8,["type"])):Z("",!0),o(so)?(g(),N(_t,{key:3,type:o(sa),class:"my-4",closable:"","onClick:close":o(ia)},{default:a(()=>[b(l(o(la)),1)]),_:1},8,["type","onClick:close"])):Z("",!0),o(et)&&Ee.value.length===0&&We.value.length===0?(g(),R("div",Cl,[e(kt,{indeterminate:"",color:"primary",size:40,width:3})])):Z("",!0),i.$route.query.debug?(g(),N(_t,{key:5,type:"info",class:"my-4"},{default:a(()=>[s("div",null,[s("strong",null,l(o(c)("components.fluxDrive.fileManager.displayLogicDebug")),1)]),s("div",null,"loading: "+l(o(et)),1),s("div",null,"files.length: "+l(Ee.value?.length||0),1),s("div",null,"resultMessage: "+l(!!o(Xe)),1),s("div",null,"hasError: "+l(o(so)),1),s("div",null,"Show loading: "+l(o(et)&&Ee.value.length===0),1),s("div",null,"Show empty state: "+l(!o(et)&&(!Ee.value||Ee.value.length===0)&&!o(Xe)&&!o(so)),1),s("div",null,"Show files: "+l(!o(et)&&Ee.value&&Ee.value.length>0),1)]),_:1})):!o(et)&&(!Ee.value||Ee.value.length===0)&&!o(Xe)&&!o(so)?(g(),R("div",{key:6,class:rt(["file-upload-area text-center py-12",{"drag-over":o(m)}]),onDragover:n[12]||(n[12]=Tt(t=>m.value=!0,["prevent"])),onDragleave:n[13]||(n[13]=Tt(t=>m.value=!1,["prevent"])),onDrop:Tt(qe,["prevent"])},[e(k,{icon:o(r).trim()?"mdi-file-search-outline":"mdi-folder-open-outline",size:"80",class:"mb-4 text-medium-emphasis"},null,8,["icon"]),s("h3",Fl,l(o(r).trim()?o(c)("components.fluxDrive.fileManager.noFilesFound"):o(c)("components.fluxDrive.fileManager.folderEmpty")),1),s("p",Dl,l(o(r).trim()?o(c)("components.fluxDrive.fileManager.noFilesMatch",{query:o(r).trim()}):o(c)("components.fluxDrive.fileManager.dropFilesHere")),1),o(r).trim()?Z("",!0):(g(),N(B,{key:0,color:"primary","prepend-icon":"mdi-upload",onClick:n[11]||(n[11]=t=>i.$refs.fileInput?.click())},{default:a(()=>[b(l(o(c)("components.fluxDrive.fileManager.uploadFiles")),1)]),_:1}))],34)):Z("",!0),We.value&&We.value.length>0?(g(),R("div",{class:"mb-4 position-relative",key:`stable-files-${We.value?.length||0}`},[o(et)?(g(),R("div",zl,[e(kt,{indeterminate:"",color:"primary",size:60,width:4})])):Z("",!0),fe.value==="list"?(g(),R("div",$l,[(g(),N(La,{headers:ca.value,items:Uo.value,loading:!1,hover:"",density:"comfortable","item-key":"id",class:"file-list-table","no-data-text":o(c)("components.fluxDrive.fileManager.noFilesOrFolders"),key:`table-${Ee.value.length}`,"hide-default-footer":""},{"item.preview":a(({item:t})=>[s("div",Tl,[t.isFolder&&!t.isGoBack?(g(),N(B,{key:0,icon:"",variant:"text",size:"small",onClick:h=>xo(t)},{default:a(()=>[e(k,{icon:"mdi-folder",size:"24",class:"text-medium-emphasis"})]),_:1},8,["onClick"])):o(ho)(t.mimetype)?(g(),N(B,{key:1,icon:"",variant:"text",size:"small",onClick:h=>Qt(t)},{default:a(()=>[e(k,{icon:o(no)(t.type),size:"24",class:"text-medium-emphasis"},null,8,["icon"])]),_:2},1032,["onClick"])):t.isGoBack?(g(),N(k,{key:2,icon:"mdi-folder-arrow-up",size:"24",class:"text-medium-emphasis"})):(g(),N(k,{key:3,icon:o(no)(t.type),size:"24",class:"text-medium-emphasis"},null,8,["icon"]))])]),"item.name":a(({item:t})=>[s("div",{class:rt(["text-truncate text-no-wrap",{"cursor-pointer":t.isFolder||t.isGoBack}]),style:{"max-width":"300px"},title:t.isGoBack?o(c)("components.fluxDrive.fileManager.goBackToParent"):t.name,onClick:h=>t.isFolder||t.isGoBack?xo(t):null},l(t.name_abbr||t.name),11,Ml)]),"item.timestamp":a(({item:t})=>[s("span",Il,l(t.isGoBack?"-":t.added_date||o(yo)(t.timestamp)),1)]),"item.size":a(({item:t})=>[s("span",Ul,l(t.isFolder?"-":o(lo)(t.size)),1)]),"item.actions":a(({item:t})=>[t.isGoBack?Z("",!0):(g(),N(jt,{key:0},{activator:a(({props:h})=>[e(B,ao({icon:"",size:"small",variant:"text"},h,{class:"text-medium-emphasis"}),{default:a(()=>[e(k,{icon:"mdi-dots-vertical",size:"20",class:"text-medium-emphasis"})]),_:1},16)]),default:a(()=>[e(It,{density:"compact"},{default:a(()=>[t.isFolder?Z("",!0):(g(),R(Ge,{key:0},[e(De,{onClick:h=>Qt(t)},{prepend:a(()=>[e(k,{icon:"mdi-eye",size:"20"})]),default:a(()=>[e(Ae,null,{default:a(()=>[b(l(o(c)("components.fluxDrive.fileManager.preview")),1)]),_:1})]),_:1},8,["onClick"]),e(De,{onClick:h=>bo(t)},{prepend:a(()=>[e(k,{icon:"mdi-download",size:"20"})]),default:a(()=>[e(Ae,null,{default:a(()=>[b(l(o(c)("components.fluxDrive.fileManager.download")),1)]),_:1})]),_:1},8,["onClick"]),t.isFolder?Z("",!0):(g(),N(De,{key:0,onClick:h=>ve(t)},{prepend:a(()=>[e(k,{icon:"mdi-file-plus",size:"20"})]),default:a(()=>[e(Ae,null,{default:a(()=>[b(l(o(c)("components.fluxDrive.fileManager.addVersion")),1)]),_:1})]),_:1},8,["onClick"])),!t.isFolder&&t.versions?.length>0?(g(),N(De,{key:1,onClick:h=>L(t)},{prepend:a(()=>[e(k,{icon:"mdi-history",size:"20"})]),default:a(()=>[e(Ae,null,{default:a(()=>[b(l(o(c)("components.fluxDrive.fileManager.viewVersions")),1)]),_:1})]),_:1},8,["onClick"])):Z("",!0)],64)),t.isGoBack?Z("",!0):(g(),R(Ge,{key:1},[e(De,{onClick:h=>_o(t)},{prepend:a(()=>[e(k,{icon:"mdi-pencil",size:"20"})]),default:a(()=>[e(Ae,null,{default:a(()=>[b(l(o(c)("components.fluxDrive.fileManager.rename")),1)]),_:1})]),_:1},8,["onClick"]),e(De,{onClick:h=>ko(t)},{prepend:a(()=>[e(k,{icon:"mdi-folder-move",size:"20"})]),default:a(()=>[e(Ae,null,{default:a(()=>[b(l(o(c)("components.fluxDrive.fileManager.moveTo")),1)]),_:1})]),_:1},8,["onClick"]),t.isFolder?Z("",!0):(g(),N(De,{key:0,onClick:h=>U(t)},{prepend:a(()=>[e(k,{icon:"mdi-link",size:"20"})]),default:a(()=>[e(Ae,null,{default:a(()=>[b(l(o(c)("components.fluxDrive.fileManager.copyLink")),1)]),_:1})]),_:1},8,["onClick"])),e(De,{onClick:h=>Po(t),class:"text-error"},{prepend:a(()=>[e(k,{icon:"mdi-delete",size:"20",color:"error"})]),default:a(()=>[e(Ae,null,{default:a(()=>[b(l(o(c)("components.fluxDrive.fileManager.delete")),1)]),_:1})]),_:1},8,["onClick"])],64))]),_:2},1024)]),_:2},1024))]),_:1},8,["headers","items","no-data-text"]))])):fe.value==="grid"?(g(),R("div",Rl,[e(zo,null,{default:a(()=>[(g(!0),R(Ge,null,Ft(Uo.value,t=>(g(),N(Ht,{key:t.id,cols:"6",sm:"4",md:"3",lg:"2"},{default:a(()=>[e(be,{elevation:1,class:"text-center pa-3 file-grid-item d-flex flex-column justify-center position-relative",style:{"border-radius":"20px","min-height":"140px"},hover:"",onClick:Tt(h=>t.isFolder||t.isGoBack?xo(t):Qt(t),["stop"]),onContextmenu:Tt(h=>!t.isGoBack&&Xt(h,t),["prevent"]),onTouchstart:h=>!t.isGoBack&&fo(h,t),onTouchend:h=>!t.isGoBack&&mo(h,t),onTouchmove:go},{default:a(()=>[t.isGoBack?Z("",!0):(g(),N(B,{key:0,icon:"mdi-dots-vertical",size:"small",variant:"text",class:"context-menu-btn text-medium-emphasis",style:{position:"absolute",top:"4px",right:"4px","z-index":"1"},onClick:Tt(h=>Xt(h,t),["stop"])},null,8,["onClick"])),s("div",El,[o(ho)(t.mimetype)&&t.thumbnail?(g(),N(Ut,{key:0,src:`${o(Me)}/ipfs/${t.thumbnail}`,width:48,height:48,class:"rounded mx-auto",cover:""},null,8,["src"])):wo(t)&&Vt.value[t.hash]?(g(),N(Ut,{key:1,src:Vt.value[t.hash],width:48,height:48,class:"rounded mx-auto",cover:""},{default:a(()=>[s("div",Ll,[e(k,{icon:"mdi-play-circle",size:"20",color:"white"})])]),_:1},8,["src"])):(g(),N(k,{key:2,icon:t.isGoBack?"mdi-folder-arrow-up":t.isFolder?"mdi-folder":o(no)(t.type),size:48,class:rt([t.isFolder||t.isGoBack?"text-medium-emphasis":""])},null,8,["icon","class"]))]),s("div",{class:"text-caption font-weight-medium text-truncate mb-1 px-1",title:t.name},l(t.name_abbr||t.name),9,Al),!t.isFolder&&!t.isGoBack?(g(),R(Ge,{key:1},[s("div",Vl,l(o(lo)(t.size)),1),s("div",Ol,l(t.added_date||o(yo)(t.timestamp)||"-"),1)],64)):t.isFolder&&!t.isGoBack?(g(),R("div",Nl,l(t.added_date||o(yo)(t.timestamp)||"-"),1)):Z("",!0),!t.isFolder&&!t.isGoBack&&t.versions?.length>0?(g(),R("div",jl,[e(He,{size:"x-small",color:"primary",variant:"flat"},{default:a(()=>[b(l(t.versions.length),1)]),_:2},1024)])):Z("",!0)]),_:2},1032,["onClick","onContextmenu","onTouchstart","onTouchend"])]),_:2},1024))),128))]),_:1})])):Z("",!0),We.value.length>5?(g(),R("div",Bl,[We.value.length>o(d)?(g(),R("div",Gl,[e(He,{variant:"tonal",size:"small",class:"text-caption pagination-info-chip",color:"success"},{default:a(()=>[e(k,{icon:"mdi-file-multiple-outline",size:"14",class:"me-1"}),b(" "+l(o(c)("components.fluxDrive.fileManager.paginationInfo",{start:(o(p)-1)*o(d)+1,end:Math.min(o(p)*o(d),We.value.length),total:We.value.length})),1)]),_:1}),s("div",Hl,[e(B,{icon:"",variant:"flat",size:"28",class:"pagination-circle",disabled:o(p)===1,onClick:n[14]||(n[14]=t=>p.value--)},{default:a(()=>[e(k,{icon:"mdi-chevron-left"})]),_:1},8,["disabled"]),s("div",ql,[(g(!0),R(Ge,null,Ft(ua.value,t=>(g(),R(Ge,{key:t},[t!=="..."?(g(),N(B,{key:0,variant:o(p)===t?"tonal":"text",color:o(p)===t?"primary":"",size:"28",class:rt(["pagination-circle",{active:o(p)===t}]),onClick:h=>p.value=t},{default:a(()=>[b(l(t),1)]),_:2},1032,["variant","color","class","onClick"])):(g(),R("div",Jl,[e(k,{icon:"mdi-dots-horizontal",size:"20",class:"text-medium-emphasis"})]))],64))),128))]),e(B,{icon:"",variant:"flat",size:"28",class:"pagination-circle",disabled:o(p)===Math.ceil(We.value.length/o(d)),onClick:n[15]||(n[15]=t=>p.value++)},{default:a(()=>[e(k,{icon:"mdi-chevron-right"})]),_:1},8,["disabled"])]),s("div",Xl,[e(k,{icon:"mdi-format-list-numbered",size:"16",class:"text-medium-emphasis me-2"}),e(jo,{modelValue:o(d),"onUpdate:modelValue":[n[16]||(n[16]=t=>eo(d)?d.value=t:null),n[17]||(n[17]=t=>p.value=1)],items:[5,10,25,50,100],variant:"solo",density:"compact",class:"pagination-selector","hide-details":""},{selection:a(({item:t})=>[s("span",Wl,l(t.value),1)]),_:1},8,["modelValue"])])])):(g(),R("div",Yl,[s("div",Zl,[e(k,{icon:"mdi-format-list-numbered",size:"16",class:"text-medium-emphasis me-2"}),e(jo,{modelValue:o(d),"onUpdate:modelValue":[n[18]||(n[18]=t=>eo(d)?d.value=t:null),n[19]||(n[19]=t=>p.value=1)],items:[5,10,25,50,100],variant:"solo",density:"compact",class:"pagination-selector","hide-details":""},{selection:a(({item:t})=>[s("span",Kl,l(t.value),1)]),_:1},8,["modelValue"])])]))])):Z("",!0)])):Z("",!0)]),_:1})]),_:1},8,["disabled"]),e(ot,{modelValue:o(ee),"onUpdate:modelValue":n[26]||(n[26]=t=>eo(ee)?ee.value=t:null),fullscreen:"",transition:"dialog-bottom-transition","content-class":"elevation-10 preview-dialog"},{default:a(()=>[o(re)?(g(),N(be,{key:0,class:"preview-card d-flex flex-column",style:{height:"100vh"}},{default:a(()=>[s("div",Ql,[e(B,{icon:"mdi-close",variant:"text",color:"grey",onClick:o(Kt)},null,8,["onClick"]),s("div",es,[s("span",ts,l(o(re).name),1)]),s("div",os,[o(Mo)(o(re).mimetype,o(re).name)?(g(),N(B,{key:0,icon:"mdi-pencil",variant:"text",color:"grey",onClick:n[20]||(n[20]=t=>Ro(o(re)))},{default:a(()=>[e(k,{icon:"mdi-pencil"}),e(oo,{activator:"parent",location:"bottom"},{default:a(()=>[b(l(o(c)("components.fluxDrive.fileManager.edit")),1)]),_:1})]),_:1})):Z("",!0),e(B,{icon:"mdi-download",variant:"text",color:"grey",onClick:n[21]||(n[21]=t=>bo(o(re)))},{default:a(()=>[e(k,{icon:"mdi-download"}),e(oo,{activator:"parent",location:"bottom"},{default:a(()=>[b(l(o(c)("components.fluxDrive.fileManager.download")),1)]),_:1})]),_:1}),e(jt,null,{activator:a(({props:t})=>[e(B,ao({icon:"mdi-dots-vertical",variant:"text",color:"grey"},t),{default:a(()=>[e(k,{icon:"mdi-dots-vertical"})]),_:1},16)]),default:a(()=>[e(It,{density:"compact"},{default:a(()=>[e(De,{onClick:n[22]||(n[22]=t=>ro("rename",o(re)))},{prepend:a(()=>[e(k,{icon:"mdi-pencil",size:"20"})]),default:a(()=>[e(Ae,null,{default:a(()=>[b(l(o(c)("components.fluxDrive.fileManager.rename")),1)]),_:1})]),_:1}),e(De,{onClick:n[23]||(n[23]=t=>ro("move",o(re)))},{prepend:a(()=>[e(k,{icon:"mdi-folder-move",size:"20"})]),default:a(()=>[e(Ae,null,{default:a(()=>[b(l(o(c)("components.fluxDrive.fileManager.moveTo")),1)]),_:1})]),_:1}),o(re)?.isFolder?Z("",!0):(g(),N(De,{key:0,onClick:n[24]||(n[24]=t=>ro("copy",o(re)))},{prepend:a(()=>[e(k,{icon:"mdi-link",size:"20"})]),default:a(()=>[e(Ae,null,{default:a(()=>[b(l(o(c)("components.fluxDrive.fileManager.copyLink")),1)]),_:1})]),_:1})),e(De,{onClick:n[25]||(n[25]=t=>ro("delete",o(re))),class:"text-error"},{prepend:a(()=>[e(k,{icon:"mdi-delete",size:"20",color:"error"})]),default:a(()=>[e(Ae,null,{default:a(()=>[b(l(o(c)("components.fluxDrive.fileManager.delete")),1)]),_:1})]),_:1})]),_:1})]),_:1})])]),e(Fo),e(Fe,{class:"preview-content pa-0 flex-grow-1 d-flex flex-column"},{default:a(()=>[o(ho)(o(re).mimetype)?(g(),R("div",as,[e(Ut,{src:`${o(Me)}/ipfs/${o(re).hash}`,contain:"",alt:o(re).name,style:{width:"100%",height:"100%"}},null,8,["src","alt"])])):wo(o(re))?(g(),R("div",ns,[s("video",{src:`${o(Me)}/ipfs/${o(re).hash}`,controls:"",autoplay:"",style:{width:"100%",height:"100%","object-fit":"contain"},poster:o(re).thumbnail},l(o(c)("components.fluxDrive.fileManager.browserNoVideoSupport")),9,ls)])):fa(o(re))?(g(),R("div",ss,[s("div",is,[e(k,{icon:"mdi-music-note",size:"64",class:"mb-4 text-medium-emphasis"}),s("audio",{src:`${o(Me)}/ipfs/${o(re).hash}`,controls:"",autoplay:"",style:{width:"300px",display:"block"}},l(o(c)("components.fluxDrive.fileManager.browserNoAudioSupport")),9,rs)])])):pa(o(re))?(g(),R("div",cs,[s("iframe",{src:`${o(Me)}/ipfs/${o(re).hash}`,style:{width:"100%",height:"100%",border:"none"},type:"application/pdf"},null,8,us)])):(g(),R("div",ds,[s("div",ps,[e(k,{icon:o(no)(o(re).type),size:"64",class:"mb-4 text-medium-emphasis"},null,8,["icon"]),s("p",fs,l(o(c)("components.fluxDrive.fileManager.previewNotAvailable")),1),e(B,{color:"primary",variant:"flat",class:"mt-4",href:`${o(Me)}/ipfs/${o(re).hash}`,target:"_blank",rel:"noopener noreferrer","prepend-icon":"mdi-download"},{default:a(()=>[b(l(o(c)("components.fluxDrive.fileManager.downloadFile")),1)]),_:1},8,["href"])])]))]),_:1})]),_:1})):Z("",!0)]),_:1},8,["modelValue"]),e(ot,{modelValue:o(Y),"onUpdate:modelValue":n[27]||(n[27]=t=>eo(Y)?Y.value=t:null),persistent:"","max-width":"420",attach:""},{default:a(()=>[e(be,{class:"modern-upload-card",elevation:"24"},{default:a(()=>[e(Fe,{class:"pa-8"},{default:a(()=>[s("div",gs,[s("div",ms,[e(k,{icon:"mdi-cloud-upload",size:"48",color:"primary",class:"upload-icon"}),e(kt,{indeterminate:"",size:"72",width:"3",color:"primary",class:"upload-spinner"})]),s("div",vs,[s("h3",hs,l(W.value>1?o(c)("components.fluxDrive.fileManager.uploadingFiles",{current:E.value+1,total:W.value}):o(c)("components.fluxDrive.fileManager.uploadingFile")),1),s("p",ys,l(Ue.value||o(c)("components.fluxDrive.fileManager.uploadWait")),1),pe.value>0?(g(),R("p",ws,l(H(pe.value)),1)):Z("",!0)]),s("div",xs,[e(uo,{"model-value":xe.value,color:"primary",height:"6",rounded:"",class:"mb-3","bg-color":"surface-variant"},null,8,["model-value"]),s("div",bs,[s("span",_s,[b(l(o(c)("components.fluxDrive.fileManager.uploadProgress",{progress:xe.value}))+" ",1),W.value>1?(g(),R("span",ks," â€¢ "+l(o(c)("components.fluxDrive.fileManager.fileOfTotal",{current:E.value+1,total:W.value})),1)):Z("",!0)])])])])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(ot,{modelValue:ne.value,"onUpdate:modelValue":n[28]||(n[28]=t=>ne.value=t),persistent:"","max-width":"400",attach:""},{default:a(()=>[e(be,null,{default:a(()=>[e(Fe,{class:"text-center pa-8"},{default:a(()=>[e(kt,{indeterminate:"",size:"64",width:"4",color:"success",class:"mb-4"}),s("h3",Ps,l(o(c)("components.fluxDrive.fileManager.downloading")),1),s("p",Ss,l(Ie.value),1),e(uo,{"model-value":v.value,color:"success",height:"8",rounded:"",class:"mb-2"},null,8,["model-value"]),s("p",Cs,l(o(c)("components.fluxDrive.fileManager.downloadProgress",{progress:v.value})),1)]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(ot,{modelValue:me.value,"onUpdate:modelValue":n[29]||(n[29]=t=>me.value=t),"max-width":"400",attach:""},{default:a(()=>[e(be,null,{default:a(()=>[e(it,{class:"d-flex align-center px-3 py-1 bg-primary text-white"},{default:a(()=>[e(k,{icon:"mdi-delete",class:"me-3",style:{color:"rgba(255,255,255,0.9)"}}),s("h3",Fs,l(o(c)("components.fluxDrive.fileManager.confirmDelete")),1)]),_:1}),e(Fe,{class:"pa-6 pt-4"},{default:a(()=>[s("p",Ds,l(o(c)("components.fluxDrive.fileManager.confirmDeleteMessage",{type:he.value?.isFolder?o(c)("components.fluxDrive.fileManager.folder"):o(c)("components.fluxDrive.fileManager.file")})),1),e(be,{variant:"outlined",class:"pa-3 bg-grey-lighten-4",density:"compact"},{default:a(()=>[s("div",zs,[e(k,{icon:he.value?.isFolder?"mdi-folder":"mdi-file-document",class:"me-2",color:he.value?.isFolder?"amber":"blue"},null,8,["icon","color"]),s("span",$s,l(he.value?.name),1)])]),_:1})]),_:1}),e(Mt,{class:"pa-6 pt-0"},{default:a(()=>[e(Qe),e(B,{variant:"flat",color:"primary",density:"compact",class:"text-caption",onClick:xa},{default:a(()=>[b(l(o(c)("components.fluxDrive.fileManager.cancel")),1)]),_:1}),e(B,{variant:"flat",color:"error",density:"compact",class:"text-caption",onClick:wa},{default:a(()=>[b(l(o(c)("components.fluxDrive.fileManager.delete")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(ot,{modelValue:Q.value,"onUpdate:modelValue":n[31]||(n[31]=t=>Q.value=t),"max-width":"500",attach:""},{default:a(()=>[e(be,null,{default:a(()=>[e(it,{class:"d-flex align-center px-4 py-3 bg-error text-white"},{default:a(()=>[e(k,{icon:"mdi-alert",class:"me-3",size:"28",style:{color:"rgba(255,255,255,0.9)"}}),s("h3",Ts,l(o(c)("components.fluxDrive.fileManager.cancelSubscriptionTitle")),1)]),_:1}),e(Fe,{class:"pa-6 pt-4"},{default:a(()=>[s("p",Ms,l(o(c)("components.fluxDrive.fileManager.cancelSubscriptionMessage")),1),e(_t,{type:"info",variant:"tonal",density:"compact"},{default:a(()=>[s("div",Is,l(o(c)("components.fluxDrive.fileManager.cancelSubscriptionNote")),1)]),_:1})]),_:1}),e(Mt,{class:"pa-6 pt-0"},{default:a(()=>[e(Qe),e(B,{variant:"flat",color:"primary",size:"default",disabled:ce.value,onClick:n[30]||(n[30]=t=>Q.value=!1)},{default:a(()=>[b(l(o(c)("components.fluxDrive.fileManager.cancelSubscriptionCancel")),1)]),_:1},8,["disabled"]),e(B,{variant:"flat",color:"error",size:"default",loading:ce.value,onClick:_a},{default:a(()=>[b(l(o(c)("components.fluxDrive.fileManager.cancelSubscriptionConfirm")),1)]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(ot,{modelValue:Ce.value,"onUpdate:modelValue":n[34]||(n[34]=t=>Ce.value=t),"max-width":"900",scrollable:"",attach:""},{default:a(()=>[e(be,null,{default:a(()=>[e(it,{class:"d-flex align-center px-4 py-2 bg-primary text-white"},{default:a(()=>[e(k,{icon:"mdi-rocket-launch",class:"me-2",size:"24",style:{color:"rgba(255,255,255,0.9)"}}),s("h3",Us,l(o(c)("components.fluxDrive.fileManager.manageSubscription")),1),e(Qe),e(B,{icon:"mdi-close",variant:"text",color:"white",onClick:n[32]||(n[32]=t=>Ce.value=!1)})]),_:1}),e(Fe,{class:"pa-6 pt-0"},{default:a(()=>[e(ta,{onSelectPlan:ka,onCancelSubscription:n[33]||(n[33]=t=>{Q.value=!0,Ce.value=!1})})]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(ot,{modelValue:$.value,"onUpdate:modelValue":n[39]||(n[39]=t=>$.value=t),"max-width":"500",persistent:"",attach:""},{default:a(()=>[e(be,null,{default:a(()=>[e(it,{class:"d-flex align-center px-3 py-1 bg-primary text-white"},{default:a(()=>[e(k,{icon:"mdi-rename-box",class:"me-2",style:{color:"rgba(255,255,255,0.9)"}}),s("h3",Rs,l(o(c)("components.fluxDrive.fileManager.renameItem",{type:le.value?.isFolder?o(c)("components.fluxDrive.fileManager.folder"):o(c)("components.fluxDrive.fileManager.file")})),1),e(Qe),e(B,{icon:"mdi-close",variant:"text",color:"white",onClick:n[35]||(n[35]=t=>$.value=!1)})]),_:1}),e(Fe,{class:"pa-6 pt-4"},{default:a(()=>[e(to,{modelValue:oe.value,"onUpdate:modelValue":n[36]||(n[36]=t=>oe.value=t),label:o(c)("components.fluxDrive.fileManager.newName"),variant:"outlined",density:"compact",autofocus:"",error:!ct.value.isValid&&!!oe.value?.trim(),"error-messages":!ct.value.isValid&&oe.value?.trim()?ct.value.hint:"",onKeyup:n[37]||(n[37]=co(t=>ct.value.isValid?Eo():null,["enter"]))},null,8,["modelValue","label","error","error-messages"])]),_:1}),e(Mt,{class:"pa-6 pt-0"},{default:a(()=>[e(Qe),e(B,{variant:"flat",color:"error",density:"compact",class:"text-caption",onClick:n[38]||(n[38]=t=>$.value=!1)},{default:a(()=>[b(l(o(c)("components.fluxDrive.fileManager.cancel")),1)]),_:1}),e(B,{variant:"flat",color:"primary",density:"compact",class:"text-caption",disabled:!ct.value.isValid,onClick:Eo},{default:a(()=>[b(l(o(c)("components.fluxDrive.fileManager.rename")),1)]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(ot,{modelValue:at.value,"onUpdate:modelValue":n[43]||(n[43]=t=>at.value=t),"max-width":"500",persistent:""},{default:a(()=>[e(be,null,{default:a(()=>[e(it,{class:"d-flex align-center px-3 py-1 bg-primary text-white"},{default:a(()=>[e(k,{icon:"mdi-folder-move",class:"me-2",style:{color:"rgba(255,255,255,0.9)"}}),s("h3",Es,l(o(c)("components.fluxDrive.fileManager.moveItem",{type:je.value?.isFolder?o(c)("components.fluxDrive.fileManager.folder"):o(c)("components.fluxDrive.fileManager.file")})),1),e(Qe),e(B,{icon:"mdi-close",variant:"text",color:"white",onClick:n[40]||(n[40]=t=>at.value=!1)})]),_:1}),e(Fe,{class:"pa-6 pt-4"},{default:a(()=>[e(be,{variant:"outlined",class:"pa-3 bg-grey-lighten-4 mb-4",density:"compact"},{default:a(()=>[s("div",Ls,[e(k,{icon:je.value?.isFolder?"mdi-folder":"mdi-file-document",class:"me-2",color:je.value?.isFolder?"amber":"blue"},null,8,["icon","color"]),s("span",As,l(je.value?.name),1)])]),_:1}),e(to,{modelValue:gt.value,"onUpdate:modelValue":n[41]||(n[41]=t=>gt.value=t),label:o(c)("components.fluxDrive.fileManager.destinationFolder"),placeholder:o(c)("components.fluxDrive.fileManager.destinationPlaceholder"),variant:"outlined",density:"compact",autofocus:"",onKeyup:co(Lo,["enter"])},null,8,["modelValue","label","placeholder"])]),_:1}),e(Mt,{class:"pa-6 pt-0"},{default:a(()=>[e(Qe),e(B,{variant:"flat",color:"error",density:"compact",class:"text-caption",onClick:n[42]||(n[42]=t=>at.value=!1)},{default:a(()=>[b(l(o(c)("components.fluxDrive.fileManager.cancel")),1)]),_:1}),e(B,{variant:"flat",color:"primary",density:"compact",class:"text-caption",onClick:Lo},{default:a(()=>[b(l(o(c)("components.fluxDrive.fileManager.move")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(ot,{modelValue:K.value,"onUpdate:modelValue":n[48]||(n[48]=t=>K.value=t),"max-width":"800",persistent:"",scrollable:""},{default:a(()=>[e(be,null,{default:a(()=>[e(it,{class:"d-flex align-center px-3 py-1 bg-primary text-white"},{default:a(()=>[e(k,{icon:"mdi-history",class:"me-2",style:{color:"rgba(255,255,255,0.9)"}}),s("h3",Vs,l(o(c)("components.fluxDrive.fileManager.fileVersionsTitle",{name:M.value?.name})),1),e(Qe),e(B,{icon:"mdi-close",variant:"text",color:"white",onClick:n[44]||(n[44]=t=>K.value=!1)})]),_:1}),e(Fe,{class:"pa-6 pt-0"},{default:a(()=>[M.value?.versions?.length>0?(g(),R("div",Os,[s("p",Ns,l(o(c)("components.fluxDrive.fileManager.fileVersionsDescription",{count:M.value.versions.length})),1),e(It,null,{default:a(()=>[e(De,null,{prepend:a(()=>[e(k,{icon:"mdi-star",color:"primary"})]),append:a(()=>[e(B,{icon:"mdi-download",size:"small",variant:"text",onClick:n[45]||(n[45]=t=>Ao(M.value))}),e(B,{icon:"mdi-open-in-new",size:"small",variant:"text",onClick:n[46]||(n[46]=t=>Vo(M.value))})]),default:a(()=>[e(Ae,null,{default:a(()=>[b(l(o(c)("components.fluxDrive.fileManager.currentVersion"))+" ",1),e(He,{size:"x-small",color:"success",class:"ml-2"},{default:a(()=>[b(l(o(c)("components.fluxDrive.fileManager.latest")),1)]),_:1})]),_:1}),e(Bo,null,{default:a(()=>[b(" Size: "+l(o(lo)(M.value.size))+" â€¢ Hash: "+l(M.value.hash_abbr),1)]),_:1})]),_:1}),e(Fo,{class:"my-2"}),(g(!0),R(Ge,null,Ft(M.value.versions,(t,h)=>(g(),N(De,{key:t.hash||h},{prepend:a(()=>[e(k,{icon:"mdi-clock-outline"})]),append:a(()=>[e(B,{icon:"mdi-download",size:"small",variant:"text",onClick:I=>Ao(t)},null,8,["onClick"]),e(B,{icon:"mdi-open-in-new",size:"small",variant:"text",onClick:I=>Vo(t)},null,8,["onClick"])]),default:a(()=>[e(Ae,null,{default:a(()=>[b(l(o(c)("components.fluxDrive.fileManager.versionNumber",{number:M.value.versions.length-h})),1)]),_:2},1024),e(Bo,null,{default:a(()=>[b(" Size: "+l(o(lo)(t.size||0))+" â€¢ Hash: "+l(t.hash?.substring(0,8))+"... ",1),t.timestamp?(g(),R("span",js," â€¢ "+l(new Date(t.timestamp*1e3).toLocaleString()),1)):Z("",!0)]),_:2},1024)]),_:2},1024))),128))]),_:1})])):(g(),R("div",Bs,[s("p",Gs,l(o(c)("components.fluxDrive.fileManager.noPreviousVersions")),1)]))]),_:1}),e(Mt,{class:"pa-6 pt-0"},{default:a(()=>[e(Qe),e(B,{variant:"flat",color:"error",density:"compact",class:"text-caption",onClick:n[47]||(n[47]=t=>K.value=!1)},{default:a(()=>[b(l(o(c)("components.fluxDrive.fileManager.close")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(ot,{modelValue:mt.value,"onUpdate:modelValue":n[52]||(n[52]=t=>mt.value=t),"max-width":"500",persistent:""},{default:a(()=>[e(be,null,{default:a(()=>[e(it,{class:"d-flex align-center px-3 py-1 bg-primary text-white"},{default:a(()=>[e(k,{icon:"mdi-folder-plus",class:"me-2",style:{color:"rgba(255,255,255,0.9)"}}),s("h3",Hs,l(o(c)("components.fluxDrive.fileManager.createNewFolder")),1),e(Qe),e(B,{icon:"mdi-close",variant:"text",color:"white",onClick:n[49]||(n[49]=t=>mt.value=!1)})]),_:1}),e(Fe,{class:"pa-6 pt-4"},{default:a(()=>[e(to,{modelValue:ut.value,"onUpdate:modelValue":n[50]||(n[50]=t=>ut.value=t),label:o(c)("components.fluxDrive.fileManager.folderName"),variant:"outlined",density:"compact",autofocus:"",onKeyup:co(Oo,["enter"])},null,8,["modelValue","label"])]),_:1}),e(Mt,{class:"pa-6 pt-0"},{default:a(()=>[e(Qe),e(B,{variant:"flat",color:"error",density:"compact",class:"text-caption",onClick:n[51]||(n[51]=t=>mt.value=!1)},{default:a(()=>[b(l(o(c)("components.fluxDrive.fileManager.cancel")),1)]),_:1}),e(B,{variant:"flat",color:"primary",density:"compact",class:"text-caption",disabled:!ut.value?.trim(),onClick:Oo},{default:a(()=>[b(l(o(c)("components.fluxDrive.fileManager.createFolder")),1)]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(jt,{modelValue:vt.value,"onUpdate:modelValue":n[61]||(n[61]=t=>vt.value=t),style:Gt({position:"fixed",left:Jt.value+"px",top:At.value+"px"}),absolute:"","offset-y":""},{default:a(()=>[st.value?(g(),N(It,{key:0,density:"compact"},{default:a(()=>[st.value.isFolder?Z("",!0):(g(),R(Ge,{key:0},[e(De,{onClick:n[53]||(n[53]=t=>Je("preview"))},{prepend:a(()=>[e(k,{icon:"mdi-eye",size:"20"})]),default:a(()=>[e(Ae,null,{default:a(()=>[...n[73]||(n[73]=[b("Preview",-1)])]),_:1})]),_:1}),e(De,{onClick:n[54]||(n[54]=t=>Je("download"))},{prepend:a(()=>[e(k,{icon:"mdi-download",size:"20"})]),default:a(()=>[e(Ae,null,{default:a(()=>[b(l(o(c)("components.fluxDrive.fileManager.download")),1)]),_:1})]),_:1}),e(De,{onClick:n[55]||(n[55]=t=>Je("addVersion"))},{prepend:a(()=>[e(k,{icon:"mdi-file-plus",size:"20"})]),default:a(()=>[e(Ae,null,{default:a(()=>[b(l(o(c)("components.fluxDrive.fileManager.addVersion")),1)]),_:1})]),_:1}),st.value.versions?.length>0?(g(),N(De,{key:0,onClick:n[56]||(n[56]=t=>Je("versions"))},{prepend:a(()=>[e(k,{icon:"mdi-history",size:"20"})]),default:a(()=>[e(Ae,null,{default:a(()=>[b(l(o(c)("components.fluxDrive.fileManager.viewVersions")),1)]),_:1})]),_:1})):Z("",!0)],64)),e(De,{onClick:n[57]||(n[57]=t=>Je("rename"))},{prepend:a(()=>[e(k,{icon:"mdi-pencil",size:"20"})]),default:a(()=>[e(Ae,null,{default:a(()=>[b(l(o(c)("components.fluxDrive.fileManager.rename")),1)]),_:1})]),_:1}),e(De,{onClick:n[58]||(n[58]=t=>Je("move"))},{prepend:a(()=>[e(k,{icon:"mdi-folder-move",size:"20"})]),default:a(()=>[e(Ae,null,{default:a(()=>[b(l(o(c)("components.fluxDrive.fileManager.moveTo")),1)]),_:1})]),_:1}),st.value.isFolder?Z("",!0):(g(),N(De,{key:1,onClick:n[59]||(n[59]=t=>Je("copy"))},{prepend:a(()=>[e(k,{icon:"mdi-link",size:"20"})]),default:a(()=>[e(Ae,null,{default:a(()=>[b(l(o(c)("components.fluxDrive.fileManager.copyLink")),1)]),_:1})]),_:1})),e(De,{onClick:n[60]||(n[60]=t=>Je("delete")),class:"text-error"},{prepend:a(()=>[e(k,{icon:"mdi-delete",size:"20",color:"error"})]),default:a(()=>[e(Ae,null,{default:a(()=>[b(l(o(c)("components.fluxDrive.fileManager.delete")),1)]),_:1})]),_:1})]),_:1})):Z("",!0)]),_:1},8,["modelValue","style"]),e(nl,{modelValue:K.value,"onUpdate:modelValue":n[62]||(n[62]=t=>K.value=t),file:M.value,onShowMessage:f,onPreviewFile:_},null,8,["modelValue","file"]),e(ot,{modelValue:F.value,"onUpdate:modelValue":n[66]||(n[66]=t=>F.value=t),"max-width":"600",persistent:""},{default:a(()=>[e(be,null,{default:a(()=>[e(it,{class:"d-flex align-center px-3 py-1 bg-primary text-white"},{default:a(()=>[e(k,{icon:"mdi-plus-circle",class:"me-2",style:{color:"rgba(255,255,255,0.9)"}}),s("h3",qs,l(o(c)("components.fluxDrive.fileManager.addVersion")),1),e(Qe),e(B,{icon:"mdi-close",variant:"text",color:"white",onClick:n[63]||(n[63]=t=>F.value=!1)})]),_:1}),e(Fe,{class:"pa-4"},{default:a(()=>[e(Aa,{ref:"versionFileInput",label:o(c)("components.fluxDrive.fileManager.selectFileToUpload"),accept:"*/*","prepend-icon":"mdi-file-upload",class:"no-wrap-filename",onChange:A},Ta({_:2},[ae.value?{name:"append-inner",fn:a(()=>[e(He,{size:"small",color:"surface-variant",variant:"tonal",class:"ml-2"},{default:a(()=>[b(l(H(ae.value.size)),1)]),_:1})]),key:"0"}:void 0]),1032,["label"]),e(to,{modelValue:te.value,"onUpdate:modelValue":n[64]||(n[64]=t=>te.value=t),label:o(c)("components.fluxDrive.fileManager.versionComment"),placeholder:o(c)("components.fluxDrive.fileManager.versionCommentPlaceholder"),"prepend-icon":"mdi-comment-text",counter:100,rules:[t=>!t||t.length<=100||o(c)("components.fluxDrive.fileManager.commentValidation")],class:"mt-4"},null,8,["modelValue","label","placeholder","rules"]),s("div",Js,l(o(c)("components.fluxDrive.fileManager.addVersionDescription",{fileName:O.value?.name})),1)]),_:1}),e(Mt,{class:"pa-4"},{default:a(()=>[e(Qe),e(B,{variant:"flat",color:"error",size:"small",onClick:n[65]||(n[65]=t=>F.value=!1)},{default:a(()=>[b(l(o(c)("components.fluxDrive.fileManager.cancel")),1)]),_:1}),e(B,{color:"primary",variant:"flat",size:"small",loading:o(Y),disabled:!ae.value,onClick:Se},{default:a(()=>[e(k,{icon:"mdi-upload",class:"mr-2"}),b(" "+l(o(c)("components.fluxDrive.fileManager.addVersion")),1)]),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(ot,{modelValue:we.value,"onUpdate:modelValue":n[71]||(n[71]=t=>we.value=t),fullscreen:"",transition:"dialog-bottom-transition"},{default:a(()=>[e(be,null,{default:a(()=>[e(Va,{color:"primary",dark:"",density:"compact"},{default:a(()=>[e(B,{icon:"",size:"small",onClick:n[67]||(n[67]=t=>we.value=!1)},{default:a(()=>[e(k,null,{default:a(()=>[...n[74]||(n[74]=[b("mdi-close",-1)])]),_:1})]),_:1}),e(Oa,{class:"text-subtitle-1"},{default:a(()=>[s("div",Xs,[e(k,{icon:"mdi-file-edit",size:"20",class:"me-2"}),b(" "+l(ue.value?.name||"Edit File"),1)])]),_:1}),e(Qe),e(B,{variant:"flat",color:"error",size:"small",class:"me-2",onClick:n[68]||(n[68]=t=>we.value=!1)},{default:a(()=>[e(k,{icon:"mdi-close",size:"18",class:"me-1"}),n[75]||(n[75]=b(" Cancel ",-1))]),_:1}),e(B,{variant:"flat",color:"success",size:"small",class:"me-4",loading:Pe.value,disabled:!Oe.value||Ye.value,onClick:ha},{default:a(()=>[e(k,{icon:"mdi-content-save",size:"18",class:"me-1"}),n[76]||(n[76]=b(" Save ",-1))]),_:1},8,["loading","disabled"])]),_:1}),e(Fe,{class:"pa-0",style:{height:"calc(100vh - 48px)",position:"relative"}},{default:a(()=>[e(o(se),{value:X.value,"onUpdate:value":n[69]||(n[69]=t=>X.value=t),language:va(ue.value?.name),theme:"vs-dark",options:{automaticLayout:!0,fontSize:14,fontFamily:"Courier New, Courier, monospace",lineHeight:19,minimap:{enabled:!0},scrollBeyondLastLine:!1,wordWrap:"on",tabSize:2,disableMonospaceOptimizations:!0,fontLigatures:!1,scrollbar:{horizontal:"visible",vertical:"visible"}},style:{height:"100%"},onMount:n[70]||(n[70]=t=>Ke.value=!0)},null,8,["value","language"]),Ma(s("div",Ws,[e(Qo,{icon:"mdi-file-document-edit","icon-size":50,title:o(c)("components.fluxDrive.fileManager.loadingFileContent"),message:""},null,8,["title"])],512),[[Ua,Ye.value||!Ke.value]])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(Na,{modelValue:zt.value,"onUpdate:modelValue":n[72]||(n[72]=t=>zt.value=t),color:Et.value,timeout:wt.value,location:"top center",style:{zIndex:1e4}},{default:a(()=>[s("div",Ys,[e(k,{icon:Lt.value,class:"me-2"},null,8,["icon"]),b(" "+l(ft.value),1)])]),_:1},8,["modelValue","color","timeout"])],64))}},Ks=Rt(Zs,[["__scopeId","data-v-3b2d1dfd"]]),Qs={class:"d-flex align-center justify-space-between mb-3"},ei={class:"text-h6"},ti={class:"text-center"},oi={class:"text-body-2"},ai={class:"text-body-2 text-medium-emphasis"},ni={class:"text-body-2 text-medium-emphasis"},li={class:"text-h6 text-primary"},si={class:"text-body-2 text-medium-emphasis"},ii={class:"text-h6 text-success"},ri={class:"text-body-2 text-medium-emphasis"},ci={class:"text-h6"},ui={__name:"StorageInfo",setup(G){const{t:T}=Dt(),{loadingStorage:Ve,usedStorage:u,totalStorage:se,storagePercentage:c,hasActiveSubscription:fe,bytesConversion:z,convertSize:$e,fetchStorageInfo:ye}=qt();return po(()=>{!fe.value||!c.value?(console.log("ğŸ“Š StorageInfo component: fetchStorageInfo may be needed"),ye()):console.log("ğŸ“Š StorageInfo component: storage info already available, skipping fetch")}),(Ce,ne)=>(g(),N(ea,null,{default:a(()=>[e(be,{variant:"outlined",class:"mt-2"},{default:a(()=>[e(Fe,null,{default:a(()=>[s("div",Qs,[s("h4",ei,l(o(T)("components.fluxDrive.storageInfo.title")),1),o(Ve)?(g(),N(kt,{key:0,indeterminate:"",size:"20",width:"2"})):Z("",!0)]),e(uo,{"model-value":o(c),color:"primary",height:"8",rounded:"",class:"mb-3"},null,8,["model-value"]),s("div",ti,[s("span",oi,l(o(T)("components.fluxDrive.storageInfo.usedOf",{used:o(z)(o(u)),total:o($e)(o(se))})),1),s("span",ai," ("+l(o(c))+"%) ",1)]),e(zo,{class:"mt-4","no-gutters":""},{default:a(()=>[e(Ht,{cols:"4",class:"text-center"},{default:a(()=>[s("div",ni,l(o(T)("components.fluxDrive.storageInfo.usedSpace")),1),s("div",li,l(o(z)(o(u))),1)]),_:1}),e(Ht,{cols:"4",class:"text-center"},{default:a(()=>[s("div",si,l(o(T)("components.fluxDrive.storageInfo.available")),1),s("div",ii,l(o(z)(o(se)-o(u))),1)]),_:1}),e(Ht,{cols:"4",class:"text-center"},{default:a(()=>[s("div",ri,l(o(T)("components.fluxDrive.storageInfo.total")),1),s("div",ci,l(o($e)(o(se))),1)]),_:1})]),_:1}),o(c)>=90?(g(),N(_t,{key:0,type:"warning",variant:"tonal",class:"mt-4",density:"compact"},{title:a(()=>[b(l(o(T)("components.fluxDrive.storageInfo.almostFull")),1)]),default:a(()=>[b(" "+l(o(T)("components.fluxDrive.storageInfo.almostFullMessage",{percentage:o(c)})),1)]),_:1})):o(c)>=75?(g(),N(_t,{key:1,type:"info",variant:"tonal",class:"mt-4",density:"compact"},{title:a(()=>[b(l(o(T)("components.fluxDrive.storageInfo.statusTitle")),1)]),default:a(()=>[b(" "+l(o(T)("components.fluxDrive.storageInfo.statusMessage",{percentage:o(c)})),1)]),_:1})):Z("",!0)]),_:1})]),_:1})]),_:1}))}},di=Rt(ui,[["__scopeId","data-v-b115c8ed"]]),pi={key:0,class:"text-center py-8"},fi={class:"text-h5 mb-2"},gi={key:1,class:"text-center py-8"},mi={class:"text-h5 mb-2"},vi={class:"text-body-1 text-medium-emphasis mb-4"},hi={key:2,class:"checkout-content"},yi={class:"plan-summary"},wi={key:0,class:"mb-3"},xi={class:"text-body-2 mb-3 text-center font-weight-medium"},bi={class:"d-flex align-center mb-2"},_i={class:"text-body-2 font-weight-medium text-info"},ki={class:"d-flex justify-space-between align-center mb-1"},Pi={class:"text-body-1 font-weight-bold"},Si={class:"text-body-2 text-medium-emphasis"},Ci={class:"text-center mb-2"},Fi={class:"d-flex align-center justify-center mb-1"},Di={class:"d-flex align-center mb-2"},zi={class:"d-flex justify-space-between align-center mb-1"},$i={class:"text-body-1 font-weight-bold"},Ti={class:"text-body-2 text-medium-emphasis"},Mi={class:"d-flex justify-space-between align-center"},Ii={class:"text-body-2"},Ui={class:"text-body-1 font-weight-bold"},Ri={key:1,class:"plan-details"},Ei={class:"d-flex justify-space-between align-center mb-3"},Li={class:"d-flex justify-space-between align-center mb-3"},Ai={class:"d-flex justify-space-between align-center mb-3"},Vi={class:"d-flex justify-center mb-3"},Oi={class:"d-flex justify-space-between"},Ni={class:"text-h6"},ji={class:"text-h6 font-weight-bold"},Bi={class:"text-center"},Gi={class:"payment-icon mb-4"},Hi={class:"circular-icon"},qi={class:"mb-6"},Ji={class:"d-flex justify-center align-center gap-3 mb-3"},Xi={key:0,class:"subscription-dates mb-3"},Wi={class:"d-flex align-center justify-space-between"},Yi={class:"flex-grow-1 text-center"},Zi={class:"d-flex justify-center mb-1",style:{"align-items":"center",height:"1.2em"}},Ki={class:"text-caption font-weight-medium text-info",style:{display:"flex","align-items":"center"}},Qi={class:"text-body-2 font-weight-medium"},er={class:"px-3"},tr={class:"flex-grow-1 text-center"},or={class:"d-flex justify-center mb-1",style:{"align-items":"center",height:"1.2em"}},ar={class:"text-body-2 font-weight-medium"},nr={class:"mb-3"},lr={class:"d-flex align-center text-caption"},sr={class:"d-flex align-center justify-space-between mb-1 px-2 py-1",style:{background:"rgba(var(--v-theme-on-surface), 0.05)","border-radius":"4px"}},ir={style:{flex:"1","min-width":"0",overflow:"hidden"}},rr={class:"text-caption",style:{"font-size":"0.65rem",opacity:"0.7"}},cr={class:"text-caption",style:{"font-size":"0.7rem","word-break":"break-all"}},ur={class:"d-flex gap-1"},dr={class:"d-flex align-center justify-space-between mb-1 px-2 py-1",style:{background:"rgba(var(--v-theme-on-surface), 0.05)","border-radius":"4px",flex:"1"}},pr={class:"text-caption",style:{"font-size":"0.65rem",opacity:"0.7"}},fr={class:"text-caption",style:{"font-size":"0.7rem"}},gr={class:"d-flex align-center justify-space-between mb-1 px-2 py-1",style:{background:"rgba(var(--v-theme-on-surface), 0.05)","border-radius":"4px",flex:"1"}},mr={style:{flex:"1","min-width":"0",overflow:"hidden"}},vr={class:"text-caption",style:{"font-size":"0.65rem",opacity:"0.7"}},hr={class:"text-caption",style:{"font-size":"0.7rem","white-space":"nowrap",overflow:"hidden","text-overflow":"ellipsis"}},yr={key:1,class:"text-center text-caption text-medium-emphasis py-2"},wr={key:0,class:"mb-4"},xr={class:"d-flex flex-column align-center"},br={class:"text-h6 mb-2 text-center"},_r={class:"text-body-2 text-center text-medium-emphasis mb-3"},kr={class:"d-flex align-center text-caption text-medium-emphasis"},Pr={key:1},Sr={class:"wallet-icons-grid mb-4"},Cr=["src","alt"],Fr={class:"text-h6 font-weight-medium"},Dr=["src","alt"],zr={class:"text-h6 font-weight-medium"},$r={key:2},Tr={class:"text-caption text-medium-emphasis mt-4 text-center"},Mr={class:"text-center"},Ir={class:"payment-icon mb-4"},Ur={class:"circular-icon"},Rr={class:"mb-4"},Er={class:"text-h6 mb-2"},Lr={class:"text-body-2 text-medium-emphasis mb-2"},Ar={class:"d-flex flex-column gap-3"},Vr={class:"text-caption text-medium-emphasis mt-4"},Or={__name:"CheckoutContent",props:{planId:{type:String,required:!0},actionType:{type:String,default:"signup"},gateway:{type:String,default:"fluxpay"}},emits:["close","success"],setup(G,{expose:T,emit:Ve}){const u=G,se=Ve,c=f=>{if(!f||typeof f!="object")return f;const _={...f};return _.zelid&&(_.zelid=_.zelid.substring(0,8)+"..."),_.signature&&(_.signature="***hidden***"),_.loginPhrase&&(_.loginPhrase="***hidden***"),_};T({cleanupPaymentMonitoring:()=>{console.log("ğŸ§¹ Cleaning up payment monitoring from parent"),X&&(clearInterval(X),X=null),de&&(clearTimeout(de),de=null),ce.value=!1,M.value=!1,F.value=null,console.log("ğŸ§¹ Cleared payment data - new sub_id will be generated on re-open"),ye(),console.log("ğŸ§¹ Cleared payment-related snackbar notifications")}});const z=Do(),{showSnackbar:$e,hideSnackbar:ye}=Zo(),Ce=Ko(),ne=ja(),{t:v}=Dt(),Ie=f=>{try{const _=plans.value?.find(L=>L.id===u.planId)||{},U=_.pricePerMonth||_.usd||0;Ce.trackCheckout("purchase",{transaction_id:F.value?.sub_id||`tx_${Date.now()}`,value:U,currency:"USD",items:[{item_id:u.planId,item_name:_.name||u.planId,item_category:u.gateway||"unknown",price:U,quantity:1}],payment_gateway:u.gateway,action_type:f||u.actionType||"signup",plan_id:u.planId}),console.log("ğŸ“Š Purchase tracked:",{plan:u.planId,gateway:u.gateway,action:f||u.actionType,price:U})}catch(_){console.warn("Failed to track purchase:",_)}},me=ze(()=>ne.global.name.value==="dark"?Ya:Za),he=S(!0),$=S(null),le=S(u.gateway),K=S(!1),Q=S(!1),ce=S(!1),M=S(!1),F=S(null),O=S(null),te=S(null),oe=S(""),we=S("info"),ue=S(null);let X=null,de=null;const Ye=ze(()=>{const f=localStorage.getItem("zelidauth");if(!f)return!1;try{const _=qo.parse(f);return!!(_.zelid&&(_.signature||_.zelidauth))}catch{return!1}}),Pe=(f,_="error")=>{oe.value=f,we.value=_,setTimeout(()=>{oe.value="",we.value="info"},8e3)},Ke=async()=>{try{const _=await(await fetch("https://explorer.runonflux.io/api/currency")).json();if(console.log("FLUX currency data:",_),_&&_.status===200&&_.data&&_.data.rate){const U=parseFloat(_.data.rate),L=parseFloat(nt());if(console.log(`FLUX price from API: $${U} USD`),console.log(`Plan price: $${L} USD`),U>0&&L>0){const ve=L/U;return console.log(`FLUX calculation: $${L} USD / $${U} per FLUX = ${ve.toFixed(2)} FLUX`),ve.toFixed(2)}else return console.error("Invalid price values:",{fluxPriceUSD:U,planPriceUSD:L}),null}else return console.error("Invalid FLUX price data structure from explorer:",_),null}catch(f){return console.error("Error getting FLUX price from explorer:",f),null}},Oe=async()=>{if(!(u.actionType!=="upgrade"&&u.actionType!=="downgrade"))try{console.log("ğŸ” Loading current subscription for",u.actionType,"comparison");const f=W();if(!f.zelid){console.error("No ZelID available for subscription lookup");return}const _={action:"READ",action_type:"current",zelid:f.zelid,signature:f.signature,loginPhrase:f.loginPhrase};console.log("ğŸ“‹ Fetching current subscription:",c(_));const L=await(await fetch("https://jetpackbridge.runonflux.io/api/v1/subscriptions.php",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams(_)})).json();console.log("ğŸ“‹ Current subscription response:",L),L&&!L.error?(te.value=L,console.log("âœ… Current subscription data loaded:",L),L.gateway&&(console.log("ğŸ’³ Current subscription gateway:",L.gateway),localStorage.setItem("fluxdrive_gateway",L.gateway))):console.log("âš ï¸ Could not load current subscription:",L.error||"Unknown error")}catch(f){console.error("âŒ Error loading current subscription:",f)}},E=async()=>{try{if(he.value=!0,oe.value="",console.log("ğŸ“‹ About to check if we need to load current subscription"),console.log("ğŸ“‹ Action type:",u.actionType),console.log("ğŸ“‹ Should load?",u.actionType==="upgrade"||u.actionType==="downgrade"),await Oe(),console.log("Loading plan details for planId:",u.planId),console.log("Gateway:",u.gateway),console.log("Action type:",u.actionType),!Ye.value){Pe(v("components.checkoutContent.pleaseLoginToContinue")),se("close");return}const f=W();console.log("Auth check:",{zelid:f.zelid?f.zelid.substring(0,8)+"...":"none",hasSignature:!!f.signature,hasLoginPhrase:!!f.loginPhrase});const _={starter:{plan_name:"starter",price:.5,storage:10737418240,storage_gb:10,period:"month",cycle:"monthly"},standard:{plan_name:"standard",price:2.5,storage:53687091200,storage_gb:50,period:"month",cycle:"monthly"},pro:{plan_name:"pro",price:5,storage:107374182400,storage_gb:100,period:"month",cycle:"monthly"}},U=W();if(!U.zelid||!U.signature||!U.loginPhrase){Pe(v("components.checkoutContent.invalidAuthenticationData")),se("close");return}_[u.planId]&&($.value=_[u.planId],ue.value=await Ke(),console.log("Estimated FLUX amount:",ue.value));let L={action:"READ",plan_name:u.planId,action_type:u.actionType,gateway:u.gateway,zelid:U.zelid||z.zelid,signature:U.signature,loginPhrase:U.loginPhrase};console.log("Reading subscription details from API"),console.log("API payload being sent (READ):",c(L));let ae=await(await fetch("https://jetpackbridge.runonflux.io/api/v1/subscriptions.php",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams(L)})).json();if(console.log("ğŸ“‹ Subscription API response (CREATE):",ae),console.log("ğŸ“‹ CREATE result.new_plan:",ae.new_plan),console.log("ğŸ“‹ CREATE result.plan:",ae.plan),console.log("ğŸ“‹ CREATE full response keys:",Object.keys(ae)),console.log("ğŸ“‹ CREATE result has sub_id?:",!!(ae.new_plan?.sub_id||ae.plan?.sub_id)),O.value=ae,ae.sub_id&&console.log("ğŸ“‹ Found sub_id in root response:",ae.sub_id),ae.error){console.error("API Error:",ae.error),Pe(ae.error);return}if(ae.new_plan||ae.plan){const A=ae.new_plan||ae.plan;_[u.planId]?($.value={..._[u.planId],price_id:A.price_id,sub_id:A.sub_id},console.log("Merged FluxDrive plan with API price_id:",$.value.price_id),ue.value||(console.log("â³ Waiting for FLUX amount calculation..."),await new Promise(Se=>setTimeout(Se,500))),ue.value?await Ue():console.log("âš ï¸ FLUX amount still not available, skipping pre-initialization")):($.value=A,ue.value||(ue.value=await Ke())),console.log("=== SUBSCRIPTION API RESPONSE ==="),console.log("Selected plan data:",$.value),console.log("Price_id from API:",$.value.price_id)}else Pe(v("components.checkoutContent.planNotFoundOrInvalidResponse"))}catch(f){console.error("Error loading plan:",f),Pe(v("components.checkoutContent.failedToLoadPlanDetails"))}finally{he.value=!1}},W=()=>{const f=localStorage.getItem("zelidauth");if(!f)return{zelid:null,signature:null,loginPhrase:null};try{const _=qo.parse(f);return{zelid:_.zelid||z.zelid,signature:_.signature||_.zelidauth||f,loginPhrase:_.loginPhrase}}catch(_){return console.error("Failed to parse zelidauth:",_),{zelid:null,signature:null,loginPhrase:null}}},Ue=async()=>{try{const f=W();if(!f.zelid||!f.signature){console.log("âš ï¸ Cannot pre-initialize payment data - missing auth"),console.log("Auth check:",{hasZelid:!!f.zelid,hasSignature:!!f.signature,hasLoginPhrase:!!f.loginPhrase});return}if(!ue.value){console.log("âš ï¸ Cannot pre-initialize payment data - missing FLUX amount");return}const _={action:"INITIALIZE",plan_name:u.planId,action_type:u.actionType,zelid:f.zelid||z.zelid,signature:f.signature,loginPhrase:f.loginPhrase};console.log("ğŸ”„ Pre-initialization payload check:",{hasZelid:!!_.zelid,hasSignature:!!_.signature,hasLoginPhrase:!!_.loginPhrase,planName:_.plan_name,actionType:_.action_type});const U=(ae,A)=>{const Se=A?"abcdefghijklmnopqrstuvwxyz0123456789":"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";let ge="";for(let H=0;H<ae;H++)ge+=Se[Math.floor(Math.random()*Se.length)];return ge};_.sub_id=U(24,!0),$.value?.price_id&&(_.price_id=$.value.price_id),ue.value&&(_.total_flux=parseFloat(ue.value)),_.payment_addr="t3NryfAQLGeFs9jEoeqsxmBN2QLRaRKFLUX",console.log("ğŸ”„ Pre-initializing payment data for manual section:",c(_));const L=await fetch("https://jetpackbridge.runonflux.io/api/v1/fluxpay.php",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams(_)});console.log("ğŸ“¡ Response status:",L.status,L.statusText);const ve=await L.json();console.log("ğŸ“¡ API response:",ve),ve.success?(console.log("âœ… Payment data pre-initialized successfully!"),F.value={amount:ue.value,usdValue:nt(),subId:ve.sub_id,endDate:ve.enddate,paymentAddr:_.payment_addr},console.log("âœ… Manual payment section now has data:",F.value)):console.log("âš ï¸ Failed to pre-initialize payment data:",ve.error||ve)}catch(f){console.error("âŒ Error pre-initializing payment data:",f)}},pe=async()=>{await pt("zelcore")},xe=async()=>{await pt("ssp")},pt=async(f="zelcore")=>{try{if(K.value=!0,oe.value="",F.value&&F.value.subId){console.log("âœ… Reusing existing payment data from pre-initialization"),console.log("   - sub_id:",F.value.subId),console.log("   - amount:",F.value.amount),console.log("   - address:",F.value.paymentAddr);const Se=parseFloat(F.value.amount).toFixed(2),ge=`FLUXDRIVE${F.value.subId}`;if(f==="ssp"){console.log("Opening SSP wallet for payment");try{await Jo({message:ge,amount:Se,address:F.value.paymentAddr,chain:"flux"}),ce.value=!0,$e(v("components.checkoutContent.sspPaymentInitiated"),"info",8e3),ft(null,F.value.subId,F.value.paymentAddr,"flux")}catch(H){console.error("SSP payment error:",H),Pe(v("components.checkoutContent.sspPaymentFailed",{error:H.message}))}}else{console.log("Opening Zelcore wallet for payment");try{await Xo({address:F.value.paymentAddr,amount:Se,message:ge,coin:"flux"}),ce.value=!0,$e(v("components.checkoutContent.openingZelcoreWallet"),"info",8e3),ft(null,F.value.subId,F.value.paymentAddr,"flux")}catch(H){console.error("Zelcore payment error:",H),Pe(v("components.checkoutContent.zelcorePaymentFailed",{error:H.message}))}}K.value=!1;return}console.log("âš ï¸ No pre-initialized payment data, creating new payment...");const _=W();if(!_.zelid||!_.signature||!_.loginPhrase){Pe(v("components.checkoutContent.authenticationRequired"));return}const U={action:"INITIALIZE",plan_name:u.planId,action_type:u.actionType,zelid:_.zelid||z.zelid,signature:_.signature,loginPhrase:_.loginPhrase},L=(Se,ge)=>{const H=ge?"abcdefghijklmnopqrstuvwxyz0123456789":"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";let Re="";for(let qe=0;qe<Se;qe++)Re+=H[Math.floor(Math.random()*H.length)];return Re};U.sub_id=L(24,!0),console.log("âœ… Generated sub_id like FluxCloud:",U.sub_id),$.value?.price_id&&(U.price_id=$.value.price_id,console.log("âœ… Including price_id:",$.value.price_id)),ue.value&&(U.total_flux=parseFloat(ue.value),console.log("âœ… Including total_flux:",U.total_flux)),U.payment_addr="t3NryfAQLGeFs9jEoeqsxmBN2QLRaRKFLUX",console.log("âœ… Including payment_addr:",U.payment_addr),console.log("=== PAYMENT PAYLOAD WITH SUB_ID ==="),console.log("Final payload:",c(U)),console.log("=== FLUXPAY PAYMENT INITIALIZATION ==="),console.log("Plan ID:",u.planId),console.log("Selected plan data:",$.value),console.log("Payment payload:",c(U));const ve=new URLSearchParams(U);console.log("URL-encoded body:",ve.toString());const ae=await fetch("https://jetpackbridge.runonflux.io/api/v1/fluxpay.php",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:ve});console.log("Response status:",ae.status),console.log("Response ok:",ae.ok),console.log("Response headers:",[...ae.headers.entries()]);const A=await ae.json();if(console.log("FluxPay initialization result:",A),console.log("Result keys:",Object.keys(A)),console.log("Result.error:",A.error),console.log("Result.success:",A.success),A.success){console.log("âœ… Payment initialized successfully!"),console.log("Response format:",A),F.value={amount:ue.value,usdValue:nt(),subId:A.sub_id,endDate:A.enddate,paymentAddr:U.payment_addr};const Se=parseFloat(ue.value).toFixed(2),ge=`FLUXDRIVE${A.sub_id}`;if(f==="ssp"){console.log("Opening SSP wallet for payment");try{await Jo({message:ge,amount:Se,address:U.payment_addr,chain:"flux"}),ce.value=!0,$e(v("components.checkoutContent.sspPaymentInitiated"),"info",8e3),ft(null,A.sub_id,U.payment_addr,"flux")}catch(H){console.error("SSP payment error:",H),Pe(v("components.checkoutContent.sspPaymentFailed",{error:H.message}))}}else{console.log("Opening Zelcore wallet for payment");try{await Xo({address:U.payment_addr,amount:Se,message:ge,coin:"flux"}),ce.value=!0,$e(v("components.checkoutContent.openingZelcoreWallet"),"info",8e3),ft(null,A.sub_id,U.payment_addr,"flux")}catch(H){console.error("Zelcore payment error:",H),Pe(v("components.checkoutContent.zelcorePaymentFailed",{error:H.message}))}}}else Pe(A.error||v("components.checkoutContent.failedToInitializePayment"))}catch(_){console.error("Error initializing payment:",_),Pe(v("components.checkoutContent.failedToInitializePaymentTryAgain"))}finally{K.value=!1}},zt=async()=>{try{Q.value=!0,oe.value="";const f=W();if(!f.zelid||!f.signature||!f.loginPhrase){Pe(v("components.checkoutContent.authenticationRequired"));return}const _={action:"INITIALIZE",plan_name:u.planId,action_type:u.actionType,zelid:f.zelid||z.zelid,signature:f.signature,loginPhrase:f.loginPhrase};console.log("=== FLUXCLOUD PATTERN CRYPTO.COM PAYLOAD ==="),console.log("Using original FluxCloud pattern - no price_id or sub_id needed"),console.log("=== CRYPTO.COM PAYMENT INITIALIZATION ==="),console.log("Plan ID:",u.planId),console.log("Selected plan data:",$.value),console.log("Payment payload:",c(_));const U=await fetch("https://jetpackbridge.runonflux.io/api/v1/cryptocom.php",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams(_)});console.log("Crypto.com response status:",U.status,U.statusText);const L=await U.json();if(console.log("Crypto.com initialization result:",L),L.success||(console.error("âŒ Crypto.com Payment Failed:"),console.error("  - Error message:",L.error),console.error("  - Response status:",U.status),console.error("  - Full result:",L),console.error("  - Sent payload:",_)),L.success){console.log("âœ… Crypto.com payment initialized successfully"),console.log("ğŸ” Checking response fields:"),console.log("  - payment_id:",L.payment_id),console.log("  - payment_addr:",L.payment_addr),console.log("  - sub_id:",L.sub_id),console.log("  - price_id:",L.price_id),console.log("  - checkout_url:",L.checkout_url),console.log("  - subscription_url:",L.subscription_url),console.log("  - checkout_url type:",typeof L.checkout_url),console.log("  - subscription_url type:",typeof L.subscription_url),F.value={amount:null,usdValue:nt(),paymentId:L.payment_id,paymentAddr:L.payment_addr,subId:L.sub_id,priceId:L.price_id,checkoutUrl:L.checkout_url||L.subscription_url};const ve=L.checkout_url||L.subscription_url;ve?(console.log("ğŸš€ Redirecting to Crypto.com:",ve),window.open(ve,"_blank"),Pe(v("components.checkoutContent.redirectedToCryptoCom"),"info"),M.value=!0,ft(L.payment_id,L.sub_id,L.payment_addr,"crypto")):(console.error("âŒ No checkout_url or subscription_url in successful response!"),console.error("This means the backend returned success=true but no payment URL"),Pe(v("components.checkoutContent.paymentInitializedNoUrl"),"warning"))}else{let ve=L.error||v("components.checkoutContent.failedToInitializeCryptoCom");U.status===500?ve+=". "+v("components.checkoutContent.serverErrorContactSupport"):U.status===404?ve+=". "+v("components.checkoutContent.paymentServiceNotFound"):(L.error&&L.error.includes("environment")||L.error&&L.error.includes("config"))&&(ve+=". "+v("components.checkoutContent.paymentServiceNotConfigured")),Pe(ve)}}catch(f){console.error("Error initializing Crypto.com payment:",f),Pe(v("components.checkoutContent.failedToInitializeCryptoComTryAgain"))}finally{Q.value=!1}},ft=async(f,_,U,L="flux")=>{if(console.log("ğŸ” Payment monitoring started:",{paymentId:f,subId:_,actionType:u.actionType}),!f&&!_){console.error("âŒ CRITICAL: Payment monitoring started without payment ID or subscription ID!"),console.error("This should not happen - monitoring requires valid payment identifiers"),console.error("Preventing false positive payment confirmation");return}let ve=null,ae=null;if(u.actionType==="renew")try{const A=W(),Se={zelid:A.zelid||z.zelid,signature:A.signature,loginPhrase:A.loginPhrase,page:"1",size:"0"};console.log("ğŸ“¸ Capturing initial /read state for renewal monitoring...");const H=await(await fetch("https://jetpackbridge.runonflux.io/api/v1/ipfs/read",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams(Se)})).json(),Re=!!(H.error&&H.period_end&&(H.error.indexOf("Subscription Expired")>-1||H.error.indexOf("Subscription Canceled")>-1));ae={hasError:!!H.error,hasPeriodEnd:!!H.period_end,hasSubscriptionExpired:Re,periodEnd:H.period_end},console.log("ğŸ“¸ Initial /read state captured:",{hasError:ae.hasError,hasPeriodEnd:ae.hasPeriodEnd,hasSubscriptionExpired:ae.hasSubscriptionExpired,periodEnd:ae.periodEnd})}catch(A){console.warn("âš ï¸ Failed to capture initial /read state:",A)}if(u.actionType==="signup")try{const A=W(),Se={zelid:A.zelid||z.zelid,signature:A.signature,loginPhrase:A.loginPhrase};console.log("ğŸ“¸ Capturing initial storage state for signup monitoring...");const H=await(await fetch("https://jetpackbridge.runonflux.io/api/v1/ipfs/storage",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams(Se)})).json();H.active!==void 0?(ve={wasActive:H.active,initialCapacity:H.capacity},console.log("ğŸ“¸ Initial signup state captured - Was Active:",H.active,"Capacity:",(H.capacity_gb||Math.round(H.capacity/1024/1024/1024))+"GB")):console.warn("âš ï¸ Failed to get initial storage state:",H.error||"Unknown error")}catch(A){console.warn("âš ï¸ Failed to capture initial signup state:",A)}if(u.actionType==="upgrade"||u.actionType==="downgrade")try{const A=W(),Se={zelid:A.zelid||z.zelid,signature:A.signature,loginPhrase:A.loginPhrase};console.log("ğŸ“¸ Capturing initial storage state for",u.actionType,"monitoring...");const H=await(await fetch("https://jetpackbridge.runonflux.io/api/v1/ipfs/storage",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams(Se)})).json();H.active!==void 0?(ve=H,console.log("ğŸ“¸ Initial state captured - Active:",H.active,"Capacity:",(H.capacity_gb||Math.round(H.capacity/1024/1024/1024))+"GB")):console.warn("âš ï¸ Failed to get initial storage state:",H.error||"Unknown error")}catch(A){console.warn("âš ï¸ Failed to capture initial storage state:",A)}X&&(console.log("ğŸ§¹ Clearing existing payment monitoring"),clearInterval(X)),de&&clearTimeout(de),X=setInterval(async()=>{try{const A=W();if(f&&_){const Se={action:"CHECK",payment_id:f,sub_id:_,zelid:A.zelid||z.zelid,signature:A.signature,loginPhrase:A.loginPhrase};U&&(Se.payment_addr=U),console.log("Checking Crypto.com payment status with payload:",c(Se));const H=await(await fetch("https://jetpackbridge.runonflux.io/api/v1/cryptocom.php",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams(Se)})).json();if(console.log("Crypto.com payment status check result:",H),H.success&&(H.status==="completed"||H.payment_status==="completed"||H.payment_status==="active")){let Re=!1,qe="";if(u.actionType==="renew"){console.log("âœ… Crypto.com payment completed - verifying renewal...");try{const Je=await(await fetch("https://jetpackbridge.runonflux.io/api/v1/ipfs/read",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({zelid:A.zelid||z.zelid,signature:A.signature,loginPhrase:A.loginPhrase,page:"1",size:"0"})})).json();!!(Je.error&&Je.period_end&&(Je.error.indexOf("Subscription Expired")>-1||Je.error.indexOf("Subscription Canceled")>-1))?console.log("â³ Payment completed but subscription still has error - will retry verification"):(console.log("âœ… Renewal verified - no subscription error"),Re=!0,qe=v("components.checkoutContent.paymentConfirmedRenewed"))}catch(lt){console.warn("âš ï¸ Could not verify renewal, assuming payment success:",lt),Re=!0,qe=v("components.checkoutContent.paymentConfirmedRenewed")}}else if(u.actionType==="upgrade"||u.actionType==="downgrade"){console.log(`âœ… Crypto.com payment completed - verifying ${u.actionType}...`);try{const Je=await(await fetch("https://jetpackbridge.runonflux.io/api/v1/ipfs/storage",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({zelid:A.zelid||z.zelid,signature:A.signature,loginPhrase:A.loginPhrase})})).json(),vt=u.planId==="pro"?107374182400:u.planId==="standard"?53687091200:u.planId==="starter"?10737418240:53687091200;ve&&Je.capacity===vt?(console.log(`âœ… ${u.actionType} verified - capacity changed to expected value`),Re=!0,qe=u.actionType==="upgrade"?v("components.checkoutContent.paymentConfirmedUpgraded"):v("components.checkoutContent.paymentConfirmedDowngraded")):console.log("â³ Payment completed but capacity not yet updated - will retry verification")}catch(lt){console.warn(`âš ï¸ Could not verify ${u.actionType}, assuming payment success:`,lt),Re=!0,qe=u.actionType==="upgrade"?v("components.checkoutContent.paymentConfirmedUpgraded"):v("components.checkoutContent.paymentConfirmedDowngraded")}}else{console.log("âœ… Crypto.com payment completed - verifying signup...");try{if((await(await fetch("https://jetpackbridge.runonflux.io/api/v1/ipfs/storage",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({zelid:A.zelid||z.zelid,signature:A.signature,loginPhrase:A.loginPhrase})})).json()).active===!0)if(ve&&ve.wasActive===!0){const st=await(await fetch("https://jetpackbridge.runonflux.io/api/v1/ipfs/read",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({zelid:A.zelid||z.zelid,signature:A.signature,loginPhrase:A.loginPhrase,page:"1",size:"0"})})).json();st.error&&(st.error.indexOf("Subscription Expired")>-1||st.error.indexOf("Subscription Canceled")>-1)?console.log("â³ Payment completed but subscription still has error - will retry verification"):(console.log("âœ… Signup verified - active with no errors"),Re=!0,qe=v("components.checkoutContent.paymentConfirmedSubscriptionActive"))}else console.log("âœ… Signup verified - subscription active"),Re=!0,qe=v("components.checkoutContent.paymentConfirmedSubscriptionActive");else console.log("â³ Payment completed but subscription not yet active - will retry verification")}catch(lt){console.warn("âš ï¸ Could not verify signup, assuming payment success:",lt),Re=!0,qe=v("components.checkoutContent.paymentConfirmedSubscriptionActive")}}Re&&(clearInterval(X),clearTimeout(de),X=null,de=null,M.value=!1,localStorage.setItem("fluxdrive_gateway",u.gateway),console.log("ğŸ’¾ Stored payment gateway:",u.gateway),Ie("signup"),$e(qe,"success",8e3),se("success"))}else H.error&&console.warn("Payment check error:",H.error)}else if(_)if(u.actionType==="renew")try{const Se=await fetch("https://jetpackbridge.runonflux.io/api/v1/ipfs/read",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({zelid:A.zelid||z.zelid,signature:A.signature,loginPhrase:A.loginPhrase,page:"1",size:"0"})});if(!Se.ok){console.warn("âš ï¸ /read endpoint returned error status:",Se.status),console.log("â³ Waiting for renewal - API returned error status, will retry...");return}const ge=await Se.json(),H=!!(ge.error&&ge.period_end);if(ge.error&&!ge.period_end){console.warn("âš ï¸ /read endpoint returned different error:",ge.error),console.log("â³ Waiting for renewal - non-subscription error detected, will retry...");return}ae&&ae.hasSubscriptionExpired&&!H?(console.log("âœ… Renewal confirmed - subscription expired error with period_end disappeared!"),console.log("Previous state: error =",ae.hasError,", period_end =",ae.periodEnd),console.log("Current state: error =",!!ge.error,", period_end =",ge.period_end||"none"),clearInterval(X),clearTimeout(de),X=null,de=null,ce.value=!1,localStorage.setItem("fluxdrive_gateway",u.gateway),console.log("ğŸ’¾ Stored payment gateway:",u.gateway),Ie("renew"),$e(v("components.checkoutContent.paymentConfirmedRenewed"),"success",8e3),se("success")):H?console.log("â³ Waiting for renewal to process - still has subscription expired error with period_end:",ge.period_end):console.log(ae?"â³ Waiting for renewal - checking read endpoint state...":"â³ Waiting for renewal - no initial state captured")}catch(Se){console.warn("âš ï¸ Failed to check /read endpoint for renewal:",Se.message),console.log("â³ Waiting for renewal - network/timeout error, will retry...")}else if(u.actionType==="upgrade"||u.actionType==="downgrade"){const ge=await(await fetch("https://jetpackbridge.runonflux.io/api/v1/ipfs/storage",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({zelid:A.zelid||z.zelid,signature:A.signature,loginPhrase:A.loginPhrase})})).json();if(ve&&ge.active===!0){const H=ge.capacity!==ve.capacity,Re=u.planId==="pro"?107374182400:u.planId==="standard"?53687091200:u.planId==="starter"?10737418240:53687091200;if(H&&ge.capacity===Re){const qe=u.actionType==="upgrade"?"Upgrade":"Downgrade";console.log(`âœ… ${qe} confirmed - storage capacity changed!`),console.log("Previous capacity:",(ve.capacity_gb||Math.round(ve.capacity/1024/1024/1024))+"GB"),console.log("New capacity:",(ge.capacity_gb||Math.round(ge.capacity/1024/1024/1024))+"GB"),clearInterval(X),clearTimeout(de),X=null,de=null,ce.value=!1,localStorage.setItem("fluxdrive_gateway",u.gateway),console.log("ğŸ’¾ Stored payment gateway:",u.gateway),Ie(u.actionType);const lt=u.actionType==="upgrade"?v("components.checkoutContent.paymentConfirmedUpgraded"):v("components.checkoutContent.paymentConfirmedDowngraded");$e(lt,"success",8e3),se("success")}else{const qe=u.actionType==="downgrade"?"downgrade":"upgrade";console.log(`â³ Waiting for ${qe} to process - current capacity:`,(ge.capacity_gb||Math.round(ge.capacity/1024/1024/1024))+"GB")}}else console.log("â³ Waiting for subscription data...")}else{const ge=await(await fetch("https://jetpackbridge.runonflux.io/api/v1/ipfs/storage",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({zelid:A.zelid||z.zelid,signature:A.signature,loginPhrase:A.loginPhrase})})).json();if(ge.active===!0){if(ve&&ve.wasActive===!0)try{const Re=await(await fetch("https://jetpackbridge.runonflux.io/api/v1/ipfs/read",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({zelid:A.zelid||z.zelid,signature:A.signature,loginPhrase:A.loginPhrase,page:"1",size:"0"})})).json();if(Re.error&&(Re.error.indexOf("Subscription Expired")>-1||Re.error.indexOf("Subscription Canceled")>-1)){console.log("â³ Subscription still inactive (has error) - continuing to monitor...");return}console.log("âœ… New subscription is now active (verified via /read) - payment completed!")}catch{console.warn("âš ï¸ Could not verify with /read, assuming storage result is correct")}else console.log("âœ… New subscription is now active - payment completed!");clearInterval(X),clearTimeout(de),X=null,de=null,ce.value=!1,localStorage.setItem("fluxdrive_gateway",u.gateway),console.log("ğŸ’¾ Stored payment gateway:",u.gateway),Ie("signup"),$e(v("components.checkoutContent.paymentConfirmedSubscriptionActive"),"success",8e3),se("success")}else console.log("â³ Subscription not yet active - continuing to monitor...",ge)}else console.warn("No payment_id or sub_id provided for monitoring - stopping"),clearInterval(X),clearTimeout(de),X=null,de=null,L==="crypto"?M.value=!1:ce.value=!1}catch(A){console.error("Error checking payment status:",A)}},12e4),de=setTimeout(()=>{clearInterval(X),X=null,de=null,L==="crypto"&&M.value?(M.value=!1,Pe(v("components.checkoutContent.cryptoComTimeoutCheckManually"),"warning")):L==="flux"&&ce.value&&(ce.value=!1,Pe(v("components.checkoutContent.fluxPayTimeoutCheckManually"),"warning"))},12e5)},Et=()=>{console.log("ğŸ›‘ Cancelling FluxPay payment monitoring (keeping payment data)"),X&&(clearInterval(X),X=null),de&&(clearTimeout(de),de=null),ye(),ce.value=!1,Pe(v("components.checkoutContent.paymentMonitoringCancelledCanPayManually"),"info")},Lt=()=>{console.log("ğŸ›‘ Cancelling Crypto.com payment and stopping monitoring"),X&&(clearInterval(X),X=null),de&&(clearTimeout(de),de=null),ye(),M.value=!1,Pe(v("components.checkoutContent.cryptoComPaymentCancelled"),"info")},wt=f=>{if(!f)return"N/A";const _=new Date(f);return _.toLocaleDateString()+" "+_.toLocaleTimeString()},ct=()=>{if((u.actionType==="upgrade"||u.actionType==="downgrade")&&te.value){console.log("ğŸ” Getting current subscription end date for",u.actionType,"(from currentSubscriptionData)..."),console.log("ğŸ“Š Full currentSubscriptionData.value:",JSON.stringify(te.value,null,2));const f=te.value;if(f.period_end){console.log("ğŸ“… Found period_end:",f.period_end,"(type:",typeof f.period_end,")");const _=new Date(f.period_end*1e3);if(console.log("ğŸ“… Converted to date:",_.toISOString()),_.getFullYear()>2e3)return _}if(f.endtime){console.log("ğŸ“… Found endtime:",f.endtime,"(type:",typeof f.endtime,")");const _=new Date(f.endtime*1e3);if(console.log("ğŸ“… Converted endtime to date:",_.toISOString()),_.getFullYear()>2e3)return _}return console.log("âš ï¸ period_end/endtime not found or invalid in:",Object.keys(f)),null}if(console.log("ğŸ” Getting current subscription end date (FluxCloud method)..."),console.log("ğŸ“Š Full subscriptionData.value:",JSON.stringify(O.value,null,2)),O.value){const f=O.value;if(f.period_end){console.log("ğŸ“… Found period_end:",f.period_end,"(type:",typeof f.period_end,")");const _=new Date(f.period_end*1e3);if(console.log("ğŸ“… Converted to date:",_.toISOString()),_.getFullYear()>2e3)return _}console.log("âš ï¸ period_end not found or invalid in:",Object.keys(f))}return console.log("âš ï¸ Using current date as fallback"),new Date},at=()=>{if(console.log("ğŸ” Getting new subscription end date (FluxCloud method)..."),O.value){const _=O.value,U=_.new_plan||_.plan;if(U&&U.endtime){console.log("ğŸ“… Raw new_plan.endtime:",U.endtime,typeof U.endtime);const L=new Date(U.endtime*1e3);if(console.log("ğŸ“… Parsed new plan end date:",L),L.getFullYear()>2e3)return L}if(U&&U.enddate){console.log("ğŸ“… Raw new_plan.enddate:",U.enddate);const L=new Date(U.enddate);if(console.log("ğŸ“… Parsed new plan end date from enddate:",L),L.getFullYear()>2e3)return L}}console.log("âš ï¸ No new_plan endtime found, calculating +1 month from now");const f=new Date;return f.setMonth(f.getMonth()+1),f},je=()=>{if((u.actionType==="upgrade"||u.actionType==="downgrade")&&te.value){console.log("ğŸ” Getting current plan from currentSubscriptionData:",te.value);const f=te.value;if(f.plan)return console.log("ğŸ“‹ Using currentSubscriptionData.plan:",f.plan),f.plan;if(f.plan_name||f.storage_gb||f.price)return console.log("ğŸ“‹ Using currentSubscriptionData root level data"),f;console.log("âš ï¸ Current subscription data found but no plan info")}if(O.value){const f=O.value;if(console.log("ğŸ” Getting current plan from subscriptionData:",f),f.plan&&!f.new_plan)return console.log("ğŸ“‹ Using data.plan:",f.plan),f.plan;if(f.plan_name||f.storage_gb||f.price)return console.log("ğŸ“‹ Using root level data as plan"),f}return z.user&&z.user.fluxdrive_subscription?(console.log("ğŸ“‹ Using flux store subscription data:",z.user.fluxdrive_subscription),z.user.fluxdrive_subscription):(console.log("âš ï¸ No current plan data found anywhere"),null)},gt=()=>O.value&&O.value.new_plan||null,mt=()=>{const f=je();if(console.log("ğŸ·ï¸ Getting current plan name, currentPlan:",f),f){const _=f.plan_name||f.name;if(_)return console.log("ğŸ·ï¸ Current plan name result:",_),_}return u.actionType==="upgrade"||u.actionType==="downgrade"?(console.log("ğŸ·ï¸ Using fallback for upgrade/downgrade - Current Subscription"),v("components.checkoutContent.currentSubscription")):(console.log("ğŸ·ï¸ Using fallback - Current Plan"),v("components.checkoutContent.currentPlanFallback"))},ut=()=>{const f=gt();return f?.plan_name||f?.name||$.value?.plan_name||"New Plan"},We=()=>{const f=je();if(f){if(f.storage_gb)return`${f.storage_gb} GB`;if(f.storage_limit)return`${f.storage_limit} GB`;if(f.storage)return`${f.storage} GB`}return u.actionType==="upgrade"||u.actionType==="downgrade"?v("components.checkoutContent.currentStorage"):"N/A"},xt=()=>{const f=je();if(f){if(f.priceInCents&&f.priceInCents>0)return(f.priceInCents/100).toFixed(2);if(f.price&&f.price>0)return f.price>10?(f.price/100).toFixed(2):f.price.toFixed(2);if(f.cost&&f.cost>0)return f.cost.toFixed(2)}return u.actionType==="upgrade"||u.actionType==="downgrade"?"-.--":"0.00"},nt=()=>$.value?$.value.priceInCents&&$.value.priceInCents>0?($.value.priceInCents/100).toFixed(2):$.value.price&&$.value.price>0?$.value.price>10?($.value.price/100).toFixed(2):$.value.price.toFixed(2):$.value.cost&&$.value.cost>0?$.value.cost.toFixed(2):"0.00":"0.00",Pt=f=>{if(!f)return"N/A";const U=f.toLowerCase().replace(/\s+/g,"");return U==="starter"?v("components.checkoutContent.planNames.starter"):U==="standard"?v("components.checkoutContent.planNames.standard"):U==="pro"?v("components.checkoutContent.planNames.pro"):U==="enterprise"?v("components.checkoutContent.planNames.enterprise"):U==="fluxdrivepro"?v("components.checkoutContent.planNames.fluxDrivePro"):f},ie=()=>{if(!$.value)return console.log("No selected plan available"),"N/A";if(console.log("Getting storage display for plan:",$.value),$.value.storage_gb)return`${$.value.storage_gb} GB`;if($.value.storage_limit)return console.log("Using storage_limit:",$.value.storage_limit),`${$.value.storage_limit} GB`;if($.value.storage)return console.log("Using storage field:",$.value.storage),$.value.storage>1e6?`${Math.round($.value.storage/1073741824)} GB`:`${$.value.storage.toString().replace(/\s*GB\s*/i,"")} GB`;const f={starter:"10",standard:"50",pro:"100",enterprise:"Customizable","flux drive pro":"Customizable"},_=$.value.plan_name?.toLowerCase();if(console.log("Plan name for mapping:",_),console.log("Available mappings:",Object.keys(f)),f[_]){const U=f[_]==="Customizable"?"Customizable":`${f[_]} GB`;return console.log("Using mapped storage:",U),U}return console.log("No storage found, returning error GB"),console.log("Full plan object:",JSON.stringify($.value,null,2)),"error GB"};let Ne=null;return Bt(()=>u.planId,f=>{f&&E()},{immediate:!0}),po(()=>{console.log("ğŸ’³ CheckoutContent mounted with props:",{planId:u.planId,gateway:u.gateway,actionType:u.actionType}),console.log("ğŸ” Action type is downgrade?",u.actionType==="downgrade"),console.log("ğŸ” Should show plan comparison?",u.actionType==="upgrade"||u.actionType==="downgrade"),console.log("ğŸ” Will load current subscription?",u.actionType==="upgrade"||u.actionType==="downgrade"),u.planId&&E(),Ne=new $o(".copy-btn",{text:f=>f.getAttribute("data-clipboard-text")}),Ne.on("success",f=>{$e(v("components.checkoutContent.copiedToClipboard"),"success",2e3,"mdi-check-circle"),f.clearSelection()}),Ne.on("error",f=>{$e(v("components.checkoutContent.failedToCopy"),"error",2e3,"mdi-alert-circle")})}),Ra(()=>{X&&(clearInterval(X),X=null),de&&(clearTimeout(de),de=null),Ne&&(Ne.destroy(),Ne=null)}),(f,_)=>(g(),R("div",null,[!$.value&&he.value?(g(),R("div",pi,[e(kt,{indeterminate:"",size:"64",width:"4",color:"primary",class:"mb-4"}),s("h3",fi,l(o(v)("components.checkoutContent.loadingPlanDetails")),1)])):!$.value&&!he.value?(g(),R("div",gi,[e(k,{icon:"mdi-alert-circle",size:"64",color:"error",class:"mb-4"}),s("h3",mi,l(o(v)("components.checkoutContent.unableToLoadPlan")),1),s("p",vi,l(o(v)("components.checkoutContent.tryAgainOrContactSupport")),1),e(B,{color:"primary",onClick:E},{default:a(()=>[b(l(o(v)("components.checkoutContent.tryAgain")),1)]),_:1})])):$.value?(g(),R("div",hi,[e(zo,null,{default:a(()=>[e(Ht,{cols:"12",md:"4"},{default:a(()=>[e(be,{variant:"outlined",class:"h-100"},{default:a(()=>[e(it,null,{default:a(()=>[e(k,{icon:u.actionType==="renew"?"mdi-refresh":u.actionType==="upgrade"?"mdi-arrow-up-bold":u.actionType==="downgrade"?"mdi-arrow-down-bold":"mdi-receipt",class:"me-2"},null,8,["icon"]),b(" "+l(u.actionType==="renew"?o(v)("components.checkoutContent.renewal"):u.actionType==="upgrade"?o(v)("components.checkoutContent.upgrade"):u.actionType==="downgrade"?o(v)("components.checkoutContent.downgrade"):o(v)("components.checkoutContent.order"))+" "+l(o(v)("components.checkoutContent.summary")),1)]),_:1}),e(Fe,null,{default:a(()=>[s("div",yi,[u.actionType==="upgrade"||u.actionType==="downgrade"?(g(),R("div",wi,[s("div",xi,l(o(v)("components.checkoutContent.planComparison")),1),e(be,{variant:"outlined",class:"mb-2",style:{"border-color":"rgb(var(--v-theme-info))"}},{default:a(()=>[e(Fe,{class:"pa-3"},{default:a(()=>[s("div",bi,[e(k,{icon:"mdi-account-check",size:"16",class:"me-2 text-info"}),s("span",_i,l(o(v)("components.checkoutContent.yourCurrentPlan")),1)]),s("div",ki,[s("span",Pi,l(Pt(mt())),1),e(He,{color:"info",variant:"flat",size:"small"},{default:a(()=>[b(" $"+l(xt())+"/mo ",1)]),_:1})]),s("div",Si,[s("div",null,l(We())+" "+l(o(v)("components.checkoutContent.storage")),1)])]),_:1})]),_:1}),s("div",Ci,[s("div",Fi,[e(k,{icon:"mdi-arrow-down",size:"20",class:rt([u.actionType==="downgrade"?"text-warning":"text-success","me-1"])},null,8,["class"]),s("span",{class:rt(["text-body-2 font-weight-medium",u.actionType==="downgrade"?"text-warning":"text-success"])},l(u.actionType==="downgrade"?o(v)("components.checkoutContent.downgradeTo"):o(v)("components.checkoutContent.upgradeTo")),3)])]),e(be,{variant:"outlined",class:"mb-2",style:Gt(`border-color: rgb(var(--v-theme-${u.actionType==="downgrade"?"warning":"success"}));`)},{default:a(()=>[e(Fe,{class:"pa-3"},{default:a(()=>[s("div",Di,[e(k,{icon:u.actionType==="downgrade"?"mdi-arrow-down-bold":"mdi-star",size:"16",class:rt(["me-2",u.actionType==="downgrade"?"text-warning":"text-success"])},null,8,["icon","class"]),s("span",{class:rt(["text-body-2 font-weight-medium",u.actionType==="downgrade"?"text-warning":"text-success"])},l(o(v)("components.checkoutContent.newPlan")),3)]),s("div",zi,[s("span",$i,l(Pt(ut())),1),e(He,{color:u.actionType==="downgrade"?"warning":"success",variant:"flat",size:"small"},{default:a(()=>[b(" $"+l(nt())+"/mo ",1)]),_:1},8,["color"])]),s("div",Ti,[s("div",null,l(ie())+" "+l(o(v)("components.checkoutContent.storage")),1)])]),_:1})]),_:1},8,["style"]),e(be,{class:"mt-3",variant:"tonal",color:u.actionType==="downgrade"?"warning":"success"},{default:a(()=>[e(Fe,{class:"pa-3"},{default:a(()=>[s("div",Mi,[s("span",Ii,l(u.actionType==="downgrade"?o(v)("components.checkoutContent.youWillSave"):o(v)("components.checkoutContent.priceDifference")),1),s("span",Ui," $"+l(Math.abs(nt()-xt()).toFixed(2))+"/month ",1)])]),_:1})]),_:1},8,["color"])])):(g(),R("div",Ri,[s("div",Ei,[s("span",null,l(o(v)("components.checkoutContent.plan"))+":",1),e(He,{color:"primary",variant:"flat",size:"small"},{default:a(()=>[b(l(Pt($.value.plan_name)),1)]),_:1})]),s("div",Li,[s("span",null,l(o(v)("components.checkoutContent.storage"))+":",1),e(He,{color:"success",variant:"tonal",size:"small"},{default:a(()=>[b(l(ie()),1)]),_:1})]),s("div",Ai,[s("span",null,l(o(v)("components.checkoutContent.duration"))+":",1),e(He,{color:"info",variant:"tonal",size:"small"},{default:a(()=>[b(l(o(v)("components.checkoutContent.oneMonth")),1)]),_:1})])])),e(Fo,{class:"my-3"}),s("div",Vi,[u.actionType==="renew"?(g(),N(He,{key:0,color:"primary",variant:"flat",size:"small",class:"action-chip"},{default:a(()=>[e(k,{icon:"mdi-refresh",size:"14",class:"me-1"}),b(" "+l(o(v)("components.checkoutContent.renewingYourCurrentPlan")),1)]),_:1})):u.actionType==="upgrade"?(g(),N(He,{key:1,color:"secondary",variant:"flat",size:"small",class:"action-chip"},{default:a(()=>[e(k,{icon:"mdi-arrow-up",size:"14",class:"me-1"}),b(" "+l(o(v)("components.checkoutContent.upgradingToHigherPlan")),1)]),_:1})):u.actionType==="downgrade"?(g(),N(He,{key:2,color:"warning",variant:"flat",size:"small",class:"action-chip"},{default:a(()=>[e(k,{icon:"mdi-arrow-down",size:"14",class:"me-1"}),b(" "+l(o(v)("components.checkoutContent.downgradingToLowerPlan")),1)]),_:1})):u.actionType==="signup"||!u.actionType?(g(),N(He,{key:3,color:"success",variant:"flat",size:"small",class:"action-chip"},{default:a(()=>[e(k,{icon:"mdi-plus",size:"14",class:"me-1"}),b(" "+l(o(v)("components.checkoutContent.newSubscription")),1)]),_:1})):Z("",!0)]),s("div",Oi,[s("span",Ni,l(o(v)("components.checkoutContent.total"))+":",1),s("span",ji,"$"+l(nt()),1)])])]),_:1})]),_:1})]),_:1}),e(Ht,{cols:"12",md:"8"},{default:a(()=>[e(be,{variant:"outlined"},{default:a(()=>[e(it,null,{default:a(()=>[e(k,{icon:"mdi-credit-card",class:"me-2"}),b(" "+l(o(v)("components.checkoutContent.paymentMethod")),1)]),_:1}),e(Fe,null,{default:a(()=>[e(Ba,{modelValue:le.value,"onUpdate:modelValue":_[0]||(_[0]=U=>le.value=U),color:"primary",class:"mb-4"},{default:a(()=>[e(Go,{value:"fluxpay"},{default:a(()=>[e(k,{icon:"mdi-wallet",class:"me-2"}),b(" "+l(o(v)("components.checkoutContent.fluxPay")),1)]),_:1}),e(Go,{value:"cryptocom"},{default:a(()=>[e(k,{icon:"mdi-credit-card-multiple",class:"me-2"}),b(" "+l(o(v)("components.checkoutContent.cryptoCom")),1)]),_:1})]),_:1},8,["modelValue"]),e(Ga,{modelValue:le.value,"onUpdate:modelValue":_[1]||(_[1]=U=>le.value=U)},{default:a(()=>[e(Ho,{value:"fluxpay"},{default:a(()=>[e(be,{variant:"outlined"},{default:a(()=>[e(Fe,{class:"pa-6"},{default:a(()=>[s("div",Bi,[s("div",Gi,[s("div",Hi,[e(Ut,{src:"/img/ZelCore_symbol_blue_white.svg","max-width":"100",class:"mx-auto"})])]),s("div",qi,[s("div",Ji,[e(He,{color:"success",variant:"flat",size:"default"},{default:a(()=>[b(" $"+l(nt())+" USD ",1)]),_:1}),F.value&&F.value.amount?(g(),N(He,{key:0,color:"primary",variant:"flat",size:"default"},{default:a(()=>[b(l(parseFloat(F.value.amount).toFixed(2))+" FLUX * ",1)]),_:1})):ue.value?(g(),N(He,{key:1,color:"primary",variant:"flat",size:"default"},{default:a(()=>[b(l(parseFloat(ue.value).toFixed(2))+" FLUX * ",1)]),_:1})):(g(),N(He,{key:2,color:"info",variant:"tonal",size:"default"},{default:a(()=>[b(l(o(v)("components.checkoutContent.calculatingFlux")),1)]),_:1}))]),u.actionType==="renew"||u.actionType==="upgrade"||u.actionType==="downgrade"?(g(),R("div",Xi,[e(be,{elevation:"12",class:"pa-3",style:Gt(`box-shadow: 0 12px 24px rgba(0,0,0,0.25), 0 4px 8px rgba(0,0,0,0.15), inset 0 1px 0 rgba(255,255,255,0.1); border: 1px solid rgba(var(--v-theme-${u.actionType==="downgrade"?"warning":"success"}), 0.3); background: linear-gradient(145deg, rgba(255,255,255,0.1), rgba(0,0,0,0.05));`)},{default:a(()=>[s("div",Wi,[s("div",Yi,[s("div",Zi,[e(k,{icon:"mdi-calendar-clock",size:"16",class:"text-info",style:{display:"flex","align-items":"center","margin-right":"6px"}}),s("span",Ki,l(o(v)("components.checkoutContent.currentEnds"))+":",1)]),s("div",Qi,l(wt(ct())),1)]),s("div",er,[e(k,{icon:"mdi-arrow-right",size:"16",class:"text-medium-emphasis"})]),s("div",tr,[s("div",or,[e(k,{icon:"mdi-calendar-plus",size:"16",class:rt(u.actionType==="downgrade"?"text-warning":"text-success"),style:{display:"flex","align-items":"center","margin-right":"6px"}},null,8,["class"]),s("span",{class:rt(["text-caption font-weight-medium",u.actionType==="downgrade"?"text-warning":"text-success"]),style:{display:"flex","align-items":"center"}},l(u.actionType==="renew"?o(v)("components.checkoutContent.renewal"):u.actionType==="upgrade"?o(v)("components.checkoutContent.upgrade"):o(v)("components.checkoutContent.downgrade"))+" "+l(o(v)("components.checkoutContent.ends"))+": ",3)]),s("div",ar,l(wt(at())),1)])])]),_:1},8,["style"])])):Z("",!0),s("div",nr,[e(Ha,{variant:"accordion"},{default:a(()=>[e(qa,null,{default:a(()=>[e(Ja,{class:"py-2 px-3"},{default:a(()=>[s("div",lr,[e(k,{size:"18",class:"me-2"},{default:a(()=>[..._[2]||(_[2]=[b("mdi-wallet-outline",-1)])]),_:1}),s("span",null,l(o(v)("components.checkoutContent.manualPaymentDetails")),1)])]),_:1}),e(Xa,{class:"pt-2"},{default:a(()=>[F.value&&F.value.paymentAddr?(g(),R(Ge,{key:0},[s("div",sr,[s("div",ir,[s("div",rr,l(o(v)("components.checkoutContent.address")),1),s("code",cr,l(F.value.paymentAddr),1)]),e(B,{size:"x-small",variant:"text",color:"secondary",icon:"mdi-content-copy",class:"copy-btn","data-clipboard-text":F.value.paymentAddr,style:{"flex-shrink":"0","margin-left":"4px"}},null,8,["data-clipboard-text"])]),s("div",ur,[s("div",dr,[s("div",null,[s("div",pr,l(o(v)("components.checkoutContent.amount")),1),s("code",fr,l(F.value.amount)+" FLUX",1)]),e(B,{size:"x-small",variant:"text",color:"secondary",icon:"mdi-content-copy",class:"copy-btn","data-clipboard-text":F.value.amount,style:{"margin-left":"4px"}},null,8,["data-clipboard-text"])]),s("div",gr,[s("div",mr,[s("div",vr,l(o(v)("components.checkoutContent.message")),1),s("code",hr,"FLUXDRIVE"+l(F.value.subId),1)]),e(B,{size:"x-small",variant:"text",color:"secondary",icon:"mdi-content-copy",class:"copy-btn","data-clipboard-text":"FLUXDRIVE"+F.value.subId,style:{"flex-shrink":"0","margin-left":"4px"}},null,8,["data-clipboard-text"])])])],64)):(g(),R("div",yr,[he.value?(g(),N(kt,{key:0,indeterminate:"",size:"20",width:"2",color:"primary",class:"me-2"})):Z("",!0),b(" "+l(he.value?o(v)("components.checkoutContent.loadingPaymentDetails"):o(v)("components.checkoutContent.paymentDetailsWillAppear")),1)]))]),_:1})]),_:1})]),_:1})])]),ce.value?(g(),R("div",wr,[e(be,{variant:"tonal",color:"info",class:"pa-4"},{default:a(()=>[s("div",xr,[e(kt,{indeterminate:"",size:"48",width:"4",color:"info",class:"mb-3"}),s("div",br,l(o(v)("components.checkoutContent.monitoringPayment")),1),s("div",_r,l(o(v)("components.checkoutContent.waitingForPaymentConfirmation")),1),s("div",kr,[e(k,{color:"warning",size:"16",class:"me-2"},{default:a(()=>[..._[3]||(_[3]=[b("mdi-clock-alert",-1)])]),_:1}),s("span",null,l(o(v)("components.checkoutContent.canTakeUpTo20Minutes")),1)])])]),_:1})])):Z("",!0),ce.value?Z("",!0):(g(),R("div",Pr,[s("div",Sr,[e(be,{variant:"outlined",class:"wallet-icon-card",onClick:pe,hover:""},{default:a(()=>[e(Fe,{class:"d-flex align-center justify-center pa-6"},{default:a(()=>[s("img",{class:"wallet-brand-icon mr-3",src:o(Ka),alt:o(v)("components.checkoutContent.zelcore")},null,8,Cr),s("span",Fr,l(o(v)("components.checkoutContent.zelcore")),1)]),_:1})]),_:1}),e(be,{variant:"outlined",class:"wallet-icon-card",onClick:xe,hover:""},{default:a(()=>[e(Fe,{class:"d-flex align-center justify-center pa-6"},{default:a(()=>[s("img",{class:"wallet-brand-icon mr-3",src:me.value,alt:o(v)("components.checkoutContent.ssp")},null,8,Dr),s("span",zr,l(o(v)("components.checkoutContent.ssp")),1)]),_:1})]),_:1})])])),ce.value?(g(),R("div",$r,[e(B,{variant:"outlined",color:"error",size:"default",block:"",onClick:Et},{default:a(()=>[e(k,{icon:"mdi-close-circle",class:"me-2"}),b(" "+l(o(v)("components.checkoutContent.cancelMonitoring")),1)]),_:1})])):Z("",!0),s("div",Tr,l(o(v)("components.checkoutContent.fluxPriceEstimated")),1)])]),_:1})]),_:1})]),_:1}),e(Ho,{value:"cryptocom"},{default:a(()=>[e(be,{variant:"outlined"},{default:a(()=>[e(Fe,{class:"pa-6"},{default:a(()=>[s("div",Mr,[s("div",Ir,[s("div",Ur,[e(Ut,{src:"/img/cdc_logo.png","max-width":"100",class:"mx-auto"})])]),s("div",Rr,[s("div",Er," $"+l(nt())+" USD / Month ",1),s("div",Lr,[b(l(o(v)("components.checkoutContent.nextAutomaticSubscription"))+":",1),_[4]||(_[4]=s("br",null,null,-1)),b(l(wt(at())),1)])]),s("div",Ar,[M.value?Z("",!0):(g(),N(B,{key:0,color:"primary",size:"default",block:"",loading:Q.value,onClick:zt},{default:a(()=>[e(k,{icon:"mdi-credit-card",class:"me-2"}),b(" "+l(o(v)("components.checkoutContent.generateSubscription")),1)]),_:1},8,["loading"])),M.value?(g(),N(B,{key:1,variant:"outlined",color:"warning",size:"default",block:""},{default:a(()=>[e(k,{icon:"mdi-clock-outline",class:"me-2"}),b(" "+l(o(v)("components.checkoutContent.pendingPayment")),1)]),_:1})):Z("",!0),M.value?(g(),N(B,{key:2,variant:"outlined",color:"error",size:"default",block:"",onClick:Lt},{default:a(()=>[b(l(o(v)("components.checkoutContent.cancel")),1)]),_:1})):Z("",!0)]),s("div",Vr,l(o(v)("components.checkoutContent.subscriptionsChargedMonthly")),1)])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),oe.value?(g(),N(_t,{key:0,type:we.value,class:"mt-4",innerHTML:oe.value},null,8,["type","innerHTML"])):Z("",!0)])):Z("",!0)]))}},Nr=Rt(Or,[["__scopeId","data-v-9a509a14"]]),jr={key:0,class:"benefits-title"},Br={key:1,class:"benefits-subtitle"},Gr={class:"benefit-text-container"},Hr={class:"benefit-text"},qr={__name:"BenefitsGrid",props:{title:{type:String,default:""},subtitle:{type:String,default:""},items:{type:[Array,String],required:!0},gridTemplateColumns:{type:String,default:"repeat(auto-fit, minmax(250px, 1fr))"},iconSize:{type:Number,default:22},iconColor:{type:String,default:"primary"},backgroundColor:{type:String,default:""},padding:{type:String,default:"24px"},elevation:{type:Number,default:0}},setup(G){const T=G,{t:Ve,te:u,locale:se,messages:c}=Dt(),fe=me=>me&&typeof me=="string"&&me.startsWith("i18n:"),z=me=>{if(!me)return"";if(fe(me)){const he=me.replace("i18n:","");return u(he)?Ve(he):me}return me},$e=me=>{try{const he=me.split(".");let $=c.value[se.value];for(const le of he)if($&&typeof $=="object")$=$[le];else break;return $}catch{return null}},ye=ze(()=>z(T.title)),Ce=ze(()=>z(T.subtitle)),ne=ze(()=>{if(typeof T.items=="string"&&fe(T.items)){const me=T.items.replace("i18n:",""),he=$e(me);if(he&&typeof he=="object"){let $=Array.isArray(he)?he:Object.values(he);return $=JSON.parse(JSON.stringify($)),$.map(le=>{const K=Q=>typeof Q=="string"?Q:Q&&typeof Q=="object"?Q.body?.static||Q.loc?.source||Q.static||JSON.stringify(Q):String(Q);return{icon:K(le.icon),text:K(le.text),color:le.color?K(le.color):void 0}})}return[]}return Array.isArray(T.items)?T.items.map(me=>({icon:z(me.icon)||me.icon,text:z(me.text)||me.text,color:me.color})):[]}),v=ze(()=>({padding:T.padding,background:T.backgroundColor||"transparent"})),Ie=ze(()=>({gridTemplateColumns:T.gridTemplateColumns}));return(me,he)=>(g(),N(be,{class:rt(["benefits-grid-card",[{"has-background":G.backgroundColor}]]),elevation:G.elevation},{default:a(()=>[e(Fe,{style:Gt(v.value)},{default:a(()=>[ye.value?(g(),R("h2",jr,l(ye.value),1)):Z("",!0),Ce.value?(g(),R("p",Br,l(Ce.value),1)):Z("",!0),s("div",{class:"benefits-list",style:Gt(Ie.value)},[(g(!0),R(Ge,null,Ft(ne.value,($,le)=>(g(),R("div",{key:le,class:"benefit-item"},[s("div",{class:"benefit-icon",style:Gt({background:`rgba(var(--v-theme-${$.color||G.iconColor}), 0.1)`})},[e(k,{icon:$.icon||"mdi-check-circle",size:G.iconSize,color:$.color||G.iconColor},null,8,["icon","size","color"])],4),s("div",Gr,[s("span",Hr,l($.text),1)])]))),128))],4)]),_:1},8,["style"])]),_:1},8,["class","elevation"]))}},Jr=Rt(qr,[["__scopeId","data-v-ea456072"]]),Xr={class:"fluxdrive-page"},Wr={key:1,class:"plans-container"},Yr={key:2},Zr={class:"text-h5 d-flex align-center",style:{color:"white"}},Co="https://cloud.runonflux.com/flux-drive",Kr="FluxDrive - Decentralized IPFS Cloud Storage | Flux Network",Qr="Secure IPFS cloud storage on Flux network. Store files across distributed FluxNodes with encryption, redundancy & censorship resistance. Decentralized.",Yo="https://cloud.runonflux.com/banner/FluxDriveBanner.png",ec={__name:"flux-drive",setup(G){const{t:T}=Dt(),Ve=Ko(),u={"@context":"https://schema.org","@type":"SoftwareApplication",name:"FluxDrive",applicationCategory:"BusinessApplication",operatingSystem:"Web",offers:{"@type":"AggregateOffer",priceCurrency:"USD",lowPrice:"5",highPrice:"50",offerCount:"4"},description:"Decentralized cloud storage solution built on IPFS and the Flux network. Encrypted, distributed file storage with censorship resistance.",url:Co,image:Yo,provider:{"@type":"Organization",name:"Flux Network",url:"https://runonflux.com"},featureList:["IPFS-based decentralized storage","End-to-end encryption","Distributed across FluxNodes","Censorship resistant","No centralized providers","Permanent file availability","Redundant storage"]},se=[{question:"What is FluxDrive?",answer:"FluxDrive is a decentralized cloud storage solution built on IPFS and the Flux network. It provides secure, encrypted file storage distributed across thousands of FluxNodes worldwide, ensuring censorship resistance and permanent file availability."},{question:"How much does FluxDrive cost?",answer:"FluxDrive offers flexible pricing starting from $5/month for 100GB of storage. Plans range up to $50/month for 1000GB, with a daily rate of $0.0017 per GB. Enterprise custom plans are also available."},{question:"Is my data encrypted on FluxDrive?",answer:"Yes, all files uploaded to FluxDrive are encrypted end-to-end. Your data is secured with strong encryption and distributed across multiple FluxNodes, ensuring privacy and security."},{question:"How is FluxDrive different from traditional cloud storage?",answer:"Unlike traditional centralized cloud storage, FluxDrive is completely decentralized. Your files are stored across a global network of FluxNodes using IPFS technology, making them censorship-resistant with no single point of failure. There are no centralized providers that can access or control your data."},{question:"What happens if I cancel my FluxDrive subscription?",answer:"If you cancel your subscription, you will retain access to your files until the end of your billing period. After that, your files will be removed from the network. We recommend downloading your files before cancellation."}];Pa({title:Kr,description:Qr,url:Co,image:Yo,imageAlt:"FluxDrive - Decentralized IPFS Cloud Storage",keywords:"decentralized storage, IPFS storage, cloud storage, blockchain storage, distributed storage, encrypted storage, Flux network, censorship resistant storage, Web3 storage, decentralized cloud, permanent storage, IPFS, FluxDrive, file storage, secure storage, private cloud",robots:"index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1",structuredData:[u,Sa(),Ca([{name:"Home",url:"https://cloud.runonflux.com"},{name:"FluxDrive",url:Co}]),Fa(se)]});const{isLoggedIn:c,hasActiveSubscription:fe,subscriptionChecked:z,subscriptionPeriodEnd:$e,openLoginBottomSheet:ye,loadFiles:Ce,checkSubscriptionStatus:ne,initializeFluxDrive:v,handlePostLogin:Ie,getPlanStatus:me,renewSubscription:he,upgradeSubscription:$,usedStorage:le,resetFluxDriveState:K}=qt(),Q=Do(),ce=ze(()=>le.value>0),M=ze(()=>fe.value||ce.value||$e.value!==null),F=[{icon:"mdi-lock-outline",color:"primary",title:T("pages.fluxDrive.features.encryption.title"),description:T("pages.fluxDrive.features.encryption.description")},{icon:"mdi-server-network",color:"success",title:T("pages.fluxDrive.features.distributed.title"),description:T("pages.fluxDrive.features.distributed.description")},{icon:"mdi-shield-check",color:"warning",title:T("pages.fluxDrive.features.censorship.title"),description:T("pages.fluxDrive.features.censorship.description")},{icon:"mdi-cloud-check",color:"info",title:T("pages.fluxDrive.features.ipfs.title"),description:T("pages.fluxDrive.features.ipfs.description")},{icon:"mdi-check-decagram",color:"success",title:T("pages.fluxDrive.features.permanent.title"),description:T("pages.fluxDrive.features.permanent.description")},{icon:"mdi-lightning-bolt",color:"error",title:T("pages.fluxDrive.features.fast.title"),description:T("pages.fluxDrive.features.fast.description")},{icon:"mdi-cash-refund",color:"success",title:T("pages.fluxDrive.features.guarantee.title"),description:T("pages.fluxDrive.features.guarantee.description")}],O=[{icon:"mdi-shield-check",color:"primary",text:T("pages.fluxDrive.benefits.noCentralized")},{icon:"mdi-key",color:"success",text:T("pages.fluxDrive.benefits.fullControl")},{icon:"mdi-earth",color:"info",text:T("pages.fluxDrive.benefits.globalRedundancy")},{icon:"mdi-currency-usd",color:"warning",text:T("pages.fluxDrive.benefits.transparentPricing")},{icon:"mdi-lock-open-variant",color:"error",text:T("pages.fluxDrive.benefits.noVendorLock")},{icon:"mdi-code-braces",color:"secondary",text:T("pages.fluxDrive.benefits.openSource")}],te=S(!1),oe=S(""),we=S(""),ue=ze(()=>{const E=we.value;return T(E==="renew"?"pages.fluxDrive.renewal":E==="upgrade"?"pages.fluxDrive.upgrade":E==="downgrade"?"pages.fluxDrive.downgrade":"pages.fluxDrive.checkout")}),X=S(null),de=S(null),Ye=async(E,W=null)=>{if(console.log("ğŸ¯ Plan selected:",E,"Action:",W),Ve.trackFluxDrive("plan_selected",{plan_id:E,action_type:W||"browse"}),W==="signin"){console.log("ğŸ” Sign in action - showing login dialog without plan selection"),ye();return}if(console.log("ğŸ” Current subscription status:",{isLoggedIn:c.value,hasActiveSubscription:fe.value,planStatus:E?me(E):"N/A"}),E==="enterprise"){window.open("https://support.runonflux.io","_blank","noopener,noreferrer");return}if(!W&&fe.value){const xe=me(E);console.log("ğŸ” Plan status for",E,":",xe),xe==="current"?W="renew":xe==="upgrade"?W="upgrade":xe==="downgrade"&&(W="downgrade")}else W||(W="signup");console.log("âœ… Final determined action type:",W);const Ue=localStorage.getItem("zelidauth"),pe=(()=>{if(Ue)try{return(Ue.includes("zelid=")?Object.fromEntries(new URLSearchParams(Ue)):JSON.parse(Ue)).zelid||Q.zelid}catch{return Q.zelid}return Q.zelid})();if(!Ue||!pe){console.log("ğŸ” User not logged in - saving plan selection for after login:",E),ye(),oe.value=E;return}if(W==="renew"){try{console.log("ğŸ”„ Processing renewal for plan:",E);const xe=await he(E);console.log("ğŸ” Renewal result analysis:"),console.log("  - Has checkout_url:",!!xe.checkout_url),console.log("  - Has new_plan:",!!xe.new_plan),console.log("  - Has subscription:",!!xe.subscription),console.log("  - Result keys:",Object.keys(xe)),xe.checkout_url||xe.new_plan?(console.log("ğŸ’³ Payment required - opening checkout dialog"),oe.value=E,we.value=W,te.value=!0):xe.subscription?(console.log("âœ… Renewal completed successfully"),await ne(),alert(T("pages.fluxDrive.renewalSuccess"))):(console.log("âš ï¸ Unexpected response - opening checkout as fallback"),oe.value=E,we.value=W,te.value=!0),X.value?.clearRenewalState&&X.value.clearRenewalState()}catch(xe){console.error("âŒ Renewal failed:",xe),alert(T("pages.fluxDrive.renewalFailed")+xe.message),oe.value=E,we.value=W,te.value=!0,X.value?.clearRenewalState&&X.value.clearRenewalState()}return}if(W==="upgrade"){try{console.log("ğŸ”„ Processing upgrade for plan:",E);const xe=await $(E);xe.checkout_url||xe.new_plan?(oe.value=E,we.value=W,te.value=!0):(console.log("âœ… Upgrade completed successfully"),await ne()),X.value?.clearRenewalState&&X.value.clearRenewalState()}catch(xe){console.error("âŒ Upgrade failed:",xe),oe.value=E,we.value=W,te.value=!0,X.value?.clearRenewalState&&X.value.clearRenewalState()}return}if(W==="downgrade"){console.log("ğŸ”„ Processing downgrade for plan:",E),console.log("ğŸ“Š Setting checkout values:"),console.log("  - selectedCheckoutPlan:",E),console.log("  - selectedActionType:",W),oe.value=E,we.value=W,te.value=!0,console.log("âœ… Checkout dialog should open with downgrade action");return}oe.value=E,we.value=W,te.value=!0};Bt(c,async(E,W)=>{if(E&&!W)if(console.log("Login successful - processing..."),await Ie(),oe.value){if(console.log("ğŸ¯ Found pending plan selection:",oe.value),!we.value)if(fe.value){const Ue=me(oe.value);we.value=Ue==="current"?"renew":Ue==="downgrade"?"downgrade":"upgrade"}else we.value="signup";console.log("ğŸ’³ Opening checkout for pending plan:",oe.value,"Action:",we.value),te.value=!0}else console.log("âœ… Login complete - showing appropriate interface based on subscription status"),console.log("ğŸ“Š hasActiveSubscription:",fe.value),console.log("ğŸ“Š subscriptionChecked:",z.value),oe.value="",we.value=""});const Pe=async()=>{Ve.trackFluxDrive("payment_success",{plan_id:oe.value,action_type:we.value}),te.value=!1,oe.value="",we.value="",console.log("ğŸ‰ Payment successful - refreshing FluxDrive data..."),X.value?.clearRenewalState&&X.value.clearRenewalState(),await new Promise(E=>setTimeout(E,2e3)),await ne(),await Ce(!0),console.log("âœ… FluxDrive data refreshed after payment success")},Ke=E=>{console.error("Payment error:",E)},Oe=()=>{console.log("ğŸšª Closing checkout dialog and cleaning up payment monitoring"),de.value&&de.value.cleanupPaymentMonitoring&&de.value.cleanupPaymentMonitoring(),X.value?.clearRenewalState&&X.value.clearRenewalState(),te.value=!1};return Bt(fe,(E,W)=>{console.log("ğŸ”„ Subscription status changed:",{oldValue:W,newValue:E}),console.log(E?"âœ… Subscription became active - should show file manager":"âŒ Subscription became inactive - should show pricing plans")},{immediate:!0}),Bt(()=>Q.privilege,(E,W)=>{console.log("ğŸ”„ Privilege changed:",{oldPrivilege:W,newPrivilege:E}),E==="none"&&W!=="none"&&(console.log("ğŸšª User logged out - clearing FluxDrive state"),K())}),po(async()=>{console.log("ğŸ”„ FluxDrive page mounted"),console.log("ğŸ” Initial hasActiveSubscription value:",fe.value),console.log("ğŸ” Initial isLoggedIn value:",c.value),Ve.trackFluxDrive("page_view",{page:"fluxdrive",has_subscription:fe.value,is_logged_in:c.value}),oe.value="",we.value="",te.value=!1,console.log("ğŸ§¹ Cleared any stale checkout selections"),await v(),console.log("ğŸ” After initialization hasActiveSubscription value:",fe.value),fe.value?console.log("âœ… Active subscription detected - FileManager will load files"):console.log("ğŸ“‹ Showing pricing plans - no active subscription")}),(E,W)=>(g(),R("div",Xr,[o(z)?(g(),R(Ge,{key:1},[M.value?Z("",!0):(g(),N(tn,{key:0,title:o(T)("pages.fluxDrive.intro.title"),subtitle:o(T)("pages.fluxDrive.intro.subtitle"),"background-image":"/banner/FluxDrive2.webp",icon:"mdi-cloud-upload","icon-aria-label":"FluxDrive Cloud Storage","min-height":"300px"},null,8,["title","subtitle"])),M.value?(g(),R("div",Yr,[e(Ks,{ref_key:"fileManagerRef",ref:X,onSelectPlan:Ye},null,512),e(di)])):(g(),R("div",Wr,[e(ta,{onSelectPlan:W[0]||(W[0]=(Ue,pe)=>Ye(Ue,pe))}),e(Qa,{title:o(T)("pages.fluxDrive.features.title"),items:F,"grid-min-width":"300px"},null,8,["title"]),e(Jr,{title:o(T)("pages.fluxDrive.benefits.title"),items:O,"grid-template-columns":"repeat(2, 1fr)"},null,8,["title"]),e(en,{"use-live-data":"","star-size":32,"show-rating-label":""})]))],64)):(g(),N(Qo,{key:0,icon:"mdi-cloud","icon-size":56,title:o(T)("pages.fluxDrive.loading")},null,8,["title"])),e(ot,{modelValue:te.value,"onUpdate:modelValue":W[1]||(W[1]=Ue=>te.value=Ue),"max-width":E.$vuetify.display.xs?"95vw":"1200",width:E.$vuetify.display.xs?"95vw":"90vw",fullscreen:E.$vuetify.display.xs,persistent:"",scrollable:""},{default:a(()=>[e(be,null,{default:a(()=>[e(it,{class:"d-flex align-center pa-2",style:{"background-color":"rgb(var(--v-theme-primary))",color:"white"}},{default:a(()=>[s("h3",Zr,[e(k,{icon:we.value==="renew"?"mdi-refresh":we.value==="upgrade"?"mdi-arrow-up-bold":we.value==="downgrade"?"mdi-arrow-down-bold":"mdi-plus",class:"me-2",style:{color:"white"}},null,8,["icon"]),b(" FluxDrive "+l(ue.value),1)]),e(Qe),e(B,{icon:"mdi-close",variant:"text",color:"white",onClick:Oe})]),_:1}),e(Fe,{class:"pa-6 pt-4"},{default:a(()=>[e(Nr,{ref_key:"checkoutContentRef",ref:de,"plan-id":oe.value,"action-type":we.value,gateway:"fluxpay",onSuccess:Pe,onClose:Ke},null,8,["plan-id","action-type"])]),_:1})]),_:1})]),_:1},8,["modelValue","max-width","width","fullscreen"])]))}},Uc=Rt(ec,[["__scopeId","data-v-6a7dfd6d"]]);export{Uc as default};
