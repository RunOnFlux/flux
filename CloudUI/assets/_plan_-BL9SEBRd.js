import{u as oe,e as le}from"./vue-core-CU9AIURn.js";import{_ as ne,c as ce}from"./index-QPPWK7xw.js";import{u as ie}from"./useSnackbar-CwwIX0V_.js";import{u as re}from"./useSEO-5BaNf11O.js";import{q as j}from"./query-parser-C3-dT-Rr.js";import{u as B}from"./useAnalytics-CteLaQrD.js";import{q as ue,o as de,p as O,V as I,a as W,d as V,Q as pe,b as w,r as N,s as me,G as he,J as G,Y as ge,Z as Q,R as $,X as fe,_ as X,c as R}from"./vuetify-_4u1He_j.js";import{u as ye}from"./i18n-Bm8bpAAW.js";import{c as M,r as g,w as J,o as _e,f as b,g as f,a3 as o,Q as c,j as a,T as h,U as t,y as n,x as P,P as F}from"./apexcharts-nIAyciCq.js";import"./crypto-metamask-D6vz180a.js";import"./ansi-utils-ChIB8aIv.js";import"./socketio-BDGyx5_k.js";import"./uuid-B49X2dQj.js";import"./vueuse-Bid7ZbHY.js";import"./unhead-DEOrWl0D.js";import"./cookie-BfmCf_44.js";import"./unjs-utils-GcjLqAqW.js";import"./http-BZQDkn3h.js";import"./casl-DNC8KRD8.js";import"./scrollbar-CXs_Utq1.js";import"./icons-mdi-_QP0sdRJ.js";import"./sanitizer-DAUAC_Zc.js";import"./element-plus-Cr1Qs4Q_.js";import"./lodash-C_Sw0jJq.js";const ve={class:"text-center mb-8"},xe={class:"text-h3 font-weight-bold mb-4"},we={class:"text-primary"},ke={class:"text-h6 text-medium-emphasis"},be={key:0,class:"mb-6"},Pe={class:"d-flex align-center mb-4"},ze={class:"text-h5"},Se={class:"text-body-2 text-medium-emphasis mb-0"},Ce={class:"d-flex justify-space-between mb-2"},Ie={class:"font-weight-medium"},Ve={class:"d-flex justify-space-between mb-2"},Te={class:"d-flex justify-space-between mb-2"},Le={class:"d-flex justify-space-between text-h6 font-weight-bold"},Ae={class:"text-primary"},je={key:1,class:"mt-6"},Re={class:"text-h6 mb-3"},Fe={class:"d-flex justify-space-between mb-2"},De={class:"d-flex justify-space-between mb-2"},Ue={class:"d-flex justify-space-between mb-2"},Ne={key:2,class:"text-center py-8"},$e={class:"text-body-2 mt-3"},Me={key:3,class:"text-center py-8"},Ze={class:"text-body-1"},Ee={class:"text-center"},qe={class:"text-h5 mb-2"},Be={class:"text-body-1 text-medium-emphasis mb-6"},Oe={key:0,class:"mb-6"},We={class:"d-flex justify-space-between"},Ge={class:"font-weight-bold"},Qe={class:"d-flex justify-space-between"},Xe={class:"d-flex flex-column gap-3"},Je={class:"text-center"},Ye={class:"text-h5 mb-2"},He={class:"text-body-1 text-medium-emphasis mb-6"},Ke={class:"d-flex align-center"},ea={class:"text-h6 mb-1"},aa={class:"text-body-2 text-medium-emphasis mb-0"},D="jetpackbridge.runonflux.io",sa={__name:"[plan]",setup(ta){re();const{t:e}=ye(),Z=oe(),Y=le(),d=ce(),{showSnackbar:H}=ie(),T=M(()=>Z.params.gateway),z=M(()=>Z.params.plan),p=g(null),v=g(null),K=g(null),x=g(!0),y=g("fluxpay"),k=g(!1),_=g(!1),L=g(""),U=g("info"),S=g(null),C=M(()=>{const l=localStorage.getItem("zelidauth"),s=d.zelid&&d.zelid.length>0;return l&&l.length>0,console.log("isLoggedIn computed - zelidauth:",!!l),console.log("isLoggedIn computed - fluxStore.zelid:",d.zelid),console.log("isLoggedIn computed - result:",!!(l&&s)),!!(l&&s)}),E=async()=>{if(!C.value){x.value=!1;return}try{const l=localStorage.getItem("zelidauth");if(!l){r(e("pages.checkout.messages.authenticationRequired"));return}const s=j.parse(l);if(console.log("LoadSubscriptionData - Parsed auth:",{hasZelid:!!s.zelid,zelid:s.zelid?s.zelid.substring(0,8)+"...":"none",hasSignature:!!s.signature,hasLoginPhrase:!!s.loginPhrase}),!s.zelid||!s.signature||!s.loginPhrase){console.error("LoadSubscriptionData - Missing auth fields"),r(e("pages.checkout.messages.invalidAuthData"));return}const m=s.signature,i=s.loginPhrase;console.log("LoadSubscriptionData - Auth fields present:",{hasSignature:!!m,hasLoginPhrase:!!i});const u=await(await fetch(`https://${D}/api/v1/subscriptions.php`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({action:"READ",plan_name:z.value,gateway:T.value,zelid:d.zelid,signature:m,loginPhrase:i})})).json();if(console.log("Subscription API response:",u),u.error){console.error("API Error:",u.error),r(u.error);return}if(u.warning){console.warn("API Warning:",u.warning),r(u.warning,"warning");return}K.value=u,v.value=u,u.new_plan?(console.log("New plan data:",u.new_plan),p.value={id:u.new_plan.plan_name,name:u.new_plan.plan_name.charAt(0).toUpperCase()+u.new_plan.plan_name.slice(1),storage:`${u.new_plan.storage} GB`,pricePerMonth:`$${(u.new_plan.price/100).toFixed(2)}`,priceInCents:u.new_plan.price,gateway:u.new_plan.gateway,gatewayName:u.new_plan.gateway_name||"Flux Pay"},A(),console.log("Selected plan set:",p.value)):(console.warn("No new_plan in response, full response:",u),r(e("pages.checkout.messages.planDetailsNotAvailable")))}catch(l){console.error("Subscription load error:",l),r(`${e("pages.checkout.messages.subscriptionLoadFailed")}: ${l.message}`)}finally{x.value=!1}},A=()=>{L.value="",U.value="info"},r=(l,s="error")=>{L.value=l,U.value=s},ee=async()=>{if(!C.value){r(e("pages.checkout.messages.pleaseLoginFirst"),"warning");return}k.value=!0;try{const l=localStorage.getItem("zelidauth");if(!l){r(e("pages.checkout.messages.authenticationRequired"));return}const s=j.parse(l);if(!s.zelid||!s.signature||!s.loginPhrase){r(e("pages.checkout.messages.invalidAuth"));return}const i=await(await fetch(`https://${D}/api/v1/fluxpay.php`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({action:"INITIALIZE",plan_name:z.value,zelid:d.zelid,signature:s.signature,loginPhrase:s.loginPhrase})})).json();i.success?(S.value={amount:i.flux_amount,usdValue:(p.value.priceInCents/100).toFixed(2),paymentId:i.payment_id},_.value=!0,i.zelcore_url&&window.open(i.zelcore_url,"_blank"),se(i.payment_id)):r(i.error||e("pages.checkout.messages.paymentFailed"))}catch(l){r(e("pages.checkout.messages.paymentInitFailed")),console.error("Payment error:",l)}finally{k.value=!1}},ae=async()=>{if(!C.value){r(e("pages.checkout.messages.pleaseLoginFirst"),"warning");return}k.value=!0;try{const l=localStorage.getItem("zelidauth");if(!l){r(e("pages.checkout.messages.authenticationRequired"));return}const s=j.parse(l);if(!s.zelid||!s.signature||!s.loginPhrase){r(e("pages.checkout.messages.invalidAuth"));return}const i=await(await fetch(`https://${D}/api/v1/cryptocom.php`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({action:"INITIALIZE",plan_name:z.value,zelid:d.zelid,signature:s.signature,loginPhrase:s.loginPhrase})})).json();i.success&&i.checkout_url?window.location.href=i.checkout_url:r(i.error||e("pages.checkout.messages.cryptoComPaymentFailed"))}catch(l){r(e("pages.checkout.messages.cryptoComInitFailed")),console.error("Crypto.com error:",l)}finally{k.value=!1}},se=async l=>{const s=async()=>{try{const i=await(await fetch(`https://${D}/api/v1/fluxpay.php`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({action:"STATUS",payment_id:l,zelid:d.zelid})})).json();i.status==="completed"?(_.value=!1,H(e("pages.checkout.messages.paymentSuccessfulRedirecting"),"success"),await d.refreshUserData(),setTimeout(()=>{Y.push("/flux-drive")},2e3)):i.status==="failed"?(_.value=!1,r(e("pages.checkout.messages.paymentFailedRetry"))):_.value&&setTimeout(s,3e3)}catch(m){console.error("Payment status check failed:",m),_.value&&setTimeout(s,5e3)}};s()},te=()=>{_.value=!1,S.value=null,A()};J(C,l=>{console.log("Checkout - login state changed:",l),l?(A(),E()):(r(e("pages.checkout.messages.pleaseLoginToContinue"),"warning"),x.value=!1)}),_e(async()=>{T.value&&["fluxpay","cryptocom"].includes(T.value)?y.value=T.value:y.value="fluxpay",B().trackPaymentSystemSelected(y.value,{plan:z.value,plan_name:p.value?.name,price:p.value?.pricePerMonth});const s=localStorage.getItem("zelidauth");if(s){const i=j.parse(s);i.zelid&&!d.zelid&&(console.log("Restoring zelid from localStorage:",i.zelid.substring(0,8)+"..."),d.setZelid(i.zelid),d.privilege==="none"&&d.setPrivilege("user"))}await new Promise(i=>setTimeout(i,100));const m=d.zelid&&d.zelid.length>0;console.log("Checkout - isLoggedIn computed:",C.value),console.log("Checkout - fluxStore.zelid:",d.zelid),console.log("Checkout - zelidauth exists:",!!s),console.log("Checkout - hasZelid:",m),s&&m?(console.log("Loading subscription data"),E()):s?(r(e("pages.checkout.messages.sessionExpired"),"warning"),x.value=!1):(r(e("pages.checkout.messages.pleaseLoginToContinue"),"warning"),x.value=!1)});let q=!1;return J(y,(l,s)=>{if(!q){q=!0;return}s&&l!==s&&B().trackPaymentSystemSelected(l,{plan:z.value,plan_name:p.value?.name,price:p.value?.pricePerMonth,previous_method:s,user_changed:!0})}),(l,s)=>(f(),b("div",null,[o(ue,{class:"py-8"},{default:c(()=>[a("div",ve,[a("h1",xe,[a("span",we,t(n(e)("pages.checkout.header.title")),1),h(" "+t(n(e)("pages.checkout.title")),1)]),a("p",ke,t(n(e)("pages.checkout.header.subtitle")),1)]),o(de,null,{default:c(()=>[o(O,{cols:"12",md:"4"},{default:c(()=>[o(I,{class:"h-100"},{default:c(()=>[o(W,{class:"text-h5 pa-6 pb-4"},{default:c(()=>[h(t(n(e)("pages.checkout.orderSummary.title")),1)]),_:1}),o(V,{class:"pa-6 pt-0"},{default:c(()=>[p.value?(f(),b("div",be,[a("div",Pe,[o(pe,{size:"60",color:"primary",variant:"tonal",class:"me-4"},{default:c(()=>[o(w,{icon:"mdi-cloud-upload-outline",size:"30"})]),_:1}),a("div",null,[a("h3",ze,t(p.value.name),1),a("p",Se,t(p.value.storage)+" "+t(n(e)("common.labels.storage")),1)])]),o(N,{class:"mb-4"}),a("div",Ce,[a("span",null,t(n(e)("pages.checkout.orderSummary.plan")),1),a("span",Ie,t(p.value.name),1)]),a("div",Ve,[a("span",null,t(n(e)("pages.checkout.orderSummary.storage")),1),a("span",null,t(p.value.storage),1)]),a("div",Te,[a("span",null,t(n(e)("pages.checkout.orderSummary.billing")),1),a("span",null,t(n(e)("pages.checkout.orderSummary.monthly")),1)]),o(N,{class:"my-4"}),a("div",Le,[a("span",null,t(n(e)("pages.checkout.orderSummary.total")),1),a("span",Ae,t(p.value.pricePerMonth),1)])])):P("",!0),v.value&&v.value.plan_name?(f(),b("div",je,[o(N,{class:"mb-4"}),a("h4",Re,t(n(e)("pages.checkout.orderSummary.currentPlan")),1),a("div",Fe,[a("span",null,t(n(e)("pages.checkout.orderSummary.plan")),1),a("span",null,t(v.value.plan_name),1)]),a("div",De,[a("span",null,t(n(e)("pages.checkout.orderSummary.storage")),1),a("span",null,t(v.value.storage)+" "+t(n(e)("common.units.gb")),1)]),a("div",Ue,[a("span",null,t(n(e)("pages.checkout.orderSummary.status")),1),o(me,{color:v.value.payment_status==="active"?"success":"warning",size:"small"},{default:c(()=>[h(t(v.value.payment_status),1)]),_:1},8,["color"])])])):P("",!0),!p.value&&x.value?(f(),b("div",Ne,[o(he,{indeterminate:"",size:"40",width:"3",color:"primary"}),a("p",$e,t(n(e)("pages.checkout.loading.planDetails")),1)])):!p.value&&!x.value?(f(),b("div",Me,[o(w,{icon:"mdi-alert-circle-outline",size:"48",class:"mb-3 text-warning"}),a("p",Ze,t(n(e)("pages.checkout.loading.unableToLoad")),1)])):P("",!0)]),_:1})]),_:1})]),_:1}),o(O,{cols:"12",md:"8"},{default:c(()=>[o(I,null,{default:c(()=>[o(W,{class:"text-h5 pa-6 pb-4"},{default:c(()=>[h(t(n(e)("pages.checkout.paymentMethod.title")),1)]),_:1}),o(V,{class:"pa-6 pt-0"},{default:c(()=>[L.value?(f(),F(G,{key:0,type:U.value,class:"mb-6",dismissible:"","onClick:close":A},{default:c(()=>[h(t(L.value),1)]),_:1},8,["type"])):P("",!0),o(ge,{modelValue:y.value,"onUpdate:modelValue":s[0]||(s[0]=m=>y.value=m),class:"mb-6",color:"primary","slider-color":"primary"},{default:c(()=>[o(Q,{value:"fluxpay"},{default:c(()=>[o($,{src:l.$vuetify.theme.current.dark?"/img/flux_white_logo.png":"/img/flux-symbol.png","max-width":"20","max-height":"20",class:"me-2"},null,8,["src"]),h(" "+t(n(e)("pages.checkout.paymentMethod.fluxPay")),1)]),_:1}),o(Q,{value:"cryptocom"},{default:c(()=>[o(w,{icon:"mdi-credit-card",class:"me-2"}),h(" "+t(n(e)("pages.checkout.paymentMethod.cryptoCom")),1)]),_:1})]),_:1},8,["modelValue"]),o(fe,{modelValue:y.value,"onUpdate:modelValue":s[1]||(s[1]=m=>y.value=m)},{default:c(()=>[o(X,{value:"fluxpay"},{default:c(()=>[o(I,{variant:"outlined"},{default:c(()=>[o(V,{class:"pa-6"},{default:c(()=>[a("div",Ee,[o($,{src:"/img/zelcore-login.jpg","max-width":"200",class:"mx-auto mb-4 rounded"}),a("h3",qe,t(n(e)("pages.checkout.fluxPay.title")),1),a("p",Be,t(n(e)("pages.checkout.fluxPay.subtitle")),1),S.value?(f(),b("div",Oe,[o(G,{type:"info",class:"mb-4 text-start"},{default:c(()=>[a("div",We,[a("span",null,t(n(e)("pages.checkout.fluxPay.amount")),1),a("span",Ge,t(S.value.amount)+" FLUX",1)]),a("div",Qe,[a("span",null,t(n(e)("pages.checkout.fluxPay.usdValue")),1),a("span",null,"$"+t(S.value.usdValue),1)])]),_:1})])):P("",!0),a("div",Xe,[_.value?(f(),F(R,{key:1,color:"success",size:"large",block:"",loading:""},{default:c(()=>[o(w,{icon:"mdi-clock-outline",class:"me-2"}),h(" "+t(n(e)("pages.checkout.fluxPay.waitingForPayment")),1)]),_:1})):(f(),F(R,{key:0,color:"primary",size:"large",block:"",loading:k.value,onClick:ee},{default:c(()=>[o(w,{icon:"mdi-wallet",class:"me-2"}),h(" "+t(n(e)("pages.checkout.fluxPay.openWallet")),1)]),_:1},8,["loading"])),_.value?(f(),F(R,{key:2,variant:"outlined",color:"error",size:"large",block:"",onClick:te},{default:c(()=>[h(t(n(e)("pages.checkout.fluxPay.cancelPayment")),1)]),_:1})):P("",!0)])])]),_:1})]),_:1})]),_:1}),o(X,{value:"cryptocom"},{default:c(()=>[o(I,{variant:"outlined"},{default:c(()=>[o(V,{class:"pa-6"},{default:c(()=>[a("div",Je,[o($,{src:"/img/crypto-com.png","max-width":"200",class:"mx-auto mb-4"}),a("h3",Ye,t(n(e)("pages.checkout.cryptoCom.title")),1),a("p",He,t(n(e)("pages.checkout.cryptoCom.subtitle")),1),o(R,{color:"primary",size:"large",block:"",loading:k.value,onClick:ae},{default:c(()=>[o(w,{icon:"mdi-credit-card",class:"me-2"}),h(" "+t(n(e)("pages.checkout.cryptoCom.continue")),1)]),_:1},8,["loading"])])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),o(I,{variant:"outlined",class:"mt-8"},{default:c(()=>[o(V,{class:"pa-6"},{default:c(()=>[a("div",Ke,[o(w,{icon:"mdi-shield-check",color:"success",class:"me-3",size:"24"}),a("div",null,[a("h4",ea,t(n(e)("pages.checkout.security.title")),1),a("p",aa,t(n(e)("pages.checkout.security.message")),1)])])]),_:1})]),_:1})]),_:1})]))}},Va=ne(sa,[["__scopeId","data-v-8533eae5"]]);export{Va as default};
