import{c as T,a1 as E,P as V,g as p,Q as n,a3 as o,R as C,T as N,U as m,y as f,a2 as A,f as R,F as B,l as F,x as I,j as _,m as j,q as J,L,r as q,o as H}from"./apexcharts-nIAyciCq.js";import{C as Q}from"./scrollbar-CXs_Utq1.js";import{b as S,y as G,V as X,P as Y,a as K,s as W,F as Z,r as O,z as ee,A as P,Q as te,R as oe,g as se,D as ae,d as ne,c as ie,x as re}from"./vuetify-_4u1He_j.js";import{u as le}from"./i18n-Bm8bpAAW.js";const ce=k=>k?k.split(" ").map(r=>r.charAt(0).toUpperCase()).join(""):"",de={class:"d-flex align-start gap-3"},ue={key:0},fe={class:"text-sm font-weight-medium mb-1"},me={class:"text-body-2 mb-2",style:{"letter-spacing":"0.4px !important","line-height":"18px"}},pe={class:"text-sm text-disabled mb-0",style:{"letter-spacing":"0.4px !important","line-height":"18px"}},ve={class:"d-flex flex-column align-end"},ge={__name:"Notifications",props:{notifications:{type:Array,required:!0},badgeProps:{type:Object,required:!1,default:void 0},location:{type:null,required:!1,default:"bottom end"}},emits:["read","unread","remove","removeAll","click:notification"],setup(k,{emit:s}){const r=k,v=s,{t:c}=le(),b=T(()=>r.notifications.some(l=>l.isSeen===!1)),y=()=>{const l=r.notifications.map(g=>g.id);b.value?v("read",l):v("unread",l)},$=T(()=>r.notifications.filter(l=>l.isSeen===!1).length),U=(l,g)=>{l?v("unread",[g]):v("read",[g])},z=()=>{v("removeAll")};return(l,g)=>{const w=E("IconBtn");return p(),V(re,L(r.badgeProps,{"model-value":r.notifications.some(t=>!t.isSeen),color:"error",bordered:""}),{default:n(()=>[o(w,{id:"notification-btn"},{default:n(()=>[o(S,{icon:"tabler-bell"}),o(G,{activator:"parent",width:"380px",location:r.location,offset:"12px","close-on-content-click":!1},{default:n(()=>[o(X,{class:"d-flex flex-column"},{default:n(()=>[o(Y,{class:"notification-section"},{append:n(()=>[C(o(W,{size:"small",color:"primary",class:"me-2"},{default:n(()=>[N(m(f(c)("core.notifications.newCount",{count:f($)})),1)]),_:1},512),[[A,r.notifications.some(t=>!t.isSeen)]]),C(o(w,{size:"34",onClick:y},{default:n(()=>[o(S,{size:"20",color:"high-emphasis",icon:f(b)?"tabler-mail-opened":"tabler-mail"},null,8,["icon"]),o(Z,{activator:"parent",location:"start"},{default:n(()=>[N(m(f(b)?f(c)("core.notifications.markAllAsRead"):f(c)("core.notifications.markAllAsUnread")),1)]),_:1})]),_:1},512),[[A,r.notifications.length]])]),default:n(()=>[o(K,{class:"text-h6"},{default:n(()=>[N(m(f(c)("core.notifications.notifications")),1)]),_:1})]),_:1}),o(O),o(f(Q),{options:{wheelPropagation:!1},style:{"max-block-size":"23.75rem"}},{default:n(()=>[o(ee,{class:"notification-list rounded-0 py-0"},{default:n(()=>[(p(!0),R(B,null,F(r.notifications,(t,M)=>(p(),R(B,{key:t.title},[M>0?(p(),V(O,{key:0})):I("",!0),o(P,{link:"",lines:"one","min-height":"66px",class:"list-item-hover-class",onClick:x=>l.$emit("click:notification",t)},{default:n(()=>[_("div",de,[o(te,{color:t.color&&!t.img?t.color:void 0,variant:t.img?void 0:"tonal"},{default:n(()=>[t.text?(p(),R("span",ue,m(("avatarText"in l?l.avatarText:f(ce))(t.text)),1)):I("",!0),t.img?(p(),V(oe,{key:1,src:t.img},null,8,["src"])):I("",!0),t.icon?(p(),V(S,{key:2,icon:t.icon},null,8,["icon"])):I("",!0)]),_:2},1032,["color","variant"]),_("div",null,[_("p",fe,m(t.title),1),_("p",me,m(t.subtitle),1),_("p",pe,m(t.time),1)]),o(se),_("div",ve,[o(S,{size:"10",icon:"tabler-circle-filled",color:t.isSeen?"#a8aaae":"primary",class:J([`${t.isSeen?"visible-in-hover":""}`,"mb-2"]),onClick:j(x=>U(t.isSeen,t.id),["stop"])},null,8,["color","class","onClick"]),o(S,{size:"20",icon:"tabler-x",class:"visible-in-hover",onClick:x=>l.$emit("remove",t.id)},null,8,["onClick"])])])]),_:2},1032,["onClick"])],64))),128)),C(o(P,{class:"text-center text-medium-emphasis",style:{"block-size":"56px"}},{default:n(()=>[o(ae,null,{default:n(()=>[N(m(f(c)("core.notifications.noNotificationFound")),1)]),_:1})]),_:1},512),[[A,!r.notifications.length]])]),_:1})]),_:1}),o(O),C(o(ne,{class:"pa-4"},{default:n(()=>[o(ie,{block:"",size:"small",color:"error",variant:"tonal",onClick:z},{default:n(()=>[N(m(f(c)("core.notifications.removeAllNotifications")),1)]),_:1})]),_:1},512),[[A,r.notifications.length]])]),_:1})]),_:1},8,["location"])]),_:1})]),_:1},16,["model-value"])}}},he="/assets/update-BklUrzn4.png",Ne={__name:"NavBarNotifications",setup(k){const s=q([]),r="2.2.0",v=()=>{const e=localStorage.getItem("notifications");if(e)try{return JSON.parse(e)}catch(i){console.error("Error parsing notifications:",i)}return[]},c=()=>{localStorage.setItem("notifications",JSON.stringify(s.value))},b=async()=>{try{const e=new AbortController,i=setTimeout(()=>e.abort(),1e4),d=await fetch("https://raw.githubusercontent.com/RunOnFlux/flux/master/package.json",{signal:e.signal});if(clearTimeout(i),!d.ok)throw new Error(`HTTP error! status: ${d.status}`);const a=(await d.json()).version;if(s.value=s.value.map(u=>(u.time=y(u.created),u)),$(r,a)){const u=JSON.parse(localStorage.getItem("new-version-notified"));(!u||u.version!==a)&&(s.value.push({id:s.value.length+1,img:he,title:"Update Available! ðŸš€",subtitle:`A new version ${a} is available.`,time:y(new Date().toISOString()),created:new Date().toISOString(),isSeen:!1,color:"info"}),c(),localStorage.setItem("new-version-notified",JSON.stringify({version:a})))}}catch(e){e.name==="AbortError"?console.warn("Version check timed out - this is normal if GitHub is not accessible"):e.message.includes("Failed to fetch")||e.message.includes("ERR_CONNECTION_RESET")?console.warn("Unable to check for updates - network connectivity issue"):console.warn("Version check failed:",e.message)}},y=e=>{const i=new Date,d=new Date(e),h=Math.floor((i-d)/1e3),a=Math.floor(h/60),u=Math.floor(a/60);return h<60?"Just now":a<60?`${a} minute${a>1?"s":""} ago`:u<24?`${u} hour${u>1?"s":""} ago`:`${Math.floor(u/24)} day${Math.floor(u/24)>1?"s":""} ago`},$=(e,i)=>{const d=e.split(".").map(a=>parseInt(a,10)),h=i.split(".").map(a=>parseInt(a,10));for(let a=0;a<3;a++){if(h[a]>d[a])return!0;if(h[a]<d[a])return!1}return!1},U=e=>{s.value=s.value.filter(i=>i.id!==e),c()},z=()=>{s.value=[],c()},l=()=>{console.log("Marking all notifications as read"),s.value=s.value.map(e=>(e.isSeen=!0,e)),c()},g=()=>{s.value=s.value.map(e=>(e.isSeen=!1,e)),c()},w=e=>{const i=s.value.find(d=>d.id===e);i&&(i.isSeen=!0,c())},t=e=>{const i=s.value.find(d=>d.id===e);i&&(i.isSeen=!1,c())},M=e=>{e.isSeen?t(e.id):w(e.id)};H(()=>{s.value=v(),b()});const x=T(()=>s.value.filter(e=>!e.isSeen).length),D=T(()=>({content:x.value>0?x.value:"",color:"error",offsetX:8,offsetY:5}));return(e,i)=>{const d=ge;return p(),R("div",null,[o(d,{notifications:s.value,"badge-props":f(D),onRemove:U,onRemoveAll:z,onRead:l,onUnread:g,"onClick:notification":M},null,8,["notifications","badge-props"])])}}};export{Ne as default};
