import{e as te}from"./vue-core-CU9AIURn.js";import{u as se}from"./useSEO-5BaNf11O.js";import{u as re}from"./useSnackbar-CwwIX0V_.js";import{_ as oe,c as le,I as y}from"./index-QPPWK7xw.js";import{q as ie}from"./query-parser-C3-dT-Rr.js";import{b as R}from"./route-block-B_A1xBdJ.js";import{Q as z,V as U,h as $,b as c,d as I,o as ne,p as q,I as de,c as g,a1 as ce,z as me,A as ue,F as E,s as ge,r as A,a as Q,J as W,f as Y,g as Z}from"./vuetify-_4u1He_j.js";import{u as pe}from"./i18n-Bm8bpAAW.js";import{r as p,c as H,o as fe,f as J,g as v,j as l,a3 as e,Q as a,U as o,y as i,T as d,F as ve,l as _e,P as b,x as L,L as M}from"./apexcharts-nIAyciCq.js";import"./unhead-DEOrWl0D.js";import"./crypto-metamask-D6vz180a.js";import"./ansi-utils-ChIB8aIv.js";import"./socketio-BDGyx5_k.js";import"./uuid-B49X2dQj.js";import"./vueuse-Bid7ZbHY.js";import"./cookie-BfmCf_44.js";import"./unjs-utils-GcjLqAqW.js";import"./http-BZQDkn3h.js";import"./casl-DNC8KRD8.js";import"./scrollbar-CXs_Utq1.js";import"./icons-mdi-_QP0sdRJ.js";import"./sanitizer-DAUAC_Zc.js";import"./element-plus-Cr1Qs4Q_.js";import"./lodash-C_Sw0jJq.js";const he={class:"mb-3"},Ue={class:"d-flex align-center mb-2"},xe={class:"text-h5 font-weight-bold"},ye={class:"text-body-2 text-medium-emphasis mb-0"},ze={class:"d-flex align-center py-2"},be={class:"text-body-2 font-weight-medium"},Ve={class:"text-body-2 font-weight-medium"},ke={class:"d-flex align-center justify-end gap-2"},we=["colspan"],Se={class:"text-subtitle-2 font-weight-medium mb-3 d-flex align-center"},Ce={class:"d-flex align-center justify-space-between w-100 py-2"},Pe={class:"d-flex align-center"},Ie={class:"text-body-2 font-weight-medium"},Ae={class:"d-flex align-center gap-2"},Le={class:"text-center pa-4 border-t"},Te={class:"text-white"},De={class:"text-white"},G={__name:"manage-users",setup(Oe){se();const T=te(),{t:s}=pe(),{showSnackbar:m}=re(),x=le(),D=p([]),O=p([]),V=p(""),k=p(!1),B=p([]),K=H(()=>[{title:"",key:"data-table-expand",sortable:!1,width:"48px"},{title:s("pages.administration.manageUsers.table.fluxId"),key:"zelid",sortable:!0},{title:s("pages.administration.manageUsers.table.loginPhrase"),key:"loginPhrase",sortable:!0},{title:"",key:"actions",sortable:!1,align:"end"}]),_=p(!1),h=p(!1),w=p(null),S=H(()=>{const n=localStorage.getItem("zelidauth");return n&&ie.parse(n).loginPhrase||""}),F=n=>O.value.filter(t=>t.zelid===n),C=async()=>{k.value=!0;try{const n=localStorage.getItem("zelidauth"),[t,r]=await Promise.all([y.loggedUsers(n),y.loggedSessions(n)]);t.data.status==="error"?m(t.data.data.message||t.data.data,"error",3e3,"mdi-alert-circle"):D.value=t.data.data,r.data.status==="error"?m(r.data.data.message||r.data.data,"error",3e3,"mdi-alert-circle"):O.value=r.data.data}catch(n){console.error(n),m(s("pages.administration.manageUsers.errors.failedToLoadUsers"),"error",3e3,"mdi-alert-circle")}finally{k.value=!1}},N=n=>{w.value=n,_.value=!0},X=async()=>{_.value=!1;try{const n=localStorage.getItem("zelidauth"),t=await y.logoutSpecificSession(n,w.value.loginPhrase);t.data.status==="error"?m(t.data.data.message||t.data.data,"error",3e3,"mdi-alert-circle"):(m(t.data.data.message||t.data.data,"success",3e3,"mdi-check-circle"),w.value.loginPhrase===S.value?(localStorage.removeItem("zelidauth"),x.setPrivilege("none"),x.setZelid(""),T.replace("/")):C())}catch(n){console.error(n),m(s("pages.administration.manageUsers.errors.failedToLogoutUser"),"error",3e3,"mdi-alert-circle")}},ee=()=>{h.value=!0},ae=async()=>{h.value=!1;try{const n=localStorage.getItem("zelidauth"),t=await y.logoutAllUsers(n);t.data.status==="error"?m(t.data.data.message||t.data.data,"error",3e3,"mdi-alert-circle"):(m(t.data.data.message||t.data.data,"success",3e3,"mdi-check-circle"),localStorage.removeItem("zelidauth"),x.setPrivilege("none"),x.setZelid(""),T.replace("/"))}catch(n){console.error(n),m(s("pages.administration.manageUsers.errors.failedToLogoutAllUsers"),"error",3e3,"mdi-alert-circle")}};return fe(()=>{C()}),(n,t)=>(v(),J("div",null,[l("div",he,[l("div",Ue,[e(z,{color:"primary",variant:"flat",size:"48",class:"mr-3"},{default:a(()=>[e(c,{icon:"mdi-account-group",size:"32",color:"white"})]),_:1}),l("div",null,[l("h2",xe,o(i(s)("pages.administration.manageUsers.title")),1),l("p",ye,o(i(s)("pages.administration.manageUsers.subtitle")),1)])])]),e(U,{elevation:"1"},{default:a(()=>[e(I,{class:"pa-3"},{default:a(()=>[e(ne,{class:"mb-3"},{default:a(()=>[e(q,{cols:"12",md:"6"},{default:a(()=>[e(de,{modelValue:V.value,"onUpdate:modelValue":t[0]||(t[0]=r=>V.value=r),label:i(s)("pages.administration.manageUsers.searchUsers"),variant:"outlined",density:"compact",clearable:"","hide-details":""},{"prepend-inner":a(()=>[e(c,{icon:"mdi-magnify",size:"22"})]),_:1},8,["modelValue","label"])]),_:1}),e(q,{cols:"12",md:"6",class:"d-flex justify-end align-center"},{default:a(()=>[e(g,{color:"primary",variant:"flat",onClick:C},{default:a(()=>[e(c,{icon:"mdi-refresh",size:"22",class:"mr-2"}),d(" "+o(i(s)("pages.administration.manageUsers.refresh")),1)]),_:1})]),_:1})]),_:1}),e(U,{variant:"outlined"},{default:a(()=>[e(ce,{headers:K.value,items:D.value,search:V.value,loading:k.value,"item-value":"zelid",hover:"","show-expand":"",expanded:B.value,"onUpdate:expanded":t[1]||(t[1]=r=>B.value=r),class:"compact-table"},{"item.data-table-expand":a(({item:r,internalItem:u,isExpanded:f,toggleExpand:P})=>[e(z,{size:"32",variant:"tonal",color:"grey",onClick:()=>P(u),style:{cursor:"pointer"}},{default:a(()=>[e(c,{icon:f(u)?"mdi-chevron-down":"mdi-chevron-right",size:"20"},null,8,["icon"])]),_:2},1032,["onClick"])]),"item.zelid":a(({item:r})=>[l("div",ze,[e(z,{color:"primary",variant:"flat",size:"32",class:"mr-3"},{default:a(()=>[e(c,{icon:"mdi-fingerprint",size:"18",color:"white"})]),_:1}),l("span",be,o(r.zelid),1)])]),"item.loginPhrase":a(({item:r})=>[l("span",Ve,o(r.loginPhrase),1)]),"item.actions":a(({item:r})=>[l("div",ke,[r.loginPhrase===S.value?(v(),b(E,{key:0,location:"top"},{activator:a(({props:u})=>[e(c,M(u,{icon:"mdi-information-outline",color:"info",size:"20"}),null,16)]),default:a(()=>[l("span",null,o(i(s)("pages.administration.manageUsers.yourCurrentSession")),1)]),_:1})):L("",!0),e(g,{size:"small",color:"error",variant:"flat","prepend-icon":"mdi-logout",onClick:u=>N(r)},{default:a(()=>[d(o(i(s)("pages.administration.manageUsers.logOut")),1)]),_:1},8,["onClick"])])]),"expanded-row":a(({columns:r,item:u})=>[l("tr",null,[l("td",{colspan:r.length,class:"pa-4 bg-surface"},[l("div",Se,[e(c,{icon:"mdi-view-list",size:"18",class:"mr-2"}),d(" "+o(i(s)("pages.administration.manageUsers.activeSessions")),1)]),e(U,{variant:"outlined"},{default:a(()=>[e(me,{class:"py-0"},{default:a(()=>[(v(!0),J(ve,null,_e(F(u.zelid),(f,P)=>(v(),b(ue,{key:f.loginPhrase,class:"px-4"},{default:a(()=>[l("div",Ce,[l("div",Pe,[e(z,{color:"success",variant:"tonal",size:"32",class:"mr-3"},{default:a(()=>[e(c,{icon:"mdi-key-variant",size:"18"})]),_:1}),l("span",Ie,o(f.loginPhrase),1)]),l("div",Ae,[f.loginPhrase===S.value?(v(),b(E,{key:0,location:"top"},{activator:a(({props:j})=>[e(ge,M({ref_for:!0},j,{size:"small",variant:"tonal",color:"info","prepend-icon":"mdi-information-outline"}),{default:a(()=>[d(o(i(s)("pages.administration.manageUsers.current")),1)]),_:1},16)]),default:a(()=>[l("span",null,o(i(s)("pages.administration.manageUsers.yourCurrentSession")),1)]),_:1})):L("",!0),e(g,{size:"small",color:"error",variant:"flat","prepend-icon":"mdi-logout",onClick:j=>N(f)},{default:a(()=>[d(o(i(s)("pages.administration.manageUsers.logOut")),1)]),_:1},8,["onClick"])])]),P<F(u.zelid).length-1?(v(),b(A,{key:0})):L("",!0)]),_:2},1024))),128))]),_:2},1024)]),_:2},1024)],8,we)])]),bottom:a(()=>[l("div",Le,[e(g,{color:"error",variant:"flat",size:"default",onClick:ee},{default:a(()=>[e(c,{icon:"mdi-account-multiple-remove",size:"22",class:"mr-2"}),d(" "+o(i(s)("pages.administration.manageUsers.logOutAllUsers")),1)]),_:1})])]),_:2},1032,["headers","items","search","loading","expanded"])]),_:1})]),_:1})]),_:1}),e($,{modelValue:_.value,"onUpdate:modelValue":t[3]||(t[3]=r=>_.value=r),"max-width":"500"},{default:a(()=>[e(U,null,{default:a(()=>[e(Q,{class:"d-flex align-center pa-3 bg-primary"},{default:a(()=>[e(c,{icon:"mdi-account-remove",size:"28",color:"white",class:"mr-2"}),l("span",Te,o(i(s)("pages.administration.manageUsers.confirmLogoutUser")),1)]),_:1}),e(A),e(I,{class:"pa-3"},{default:a(()=>[e(W,{type:"warning",variant:"tonal",class:"mb-2"},{default:a(()=>[d(o(i(s)("pages.administration.manageUsers.logoutUserWarning")),1)]),_:1}),d(" "+o(i(s)("pages.administration.manageUsers.areYouSureProceed")),1)]),_:1}),e(Y,{class:"pa-3 pt-0"},{default:a(()=>[e(Z),e(g,{color:"error",variant:"flat",size:"small",onClick:t[2]||(t[2]=r=>_.value=!1)},{default:a(()=>[d(o(i(s)("pages.administration.manageUsers.cancel")),1)]),_:1}),e(g,{color:"primary",variant:"flat",size:"small",onClick:X},{default:a(()=>[d(o(i(s)("pages.administration.manageUsers.logOut")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),e($,{modelValue:h.value,"onUpdate:modelValue":t[5]||(t[5]=r=>h.value=r),"max-width":"500"},{default:a(()=>[e(U,null,{default:a(()=>[e(Q,{class:"d-flex align-center pa-3 bg-primary"},{default:a(()=>[e(c,{icon:"mdi-account-multiple-remove",size:"28",color:"white",class:"mr-2"}),l("span",De,o(i(s)("pages.administration.manageUsers.confirmLogoutAllUsers")),1)]),_:1}),e(A),e(I,{class:"pa-3"},{default:a(()=>[e(W,{type:"error",variant:"tonal",class:"mb-2"},{default:a(()=>[d(o(i(s)("pages.administration.manageUsers.logoutAllUsersWarning")),1)]),_:1}),d(" "+o(i(s)("pages.administration.manageUsers.areYouSureProceed")),1)]),_:1}),e(Y,{class:"pa-3 pt-0"},{default:a(()=>[e(Z),e(g,{color:"error",variant:"flat",size:"small",onClick:t[4]||(t[4]=r=>h.value=!1)},{default:a(()=>[d(o(i(s)("pages.administration.manageUsers.cancel")),1)]),_:1}),e(g,{color:"primary",variant:"flat",size:"small",onClick:ae},{default:a(()=>[d(o(i(s)("pages.administration.manageUsers.logOutAll")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}};typeof R=="function"&&R(G);const la=oe(G,[["__scopeId","data-v-927935f2"]]);export{la as default};
