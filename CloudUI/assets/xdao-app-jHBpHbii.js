import{a as Ie,g as qe,b as Be}from"./useSEO-5BaNf11O.js";import{u as Ye}from"./useAnalytics-CteLaQrD.js";import{a as ce}from"./http-BZQDkn3h.js";import{_ as ye,c as Ae}from"./index-QPPWK7xw.js";import{s as Re}from"./vue-core-CU9AIURn.js";import{u as Me}from"./useLoginSheet-e2RZXtPE.js";import{c as A,r as y,o as we,w as fe,az as We,P as S,g as b,Q as t,x as O,a3 as e,j as a,U as s,y as n,R as Pe,T as _,aA as Ze,f as I,F as xe,q as De,l as be,p as ke}from"./apexcharts-nIAyciCq.js";import{u as Xe}from"./useSnackbar-CwwIX0V_.js";import{e as He}from"./walletService-ARo4SzYC.js";import{u as je,V as D,a as de,b as f,d as k,s as Y,o as oe,p as z,Q as ue,J as $e,c as q,K as Le,L as Ee,M as Fe,N as Oe,O as Te,f as Ge,g as Je,h as Qe,H as Ke,I as he,ad as et,a9 as Se,n as ze,x as tt,z as at,A as Ne,D as Ce,r as st,S as ot,a0 as lt,G as nt}from"./vuetify-_4u1He_j.js";import{u as Ve}from"./i18n-Bm8bpAAW.js";import{s as it,a as rt,f as dt}from"./ssp-logo-white-BYX0TNEU.js";import"./unhead-DEOrWl0D.js";import"./ansi-utils-ChIB8aIv.js";import"./crypto-metamask-D6vz180a.js";import"./socketio-BDGyx5_k.js";import"./uuid-B49X2dQj.js";import"./vueuse-Bid7ZbHY.js";import"./cookie-BfmCf_44.js";import"./unjs-utils-GcjLqAqW.js";import"./query-parser-C3-dT-Rr.js";import"./casl-DNC8KRD8.js";import"./scrollbar-CXs_Utq1.js";import"./icons-mdi-_QP0sdRJ.js";import"./sanitizer-DAUAC_Zc.js";import"./element-plus-Cr1Qs4Q_.js";import"./lodash-C_Sw0jJq.js";const ct={class:"d-flex align-center"},ut={class:"text-h5",style:{color:"white !important"}},pt={class:"mb-6"},mt={class:"d-flex justify-space-between align-start mb-3"},vt={class:"flex-grow-1"},ft={class:"text-h5 font-weight-bold mb-3"},gt={class:"d-flex flex-wrap gap-4 mb-4"},ht={class:"d-flex align-center"},xt={class:"text-body-1"},_t={class:"d-flex align-center"},bt={class:"text-body-1"},yt={class:"d-flex align-center"},wt={class:"text-body-1"},Vt={class:"d-flex align-center"},Pt={class:"text-h6 font-weight-bold"},Dt={class:"chart-container mb-4 position-relative"},kt={class:"chart-status-chip"},$t={class:"modern-stats-grid"},St={class:"text-caption text-medium-emphasis"},zt={class:"text-subtitle-1 font-weight-bold"},Nt={class:"text-caption text-medium-emphasis"},Ct={class:"text-subtitle-1 font-weight-bold"},At={class:"d-flex align-center"},Rt={class:"text-h6 font-weight-bold"},jt={class:"chart-container mb-4"},Lt={class:"modern-stats-grid"},Et={class:"text-caption text-medium-emphasis"},Ft={class:"text-subtitle-1 font-weight-bold text-success"},Ot={class:"text-caption text-medium-emphasis"},Tt={class:"text-subtitle-1 font-weight-bold text-error"},Ut={class:"text-h6 font-weight-bold"},It={class:"text-caption text-medium-emphasis"},qt={key:0,class:"text-center py-6"},Bt={class:"text-h6 mb-3"},Yt={class:"text-body-2 text-medium-emphasis"},Mt={key:1,class:"modern-voting-container"},Wt={class:"text-center mb-6"},Zt={class:"vote-power-container"},Xt={class:"text-caption text-medium-emphasis mb-1"},Ht={class:"text-h5 font-weight-bold text-primary"},Gt={class:"text-body-2 text-medium-emphasis"},Jt={class:"d-flex justify-center gap-3 flex-wrap"},Qt={class:"d-flex align-center justify-space-between"},Kt={class:"ms-1"},ea={class:"text-center mt-4 text-caption text-medium-emphasis"},ta={class:"text-h6 font-weight-bold"},aa={class:"text-caption text-medium-emphasis"},sa={class:"grant-info-grid"},oa={class:"d-flex align-center justify-space-between mb-2"},la={class:"text-caption text-medium-emphasis mb-1"},na={class:"text-h5 font-weight-bold"},ia={class:"d-flex align-center justify-space-between mb-2"},ra={class:"text-caption text-medium-emphasis mb-1"},da={class:"text-body-2 font-mono text-truncate"},ca={class:"text-body-1 line-height-relaxed description-text"},ua={class:"description-content"},pa={class:"mb-3"},ma={class:"text-body-2 text-medium-emphasis mb-1"},va={class:"text-body-1 font-mono"},fa={class:"mb-3"},ga={class:"text-body-2 text-medium-emphasis mb-1"},ha={class:"text-body-1"},xa={class:"mb-3"},_a={class:"text-body-2 text-medium-emphasis mb-1"},ba={class:"text-body-1"},ya={class:"mb-3"},wa={class:"text-body-2 text-medium-emphasis mb-1"},Va={__name:"ProposalDetailDialog",props:{modelValue:{type:Boolean,required:!0},proposal:{type:Object,default:null},zelid:{type:String,default:""}},emits:["update:modelValue","showLogin"],setup(x,{emit:le}){const i=x,p=le,{t:d}=Ve(),J=je(),ge=Ae(),{privilege:pe,zelid:T}=Re(ge),{showSnackbar:j}=Xe(),N=A(()=>pe.value!=="none"),R=A(()=>T.value),V=A(()=>i.proposal?Number(i.proposal.votesYes)+Number(i.proposal.votesNo):0),C=A(()=>i.proposal&&i.proposal.status==="Open"&&V.value===0),ne=A(()=>{if(!i.proposal)return[0];if(C.value)return[65.5];const o=V.value/i.proposal.votesRequired*100;return[Math.min(o,100).toFixed(1)]}),B=A(()=>i.proposal?C.value?[72.3]:V.value===0?[0]:[(i.proposal.votesYes/V.value*100).toFixed(1)]:[0]),K=A(()=>({chart:{height:250,type:"radialBar",sparkline:{enabled:!1},background:"transparent",offsetY:0,offsetX:0,margin:{top:20,right:20,bottom:20,left:20}},colors:["#3B82F6"],plotOptions:{radialBar:{offsetY:0,startAngle:0,endAngle:360,hollow:{size:"65%",background:"transparent"},track:{background:J.current.value.dark?"rgba(59, 130, 246, 0.1)":"rgba(59, 130, 246, 0.08)",strokeWidth:"100%",margin:8,dropShadow:{enabled:!0,top:0,left:0,blur:4,opacity:.15}},dataLabels:{name:{show:!1},value:{color:J.current.value.dark?"#fff":"#2D3748",fontSize:"2.2rem",fontWeight:"700",fontFamily:"Inter, sans-serif",formatter:o=>`${o}%`,offsetY:15}}}},fill:{type:"gradient",gradient:{shade:"light",type:"diagonal1",shadeIntensity:.5,gradientToColors:["#8B5CF6","#3B82F6"],inverseColors:!1,opacityFrom:1,opacityTo:1,stops:[0,50,100],colorStops:[{offset:0,color:"#3B82F6",opacity:1},{offset:100,color:"#8B5CF6",opacity:1}]}},stroke:{lineCap:"round",width:2}})),ee=A(()=>({chart:{height:250,type:"radialBar",sparkline:{enabled:!1},background:"transparent",offsetY:0,offsetX:0,margin:{top:20,right:20,bottom:20,left:20}},colors:["#10B981"],labels:["Yes Votes"],plotOptions:{radialBar:{offsetY:0,startAngle:0,endAngle:360,hollow:{size:"65%",background:"transparent"},track:{background:J.current.value.dark?"rgba(16, 185, 129, 0.1)":"rgba(16, 185, 129, 0.08)",strokeWidth:"100%",margin:8,dropShadow:{enabled:!0,top:0,left:0,blur:4,opacity:.15}},dataLabels:{name:{offsetY:-10,color:J.current.value.dark?"rgba(255,255,255,0.8)":"rgba(45,55,72,0.8)",fontSize:"1rem",fontWeight:"500",fontFamily:"Inter, sans-serif"},value:{offsetY:5,color:J.current.value.dark?"#fff":"#2D3748",fontSize:"2.2rem",fontWeight:"700",fontFamily:"Inter, sans-serif",formatter:o=>`${o}%`}}}},fill:{type:"gradient",gradient:{shade:"light",type:"diagonal1",shadeIntensity:.5,gradientToColors:["#34D399","#10B981"],inverseColors:!1,opacityFrom:1,opacityTo:1,stops:[0,50,100],colorStops:[{offset:0,color:"#10B981",opacity:1},{offset:100,color:"#34D399",opacity:1}]}},stroke:{lineCap:"round",width:2}})),L=y(!1),v=y(null),E=y(0),W=y(""),F=y(""),M=y(""),Z=y(!1),ie=y(!1),te=A({get:()=>i.modelValue,set:o=>p("update:modelValue",o)}),me=o=>o==="Open"?"warning":o==="Passed"?"success":o==="Unpaid"?"info":o.includes("Rejected")?"error":"primary",ve=o=>{if(!o)return"";const m={Open:d("components.xdao.proposalDetail.charts.status.open"),Passed:d("components.xdao.proposalDetail.charts.status.passed"),Unpaid:d("components.xdao.proposalDetail.charts.status.unpaid"),Rejected:d("components.xdao.proposalDetail.charts.status.rejected"),"Not Enough Votes":d("components.xdao.proposalDetail.charts.status.notEnoughVotes")};return o.includes("Not Enough Votes")?o.replace("Not Enough Votes",m["Not Enough Votes"]).replace("Rejected",m.Rejected):o.includes(" ")?o.split(" ").map(P=>m[P]||P).join(" "):m[o]||o},re=o=>(o.votesYes+o.votesNo)/o.votesRequired>=1?o.votesYes>o.votesNo?"success":"error":"warning",ae=o=>{const $=(o.votesYes+o.votesNo)/o.votesRequired,w=Math.round($*100);return $>=1?o.votesYes>o.votesNo?d("components.xdao.proposalDetail.charts.votingCompletePassed"):d("components.xdao.proposalDetail.charts.votingCompleteRejected"):d("components.xdao.proposalDetail.charts.percentageOfVotesReceived",{percentage:w})},se=o=>new Date(o).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}),X=o=>new Date(o).toLocaleString("en-US",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit",timeZoneName:"short"}),U=o=>o?o.status==="Passed"?d("components.xdao.proposalDetail.charts.status.passed"):o.status==="Rejected"||o.status.includes("Rejected")?d("components.xdao.proposalDetail.charts.status.rejected"):o.status==="Unpaid"?d("components.xdao.proposalDetail.charts.status.unpaid"):(Number(o.votesYes)+Number(o.votesNo))/o.votesRequired>=1?o.votesYes>o.votesNo?d("components.xdao.proposalDetail.charts.status.passed"):d("components.xdao.proposalDetail.charts.status.rejected"):d("components.xdao.proposalDetail.charts.status.voting"):"",g=async o=>{try{await navigator.clipboard.writeText(o),j(d("components.xdao.proposalDetail.messages.copiedToClipboard"),"success")}catch(m){console.error("Failed to copy to clipboard:",m)}},u=async()=>{try{const o=await ce.get("https://stats.runonflux.io/general/messagephrase");return o.data.status==="success"?o.data.data:!1}catch(o){return console.error("Error getting message phrase:",o),!1}},h=async()=>{const o=R.value||M.value;if(console.log("ðŸ” Loading vote data for zelid:",o),!o){console.log("âŒ No zelid available"),E.value=0,L.value=!1;return}try{let m=`https://stats.runonflux.io/proposals/votepower?zelid=${o}`;i.proposal?.hash&&(m+=`&hash=${i.proposal.hash}`),console.log("ðŸ“¡ Fetching vote data:",m);const $=await ce.get(m);if($.data.status==="success"&&$.data.data){const w=$.data.data;E.value=w.power||0,console.log("âœ… Vote power:",E.value),w.hasVoted!==void 0?(L.value=w.hasVoted,v.value=w.vote||null,console.log("âœ… Vote status from API - hasVoted:",L.value,"vote:",v.value)):(L.value=!1,console.log("ðŸ”„ API did not provide vote status, assuming not voted"))}else console.log("âš ï¸ API returned no data"),E.value=0,L.value=!1}catch(m){console.error("âŒ Vote data API error:",m),E.value=0,L.value=!1}},_e=async()=>{await h()},r=async()=>{try{const o=await He(W.value);F.value=o.signature,M.value=o.address,await _e(),j(d("components.xdao.proposalDetail.messages.successfullySignedWithSSP"),"success")}catch(o){console.error("SSP signing error:",o),j(o.message||d("components.xdao.proposalDetail.messages.failedToSignWithSSP"),"error")}},c=async o=>{if(!N.value){j(d("components.xdao.proposalDetail.messages.pleaseLogInFirst"),"warning");return}if(L.value){j(d("components.xdao.proposalDetail.messages.alreadyVoted"),"warning");return}if(!i.proposal?.hash){j(d("components.xdao.proposalDetail.messages.proposalHashNotAvailable"),"error");return}if(!F.value||!W.value){j(d("components.xdao.proposalDetail.messages.missingSignature"),"warning"),await r();return}Z.value=!0;try{const m={hash:i.proposal.hash,zelid:M.value||R.value,message:W.value,signature:F.value,vote:o==="yes"},$=await ce.post("https://stats.runonflux.io/proposals/voteproposal",JSON.stringify(m),{headers:{"Content-Type":"application/json"}});if($.data.status==="success")console.log("Vote registered successfully!"),L.value=!0,v.value=o,j(d("components.xdao.proposalDetail.messages.voteRecordedSuccess"),"success"),o==="yes"?i.proposal.votesYes+=E.value:i.proposal.votesNo+=E.value,i.proposal.votesTotal+=E.value;else throw new Error($.data.data?.message||$.data.data||d("components.xdao.proposalDetail.messages.voteFailed"))}catch(m){console.error("Voting error:",m),j(m.message||d("components.xdao.proposalDetail.messages.failedToCastVote"),"error")}finally{Z.value=!1}};we(async()=>{console.log("ðŸ”„ Component mounted with proposal:",i.proposal?.status,"zelid:",i.zelid),i.proposal?.status==="Open"&&(W.value=await u(),M.value=i.zelid,console.log("âœ… Got message phrase and set userZelid:",M.value),await h())}),fe(()=>i.proposal,async o=>{console.log("ðŸ”„ Proposal changed:",o?.hash,"status:",o?.status),o&&(L.value=!1,v.value="",F.value="",E.value=0,console.log("ðŸ”„ Reset voting state for new proposal"),o.status==="Open"&&(W.value=await u(),M.value=i.zelid,console.log("âœ… Got message phrase and set userZelid:",M.value),await h()))}),fe(()=>i.zelid,async o=>{o&&i.proposal?.status==="Open"&&(M.value=o,await h())}),fe(N,async o=>{console.log("ðŸ”„ Login status changed:",o),o&&i.proposal?.status==="Open"&&await h()}),fe(R,async o=>{console.log("ðŸ”„ CurrentUserZelid changed:",o),o&&i.proposal?.status==="Open"&&await h()});const l=o=>{if(!o)return"";const m=o.split(`
`);let $=[],w=!1,P=[];for(let H=0;H<m.length;H++){let Q=m[H];Q.includes("|")&&Q.split("|").length>=3?(w||(w=!0,P=[]),P.push(Q)):(w&&P.length>0&&($.push(G(P)),w=!1,P=[]),Q=Q.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\*\*([^*]+)\*\*/g,"<b>$1</b>").replace(/^(\s*)\*\s+(.+)$/,"$1â€¢ $2").replace(/\t/g,"&nbsp;&nbsp;&nbsp;&nbsp;").replace(/  /g,"&nbsp;&nbsp;"),$.push(Q))}return w&&P.length>0&&$.push(G(P)),$.join("<br>")},G=o=>{if(o.length<2)return o.join("<br>");const m=o.map(P=>P.split("|").map(H=>H.trim()).filter((H,Q,Ue)=>Q>0&&Q<Ue.length-1||H!=="")),$=m.length>1&&m[1].every(P=>/^[-:\s]+$/.test(P));let w='<table class="simple-table">';if($&&m.length>0){if(w+="<thead><tr>",m[0].forEach(P=>{w+=`<th>${P}</th>`}),w+="</tr></thead>",m.length>2){w+="<tbody>";for(let P=2;P<m.length;P++)w+="<tr>",m[P].forEach(H=>{w+=`<td>${H}</td>`}),w+="</tr>";w+="</tbody>"}}else w+="<tbody>",m.forEach(P=>{w+="<tr>",P.forEach(H=>{w+=`<td>${H}</td>`}),w+="</tr>"}),w+="</tbody>";return w+="</table>",w};return(o,m)=>{const $=Ze,w=We("sanitize-html");return b(),S(Qe,{modelValue:te.value,"onUpdate:modelValue":m[5]||(m[5]=P=>te.value=P),"max-width":o.$vuetify.display.xs?"95vw":"900",fullscreen:o.$vuetify.display.xs,scrollable:""},{default:t(()=>[x.proposal?(b(),S(D,{key:0},{default:t(()=>[e(de,{class:"bg-primary pa-4",style:{color:"white !important"}},{default:t(()=>[a("div",ct,[e(f,{icon:"mdi-clipboard-text-outline",class:"me-3",color:"white"}),a("span",ut,s(n(d)("components.xdao.proposalDetail.title")),1)])]),_:1}),e(k,{class:"pa-4 pa-sm-6"},{default:t(()=>[a("div",pt,[a("div",mt,[a("div",vt,[Pe(a("h2",ft,null,512),[[w,l(x.proposal.topic)]])]),e(Y,{color:me(x.proposal.status),variant:"elevated",size:"large"},{default:t(()=>[_(s(ve(x.proposal.status)),1)]),_:1},8,["color"])]),a("div",gt,[a("div",ht,[e(f,{icon:"mdi-account",class:"me-2 text-medium-emphasis"}),a("span",xt,s(x.proposal.nickName||n(d)("components.xdao.proposalDetail.anonymous")),1)]),a("div",_t,[e(f,{icon:"mdi-calendar",class:"me-2 text-medium-emphasis"}),a("span",bt,s(n(d)("components.xdao.proposalDetail.submitted"))+": "+s(se(x.proposal.submitDate)),1)]),a("div",yt,[e(f,{icon:"mdi-calendar-end",class:"me-2 text-medium-emphasis"}),a("span",wt,s(n(d)("components.xdao.proposalDetail.endDate"))+": "+s(se(x.proposal.voteEndDate)),1)])])]),e(oe,{class:"mb-6"},{default:t(()=>[e(z,{cols:"12",md:"6"},{default:t(()=>[e(D,{class:"modern-chart-card simple-payment-card h-100",variant:"outlined"},{default:t(()=>[e(de,{class:"d-flex align-center justify-space-between pa-4 pb-2"},{default:t(()=>[a("div",Vt,[e(f,{icon:"mdi-chart-donut",class:"me-2",color:"primary",size:"20"}),a("span",Pt,s(n(d)("components.xdao.proposalDetail.charts.voteProgress")),1)]),e(Y,{color:re(x.proposal),variant:"tonal",size:"small",class:"font-weight-bold"},{default:t(()=>[_(s(ae(x.proposal)),1)]),_:1},8,["color"])]),_:1}),e(k,{class:"pa-4 pt-0 pb-6"},{default:t(()=>[a("div",Dt,[e($,{type:"radialBar",height:"250",options:K.value,series:ne.value},null,8,["options","series"]),a("div",kt,[e(Y,{color:re(x.proposal),variant:"flat",size:"x-small",class:"font-weight-bold"},{default:t(()=>[_(s(U(x.proposal)),1)]),_:1},8,["color"])])]),a("div",$t,[e(D,{variant:"tonal",color:"primary",class:"stat-card"},{default:t(()=>[e(k,{class:"pa-2 text-center"},{default:t(()=>[e(f,{icon:"mdi-target",size:"16",class:"mb-1"}),a("div",St,s(n(d)("components.xdao.proposalDetail.charts.required")),1),a("div",zt,s(Number(x.proposal.votesRequired).toLocaleString()),1)]),_:1})]),_:1}),e(D,{variant:"tonal",color:"success",class:"stat-card"},{default:t(()=>[e(k,{class:"pa-2 text-center"},{default:t(()=>[e(f,{icon:"mdi-check-circle",size:"16",class:"mb-1"}),a("div",Nt,s(n(d)("components.xdao.proposalDetail.charts.received")),1),a("div",Ct,s(C.value?Math.floor(x.proposal.votesRequired*.655).toLocaleString():V.value.toLocaleString()),1)]),_:1})]),_:1})])]),_:1})]),_:1})]),_:1}),e(z,{cols:"12",md:"6"},{default:t(()=>[e(D,{class:"modern-chart-card simple-payment-card h-100",variant:"outlined"},{default:t(()=>[e(de,{class:"d-flex align-center justify-space-between pa-4 pb-2"},{default:t(()=>[a("div",At,[e(f,{icon:"mdi-chart-pie",class:"me-2",color:"success",size:"20"}),a("span",Rt,s(n(d)("components.xdao.proposalDetail.charts.voteSplit")),1)]),e(Y,{color:B.value[0]>=50?"success":"error",variant:"tonal",size:"small",class:"font-weight-bold"},{default:t(()=>[e(f,{icon:B.value[0]>=50?"mdi-thumb-up":"mdi-thumb-down",size:"14",class:"me-1"},null,8,["icon"]),_(" "+s(B.value[0])+"% Yes ",1)]),_:1},8,["color"])]),_:1}),e(k,{class:"pa-4 pt-0 pb-6"},{default:t(()=>[a("div",jt,[e($,{type:"radialBar",height:"250",options:ee.value,series:B.value},null,8,["options","series"])]),a("div",Lt,[e(D,{variant:"tonal",color:"success",class:"stat-card"},{default:t(()=>[e(k,{class:"pa-2 text-center"},{default:t(()=>[e(f,{icon:"mdi-thumb-up",size:"16",class:"mb-1"}),a("div",Et,s(n(d)("components.xdao.proposalDetail.charts.yesVotes")),1),a("div",Ft,s(C.value?Math.floor(x.proposal.votesRequired*.474).toLocaleString():Number(x.proposal.votesYes).toLocaleString()),1)]),_:1})]),_:1}),e(D,{variant:"tonal",color:"error",class:"stat-card"},{default:t(()=>[e(k,{class:"pa-2 text-center"},{default:t(()=>[e(f,{icon:"mdi-thumb-down",size:"16",class:"mb-1"}),a("div",Ot,s(n(d)("components.xdao.proposalDetail.charts.noVotes")),1),a("div",Tt,s(C.value?Math.floor(x.proposal.votesRequired*.181).toLocaleString():Number(x.proposal.votesNo).toLocaleString()),1)]),_:1})]),_:1})])]),_:1})]),_:1})]),_:1})]),_:1}),x.proposal.status==="Open"?(b(),S(D,{key:0,class:"simple-payment-card mb-6",variant:"outlined"},{default:t(()=>[e(de,{class:"d-flex align-center pa-4 pb-3"},{default:t(()=>[e(ue,{size:"36",color:"primary",variant:"tonal",class:"me-3"},{default:t(()=>[e(f,{icon:"mdi-vote",size:"20"})]),_:1}),a("div",null,[a("div",Ut,s(n(d)("components.xdao.proposalDetail.voting.castYourVote")),1),a("div",It,s(n(d)("components.xdao.proposalDetail.voting.makeYourVoiceHeard")),1)])]),_:1}),e(k,{class:"pa-4 pt-2"},{default:t(()=>[N.value?N.value&&!L.value?(b(),I("div",Mt,[e(D,{class:"modern-voting-card pa-6",variant:"tonal",color:"surface"},{default:t(()=>[e($e,{type:"info",variant:"tonal",class:"mb-6 modern-alert",density:"comfortable"},{default:t(()=>[_(s(n(d)("components.xdao.proposalDetail.voting.voteWarning")),1)]),_:1}),a("div",Wt,[a("div",Zt,[e(ue,{size:"48",color:"primary",variant:"tonal",class:"mb-3 vote-power-avatar"},{default:t(()=>[e(f,{icon:"mdi-vote",size:"28"})]),_:1}),a("div",Xt,s(n(d)("components.xdao.proposalDetail.voting.yourVotingPower")),1),a("div",Ht,s(E.value),1),a("div",Gt,s(n(d)("components.xdao.proposalDetail.voting.votesAvailable")),1)])]),a("div",Jt,[e(q,{color:"success",variant:"flat",size:"large",class:"vote-button vote-yes","min-width":"110","min-height":"50",onClick:m[0]||(m[0]=P=>c("yes")),loading:Z.value,disabled:L.value||Z.value},{default:t(()=>[e(f,{icon:"mdi-thumb-up",class:"me-2",size:"16"}),_(" "+s(n(d)("components.xdao.proposalDetail.voting.voteYes")),1)]),_:1},8,["loading","disabled"]),e(q,{color:"error",variant:"flat",size:"large",class:"vote-button vote-no","min-width":"110","min-height":"50",onClick:m[1]||(m[1]=P=>c("no")),loading:Z.value,disabled:L.value||Z.value},{default:t(()=>[e(f,{icon:"mdi-thumb-down",class:"me-2",size:"16"}),_(" "+s(n(d)("components.xdao.proposalDetail.voting.voteNo")),1)]),_:1},8,["loading","disabled"])])]),_:1})])):O("",!0):(b(),I("div",qt,[a("h3",Bt,s(n(d)("components.xdao.proposalDetail.voting.loginRequired")),1),a("p",Yt,s(n(d)("components.xdao.proposalDetail.voting.loginRequiredMessage")),1)])),L.value?(b(),S($e,{key:2,type:"success",variant:"tonal",class:"mt-4"},{default:t(()=>[a("div",Qt,[a("div",null,[_(s(n(d)("components.xdao.proposalDetail.voting.youHaveVoted"))+": ",1),a("strong",Kt,s(v.value==="yes"?n(d)("components.xdao.proposalDetail.voting.yes"):n(d)("components.xdao.proposalDetail.voting.no")),1)]),e(Y,{color:v.value==="yes"?"success":"error",variant:"flat",size:"small",class:"font-weight-bold"},{default:t(()=>[_(s(n(d)("components.xdao.proposalDetail.voting.voteCount",{count:E.value})),1)]),_:1},8,["color"])])]),_:1})):O("",!0),a("div",ea,s(n(d)("components.xdao.proposalDetail.voting.votingEnds"))+": "+s(se(x.proposal.voteEndDate)),1),ie.value?(b(),S(Le,{key:3,indeterminate:"",color:"primary",class:"mt-4"})):O("",!0)]),_:1})]),_:1})):O("",!0),x.proposal.grantValue&&x.proposal.grantValue>0?(b(),S(D,{key:1,variant:"outlined",class:"grant-main-card simple-payment-card mb-6"},{default:t(()=>[e(de,{class:"d-flex align-center pa-4 pb-3"},{default:t(()=>[e(ue,{size:"36",color:"success",variant:"tonal",class:"me-3"},{default:t(()=>[e(f,{icon:"mdi-cash-multiple",size:"20"})]),_:1}),a("div",null,[a("div",ta,s(n(d)("components.xdao.proposalDetail.grant.title")),1),a("div",aa,s(n(d)("components.xdao.proposalDetail.grant.fundingDetails")),1)])]),_:1}),e(k,{class:"pa-4 pt-2"},{default:t(()=>[a("div",sa,[e(D,{variant:"tonal",color:"primary",class:"grant-inner-card simple-payment-card"},{default:t(()=>[e(k,{class:"pa-3"},{default:t(()=>[a("div",oa,[e(f,{icon:"mdi-cash",color:"primary",size:"32"}),e(Y,{color:"primary",variant:"flat",size:"x-small",class:"font-weight-bold"},{default:t(()=>[...m[6]||(m[6]=[_(" FLUX ",-1)])]),_:1})]),a("div",la,s(n(d)("components.xdao.proposalDetail.grant.grantAmount")),1),a("div",na,s(Number(x.proposal.grantValue).toLocaleString()),1)]),_:1})]),_:1}),e(D,{variant:"outlined",class:"grant-inner-card simple-payment-card"},{default:t(()=>[e(k,{class:"pa-3"},{default:t(()=>[a("div",ia,[e(f,{icon:"mdi-wallet-outline",color:"primary",size:"24"}),e(q,{icon:"",variant:"text",size:"x-small",color:"primary",onClick:m[2]||(m[2]=P=>g(x.proposal.grantAddress))},{default:t(()=>[e(f,{icon:"mdi-content-copy",size:"16"})]),_:1})]),a("div",ra,s(n(d)("components.xdao.proposalDetail.grant.recipientAddress")),1),a("div",da,s(x.proposal.grantAddress),1),e(q,{color:"primary",variant:"text",size:"small",class:"mt-2 pa-0",href:`https://explorer.runonflux.io/address/${x.proposal.grantAddress}`,target:"_blank",rel:"noopener noreferrer"},{default:t(()=>[e(f,{icon:"mdi-open-in-new",size:"14",class:"me-1"}),_(" "+s(n(d)("components.xdao.proposalDetail.grant.viewOnExplorer")),1)]),_:1},8,["href"])]),_:1})]),_:1})])]),_:1})]),_:1})):O("",!0),e(D,{variant:"outlined",class:"mb-6"},{default:t(()=>[e(de,{class:"text-h6 pa-4 pb-2"},{default:t(()=>[e(f,{icon:"mdi-text",class:"me-2"}),_(" "+s(n(d)("components.xdao.proposalDetail.description")),1)]),_:1}),e(k,{class:"pa-4 pt-2"},{default:t(()=>[a("div",ca,[Pe(a("div",ua,null,512),[[w,l(x.proposal.description)]])])]),_:1})]),_:1}),e(Ee,{variant:"accordion"},{default:t(()=>[e(Fe,null,{default:t(()=>[e(Oe,null,{default:t(()=>[e(f,{icon:"mdi-information-outline",class:"me-2"}),_(" "+s(n(d)("components.xdao.proposalDetail.technicalDetails.title")),1)]),_:1}),e(Te,null,{default:t(()=>[e(oe,null,{default:t(()=>[e(z,{cols:"12",md:"6"},{default:t(()=>[a("div",pa,[a("div",ma,s(n(d)("components.xdao.proposalDetail.technicalDetails.proposalHash")),1),a("div",va,s(x.proposal.hash),1),e(q,{size:"small",variant:"text",onClick:m[3]||(m[3]=P=>g(x.proposal.hash))},{default:t(()=>[e(f,{icon:"mdi-content-copy",class:"me-1",size:"16"}),_(" "+s(n(d)("components.xdao.proposalDetail.technicalDetails.copy")),1)]),_:1})])]),_:1}),e(z,{cols:"12",md:"6"},{default:t(()=>[a("div",fa,[a("div",ga,s(n(d)("components.xdao.proposalDetail.technicalDetails.submitDate")),1),a("div",ha,s(X(x.proposal.submitDate)),1)])]),_:1}),e(z,{cols:"12",md:"6"},{default:t(()=>[a("div",xa,[a("div",_a,s(n(d)("components.xdao.proposalDetail.technicalDetails.voteEndDate")),1),a("div",ba,s(X(x.proposal.voteEndDate)),1)])]),_:1}),e(z,{cols:"12",md:"6"},{default:t(()=>[a("div",ya,[a("div",wa,s(n(d)("components.xdao.proposalDetail.technicalDetails.currentStatus")),1),e(Y,{color:me(x.proposal.status),variant:"tonal",size:"small"},{default:t(()=>[_(s(ve(x.proposal.status)),1)]),_:1},8,["color"])])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(Ge,{class:"pa-4 pa-sm-6 pt-0"},{default:t(()=>[e(Je),e(q,{color:"error",variant:"flat",onClick:m[4]||(m[4]=P=>te.value=!1)},{default:t(()=>[_(s(n(d)("common.buttons.close")),1)]),_:1}),x.proposal.grantAddress?(b(),S(q,{key:0,color:"primary",variant:"elevated",href:`https://explorer.runonflux.io/address/${x.proposal.grantAddress}`,target:"_blank",rel:"noopener noreferrer"},{default:t(()=>[e(f,{icon:"mdi-open-in-new",class:"me-2"}),_(" "+s(n(d)("components.xdao.proposalDetail.viewAddressOnExplorer")),1)]),_:1},8,["href"])):O("",!0)]),_:1})]),_:1})):O("",!0)]),_:1},8,["modelValue","max-width","fullscreen"])}}},Pa=ye(Va,[["__scopeId","data-v-e03b0c01"]]),Da={class:"d-flex align-center"},ka={class:"text-center"},$a={class:"text-h5 mb-4"},Sa={class:"text-h6 mb-4"},za={class:"text-center mb-6"},Na={class:"text-h4 mb-3 font-weight-bold"},Ca={class:"payment-info-card mx-auto mb-4"},Aa={class:"text-body-1 mb-1"},Ra={class:"d-flex align-center justify-center"},ja={class:"text-caption text-medium-emphasis mt-1"},La={class:"text-h6 mb-3"},Ea={class:"text-body-2 text-medium-emphasis mb-3"},Fa={class:"wallet-options"},Oa=["src"],Ta=["src"],Ua={class:"text-h6 mb-3"},Ia={class:"mb-3"},qa={class:"text-caption mb-1"},Ba={class:"copy-container"},Ya=["value"],Ma={class:"mb-3"},Wa={class:"text-caption mb-1"},Za={class:"copy-container"},Xa=["value"],Ha={class:"d-flex align-center"},Ga={class:"d-flex align-center"},Ja={__name:"AddProposalTab",emits:["proposal-added"],setup(x,{emit:le}){const i=le,{t:p}=Ve(),d=je(),J=A(()=>d.global.name.value==="dark"?it:rt),ge=y(null),pe=y(!1),T=y(!1),j=y(!1),N=y(!1),R=y(null),V=y(""),C=y(""),ne=y(0),B=y(!1),K=y(!1),ee=y(""),L=y(""),v=y({topic:"",description:"",grantValue:"",grantAddress:"",nickName:""}),E=A(()=>v.value.topic.length>=3&&v.value.description.length>=50&&(!v.value.grantValue||!v.value.grantAddress||v.value.grantValue>0&&v.value.grantAddress.length>0)),W=A(()=>N.value?{color:"success",text:p("components.xdao.addProposal.validated")}:E.value?{color:"primary",text:p("components.xdao.addProposal.validateProposal")}:{color:"grey",text:p("components.xdao.addProposal.completeFormToValidate")}),F=A(()=>({required:g=>!!g||p("components.xdao.addProposal.validation.fieldRequired"),minLength:g=>u=>u&&u.length>=g||p("components.xdao.addProposal.validation.minCharactersRequired",{min:g})})),M=A(()=>{const g=[];return v.value.grantValue&&g.push(u=>{const h=Number(u);return!isNaN(h)&&Number.isInteger(h)||p("components.xdao.addProposal.validation.grantMustBeWholeNumber")}),g}),Z=A(()=>v.value.grantValue&&v.value.grantValue>0?[F.value.required,g=>!/\s/.test(g)||p("components.xdao.addProposal.validation.addressNoSpaces")]:[]),ie=async()=>{try{if(T.value=!0,!E.value){U(p("components.xdao.addProposal.messages.completeRequiredFields"));return}const u=await ce.get("https://stats.runonflux.io/proposals/price");u.data.status==="success"?(R.value=u.data.data,N.value=!0,X(p("components.xdao.addProposal.messages.proposalValidatedSuccess"))):U(u.data.data.message||u.data.data)}catch(g){U(p("components.xdao.addProposal.messages.failedToValidate",{error:g.message}))}finally{T.value=!1}},te=async()=>{try{j.value=!0;const g={topic:v.value.topic,description:v.value.description,grantValue:v.value.grantValue||0,grantAddress:v.value.grantAddress||"",nickName:v.value.nickName||""},h=await ce.post("https://stats.runonflux.io/proposals/submitproposal",JSON.stringify(g),{headers:{"Content-Type":"application/json"}});h.data.status==="success"?(C.value=h.data.data.address,V.value=h.data.data.hash,R.value=h.data.data.amount,ne.value=h.data.data.paidTillDate,X(p("components.xdao.addProposal.messages.proposalRegisteredSuccess"))):U(h.data.data.message||h.data.data)}catch(g){U(p("components.xdao.addProposal.messages.failedToRegister",{error:g.message}))}finally{j.value=!1}},me=()=>{try{if(!C.value||!R.value||!V.value){U(p("components.xdao.addProposal.messages.paymentDetailsNotAvailable"));return}const g=`zel:?action=pay&coin=zelcash&address=${C.value}&amount=${R.value}&message=${V.value}`,u=document.createElement("a");u.href=g,u.style.display="none",document.body.appendChild(u),u.click(),document.body.removeChild(u),X(p("components.xdao.addProposal.messages.zelcorePaymentInitiated"))}catch{U(p("components.xdao.addProposal.messages.failedToOpenZelcore"))}},ve=async()=>{try{if(!window.ssp){U(p("components.xdao.addProposal.messages.sspWalletNotInstalled"));return}const g={message:V.value,amount:(R.value||0).toString(),address:C.value,chain:"flux"},u=await window.ssp.request("pay",g);if(u.status==="ERROR")throw new Error(u.data||u.result);X(p("components.xdao.addProposal.messages.sspPaymentInitiated"))}catch(g){U(p("components.xdao.addProposal.messages.failedToInitiateSSP",{error:g.message}))}},re=async g=>{try{await navigator.clipboard.writeText(g),X(p("components.xdao.addProposal.messages.copiedToClipboard"))}catch{U(p("components.xdao.addProposal.messages.failedToCopy"))}},ae=()=>{v.value={topic:"",description:"",grantValue:"",grantAddress:"",nickName:""},N.value=!1,V.value="",C.value="",ne.value=0,R.value=null},se=async()=>{try{const u=await ce.get("https://stats.runonflux.io/proposals/price");u.data&&u.data.status==="success"&&(R.value=u.data.data)}catch(g){console.log("Failed to fetch proposal price:",g.message),R.value=null}};we(()=>{se()});const X=g=>{ee.value=g,B.value=!0,g.includes("payment")&&V.value&&setTimeout(()=>{i("proposalAdded"),ae()},2e3)},U=g=>{L.value=g,K.value=!0};return(g,u)=>(b(),I(xe,null,[e(D,null,{default:t(()=>[e(de,{class:"bg-primary text-white pa-4"},{default:t(()=>[a("div",Da,[e(f,{icon:"mdi-plus-circle-outline",class:"me-2"}),_(" "+s(n(p)("components.xdao.addProposal.title")),1)])]),_:1}),e(k,{class:"pa-4 pa-sm-6"},{default:t(()=>[e(Ke,{ref_key:"form",ref:ge,modelValue:pe.value,"onUpdate:modelValue":u[7]||(u[7]=h=>pe.value=h)},{default:t(()=>[e(oe,null,{default:t(()=>[e(z,{cols:"12"},{default:t(()=>[e(he,{modelValue:v.value.topic,"onUpdate:modelValue":u[0]||(u[0]=h=>v.value.topic=h),label:n(p)("components.xdao.addProposal.fields.topic.label"),rules:[F.value.value.required,F.value.value.minLength(3)],variant:"outlined",placeholder:n(p)("components.xdao.addProposal.fields.topic.placeholder")},null,8,["modelValue","label","rules","placeholder"])]),_:1}),e(z,{cols:"12"},{default:t(()=>[e(et,{modelValue:v.value.description,"onUpdate:modelValue":u[1]||(u[1]=h=>v.value.description=h),label:n(p)("components.xdao.addProposal.fields.description.label"),rules:[F.value.value.required,F.value.value.minLength(50)],rows:"6",variant:"outlined",placeholder:n(p)("components.xdao.addProposal.fields.description.placeholder")},null,8,["modelValue","label","rules","placeholder"])]),_:1}),e(z,{cols:"12"},{default:t(()=>[e(Ee,{variant:"accordion"},{default:t(()=>[e(Fe,null,{default:t(()=>[e(Oe,null,{default:t(()=>[e(ue,{variant:"tonal",color:"success",size:"32",class:"me-2"},{default:t(()=>[e(f,{icon:"mdi-currency-usd",size:"16"})]),_:1}),_(" "+s(n(p)("components.xdao.addProposal.fields.grantInformation")),1)]),_:1}),e(Te,null,{default:t(()=>[e(oe,null,{default:t(()=>[e(z,{cols:"12",md:"6"},{default:t(()=>[e(he,{modelValue:v.value.grantValue,"onUpdate:modelValue":u[2]||(u[2]=h=>v.value.grantValue=h),label:n(p)("components.xdao.addProposal.fields.grantAmount.label"),type:"number",variant:"outlined",placeholder:"0",rules:M.value},null,8,["modelValue","label","rules"])]),_:1}),e(z,{cols:"12",md:"6"},{default:t(()=>[e(he,{modelValue:v.value.grantAddress,"onUpdate:modelValue":u[3]||(u[3]=h=>v.value.grantAddress=h),label:n(p)("components.xdao.addProposal.fields.grantAddress.label"),variant:"outlined",placeholder:n(p)("components.xdao.addProposal.fields.grantAddress.placeholder"),rules:Z.value,disabled:!v.value.grantValue||v.value.grantValue<=0},null,8,["modelValue","label","placeholder","rules","disabled"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(z,{cols:"12",md:"6"},{default:t(()=>[e(he,{modelValue:v.value.nickName,"onUpdate:modelValue":u[4]||(u[4]=h=>v.value.nickName=h),label:n(p)("components.xdao.addProposal.fields.nickname.label"),variant:"outlined",placeholder:n(p)("components.xdao.addProposal.fields.nickname.placeholder")},null,8,["modelValue","label","placeholder"])]),_:1}),e(z,{cols:"12",md:"6"},{default:t(()=>[e(D,{variant:"outlined",color:W.value.color,class:"pa-4 text-center"},{default:t(()=>[e(q,{disabled:!E.value||T.value,loading:T.value,color:W.value.color,variant:"elevated",onClick:ie},{default:t(()=>[e(f,{icon:"mdi-check-circle-outline",class:"me-2"}),_(" "+s(W.value.text),1)]),_:1},8,["disabled","loading","color"])]),_:1},8,["color"])]),_:1})]),_:1}),e(Se,null,{default:t(()=>[N.value?(b(),S(D,{key:0,variant:"tonal",color:"success",class:"mt-6"},{default:t(()=>[e(k,{class:"pa-6"},{default:t(()=>[a("div",ka,[a("h3",$a,s(n(p)("components.xdao.addProposal.validatedSuccessfully")),1),a("p",Sa,[_(s(n(p)("components.xdao.addProposal.registrationFee"))+": ",1),a("strong",null,s(R.value)+" FLUX",1)]),e(q,{loading:j.value,disabled:j.value,color:"primary",variant:"elevated",size:"large",onClick:te},{default:t(()=>[e(f,{icon:"mdi-clipboard-check-outline",class:"me-2"}),_(" "+s(n(p)("components.xdao.addProposal.registerProposal")),1)]),_:1},8,["loading","disabled"])])]),_:1})]),_:1})):O("",!0)]),_:1}),e(Se,null,{default:t(()=>[V.value?(b(),S(D,{key:0,variant:"outlined",class:"mt-6"},{default:t(()=>[e(k,{class:"pa-6"},{default:t(()=>[a("div",za,[a("h2",Na,s(n(p)("components.xdao.addProposal.payment.completePayment")),1),a("div",Ca,[a("div",Aa,s(n(p)("components.xdao.addProposal.payment.paymentRequired")),1),a("div",Ra,[e(Y,{variant:"flat",color:"success",size:"large",class:"payment-chip"},{default:t(()=>[e(f,{icon:"mdi-currency-usd",class:"me-2",size:"20"}),_(" "+s(R.value)+" FLUX ",1)]),_:1})]),a("div",ja,s(n(p)("components.xdao.addProposal.payment.toCompleteRegistration")),1)]),e(oe,{class:"mt-4"},{default:t(()=>[e(z,{cols:"12",md:"6"},{default:t(()=>[e(D,{class:"simple-payment-card h-100",variant:"outlined"},{default:t(()=>[e(k,{class:"text-center"},{default:t(()=>[a("div",La,s(n(p)("components.xdao.addProposal.payment.walletPayment")),1),a("div",Ea,s(n(p)("components.xdao.addProposal.payment.chooseWallet")),1),a("div",Fa,[a("div",{class:"wallet-image-container",onClick:me},[a("img",{src:n(dt),alt:"Zelcore",class:"wallet-image"},null,8,Oa),u[10]||(u[10]=a("div",{class:"text-caption mt-2"},"Zelcore",-1))]),a("div",{class:"wallet-image-container",onClick:ve},[a("img",{src:J.value,alt:"SSP",class:"wallet-image"},null,8,Ta),u[11]||(u[11]=a("div",{class:"text-caption mt-2"},"SSP",-1))])])]),_:1})]),_:1})]),_:1}),e(z,{cols:"12",md:"6"},{default:t(()=>[e(D,{class:"simple-payment-card h-100",variant:"outlined"},{default:t(()=>[e(k,null,{default:t(()=>[a("div",Ua,s(n(p)("components.xdao.addProposal.payment.manualPayment")),1),a("div",Ia,[a("div",qa,s(n(p)("components.xdao.addProposal.payment.foundationAddress")),1),a("div",Ba,[a("input",{readonly:"",value:C.value,class:"copy-input"},null,8,Ya),e(q,{icon:"mdi-content-copy",size:"small",variant:"text",onClick:u[5]||(u[5]=h=>re(C.value))})])]),a("div",Ma,[a("div",Wa,s(n(p)("components.xdao.addProposal.payment.transactionMessage")),1),a("div",Za,[a("input",{readonly:"",value:V.value,class:"copy-input"},null,8,Xa),e(q,{icon:"mdi-content-copy",size:"small",variant:"text",onClick:u[6]||(u[6]=h=>re(V.value))})])]),e(q,{variant:"text",size:"small",href:`https://explorer.runonflux.io/address/${C.value}`,target:"_blank",rel:"noopener noreferrer"},{default:t(()=>[e(f,{icon:"mdi-open-in-new",size:"14",class:"me-1"}),_(" "+s(n(p)("components.xdao.addProposal.payment.viewOnExplorer")),1)]),_:1},8,["href"])]),_:1})]),_:1})]),_:1})]),_:1})])]),_:1})]),_:1})):O("",!0)]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(ze,{modelValue:B.value,"onUpdate:modelValue":u[8]||(u[8]=h=>B.value=h),color:"success",timeout:"5000",location:"top"},{default:t(()=>[a("div",Ha,[e(f,{icon:"mdi-check-circle",class:"me-2"}),_(" "+s(ee.value),1)])]),_:1},8,["modelValue"]),e(ze,{modelValue:K.value,"onUpdate:modelValue":u[9]||(u[9]=h=>K.value=h),color:"error",timeout:"5000",location:"top"},{default:t(()=>[a("div",Ga,[e(f,{icon:"mdi-alert-circle",class:"me-2"}),_(" "+s(L.value),1)])]),_:1},8,["modelValue"])],64))}},Qa=ye(Ja,[["__scopeId","data-v-3d2c14c1"]]),Ka={class:"d-flex align-center mb-3"},es={class:"text-h4 mb-1"},ts={class:"text-body-2 mb-0 text-medium-emphasis"},as={class:"text-body-1 mb-0"},ss={key:0,class:"mt-4"},os={class:"d-flex align-center"},ls={key:1,style:{width:"20px"}},ns={key:0},is={class:"mt-4 text-body-1"},rs={class:"text-h5 mb-2"},ds={class:"text-body-1 text-medium-emphasis mb-4"},cs={class:"text-h5 mb-2"},us={class:"text-body-1 text-medium-emphasis"},ps={class:"d-block d-sm-none"},ms={class:"d-flex justify-space-between align-start mb-3"},vs={class:"text-h6 font-weight-bold flex-grow-1 me-3"},fs={class:"d-flex flex-column gap-2 mb-3"},gs={class:"d-flex align-center"},hs={class:"text-caption"},xs={class:"text-body-2"},_s={class:"text-caption text-medium-emphasis"},bs={class:"d-none d-sm-block"},ys={class:"d-flex justify-space-between align-start mb-3"},ws={class:"flex-grow-1 me-4"},Vs={class:"text-h6 font-weight-bold mb-0"},Ps={class:"d-flex justify-space-between align-center mb-3"},Ds={class:"d-flex align-center"},ks={class:"text-caption"},$s={class:"text-body-2"},Ss={class:"text-caption text-medium-emphasis"},zs={class:"voting-progress pt-3"},Ns={class:"d-flex justify-space-between text-caption mb-2"},Cs={class:"progress-segments"},As={class:"d-flex justify-space-between text-caption mt-2"},Rs={class:"text-success"},js={class:"text-error"},Ls={key:1},Es={key:0,class:"debug-info pa-4 ma-4 bg-surface rounded"},Fs={__name:"xdao-app",setup(x){const le=Ye();Ie({title:"FluxDAO - Decentralized Governance | Flux Network",description:"Participate in FluxDAO governance. Vote on proposals, submit ideas, and shape the future of Flux decentralized cloud. Community-driven decisions.",url:"https://cloud.runonflux.com/xdao-app",keywords:"FluxDAO, DAO, decentralized governance, voting, proposals, blockchain governance, community governance, flux governance, DAO voting",structuredData:[qe(),Be([{name:"Home",url:"https://cloud.runonflux.com"},{name:"FluxDAO",url:"https://cloud.runonflux.com/xdao-app"}])]});const{t:i}=Ve(),{openLoginBottomSheet:p,closeLoginBottomSheet:d}=Me(),J=Ae(),{privilege:ge,zelid:pe}=Re(J),T=y([]),j=y(!0),N=y(null),R=y(""),V=y("open"),C=y("latest"),ne=y(!1),B=y(!1),K=y(null),ee=y(!1),L=y(0),v=y(0),E=A(()=>ge.value!=="none"),W=A(()=>pe.value),F=A(()=>{const r=c=>T.value.filter(l=>c==="open"?l.status==="Open":c==="passed"?l.status==="Passed":c==="unpaid"?l.status==="Unpaid"||l.status.includes("Unpaid")&&!l.status.includes("Rejected")&&!l.status.includes("Not Enough Votes"):c==="rejected"?l.status.includes("Rejected")||l.status==="Rejected":!1).length;return[{title:i("pages.xdao.open"),icon:"mdi-clock-outline",value:"open",count:r("open")},{title:i("pages.xdao.passed"),icon:"mdi-check-circle-outline",value:"passed",count:r("passed")},{title:i("pages.xdao.rejected"),icon:"mdi-close-circle-outline",value:"rejected",count:r("rejected")},{title:i("pages.xdao.unpaid"),icon:"mdi-currency-usd-off",value:"unpaid",count:r("unpaid")}]}),M=A(()=>[{title:i("pages.xdao.latest"),value:"latest"},{title:i("pages.xdao.titleAsc"),value:"title-asc"},{title:i("pages.xdao.titleDesc"),value:"title-desc"},{title:i("pages.xdao.endDate"),value:"end-date"}]),Z=A(()=>{let r=T.value;if(r=r.filter(c=>(console.log("Filtering proposal:",c.topic,"Status:",c.status,"Filter:",V.value),V.value==="open"?c.status==="Open":V.value==="passed"?c.status==="Passed":V.value==="unpaid"?c.status==="Unpaid"||c.status.includes("Unpaid")&&!c.status.includes("Rejected")&&!c.status.includes("Not Enough Votes"):V.value==="rejected"?c.status.includes("Rejected")||c.status==="Rejected":!1)),console.log("Filtered results for",V.value,":",r.length,"proposals"),R.value){const c=R.value.toLowerCase();r=r.filter(l=>l.topic.toLowerCase().includes(c)||l.description.toLowerCase().includes(c)||l.nickName&&l.nickName.toLowerCase().includes(c))}return r.sort((c,l)=>C.value==="title-asc"?c.topic.localeCompare(l.topic):C.value==="title-desc"?l.topic.localeCompare(c.topic):C.value==="end-date"?c.voteEndDate-l.voteEndDate:l.submitDate-c.submitDate),r}),ie=async()=>{try{j.value=!0,N.value=null,console.log("Fetching proposals from API...");const r="https://stats.runonflux.io/proposals/listProposals";console.log("API URL:",r);const c=await ce.get(r,{timeout:1e4,headers:{Accept:"application/json","Content-Type":"application/json"}});if(console.log("API Response:",c.data),c.data&&c.data.status==="success"){console.log("Proposals received:",c.data.data.length),T.value=c.data.data||[],N.value=null;const l=[...new Set(T.value.map(G=>G.status))];console.log("Unique status values found:",l)}else console.error("API returned error:",c.data),T.value=[],N.value=i("pages.xdao.errors.loadProposalsServer")}catch(r){console.error("Error fetching proposals:",r),console.error("Error details:",{message:r.message,code:r.code,response:r.response?.data,status:r.response?.status}),T.value=[],r.code==="NETWORK_ERROR"||r.message.includes("Network Error")?N.value=i("pages.xdao.errors.networkFailed"):r.code==="ECONNABORTED"||r.message.includes("timeout")?N.value=i("pages.xdao.errors.timeout"):r.response?.status>=500?N.value=i("pages.xdao.errors.serverError"):r.response?.status===404?N.value=i("pages.xdao.errors.serviceNotFound"):N.value=i("pages.xdao.errors.loadProposalsGeneric")}finally{j.value=!1,console.log("Final proposals count:",T.value.length)}},te=r=>{V.value=r,v.value=0;const c=F.value.findIndex(l=>l.value===r);c!==-1&&(L.value=c)},me=()=>{v.value=1},ve=r=>{K.value=r,B.value=!0,le.trackXDAO("view_proposal",{proposal_hash:r.hash,proposal_status:r.status,proposal_topic:r.topic?.substring(0,100)})},re=()=>{le.trackXDAO("create_proposal",{success:!0}),ie(),v.value=0},ae=r=>r==="Open"?"warning":r==="Passed"?"success":r==="Unpaid"||r.includes("Unpaid")&&!r.includes("Rejected")?"info":r.includes("Rejected")||r==="Rejected"?"error":"primary",se=r=>{if(!r)return"";const c={Open:i("components.xdao.proposalDetail.charts.status.open"),Passed:i("components.xdao.proposalDetail.charts.status.passed"),Unpaid:i("components.xdao.proposalDetail.charts.status.unpaid"),Rejected:i("components.xdao.proposalDetail.charts.status.rejected"),"Not Enough Votes":i("components.xdao.proposalDetail.charts.status.notEnoughVotes")};return r.includes("Not Enough Votes")?r.replace("Not Enough Votes",c["Not Enough Votes"]).replace("Rejected",c.Rejected):r.includes(" ")?r.split(" ").map(o=>c[o]||o).join(" "):c[r]||r},X=r=>r?.charAt(0).toUpperCase()||"?",U=r=>new Date(r).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}),g=()=>({open:i("pages.xdao.noOpenProposals"),passed:i("pages.xdao.noPassedProposals"),unpaid:i("pages.xdao.noUnpaidProposals"),rejected:i("pages.xdao.noRejectedProposals")})[V.value]||i("pages.xdao.noProposalsFound"),u=()=>({open:i("pages.xdao.noOpenProposalsMessage"),passed:i("pages.xdao.noPassedProposalsMessage"),unpaid:i("pages.xdao.noUnpaidProposalsMessage"),rejected:i("pages.xdao.noRejectedProposalsMessage")})[V.value]||i("pages.xdao.tryDifferentFilter"),h=r=>r?r.replace(/\*\*([^*]+)\*\*/g,"$1").replace(/^\s*\*\s+/gm,"").replace(/\s+/g," ").trim():"",_e=r=>r.status==="Passed"?"success":r.status==="Open"?"primary":"error";return fe(ne,(r,c)=>{console.log("showAddProposal changed from",c,"to",r)}),fe(E,r=>{r&&d()}),we(()=>{le.trackXDAO("page_view",{page:"xdao",is_logged_in:E.value}),ie()}),(r,c)=>(b(),I("div",null,[e(oe,null,{default:t(()=>[e(z,{cols:"12"},{default:t(()=>[e(D,{class:"xdao-intro-card"},{default:t(()=>[e(k,null,{default:t(()=>[a("div",Ka,[e(ue,{size:"48",color:"primary",variant:"tonal",class:"mr-3"},{default:t(()=>[e(f,{size:"28"},{default:t(()=>[...c[4]||(c[4]=[_("mdi-account-group",-1)])]),_:1})]),_:1}),a("div",null,[a("h2",es,s(n(i)("pages.xdao.title")),1),a("p",ts,s(n(i)("pages.xdao.subtitle")),1)])]),a("p",as,s(n(i)("pages.xdao.description")),1)]),_:1})]),_:1})]),_:1})]),_:1}),e(oe,null,{default:t(()=>[e(z,{cols:"12",class:"d-md-none"},{default:t(()=>[e(D,null,{default:t(()=>[e(k,{class:"pa-4"},{default:t(()=>[e(q,{variant:"outlined",color:"secondary",onClick:c[0]||(c[0]=l=>ee.value=!ee.value)},{default:t(()=>[e(f,{icon:"mdi-filter-variant",class:"me-2"}),_(" "+s(n(i)("pages.xdao.filters")),1)]),_:1}),ee.value?(b(),I("div",ss,[a("div",{class:De(["filter-grid",{"grid-full-width":F.value.length%2===1}])},[(b(!0),I(xe,null,be(F.value,(l,G)=>(b(),S(Y,{key:l.value,value:G,variant:V.value===l.value?"flat":"outlined",color:V.value===l.value?"primary":"default",size:"default",class:De(["px-3 py-2 d-flex align-center filter-chip",{"last-full-width":G===F.value.length-1&&F.value.length%2===1}]),onClick:o=>te(l.value)},{default:t(()=>[a("div",os,[e(f,{icon:l.icon,class:"me-1",size:"18"},null,8,["icon"]),a("span",null,s(l.title),1)]),l.count>0?(b(),S(tt,{key:0,content:l.count,color:V.value===l.value?"white":"primary",inline:"",density:"compact",class:"badge-xs ml-1"},null,8,["content","color"])):(b(),I("div",ls))]),_:2},1032,["value","variant","color","class","onClick"]))),128))],2)])):O("",!0)]),_:1})]),_:1})]),_:1}),e(z,{cols:"12",md:"4",lg:"3",class:"d-none d-md-block"},{default:t(()=>[e(D,null,{default:t(()=>[e(k,{class:"pa-6"},{default:t(()=>[e(at,{class:"pa-0 sidebar-list compact-sidebar"},{default:t(()=>[e(Ne,{active:v.value===1,"prepend-icon":"mdi-plus-circle-outline",rounded:"xl",class:"mb-1 compact-list-item add-proposal-item",onClick:me},{default:t(()=>[e(Ce,{class:"text-body-2 font-weight-medium"},{default:t(()=>[_(s(n(i)("pages.xdao.addProposal")),1)]),_:1})]),_:1},8,["active"]),e(st,{class:"my-3"}),e(ot,{class:"text-medium-emphasis px-0 mb-2 text-body-2"},{default:t(()=>[_(s(n(i)("pages.xdao.filterProposals")),1)]),_:1}),(b(!0),I(xe,null,be(F.value,l=>(b(),S(Ne,{key:l.title,active:V.value===l.value&&v.value===0,"prepend-icon":l.icon,rounded:"xl",class:"mb-1 compact-list-item",onClick:G=>te(l.value)},{default:t(()=>[e(Ce,{class:"text-body-2"},{default:t(()=>[_(s(l.title)+" ",1),l.count>0?(b(),S(Y,{key:0,color:V.value===l.value&&v.value===0?"success":"default",variant:"tonal",size:"x-small",class:"ml-2"},{default:t(()=>[_(s(l.count),1)]),_:2},1032,["color"])):O("",!0)]),_:2},1024)]),_:2},1032,["active","prepend-icon","onClick"]))),128))]),_:1})]),_:1})]),_:1})]),_:1}),e(z,{cols:"12",md:"8",lg:"9"},{default:t(()=>[v.value===0?(b(),I("div",ns,[e(D,{class:"mb-4"},{default:t(()=>[e(k,{class:"pa-4"},{default:t(()=>[e(oe,{align:"center"},{default:t(()=>[e(z,{cols:"12",md:"8"},{default:t(()=>[e(he,{modelValue:R.value,"onUpdate:modelValue":c[1]||(c[1]=l=>R.value=l),placeholder:n(i)("pages.xdao.searchProposals"),"prepend-inner-icon":"mdi-magnify",variant:"outlined",density:"compact","hide-details":""},null,8,["modelValue","placeholder"])]),_:1}),e(z,{cols:"12",md:"4"},{default:t(()=>[e(lt,{modelValue:C.value,"onUpdate:modelValue":c[2]||(c[2]=l=>C.value=l),items:M.value,label:n(i)("pages.xdao.sortBy"),variant:"outlined",density:"compact","hide-details":""},null,8,["modelValue","items","label"])]),_:1})]),_:1})]),_:1})]),_:1}),j.value?(b(),S(D,{key:0,class:"text-center pa-8"},{default:t(()=>[e(k,null,{default:t(()=>[e(nt,{indeterminate:"",color:"primary",size:"48"}),a("div",is,s(n(i)("pages.xdao.loadingProposals")),1)]),_:1})]),_:1})):N.value?(b(),S(D,{key:1,class:"text-center pa-8"},{default:t(()=>[e(k,null,{default:t(()=>[e(f,{icon:"mdi-alert-circle-outline",size:"64",color:"error",class:"mb-4"}),a("h3",rs,s(n(i)("pages.xdao.failedToLoad")),1),a("p",ds,s(N.value),1),e(q,{color:"primary",variant:"elevated",onClick:ie},{default:t(()=>[e(f,{icon:"mdi-refresh",class:"me-2"}),_(" "+s(n(i)("pages.xdao.tryAgain")),1)]),_:1})]),_:1})]),_:1})):Z.value.length===0?(b(),S(D,{key:2,class:"text-center pa-8"},{default:t(()=>[e(k,null,{default:t(()=>[e(f,{icon:"mdi-clipboard-outline",size:"64",color:"grey-lighten-1",class:"mb-4"}),a("h3",cs,s(g()),1),a("p",us,s(u()),1)]),_:1})]),_:1})):O("",!0),(b(!0),I(xe,null,be(Z.value,l=>(b(),S(D,{key:l.hash,class:"mb-4 proposal-card",onClick:G=>ve(l)},{default:t(()=>[e(k,{class:"pa-4 pa-sm-6"},{default:t(()=>[a("div",ps,[a("div",ms,[a("h3",vs,s(h(l.topic)),1),e(Y,{color:ae(l.status),variant:"elevated",size:"small",class:"flex-shrink-0"},{default:t(()=>[_(s(se(l.status)),1)]),_:2},1032,["color"])]),a("div",fs,[a("div",gs,[l.nickName?(b(),S(ue,{key:0,size:"20",color:ae(l.status),variant:"tonal",class:"me-2"},{default:t(()=>[a("span",hs,s(X(l.nickName)),1)]),_:2},1032,["color"])):(b(),S(f,{key:1,icon:"mdi-account",size:"20",class:"me-2 text-medium-emphasis"})),a("span",xs,s(l.nickName||n(i)("pages.xdao.anonymous")),1)]),a("div",_s,s(n(i)("pages.xdao.end"))+": "+s(U(l.voteEndDate)),1)])]),a("div",bs,[a("div",ys,[a("div",ws,[a("h3",Vs,s(h(l.topic)),1)]),e(Y,{color:ae(l.status),variant:"elevated",size:"small",class:"flex-shrink-0"},{default:t(()=>[_(s(se(l.status)),1)]),_:2},1032,["color"])]),a("div",Ps,[a("div",Ds,[l.nickName?(b(),S(ue,{key:0,size:"24",color:ae(l.status),variant:"tonal",class:"me-2"},{default:t(()=>[a("span",ks,s(X(l.nickName)),1)]),_:2},1032,["color"])):(b(),S(f,{key:1,icon:"mdi-account",size:"24",class:"me-2 text-medium-emphasis"})),a("span",$s,s(l.nickName||n(i)("pages.xdao.anonymous")),1)]),a("div",Ss,s(n(i)("pages.xdao.end"))+": "+s(U(l.voteEndDate)),1)])]),a("div",zs,[a("div",Ns,[a("span",null,s(n(i)("pages.xdao.required"))+": "+s(Number(l.votesRequired).toLocaleString()),1),a("span",null,s(n(i)("pages.xdao.total"))+": "+s(Number(l.votesYes+l.votesNo).toLocaleString()),1)]),e(Le,{"model-value":(l.votesYes+l.votesNo)/l.votesRequired*100,color:"primary",height:"20",rounded:""},{default:t(()=>[a("div",Cs,[l.votesYes>0?(b(),I("div",{key:0,class:"progress-yes",style:ke({width:`${l.votesYes/l.votesRequired*100}%`})},null,4)):O("",!0),l.votesNo>0?(b(),I("div",{key:1,class:"progress-no",style:ke({width:`${l.votesNo/l.votesRequired*100}%`,left:`${l.votesYes/l.votesRequired*100}%`})},null,4)):O("",!0)])]),_:2},1032,["model-value"]),a("div",As,[a("span",Rs,s(n(i)("pages.xdao.yes"))+": "+s(Number(l.votesYes).toLocaleString()),1),e(Y,{variant:"tonal",size:"x-small",color:_e(l),class:"percentage-chip"},{default:t(()=>[_(s(Math.round((l.votesYes+l.votesNo)/l.votesRequired*100))+"% ",1)]),_:2},1032,["color"]),a("span",js,s(n(i)("pages.xdao.no"))+": "+s(Number(l.votesNo).toLocaleString()),1)])])]),_:2},1024)]),_:2},1032,["onClick"]))),128))])):O("",!0),v.value===1?(b(),I("div",Ls,[e(Qa,{onProposalAdded:re})])):O("",!0)]),_:1})]),_:1}),e(Pa,{modelValue:B.value,"onUpdate:modelValue":c[3]||(c[3]=l=>B.value=l),proposal:K.value,zelid:W.value,onShowLogin:n(p)},null,8,["modelValue","proposal","zelid","onShowLogin"]),r.$route.query.debug?(b(),I("div",Es,[a("h4",null,s(n(i)("pages.xdao.debugInfo")),1),a("p",null,"showAddProposal: "+s(ne.value),1),a("p",null,"showProposalDetail: "+s(B.value),1),a("p",null,"proposals.length: "+s(T.value.length),1),a("p",null,"activeFilter: "+s(V.value),1)])):O("",!0)]))}},po=ye(Fs,[["__scopeId","data-v-ebf51d3b"]]);export{po as default};
