import{a as C}from"./http-BZQDkn3h.js";import{G as p,r as u,c as b}from"./apexcharts-nIAyciCq.js";class ${constructor(){this.marketplaceURL="https://jetpackbridge.runonflux.io",this.apiVersion=1}getMarketplaceClient(){const e=localStorage.getItem("zelidauth"),t={"Content-Type":"application/json"};if(e){t.zelidauth=e;try{const a=e.includes("zelid=")?Object.fromEntries(new URLSearchParams(e)):JSON.parse(e);a.zelid&&(t.zelid=a.zelid),a.signature&&(t.signature=a.signature),a.loginPhrase&&(t.loginPhrase=a.loginPhrase)}catch(a){console.warn("Failed to parse zelidauth, using raw value:",a)}}return C.create({baseURL:this.marketplaceURL,headers:t,timeout:1e4})}async getAllAppsWithVisibility(){try{const t=await this.getMarketplaceClient().get(`/api/v${this.apiVersion}/marketplace/apps`);if(t.data&&t.data.status==="success"){let a=t.data.data||[];return a=a.filter(r=>r.visible!==!1&&r.enabled!==!1),{data:a}}return{data:[]}}catch(e){return console.error("Failed to fetch marketplace apps:",e),{data:[]}}}async getApps(e={}){try{let a=(await this.getAllAppsWithVisibility()).data||[];const r=["53542105-d2c4-41a7-9fe5-2cf0c6a60018","7ce5a03c-b808-478b-94a1-2a1b3eaaeb36"];if(a=a.filter(o=>!r.includes(o.category)),e.category&&(a=a.filter(o=>o.category===e.category)),e.search){const o=e.search.toLowerCase();a=a.filter(n=>n.name?.toLowerCase().includes(o)||n.displayName?.toLowerCase().includes(o)||n.description?.toLowerCase().includes(o))}return{data:a}}catch(t){return console.error("Failed to fetch marketplace apps:",t),{data:[]}}}async getFeaturedApps(){try{const e=this.getMarketplaceClient(),a=(await this.getAllAppsWithVisibility()).data||[];try{const r=await e.get(`/api/v${this.apiVersion}/marketplace/featured`);if(r.data&&r.data.status==="success"){const n=(r.data.data.data||[]).map(c=>a.find(s=>s.uuid===c)).filter(c=>c!==void 0);return console.log("‚úÖ Featured apps loaded:",n.length),{data:n}}throw new Error("Invalid featured response structure")}catch(r){return console.log("‚ö†Ô∏è Featured endpoint failed:",r.message),{data:a.filter(n=>(n.installCount||0)>=5||(n.rating||0)>=3).sort((n,c)=>(c.rating||0)*(c.installCount||1)-(n.rating||0)*(n.installCount||1)).slice(0,6)}}}catch(e){return console.error("‚ùå Failed to fetch featured apps:",e),{data:[]}}}async getNewListedApps(){try{return{data:(await this.getAllAppsWithVisibility()).data.sort((a,r)=>(a.timestamp||0)-(r.timestamp||0)).slice(0,10)}}catch(e){return console.error("Failed to fetch new listed apps:",e),{data:[]}}}async getSponsoredApps(){try{const e=this.getMarketplaceClient(),a=(await this.getAllAppsWithVisibility()).data||[];try{const r=await e.get(`/api/v${this.apiVersion}/marketplace/featured`);if(r.data&&r.data.status==="success"){const n=(r.data.data.data||[]).map(c=>a.find(s=>s.uuid===c)).filter(c=>c!==void 0).slice(0,4);return console.log("‚úÖ Sponsored apps loaded from featured:",n.length),{data:n}}throw new Error("Invalid featured response structure")}catch(r){return console.log("‚ö†Ô∏è Featured endpoint failed:",r.message),{data:a.filter(n=>(n.installCount||0)>=1).sort((n,c)=>(c.installCount||0)-(n.installCount||0)).slice(0,4)}}}catch(e){return console.error("‚ùå Failed to fetch sponsored apps:",e),{data:[]}}}async getAppDetails(e){try{const r=((await this.getAllAppsWithVisibility()).data||[]).find(o=>o.name===e||o.uuid===e||o.name?.toLowerCase()===e?.toLowerCase());if(!r)throw new Error("App not found");return{data:r}}catch(t){throw t.message!=="App not found"&&console.error("Failed to fetch app details:",t),t}}async getAppsByZelID(e){try{const a=await this.getMarketplaceClient().get(`/api/v${this.apiVersion}/marketplace/apps/${e}`);return a.data&&a.data.status==="success"?{data:a.data.data||[]}:{data:[]}}catch(t){return console.error("Failed to fetch apps by ZelID:",t),{data:[]}}}async getCategories(){try{const t=await this.getMarketplaceClient().get(`/api/v${this.apiVersion}/marketplace/categories`);return t.data&&t.data.status==="success"?{data:t.data.data||[]}:{data:[]}}catch(e){return console.error("Failed to fetch categories:",e),{data:[]}}}async deployApp(e,t={}){try{const a=localStorage.getItem("zelidauth");if(!a)throw new Error("Authentication required");const o=await this.getMarketplaceClient().post(`/api/v${this.apiVersion}/marketplace/deploy/${e}`,t,{headers:{zelidauth:a}});if(o.data&&o.data.status==="success")return o.data;throw new Error("Deployment failed")}catch(a){throw console.error("Failed to deploy app:",a),a}}async getDeployedApps(){try{const e=localStorage.getItem("zelidauth");if(!e)return{data:[]};let t=null;try{t=(e.includes("zelid=")?Object.fromEntries(new URLSearchParams(e)):JSON.parse(e)).zelid}catch(o){return console.error("Failed to parse zelidauth:",o),{data:[]}}if(!t)return{data:[]};const r=await this.getMarketplaceClient().get(`/api/v${this.apiVersion}/marketplace/apps/${t}`);return r.data&&r.data.status==="success"?{data:r.data.data||[]}:{data:[]}}catch(e){return console.error("Failed to fetch deployed apps:",e),{data:[]}}}async getAppInstance(e){try{const a=await this.getMarketplaceClient().get(`/api/v${this.apiVersion}/marketplace/appinstance/${e}`);return a.data&&a.data.status==="success"?{data:a.data.data}:{data:null}}catch(t){return console.error("Failed to fetch app instance:",t),{data:null}}}async submitReview(e,t){try{const a=localStorage.getItem("zelidauth");if(!a)throw new Error("Authentication required");return(await this.getMarketplaceClient().post(`/api/v${this.apiVersion}/marketplace/app/${e}/review`,t,{headers:{zelidauth:a}})).data}catch(a){throw console.error("Failed to submit review:",a),a}}async getAppReviews(e){try{const a=await this.getMarketplaceClient().get(`/api/v${this.apiVersion}/marketplace/app/${e}/reviews`);return a.data&&a.data.status==="success"?{data:a.data.data||[]}:{data:[]}}catch(t){return console.error("Failed to fetch reviews:",t),{data:[]}}}async getMarketplaceStats(){try{const t=await this.getMarketplaceClient().get(`/api/v${this.apiVersion}/marketplace/stats`);return t.data&&t.data.status==="success"?{data:t.data.data}:{data:{}}}catch(e){return console.error("Failed to fetch marketplace stats:",e),{data:{}}}}async getPopularApps(){try{const t=await this.getMarketplaceClient().get(`/api/v${this.apiVersion}/marketplace/apps/popular`);return t.data&&t.data.status==="success"?{data:t.data.data||[]}:{data:[]}}catch(e){return console.error("Failed to fetch popular apps:",e),{data:[]}}}async getGamesList(){try{const t=await this.getMarketplaceClient().get(`/api/v${this.apiVersion}/marketplace/trending`);return t.data&&t.data.status==="success"?{data:t.data.data.data||[]}:{data:[]}}catch(e){return console.error("Failed to fetch games list:",e),{data:[]}}}async getGames(){try{const t=(await this.getAllAppsWithVisibility()).data||[];return{data:((await this.getGamesList()).data||[]).map(n=>t.find(c=>c.uuid===n)).filter(n=>n!==void 0)}}catch(e){return console.error("Failed to fetch games:",e),{data:[]}}}}const h=new $,v=u([]),y=u([]),m=u([]),w=u([]),d=u([]),A=u([]),F=u(new Map),i=u(0),M=b(()=>i.value>0),f=u(null);function R(){const k=async(s={})=>{i.value++,f.value=null;try{const l=await h.getApps(s);v.value=l.data||[]}catch(l){console.error("Failed to fetch marketplace apps:",l),f.value=l.message,v.value=[]}finally{i.value--}},e=async()=>{i.value++;try{console.log("üìã Fetching featured apps...");const s=await h.getFeaturedApps();y.value=s.data||[],console.log(`‚úÖ Featured apps: ${y.value.length}`)}catch(s){console.error("‚ùå Failed to fetch featured apps:",s),y.value=[]}finally{i.value--}},t=async()=>{i.value++;try{console.log("üöÄ Fetching new apps...");const s=await h.getNewListedApps();m.value=s.data||[],console.log(`‚úÖ New apps: ${m.value.length}`)}catch(s){console.error("‚ùå Failed to fetch new apps:",s),m.value=[]}finally{i.value--}},a=async()=>{i.value++;try{console.log("‚≠ê Fetching sponsored apps...");const s=await h.getSponsoredApps();w.value=s.data||[],console.log(`‚úÖ Sponsored apps: ${w.value.length}`)}catch(s){console.error("‚ùå Failed to fetch sponsored apps:",s),w.value=[]}finally{i.value--}},r=async()=>{try{const s=await h.getCategories();A.value=s.data||[];const l=new Map;A.value.forEach(g=>{l.set(g.uuid,g.name)}),F.value=l}catch(s){console.error("Failed to fetch categories:",s),A.value=[]}},o=async s=>{i.value++,f.value=null;try{return(await h.getAppDetails(s)).data}catch(l){throw l.response?.status!==404&&console.error("Failed to fetch app details:",l),f.value=l.message,l}finally{i.value--}},n=async(s,l={})=>{i.value++,f.value=null;try{return(await h.deployApp(s,l)).data}catch(g){throw console.error("Failed to deploy app:",g),f.value=g.message,g}finally{i.value--}},c=async()=>{i.value++;try{console.log("üéÆ Fetching games...");const s=await h.getGames();console.log("üéÆ Games response:",s),s.data&&Array.isArray(s.data)?(d.value=s.data.filter(l=>l&&l.visible&&l.enabled),console.log(`‚úÖ Games loaded: ${d.value.length}`,d.value)):s&&Array.isArray(s)?(d.value=s.filter(l=>l&&l.visible&&l.enabled),console.log(`‚úÖ Games loaded: ${d.value.length}`,d.value)):(console.warn("‚ö†Ô∏è Unexpected games response format:",s),d.value=[])}catch(s){console.error("‚ùå Failed to fetch games:",s),d.value=[]}finally{i.value--}};return{apps:p(v),featuredApps:p(y),newApps:p(m),sponsoredApps:p(w),games:p(d),categories:p(A),categoryMap:p(F),loading:p(M),error:p(f),fetchApps:k,fetchFeaturedApps:e,fetchNewApps:t,fetchSponsoredApps:a,fetchGames:c,fetchCategories:r,fetchAppDetails:o,deployApp:n}}export{R as u};
