import{x as j,b as _,V,a as U,c as H,d as z,J as S,K as I,o as P,p as L,r as J,L as Y,M as q,N as Q,O as W,g as X,h as Z}from"./vuetify-_4u1He_j.js";import{u as ee}from"./i18n-Bm8bpAAW.js";import{r as x,c as p,w as te,o as oe,a6 as se,a1 as ie,f as w,g,a3 as a,Q as m,j as l,T as f,U as r,x as B,P as C,q as ne,F as R,l as re}from"./apexcharts-nIAyciCq.js";const ae=6e4,le=.8,me=.9,ce=!1;class de{constructor(){this.intervalId=null,this.memoryHistory=[],this.maxHistoryLength=30,this.isMonitoring=!1,this.listeners=[]}start(e={}){if(this.isMonitoring){console.warn("[MemoryMonitor] Already monitoring");return}if(!performance.memory){console.warn("[MemoryMonitor] Performance Memory API not available in this browser"),console.info("[MemoryMonitor] Available in Chrome/Edge with --enable-precise-memory-info flag");return}const o={interval:e.interval||ae,highThreshold:e.highThreshold||le,criticalThreshold:e.criticalThreshold||me,detailedLogging:e.detailedLogging??ce};this.isMonitoring=!0,console.info("[MemoryMonitor] Started monitoring (interval: %dms)",o.interval),this.intervalId=setInterval(()=>{this.checkMemory(o)},o.interval),this.checkMemory(o)}stop(){this.intervalId&&(clearInterval(this.intervalId),this.intervalId=null,this.isMonitoring=!1,console.info("[MemoryMonitor] Stopped monitoring"))}checkMemory(e){const o=performance.memory,t=o.usedJSHeapSize/1048576,s=o.jsHeapSizeLimit/1048576,d=o.totalJSHeapSize/1048576,i=t/s,c={timestamp:Date.now(),used:t,total:d,limit:s,usageRatio:i};this.memoryHistory.push(c),this.memoryHistory.length>this.maxHistoryLength&&this.memoryHistory.shift(),i>=e.criticalThreshold?(console.error("üö® [MemoryMonitor] CRITICAL: Memory usage at %.1f%% (%.2f MB / %.2f MB)",i*100,t,s),this.notifyListeners("critical",c)):i>=e.highThreshold?(console.warn("‚ö†Ô∏è [MemoryMonitor] HIGH: Memory usage at %.1f%% (%.2f MB / %.2f MB)",i*100,t,s),this.notifyListeners("high",c)):e.detailedLogging&&console.log("‚úÖ [MemoryMonitor] OK: Memory usage at %.1f%% (%.2f MB / %.2f MB)",i*100,t,s),this.detectMemoryLeak(e)}detectMemoryLeak(e){if(this.memoryHistory.length<10)return;const o=this.memoryHistory.slice(-10),t=this.memoryHistory.slice(-20,-10);if(t.length<10)return;const s=o.reduce((h,M)=>h+M.used,0)/o.length,d=t.reduce((h,M)=>h+M.used,0)/t.length,i=s-d,c=i/d*100;c>20&&(console.warn(`üìà [MemoryMonitor] Potential memory leak detected: ${c.toFixed(1)}% increase (${d.toFixed(2)} MB ‚Üí ${s.toFixed(2)} MB)`),this.notifyListeners("leak-detected",{increase:i,increasePercent:c,olderAvg:d,recentAvg:s}))}addListener(e){this.listeners.push(e)}removeListener(e){const o=this.listeners.indexOf(e);o>-1&&this.listeners.splice(o,1)}notifyListeners(e,o){this.listeners.forEach(t=>{try{t(e,o)}catch(s){console.error("[MemoryMonitor] Listener error:",s)}})}getSnapshot(){if(!performance.memory)return null;const e=performance.memory;return{timestamp:Date.now(),used:e.usedJSHeapSize/1048576,total:e.totalJSHeapSize/1048576,limit:e.jsHeapSizeLimit/1048576,usageRatio:e.usedJSHeapSize/e.jsHeapSizeLimit}}getHistory(){return[...this.memoryHistory]}getStats(){if(this.memoryHistory.length===0)return null;const e=this.memoryHistory.map(i=>i.used),o=Math.min(...e),t=Math.max(...e),s=e.reduce((i,c)=>i+c,0)/e.length,d=this.memoryHistory[this.memoryHistory.length-1];return{min:o,max:t,avg:s,current:d.used,trend:this.memoryHistory.length>=2?d.used-this.memoryHistory[0].used:0,samples:this.memoryHistory.length}}clearHistory(){this.memoryHistory=[]}forceGC(){window.gc?(console.info("[MemoryMonitor] Forcing garbage collection..."),window.gc(),setTimeout(()=>{const e=this.getSnapshot();e&&console.info("[MemoryMonitor] After GC: %.2f MB used",e.used)},100)):console.warn("[MemoryMonitor] GC not available. Run Chrome with --expose-gc flag.")}analyzeMemoryUsage(){const e=this.getSnapshot();if(!e)return null;const o={timestamp:Date.now(),totalUsed:e.used,totalLimit:e.limit,usageRatio:e.usageRatio,categories:[]},t=e.total,s=e.used,d=t-s;if(o.categories.push({nameKey:"memoryMonitor.categories.usedHeap",size:s,percentage:s/e.limit*100,descriptionKey:"memoryMonitor.categories.usedHeapDesc"}),o.categories.push({nameKey:"memoryMonitor.categories.freeHeap",size:d,percentage:d/e.limit*100,descriptionKey:"memoryMonitor.categories.freeHeapDesc"}),o.categories.push({nameKey:"memoryMonitor.categories.available",size:e.limit-t,percentage:(e.limit-t)/e.limit*100,descriptionKey:"memoryMonitor.categories.availableDesc"}),typeof document<"u")try{const i=document.getElementsByTagName("*").length;o.domNodes=i,o.categories.push({nameKey:"memoryMonitor.categories.domNodes",size:i*.001,percentage:i*.001/e.limit*100,descriptionKey:"memoryMonitor.categories.domNodesDesc",count:i});const c=i*2;o.eventListeners=c,o.categories.push({nameKey:"memoryMonitor.categories.eventListeners",size:c*5e-4,percentage:c*5e-4/e.limit*100,descriptionKey:"memoryMonitor.categories.eventListenersDesc",count:c})}catch(i){console.warn("[MemoryMonitor] Could not analyze DOM:",i)}if(typeof window<"u")try{if(window.__VUE_DEVTOOLS_GLOBAL_HOOK__){const i=window.__VUE_DEVTOOLS_GLOBAL_HOOK__.apps||[];o.vueApps=i.length,o.categories.push({nameKey:"memoryMonitor.categories.vueApps",size:i.length*.5,percentage:i.length*.5/e.limit*100,descriptionKey:"memoryMonitor.categories.vueAppsDesc",count:i.length})}}catch{}return o}getDetailedReport(){const e=this.getSnapshot();if(!e)return null;const o=this.getStats(),t=this.analyzeMemoryUsage(),s=this.getHistory();return{snapshot:e,stats:o,breakdown:t,history:s,recommendations:this.getRecommendations(e,o)}}getRecommendations(e,o){const t=[];e.usageRatio>.9&&t.push({priority:"critical",message:"Memory usage is critically high. Consider closing unused tabs or refreshing the page."}),e.usageRatio>.75&&t.push({priority:"high",message:"Memory usage is high. Monitor for memory leaks or excessive data loading."}),o&&o.trend>50&&t.push({priority:"medium",message:`Memory has increased by ${o.trend.toFixed(1)} MB since monitoring started. Check for memory leaks.`});const s=this.analyzeMemoryUsage();return s&&s.domNodes>5e3&&t.push({priority:"medium",message:`Large number of DOM nodes (${s.domNodes}). Consider implementing virtualization for long lists.`}),t.length===0&&t.push({priority:"info",message:"Memory usage is normal. No action required."}),t}}const b=new de,ue={class:"d-flex align-center"},ye={key:0},fe={key:1},ge={class:"mb-4"},he={class:"d-flex justify-space-between mb-2"},pe={class:"text-body-2"},Me={class:"text-body-2 font-weight-bold"},ve={class:"d-flex justify-space-between mt-1"},_e={class:"text-caption text-disabled"},xe={class:"text-caption text-disabled"},we={class:"text-subtitle-2 mb-2"},be={class:"text-caption text-disabled"},He={class:"text-caption"},Le={class:"text-caption text-disabled"},Be={class:"text-caption"},Ce={class:"text-caption text-disabled"},ke={class:"text-caption"},Ve={class:"text-caption text-disabled"},ze={class:"text-caption"},Se={class:"d-flex justify-space-between"},Ie={class:"text-caption text-disabled"},Re={class:"d-flex justify-space-between mb-1"},$e={class:"text-caption"},Te={class:"text-caption font-weight-bold"},Ee={class:"text-caption text-disabled mt-1"},De={class:"d-flex gap-2"},Ne={__name:"NavBarMemoryMonitor",setup($){const{t:e}=ee(),o=x(!1),t=x(null),s=x(null),d=x(null),i=x(!1);let c=null;const h=p(()=>{if(!t.value)return"primary";const n=t.value.usageRatio;return n>=.9?"error":n>=.75?"warning":"success"}),M=p(()=>{if(!t.value)return"info";const n=t.value.usageRatio;return n>=.9?"error":n>=.75?"warning":"success"}),T=p(()=>{if(!t.value)return e("memoryMonitor.loading");const n=t.value.usageRatio;return n>=.9?e("memoryMonitor.statusHigh"):n>=.75?e("memoryMonitor.statusWarning"):e("memoryMonitor.statusNormal")}),E=p(()=>t.value?t.value.usageRatio>=.75:!1),D=p(()=>{if(!t.value)return"mdi-information";const n=t.value.usageRatio;return n>=.9?"mdi-alert-circle":n>=.75?"mdi-alert":"mdi-check-circle"}),O=p(()=>typeof window.gc=="function"),v=()=>{t.value=b.getSnapshot(),s.value=b.getStats(),d.value=b.analyzeMemoryUsage(),i.value=t.value!==null},A=()=>{b.forceGC(),setTimeout(v,200)},K=()=>{b.clearHistory(),v()},N=()=>{i.value&&!c&&(v(),c=setInterval(v,5e3))},k=()=>{c&&(clearInterval(c),c=null)};return te(o,n=>{n?N():k()}),oe(()=>{i.value=performance.memory!==void 0}),se(()=>{k()}),(n,u)=>{const F=ie("IconBtn");return g(),w(R,null,[a(F,{onClick:u[0]||(u[0]=y=>o.value=!0)},{default:m(()=>[a(j,{color:h.value,dot:"","model-value":E.value},{default:m(()=>[a(_,{icon:"mdi-gauge"})]),_:1},8,["color","model-value"])]),_:1}),a(Z,{modelValue:o.value,"onUpdate:modelValue":u[2]||(u[2]=y=>o.value=y),"max-width":"500"},{default:m(()=>[a(V,{rounded:"xl"},{default:m(()=>[a(U,{class:"d-flex align-center justify-space-between bg-primary"},{default:m(()=>[l("div",ue,[a(_,{color:"white",class:"ml-3 mr-2"},{default:m(()=>[...u[3]||(u[3]=[f(" mdi-gauge ",-1)])]),_:1}),l("span",null,r(n.$t("memoryMonitor.title")),1)]),a(H,{icon:"mdi-close",variant:"flat",size:"small",onClick:u[1]||(u[1]=y=>o.value=!1)})]),_:1}),a(z,null,{default:m(()=>[i.value?t.value?(g(),w("div",fe,[l("div",ge,[l("div",he,[l("span",pe,r(n.$t("memoryMonitor.currentUsage")),1),l("span",Me,r((t.value.usageRatio*100).toFixed(1))+"%",1)]),a(I,{"model-value":t.value.usageRatio*100,color:h.value,height:"12",rounded:""},null,8,["model-value","color"]),l("div",ve,[l("span",_e,r(t.value.used.toFixed(1))+" MB "+r(n.$t("memoryMonitor.used")),1),l("span",xe,r(t.value.limit.toFixed(0))+" MB "+r(n.$t("memoryMonitor.limit")),1)])]),s.value?(g(),C(V,{key:0,variant:"tonal",class:"mb-4"},{default:m(()=>[a(z,null,{default:m(()=>[l("div",we,r(n.$t("memoryMonitor.statistics")),1),a(P,{dense:""},{default:m(()=>[a(L,{cols:"6",class:"d-flex justify-space-between"},{default:m(()=>[l("span",be,r(n.$t("memoryMonitor.minimum"))+":",1),l("span",He,r(s.value.min.toFixed(1))+" MB",1)]),_:1}),a(L,{cols:"6",class:"d-flex justify-space-between"},{default:m(()=>[l("span",Le,r(n.$t("memoryMonitor.maximum"))+":",1),l("span",Be,r(s.value.max.toFixed(1))+" MB",1)]),_:1}),a(L,{cols:"6",class:"d-flex justify-space-between"},{default:m(()=>[l("span",Ce,r(n.$t("memoryMonitor.average"))+":",1),l("span",ke,r(s.value.avg.toFixed(1))+" MB",1)]),_:1}),a(L,{cols:"6",class:"d-flex justify-space-between"},{default:m(()=>[l("span",Ve,r(n.$t("memoryMonitor.samples"))+":",1),l("span",ze,r(s.value.samples),1)]),_:1})]),_:1}),a(J,{class:"my-2"}),l("div",Se,[l("span",Ie,r(n.$t("memoryMonitor.trend"))+":",1),l("span",{class:ne(["text-caption font-weight-bold",s.value.trend>0?"text-warning":"text-success"])},r(s.value.trend>0?"+":"")+r(s.value.trend.toFixed(1))+" MB ",3)])]),_:1})]),_:1})):B("",!0),a(S,{type:M.value,variant:"tonal",density:"compact",class:"mb-4",icon:D.value},{default:m(()=>[f(r(T.value),1)]),_:1},8,["type","icon"]),d.value?(g(),C(Y,{key:1,class:"mb-4"},{default:m(()=>[a(q,null,{default:m(()=>[a(Q,null,{default:m(()=>[a(_,{start:"",size:"20"},{default:m(()=>[...u[5]||(u[5]=[f(" mdi-chart-pie ",-1)])]),_:1}),f(" "+r(n.$t("memoryMonitor.breakdown")),1)]),_:1}),a(W,null,{default:m(()=>[(g(!0),w(R,null,re(d.value.categories,(y,G)=>(g(),w("div",{key:G,class:"mb-3"},[l("div",Re,[l("span",$e,r(n.$t(y.nameKey)),1),l("span",Te,r(y.size.toFixed(1))+" MB ("+r(y.percentage.toFixed(1))+"%)",1)]),a(I,{"model-value":y.percentage,color:y.percentage>50?"warning":"primary",height:"6",rounded:""},null,8,["model-value","color"]),l("div",Ee,r(n.$t(y.descriptionKey,{count:y.count||0})),1)]))),128))]),_:1})]),_:1})]),_:1})):B("",!0),l("div",De,[a(H,{variant:"flat",color:"primary",size:"small",onClick:v},{default:m(()=>[a(_,{start:"",size:"18"},{default:m(()=>[...u[6]||(u[6]=[f(" mdi-refresh ",-1)])]),_:1}),f(" "+r(n.$t("memoryMonitor.refresh")),1)]),_:1}),O.value?(g(),C(H,{key:0,variant:"flat",color:"secondary",size:"small",onClick:A},{default:m(()=>[a(_,{start:"",size:"18"},{default:m(()=>[...u[7]||(u[7]=[f(" mdi-delete-sweep ",-1)])]),_:1}),f(" "+r(n.$t("memoryMonitor.forceGC")),1)]),_:1})):B("",!0),a(X),a(H,{variant:"flat",color:"error",size:"small",onClick:K},{default:m(()=>[f(r(n.$t("memoryMonitor.clearHistory")),1)]),_:1})])])):B("",!0):(g(),w("div",ye,[a(S,{type:"warning",variant:"tonal"},{default:m(()=>[f(r(n.$t("memoryMonitor.notAvailable"))+" ",1),u[4]||(u[4]=l("br",null,null,-1)),l("small",null,r(n.$t("memoryMonitor.notAvailableHint")),1)]),_:1})]))]),_:1})]),_:1})]),_:1},8,["modelValue"])],64)}}};export{Ne as default};
