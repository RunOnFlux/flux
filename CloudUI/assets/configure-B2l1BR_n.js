import{_ as J}from"./SubscriptionManager-Ck2M1jzK.js";import{_ as U,c as B,k as A}from"./index-QPPWK7xw.js";import{s as F}from"./vue-core-CU9AIURn.js";import{u as T}from"./useSEO-5BaNf11O.js";import{u as M}from"./useLoginSheet-e2RZXtPE.js";import{a as k}from"./http-BZQDkn3h.js";import{o as R,p as O,V as Y,d as j,Q as q,b as g,c as P}from"./vuetify-_4u1He_j.js";import{u as G}from"./i18n-Bm8bpAAW.js";import{c as Q,r as S,w as L,o as $,n as H,f as z,g as _,a3 as n,Q as a,P as Z,j as s,T as c,U as p,y as r}from"./apexcharts-nIAyciCq.js";import"./TosDialog-BaExyJJf.js";import"./crypto-metamask-D6vz180a.js";import"./ansi-utils-ChIB8aIv.js";import"./socketio-BDGyx5_k.js";import"./uuid-B49X2dQj.js";import"./LoadingSpinner-BLJvP0iy.js";import"./element-plus-Cr1Qs4Q_.js";import"./lodash-C_Sw0jJq.js";import"./geolocation-BklMEt0S.js";import"./query-parser-C3-dT-Rr.js";import"./walletService-ARo4SzYC.js";import"./firebase-BnYKcu-W.js";import"./firebase-Cn841U3c.js";import"./PayPal-ugRCKXrL.js";import"./ExplorerService-oc3qiwdf.js";import"./DaemonService-D09C4O6H.js";import"./yaml-CtIyp6rB.js";import"./clipboard-DDQOmope.js";import"./enterpriseCrypto-BkXqwt7M.js";import"./crypto-walletconnect-Nsddz84n.js";import"./event-utils-DGlX1gEp.js";import"./lit-Ba94Z-Zv.js";import"./crypto-viem-CJP2v0S5.js";import"./date-utils-Cx_iWJ70.js";import"./crypto-ox-C1hHNqF1.js";import"./unjs-utils-GcjLqAqW.js";import"./ssp-logo-white-BYX0TNEU.js";import"./vueuse-Bid7ZbHY.js";import"./unhead-DEOrWl0D.js";import"./cookie-BfmCf_44.js";import"./casl-DNC8KRD8.js";import"./scrollbar-CXs_Utq1.js";import"./icons-mdi-_QP0sdRJ.js";import"./sanitizer-DAUAC_Zc.js";const K={key:0},W={class:"text-center py-8"},X={class:"d-flex justify-center mb-3"},ee={class:"text-h4 font-weight-bold mb-3"},oe={class:"text-body-1 text-medium-emphasis mb-8 px-4"},te={class:"d-flex justify-center mb-8"},se={style:{display:"inline-block"}},ne={class:"d-sm-flex"},ae={class:"mr-sm-8"},re={class:"d-flex align-center mb-2"},ie={class:"text-body-2 text-no-wrap"},le={class:"d-flex align-center mb-2"},ce={class:"text-body-2 text-no-wrap"},pe={class:"d-flex align-center mb-2"},de={class:"text-body-2 text-no-wrap"},me={class:"d-flex align-center"},ue={class:"text-body-2 text-no-wrap"},ge={class:"d-flex flex-column flex-sm-row justify-center gap-2"},fe={class:"text-caption text-medium-emphasis mt-6"},he={href:"https://docs.runonflux.io",target:"_blank",rel:"noopener noreferrer",class:"text-primary text-decoration-none"},ve={__name:"configure",setup(Se){T();const{t:i}=G(),{openLoginBottomSheet:C,closeLoginBottomSheet:N}=M(),f=B(),{privilege:I}=F(f),x=Q(()=>I.value!=="none"),y=S(!1),m=S({version:8,name:"",description:"",owner:"",contacts:[],instances:3,staticip:!1,enterprise:"",nodes:[],geolocation:[],expire:88e3,compose:[{name:"",description:"",repotag:"",ports:[],containerPorts:[],domains:[],environmentParameters:[],commands:[],containerData:"",cpu:.1,ram:128,hdd:1,repoauth:""}]}),d=S(null);L(m,e=>{if(console.log("[Spec Adapter] Input spec:",e),!e){console.log("[Spec Adapter] No spec available"),d.value=null;return}console.log("[Spec Adapter] Spec version:",e.version),console.log("[Spec Adapter] Has compose?",!!e.compose),console.log("[Spec Adapter] Root name:",e.name),console.log("[Spec Adapter] Root description:",e.description),console.log("[Spec Adapter] Root owner:",e.owner),e.version===3&&!e.compose?(console.log("[Spec Adapter] Converting V3 flat to compose format"),console.log("[Spec Adapter] Original V3 spec:",JSON.parse(JSON.stringify(e))),d.value={...JSON.parse(JSON.stringify(e)),compose:[{name:e.name,description:e.description,repotag:e.repotag,ports:e.ports?.map(o=>parseInt(o,10))||[],containerPorts:e.containerPorts?.map(o=>parseInt(o,10))||[],domains:e.domains||[],environmentParameters:e.enviromentParameters||[],commands:e.commands||[],containerData:e.containerData||"",cpu:e.cpu||.1,ram:e.ram||100,hdd:e.hdd||1,tiered:!1,repoauth:e.repoauth||""}],_isV3Original:!0},console.log("[Spec Adapter] Adapted spec - root name:",d.value.name),console.log("[Spec Adapter] Adapted spec - root description:",d.value.description),console.log("[Spec Adapter] Adapted spec - root owner:",d.value.owner),console.log("[Spec Adapter] Adapted spec - compose[0].name:",d.value.compose[0].name),console.log("[Spec Adapter] Adapted spec with compose:",JSON.parse(JSON.stringify(d.value)))):(console.log("[Spec Adapter] Returning deep copy of spec (not V3 or already has compose)"),d.value=JSON.parse(JSON.stringify(e)))},{immediate:!0,deep:!0});function V(e){console.log("[handleSpecConverted] Received converted spec:",e),console.log("[handleSpecConverted] Original version:",m.value?.version),console.log("[handleSpecConverted] New version:",e.version);const o=JSON.parse(JSON.stringify(e));delete o._isV3Original,console.log("[handleSpecConverted] Clean spec without flags:",o),m.value=o,console.log("[handleSpecConverted] App specification updated to V"+e.version),console.log("[handleSpecConverted] Fields should now be editable")}async function E(e,o=null,t=null,h=!1){try{const l=localStorage.getItem("zelidauth");if(!l)throw new Error("Authentication required. Please log in first.");const u={headers:{zelidauth:l,...h&&{"x-apicache-bypass":"true"},...t?.headers||{}}};if(t){const{headers:_e,timeout:xe,...D}=t;Object.assign(u,D)}const w=localStorage.getItem("backendURL")||A(),v=`${w}${e}`;console.log("Executing command:",e,"URL:",v),console.log("Backend URL:",w),console.log("From localStorage:",localStorage.getItem("backendURL")),console.log("Auto-detected:",A()),console.log("Using zelidauth:",l?"Present":"Missing");const b=o?await k.post(v,o,u):await k.get(v,u);return console.log("Command result:",b.data),b}catch(l){throw console.error("Command execution failed:",l,"Command:",e),console.error("Full error response:",l.response?.data),l}}return L(x,e=>{e&&N()}),$(async()=>{const e=localStorage.getItem("zelidauth");if(console.log("zelidauth from localStorage:",e?"Present":"Missing"),e)try{const t=new URLSearchParams(e),h=t.get("zelid"),l=t.get("privilege"),u=t.get("logintype");console.log("Parsed auth data:",{zelid:h?"Present":"Missing",privilege:l,loginType:u}),h&&(f.setZelid(h),l&&f.setPrivilege(l),u&&f.setLoginType(u))}catch(t){console.warn("Failed to restore authentication state:",t)}const o=sessionStorage.getItem("redeploySpecs");if(o)try{const t=JSON.parse(o);console.log("ðŸ”„ [REDEPLOY] Loading app spec from sessionStorage:",t),console.log("ðŸ”„ [REDEPLOY] Full appspecs object:",JSON.stringify(t.appspecs,null,2)),await H(),m.value=t.appspecs,t.isRedeploy&&(y.value=!0,console.log("ðŸ”„ [REDEPLOY] Redeploy mode enabled")),sessionStorage.removeItem("redeploySpecs"),console.log("ðŸ”„ [REDEPLOY] App spec loaded and sessionStorage cleared"),console.log("ðŸ”„ [REDEPLOY] newAppSpec after assignment:",JSON.stringify(m.value,null,2))}catch(t){console.error("âŒ [REDEPLOY] Failed to load app spec:",t),sessionStorage.removeItem("redeploySpecs")}else{const t=f.zelid||new URLSearchParams(e)?.get("zelid");t&&(m.value.owner=t,console.log("Set newAppSpec.owner to:",t))}console.log("Final newAppSpec.owner:",m.value.owner)}),(e,o)=>{const t=J;return _(),z("div",null,[n(R,null,{default:a(()=>[n(O,{cols:"12"},{default:a(()=>[n(Y,null,{default:a(()=>[n(j,null,{default:a(()=>[x.value?(_(),Z(t,{key:1,"app-spec":d.value,"new-app":"","is-redeploy":y.value,"execute-local-command":E,onSpecConverted:V},null,8,["app-spec","is-redeploy"])):(_(),z("div",K,[n(R,null,{default:a(()=>[n(O,{cols:"12",md:"8",lg:"6",class:"mx-auto"},{default:a(()=>[s("div",W,[s("div",X,[n(q,{size:"120",color:"primary",variant:"tonal",class:"elevation-3 auth-icon-container"},{default:a(()=>[n(g,{size:"60",color:"primary",class:"auth-icon"},{default:a(()=>[...o[0]||(o[0]=[c(" mdi-shield-lock-outline ",-1)])]),_:1})]),_:1})]),s("h1",ee,p(r(i)("menu.application.signInRequired")),1),s("p",oe,p(r(i)("menu.application.signInDescription")),1),s("div",te,[s("div",se,[s("div",ne,[s("div",ae,[s("div",re,[n(g,{color:"success",size:"20",class:"mr-2 flex-shrink-0"},{default:a(()=>[...o[1]||(o[1]=[c("mdi-check-circle",-1)])]),_:1}),s("span",ie,p(r(i)("menu.application.deployDistributedApps")),1)]),s("div",le,[n(g,{color:"success",size:"20",class:"mr-2 flex-shrink-0"},{default:a(()=>[...o[2]||(o[2]=[c("mdi-check-circle",-1)])]),_:1}),s("span",ce,p(r(i)("menu.application.manageResources")),1)])]),s("div",null,[s("div",pe,[n(g,{color:"success",size:"20",class:"mr-2 flex-shrink-0"},{default:a(()=>[...o[3]||(o[3]=[c("mdi-check-circle",-1)])]),_:1}),s("span",de,p(r(i)("menu.application.monitorPerformance")),1)]),s("div",me,[n(g,{color:"success",size:"20",class:"mr-2 flex-shrink-0"},{default:a(()=>[...o[4]||(o[4]=[c("mdi-check-circle",-1)])]),_:1}),s("span",ue,p(r(i)("menu.application.scaleGlobally")),1)])])])])]),s("div",ge,[n(P,{color:"primary",variant:"flat",onClick:r(C)},{default:a(()=>[n(g,{size:"22",class:"mr-2"},{default:a(()=>[...o[5]||(o[5]=[c("mdi-login-variant",-1)])]),_:1}),c(" "+p(r(i)("menu.application.signIn")),1)]),_:1},8,["onClick"]),n(P,{variant:"flat",href:"https://runonflux.io",target:"_blank",rel:"noopener noreferrer"},{default:a(()=>[n(g,{size:"22",class:"mr-2"},{default:a(()=>[...o[6]||(o[6]=[c("mdi-information-outline",-1)])]),_:1}),c(" "+p(r(i)("menu.application.learnMore")),1)]),_:1})]),s("p",fe,[c(p(r(i)("menu.application.newToFlux"))+" ",1),s("a",he,p(r(i)("menu.application.checkDocumentation")),1),c(" "+p(r(i)("menu.application.toGetStarted")),1)])])]),_:1})]),_:1})]))]),_:1})]),_:1})]),_:1})]),_:1})])}}},po=U(ve,[["__scopeId","data-v-a1903d75"]]);export{po as default};
