const N=/"(?:_|\\u0{2}5[Ff]){2}(?:p|\\u0{2}70)(?:r|\\u0{2}72)(?:o|\\u0{2}6[Ff])(?:t|\\u0{2}74)(?:o|\\u0{2}6[Ff])(?:_|\\u0{2}5[Ff]){2}"\s*:/,m=/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/,I=/^\s*["[{]|^\s*-?\d{1,16}(\.\d{1,17})?([Ee][+-]?\d+)?\s*$/;function w(t,r){if(t==="__proto__"||t==="constructor"&&r&&typeof r=="object"&&"prototype"in r){g(t);return}return r}function g(t){console.warn(`[destr] Dropping "${t}" key to prevent prototype pollution.`)}function z(t,r={}){if(typeof t!="string")return t;const o=t.trim();if(t[0]==='"'&&t.endsWith('"')&&!t.includes("\\"))return o.slice(1,-1);if(o.length<=9){const e=o.toLowerCase();if(e==="true")return!0;if(e==="false")return!1;if(e==="undefined")return;if(e==="null")return null;if(e==="nan")return Number.NaN;if(e==="infinity")return Number.POSITIVE_INFINITY;if(e==="-infinity")return Number.NEGATIVE_INFINITY}if(!I.test(t)){if(r.strict)throw new SyntaxError("[destr] Invalid JSON");return t}try{if(N.test(t)||m.test(t)){if(r.strict)throw new Error("[destr] Possible prototype pollution");return JSON.parse(t,w)}return JSON.parse(t)}catch(e){if(r.strict)throw e;return t}}const P=/#/g,O=/&/g,b=/\//g,C=/=/g,f=/\+/g,T=/%5e/gi,A=/%60/gi,F=/%7c/gi,S=/%20/gi;function $(t){return encodeURI(""+t).replace(F,"|")}function u(t){return $(typeof t=="string"?t:JSON.stringify(t)).replace(f,"%2B").replace(S,"+").replace(P,"%23").replace(O,"%26").replace(A,"`").replace(T,"^").replace(b,"%2F")}function i(t){return u(t).replace(C,"%3D")}function _(t=""){try{return decodeURIComponent(""+t)}catch{return""+t}}function L(t){return _(t.replace(f," "))}function x(t){return _(t.replace(f," "))}function Q(t=""){const r={};t[0]==="?"&&(t=t.slice(1));for(const o of t.split("&")){const e=o.match(/([^=]+)=?(.*)/)||[];if(e.length<2)continue;const n=L(e[1]);if(n==="__proto__"||n==="constructor")continue;const c=x(e[2]||"");r[n]===void 0?r[n]=c:Array.isArray(r[n])?r[n].push(c):r[n]=[r[n],c]}return r}function j(t,r){return(typeof r=="number"||typeof r=="boolean")&&(r=String(r)),r?Array.isArray(r)?r.map(o=>`${i(t)}=${u(o)}`).join("&"):`${i(t)}=${u(r)}`:i(t)}function J(t){return Object.keys(t).filter(r=>t[r]!==void 0).map(r=>j(r,t[r])).filter(Boolean).join("&")}const V=/^[\s\w\0+.-]{2,}:([/\\]{1,2})/,D=/^[\s\w\0+.-]{2,}:([/\\]{2})?/,K=/^([/\\]\s*){2,}[^/\\]/;function U(t,r={}){return typeof r=="boolean"&&(r={acceptRelative:r}),r.strict?V.test(t):D.test(t)||(r.acceptRelative?K.test(t):!1)}function Z(t,r){const o=G(t),e={...Q(o.search),...r};return o.search=J(e),Y(o)}const y=Symbol.for("ufo:protocolRelative");function G(t="",r){const o=t.match(/^[\s\0]*(blob:|data:|javascript:|vbscript:)(.*)/i);if(o){const[,h,p=""]=o;return{protocol:h.toLowerCase(),pathname:p,href:h+p,auth:"",host:"",search:"",hash:""}}if(!U(t,{acceptRelative:!0}))return l(t);const[,e="",n,c=""]=t.replace(/\\/g,"/").match(/^[\s\0]*([\w+.-]{2,}:)?\/\/([^/@]+@)?(.*)/)||[];let[,a="",s=""]=c.match(/([^#/?]*)(.*)?/)||[];e==="file:"&&(s=s.replace(/\/(?=[A-Za-z]:)/,""));const{pathname:E,search:d,hash:R}=l(s);return{protocol:e.toLowerCase(),auth:n?n.slice(0,Math.max(0,n.length-1)):"",host:a,pathname:E,search:d,hash:R,[y]:!e}}function l(t=""){const[r="",o="",e=""]=(t.match(/([^#?]*)(\?[^#]*)?(#.*)?/)||[]).splice(1);return{pathname:r,search:o,hash:e}}function Y(t){const r=t.pathname||"",o=t.search?(t.search.startsWith("?")?"":"?")+t.search:"",e=t.hash||"",n=t.auth?t.auth+"@":"",c=t.host||"";return(t.protocol||t[y]?(t.protocol||"")+"//":"")+n+c+r+o+e}const B=/"(?:_|\\u0{2}5[Ff]){2}(?:p|\\u0{2}70)(?:r|\\u0{2}72)(?:o|\\u0{2}6[Ff])(?:t|\\u0{2}74)(?:o|\\u0{2}6[Ff])(?:_|\\u0{2}5[Ff]){2}"\s*:/,H=/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/,M=/^\s*["[{]|^\s*-?\d{1,16}(\.\d{1,17})?([Ee][+-]?\d+)?\s*$/;function X(t,r){if(t==="__proto__"||t==="constructor"&&r&&typeof r=="object"&&"prototype"in r){W(t);return}return r}function W(t){console.warn(`[destr] Dropping "${t}" key to prevent prototype pollution.`)}function q(t,r={}){if(typeof t!="string")return t;if(t[0]==='"'&&t[t.length-1]==='"'&&t.indexOf("\\")===-1)return t.slice(1,-1);const o=t.trim();if(o.length<=9)switch(o.toLowerCase()){case"true":return!0;case"false":return!1;case"undefined":return;case"null":return null;case"nan":return Number.NaN;case"infinity":return Number.POSITIVE_INFINITY;case"-infinity":return Number.NEGATIVE_INFINITY}if(!M.test(t)){if(r.strict)throw new SyntaxError("[destr] Invalid JSON");return t}try{if(B.test(t)||H.test(t)){if(r.strict)throw new Error("[destr] Possible prototype pollution");return JSON.parse(t,X)}return JSON.parse(t)}catch(e){if(r.strict)throw e;return t}}export{z as a,q as d,Z as w};
