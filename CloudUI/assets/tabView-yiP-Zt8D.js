import{a as Ie,b as Be,c as Fe,_ as Re}from"./ConfirmCustomDialog-D5jNuL5-.js";import{_ as ze,r as de}from"./index-QPPWK7xw.js";import{b as v,s as X,c as q,F as te,n as Ue,V as Le,a as Ne,d as je,K as Se,a9 as He,f as qe,h as Je,o as xe,p as ke,a0 as _e,I as ae,y as Ye,z as Ge,A as Q,a6 as Ke,a3 as We,a1 as Qe,Y as Xe,Z as Ze,X as ea,_ as aa,a7 as ta,G as sa,Q as la,ac as oa}from"./vuetify-_4u1He_j.js";import{c as N,f as z,g,a3 as a,j as u,Q as t,T as p,U as y,q as na,F as se,l as pe,r as B,w as Ve,n as Ee,az as ia,P as j,x as H,L as le,y as c,R as Ae,a2 as Pe,o as ra,a as ua,aw as Te,m as Ce}from"./apexcharts-nIAyciCq.js";import{u as ca}from"./useLoginSheet-e2RZXtPE.js";import{e as Me}from"./eventBus-BZyChua5.js";import{e as De}from"./vue-core-CU9AIURn.js";import{u as $e}from"./i18n-Bm8bpAAW.js";import{q as pa}from"./query-parser-C3-dT-Rr.js";const da={class:"status-text"},ma={__name:"ExpiryLabel",props:{expireTime:{type:String,required:!0}},setup(f){const C=f;function P(o){if(!o)return!0;const V=o.split(",").map(D=>D.trim());let k=0,I=0,s=0;return V.forEach(D=>{D.includes("days")?k=parseInt(D,10):D.includes("hours")?I=parseInt(D,10):D.includes("minutes")&&(s=parseInt(D,10))}),k*24*60+I*60+s<2880}const M=N(()=>({"red-text":P(C.expireTime),"no-wrap":!0}));return(o,V)=>(g(),z("span",{class:na(["status-badge",M.value])},[a(v,{size:"15",class:"status-icon"},{default:t(()=>[...V[0]||(V[0]=[p("mdi-timer-sand",-1)])]),_:1}),u("span",da,y(f.expireTime),1)],2))}},ga=ze(ma,[["__scopeId","data-v-0a5328cf"]]),fa={class:"d-flex align-items-center usage-row"},va={__name:"UsageChips",props:{items:{type:Array,required:!0,default:()=>[]}},setup(f){return(C,P)=>(g(),z("div",fa,[(g(!0),z(se,null,pe(f.items,(M,o)=>(g(),z(se,{key:o},[a(v,{icon:M.icon,class:"usage-icon mr-1"},null,8,["icon"]),a(X,{color:M.color||"default",class:"custom-usage-chip mr-2",density:"comfortable",size:"small",rounded:"pill"},{default:t(()=>[p(y(M.value),1)]),_:2},1032,["color"])],64))),128))]))}},ba=ze(va,[["__scopeId","data-v-4302e680"]]),ha={class:"d-flex flex-nowrap align-end justify-end"},ya={class:"action-center"},wa={key:0},xa={class:"mb-2 d-flex align-center"},ka={key:1},_a={key:2,class:"mt-4"},Aa={class:"mb-2 d-flex align-center"},Ca={class:"mt-4"},Va={class:"mb-2 d-flex align-center"},za={class:"mt-2"},$a={__name:"manage",props:{row:{type:Object,required:!0},showManage:{type:Boolean,default:!1},showInstall:{type:[Boolean,Function],default:!1},showControl:{type:[Boolean,Function],default:!1}},setup(f){const{t:C}=$e(),P=De(),M=B({show:!1,message:"",color:"error"}),o=B({show:!1,title:C("pages.apps.manage.dialog.installingTitle")}),V=B([]),k=B({}),I=B(null),s=B(""),E=B(!1),D=B(""),oe=N(()=>{const d=Object.values(k.value).filter(A=>A.detail.total>0||A.detail.current>0);if(!d.length)return{current:0,total:0};const i=d.reduce((A,b)=>A+b.detail.total,0);return{current:d.reduce((A,b)=>A+b.detail.current,0),total:i}});function K(d,i="error"){M.value.message=d,M.value.color=i,M.value.show=!0}function Z(d){P.push(`/apps/manage/${encodeURIComponent(d)}`)}async function W(d){try{const i=await de.getAppLocation(d);if(i.data.status==="success"){if(!i.data.data[0]){K(C("pages.apps.manage.messages.awaitingLaunch"),"error");return}const A=`https://${d}.app.runonflux.io`;window.open(A,"_blank")?.focus()}else K(i.data.data.message||i.data.data,"error")}catch(i){K(i.message||i,"error")}}async function J(d){V.value=[],k.value={},s.value="",o.value.title=C("pages.apps.manage.dialog.installingAppName",{appName:d}),o.value.show=!0,E.value=!1;const i=localStorage.getItem("zelidauth");try{const _={headers:{zelidauth:i},onDownloadProgress(x){try{const S=x.event?.target?.response,w=JSON.parse(`[${S.replace(/\}\{/g,"},{")}]`);V.value=w;const $=w.at(-1);s.value=$?.data?.message||$?.data||$?.status}catch{}}};await me(2e3);const A=await de.justAPI().get(`/apps/installapplocally/${d}`,_),b=typeof A.data=="string"?A.data:JSON.stringify(A.data),F=JSON.parse(`[${b.replace(/\}\{/g,"},{")}]`);V.value=F;const T=F.at(-1);s.value=T?.data?.message||T?.data||T?.status,D.value=T?.status,Me.emit("updateInstalledApp")}catch(_){K(_.message||_,"error")}}async function ne(d){V.value=[],k.value={},s.value="",o.value.title=C("pages.apps.manage.dialog.removingAppName",{appName:d}),o.value.show=!0,E.value=!1;const i=localStorage.getItem("zelidauth");try{const _={headers:{zelidauth:i},onDownloadProgress(x){const S=x.event?.target?.response,w=JSON.parse(`[${S.replace(/\}\{/g,"},{")}]`);V.value=w;const $=w.at(-1);s.value=$?.data?.message||$?.data||$?.status}},A=await de.justAPI().get(`/apps/appremove/${d}`,_),b=typeof A.data=="string"?A.data:JSON.stringify(A.data),F=JSON.parse(`[${b.replace(/\}\{/g,"},{")}]`);V.value=F;const T=F.at(-1);s.value=T?.data?.message||T?.data||T?.status,D.value=T?.status}catch(_){K(_.message||_,"error")}}Ve(V,()=>{Ee(()=>{I.value&&(I.value.scrollTop=I.value.scrollHeight)}),V.value.forEach(d=>{if(!d?.id&&!d?.status)return;const i=d.id||d.status+Math.random().toString(36).substring(2,8),_=d.progressDetail;(d.status==="Downloading"||d.status==="Extracting")&&(k.value[i]||(k.value[i]={id:i,detail:{current:0,total:1},variant:d.status==="Downloading"?"error":"primary"}),_&&_.total>0&&(k.value[i].detail={current:_.current,total:_.total})),(d.status==="Download complete"||d.status==="Pull complete")&&k.value[i]&&(k.value[i].detail={current:1,total:1},k.value[i].variant="success"),!k.value[i]&&d.progressDetail&&(k.value[i]={id:i,detail:{current:1,total:1},variant:"primary"})})});function ie(){const d={},i=x=>{let S=0;for(let $=0;$<x.length;$++)S=x.charCodeAt($)+((S<<5)-S);return`hsl(${Math.abs(S)%360}, 60%, 40%)`},_=[];let A=[],b=C("components.checkoutContent.general"),F=null;const T=x=>{x||(x=F||C("components.checkoutContent.general")),A.forEach(({text:S,phase:w})=>{_.push({component:x,phase:w,text:S})}),A=[]};return V.value.forEach(x=>{const S=x?.data?.message||x?.data||x?.status,w=typeof S=="string"?S:JSON.stringify(S),$=w.toLowerCase(),G=/Flux App (\w[\w-]*)/.exec(w);G&&!w.includes("component")&&(F=G[1]);const ge=/^Pulling from /i.test(w),re=/Pulling component (\w[\w-]*) of Flux App/.exec(w),ue=/Pulling global Flux App (\w[\w-]*) was successful/i.exec(w),fe=/Creating component (\w[\w-]*) of Flux App/.exec(w),ve=/Starting component (\w[\w-]*) of Flux App/.exec(w),be=/Creating Flux App (\w[\w-]*)/.exec(w),ee=/Starting Flux App (\w[\w-]*)/.exec(w),n=/Stopping Flux App (\w[\w-]*)/.exec(w),e=/(?:Stopping|Removing|Cleaning|Flux App component)\s+(?:Flux App\s+)?component\s+(\w[\w-]*)/i.exec(w);if(e){T(e[1]),b=e[1];return}let m="Finalizing";if(/error|fail|aborting/.test($)?m="Error":/warning/.test($)?m="Warning":/initial|connecting|checking|allocating|creating|adjusting|searching|mounting|making|ports...|removing|stopping|starting|initiating|denying|unmounting|clearing|cleaning/.test($)?m="Setup":/pull|download|digest|waiting|extract|verify|already exists/.test($)?m="Pulling":m="Finalizing",ge){T(b),A.push({text:w,phase:m});return}if(re){T(re[1]),b=re[1];return}if(ue){T(ue[1]),b=ue[1];return}if(fe||ve){const r=(fe||ve)[1];T(r),b=r;return}if(be||ee||n){const r=(be||ee||n)[1];F=r,b=r}A.length>0?A.push({text:w,phase:m}):_.push({component:b,phase:m,text:w})}),T(b),_.map(({component:x,phase:S,text:w})=>{d[x]||(d[x]=i(x));const $=`<span class="tag tag-component" style="background-color:${d[x]};color:#fff;">${x}</span>`,G=`<span class="tag tag-${S.toLowerCase()}">${S}</span>`;return`${$}${G}&nbsp;${w}`}).join("<br>")}const he=N(()=>V.value.some(i=>{const _=i?.data?.message||i?.data||i?.status||"";return/error/i.test(_)})||/error|aborting/i.test(s.value)||/error/i.test(D.value)?"error":/success/i.test(D.value)?"success":/warning/i.test(D.value)?"warning":"primary");function me(d){return new Promise(i=>setTimeout(i,d))}return(d,i)=>{const _=Ie,A=ia("sanitize-html");return g(),z("div",ha,[f.showManage?(g(),j(te,{key:0,text:c(C)("pages.apps.manage.tooltips.manage")},{activator:t(({props:b})=>[a(q,le(b,{id:`manage-installed-app-${f.row.item.name}`,size:"small",icon:"",variant:"tonal",color:"default",rounded:"true",class:"mr-2"}),{default:t(()=>[a(v,{size:"24"},{default:t(()=>[...i[8]||(i[8]=[p(" mdi-cog-outline ",-1)])]),_:1})]),_:1},16,["id"])]),_:1},8,["text"])):H("",!0),f.showInstall?(g(),j(te,{key:1,text:c(C)("pages.apps.manage.tooltips.install")},{activator:t(({props:b})=>[a(q,le(b,{size:"small",variant:"tonal",color:"success",rounded:"true",class:"mr-2",icon:"",onClick:i[0]||(i[0]=F=>J(f.row.item.name))}),{default:t(()=>[a(v,{size:"24"},{default:t(()=>[...i[9]||(i[9]=[p(" mdi-progress-download ",-1)])]),_:1})]),_:1},16)]),_:1},8,["text"])):H("",!0),f.showControl?(g(),j(te,{key:2,text:c(C)("pages.apps.manage.tooltips.remove")},{activator:t(({props:b})=>[a(q,le(b,{icon:"mdi-delete",size:"small",variant:"tonal",color:"error",rounded:"true",class:"mr-2",onClick:i[1]||(i[1]=F=>ne(f.row.item.name))}),null,16)]),_:1},8,["text"])):H("",!0),a(te,{text:c(C)("pages.apps.manage.tooltips.visit")},{activator:t(({props:b})=>[a(q,le(b,{icon:"mdi-open-in-new",size:"small",variant:"tonal",color:"default",rounded:"true",onClick:i[2]||(i[2]=F=>W(f.row.item.name))}),null,16)]),_:1},8,["text"]),a(_,{target:`manage-installed-app-${f.row.item.name}`,"confirm-button":c(C)("pages.apps.manage.confirmButton"),onConfirm:i[3]||(i[3]=b=>Z(f.row.item.name))},null,8,["target","confirm-button"]),a(Ue,{modelValue:M.value.show,"onUpdate:modelValue":i[4]||(i[4]=b=>M.value.show=b),color:M.value.color,timeout:"4000"},{default:t(()=>[p(y(M.value.message),1)]),_:1},8,["modelValue","color"]),a(Je,{modelValue:o.value.show,"onUpdate:modelValue":i[7]||(i[7]=b=>o.value.show=b),"max-width":"900",persistent:""},{default:t(()=>[a(Le,null,{default:t(()=>[a(Ne,{class:"dialog-title d-flex justify-space-between align-center"},{default:t(()=>[p(y(o.value.title),1)]),_:1}),a(je,null,{default:t(()=>[u("div",ya,[s.value?(g(),z("div",wa,[u("h3",xa,[a(v,{icon:"mdi-progress-tag",class:"mr-1"}),p(" "+y(c(C)("pages.apps.manage.dialog.currentTask")),1)]),a(X,{class:"current-task-chip",color:he.value,variant:"tonal",rounded:"pill"},{prepend:t(()=>[a(v,{size:"24",class:"mr-1"},{default:t(()=>[...i[10]||(i[10]=[p(" mdi-progress-wrench ",-1)])]),_:1})]),default:t(()=>[p(" "+y(s.value),1)]),_:1},8,["color"])])):(g(),z("div",ka,[a(Se,{indeterminate:"",color:"primary"})])),oe.value.total>0?(g(),z("div",_a,[u("h3",Aa,[a(v,{icon:"mdi-progress-download",class:"mr-1"}),p(" "+y(c(C)("pages.apps.manage.dialog.overallProgress")),1)]),a(Se,{"model-value":oe.value.current/oe.value.total*100,height:"16",color:"success",rounded:""},null,8,["model-value"])])):H("",!0),Ae(u("div",Ca,[u("h3",Va,[a(v,{icon:"mdi-text-box-outline",class:"mr-1"}),p(" "+y(c(C)("pages.apps.manage.dialog.fullLogs")),1)]),a(q,{size:"small",variant:"text",color:"primary",onClick:i[5]||(i[5]=b=>E.value=!E.value)},{default:t(()=>[a(v,{icon:E.value?"mdi-eye-off":"mdi-eye",start:"",class:"mr-1"},null,8,["icon"]),p(" "+y(E.value?c(C)("pages.apps.manage.dialog.hideLogs"):c(C)("pages.apps.manage.dialog.showLogs")),1)]),_:1}),a(He,null,{default:t(()=>[Ae(u("div",za,[u("div",{ref_key:"logContainer",ref:I,class:"log-output log-html"},[Ae(u("div",null,null,512),[[A,ie()]])],512)],512),[[Pe,E.value]])]),_:1})],512),[[Pe,V.value.length>1]])])]),_:1}),s.value?(g(),j(qe,{key:0,class:"justify-end px-7"},{default:t(()=>[a(q,{color:"error",size:"small",variant:"flat",onClick:i[6]||(i[6]=()=>{o.value.show=!1,c(Me).emit("updateInstalledApp")})},{default:t(()=>[p(y(c(C)("pages.apps.manage.dialog.close")),1)]),_:1})]),_:1})):H("",!0)]),_:1})]),_:1},8,["modelValue"])])}}},Sa={class:"d-flex flex-nowrap align-end justify-end"},Pa={__name:"redeploy",props:{row:{type:Object,required:!0}},setup(f){const{t:C}=$e(),P=De();function M(o,V=!1){console.log("ðŸš€ [REDEPLOY] Starting redeploy with appSpecs:",o),console.log("ðŸš€ [REDEPLOY] Full structure:",JSON.stringify(o,null,2));const k={...o},I=k.name;k.name=`${I}${Date.now().toString().slice(-5)}`,console.log("ðŸš€ [REDEPLOY] Generated new name:",k.name,"from original:",I);const s=localStorage.getItem("zelidauth"),E=pa.parse(s);E?k.owner=E.zelid:V&&(k.owner=""),console.log("ðŸš€ [REDEPLOY] Processed specs to store:",JSON.stringify(k,null,2)),sessionStorage.setItem("redeploySpecs",JSON.stringify({appspecs:k,isRedeploy:!0})),console.log("ðŸš€ [REDEPLOY] Stored in sessionStorage, navigating to apps-register-configure"),P.push({name:"apps-register-configure"})}return(o,V)=>{const k=Ie;return g(),z("div",Sa,[a(te,{text:c(C)("pages.apps.redeploy.tooltip")},{activator:t(({props:I})=>[a(q,le(I,{id:`redeploy-installed-app-${f.row.item.name}`,size:"small",variant:"tonal",rounded:"true",color:"default",icon:""}),{default:t(()=>[a(v,{size:"22"},{default:t(()=>[...V[1]||(V[1]=[p(" mdi-cloud-refresh-variant ",-1)])]),_:1})]),_:1},16,["id"])]),_:1},8,["text"]),a(k,{target:`redeploy-installed-app-${f.row.item.name}`,"confirm-button":c(C)("pages.apps.redeploy.confirmButton"),onConfirm:V[0]||(V[0]=()=>M(f.row.item))},null,8,["target","confirm-button"])])}}},Ta={class:"myapps-table-wrapper"},Ma={key:0,class:"small-checkbox"},Ia={class:"chip-group mt-1"},La={class:"text-center py-10 fade-in"},Ea={key:0,class:"d-flex align-center justify-center"},Da={key:1,class:"d-flex flex-column align-center justify-center"},Oa={class:"text-center"},Ba={class:"d-flex justify-center mb-4"},Fa={class:"text-h4 font-weight-bold mb-3"},Ra={class:"text-body-1 text-medium-emphasis mb-8 px-4"},Ua={class:"d-flex justify-center mb-8"},Na={style:{display:"inline-block"}},ja={class:"d-sm-flex gap-8"},Ha={class:"d-flex align-center mb-2"},qa={class:"text-body-2 text-no-wrap"},Ja={class:"d-flex align-center mb-2"},Ya={class:"text-body-2 text-no-wrap"},Ga={class:"d-flex align-center mb-2"},Ka={class:"text-body-2 text-no-wrap"},Wa={class:"d-flex align-center"},Qa={class:"text-body-2 text-no-wrap"},Xa={class:"d-flex flex-column flex-sm-row justify-center gap-2"},Za={key:2,class:"d-flex align-center justify-center"},et={key:3,class:"d-flex align-center justify-center"},at={class:"text-error"},tt={key:4},st={class:"col-name text-left"},lt={style:{"font-size":"12px"}},ot={key:1,class:"mb-1"},nt={class:"col-description text-secondary"},it=["data-name"],rt=["colspan"],ut={class:"pa-0 expanded-content-wrapper"},ct={key:0},pt={class:"d-flex align-center justify-start mb-3 mt-3"},dt={class:"ml-1"},mt={class:"locations-wrapper"},gt={key:0,class:"d-flex align-center justify-start mb-4 mt-4"},ft={class:"ml-2"},vt={key:0},bt={__name:"tabView",props:{apps:Array,loading:Boolean,loggedIn:Boolean,currentBlockHeight:Number,activeAppsTab:Boolean,isMarketplace:{type:Boolean,default:!1},manage:{type:Boolean,default:!1},apiError:Boolean,showStatus:{type:Boolean,default:!1},showInstall:{type:[Boolean,Function],default:!1},showControl:{type:[Boolean,Function],default:!1},privilege:{type:String,default:""}},emits:["openAppManagement"],setup(f,{emit:C}){const P=f,M=C,{t:o}=$e(),{openLoginBottomSheet:V,closeLoginBottomSheet:k}=ca(),I=B(0),s=B({perPage:10,pageOptions:[5,10,25,50,100],currentPage:1,sortBy:[],sortDesc:!1,filter:"",repotags:[],matchAllRepotags:!1,version:"all"}),E=B(""),D=N(()=>[{text:o("pages.apps.table.modeOptions.all"),value:"all",icon:"mdi-apps-box"},{text:o("pages.apps.table.modeOptions.marketplace"),value:"marketplace",icon:"mdi-basket"},{text:o("pages.apps.table.modeOptions.marketplaceExcluded"),value:"marketplaceExcluded",icon:"mdi-basket-off"}]),oe=N(()=>[{text:o("pages.apps.table.versionOptions.all"),value:"all",icon:"mdi-tag-multiple"},{text:o("pages.apps.table.versionOptions.v3"),value:3,icon:"mdi-numeric-3-circle"},{text:o("pages.apps.table.versionOptions.v4"),value:4,icon:"mdi-numeric-4-circle"},{text:o("pages.apps.table.versionOptions.v5"),value:5,icon:"mdi-numeric-5-circle"},{text:o("pages.apps.table.versionOptions.v6"),value:6,icon:"mdi-numeric-6-circle"},{text:o("pages.apps.table.versionOptions.v7"),value:7,icon:"mdi-numeric-7-circle"},{text:o("pages.apps.table.versionOptions.v8"),value:8,icon:"mdi-numeric-8-circle"}]);function K(n){if(n.length>=14){const e=n.substring(n.length-13),m=Number(e);return!isNaN(m)}return!1}N(()=>({...activatorPropsMenu,...tooltipActivatorProps}));const Z=B("all"),W=B([]),J=B({}),ne=N(()=>Array.isArray(P.apps)?P.apps:[]),ie=N(()=>{let n=ne.value;Z.value==="marketplace"?n=n.filter(r=>K(r.name)):Z.value==="marketplaceExcluded"&&(n=n.filter(r=>!K(r.name))),s.value.version&&s.value.version!=="all"&&(n=n.filter(r=>r.version===s.value.version));const e=s.value.filter?.toLowerCase();e&&(n=n.filter(r=>r.name?.toLowerCase().includes(e)||r.description?.toLowerCase().includes(e)));const m=(s.value.repotags||[]).map(r=>r.toLowerCase().trim());return m.length>0&&(n=n.filter(r=>{const R=[...r.repotag||[],...Array.isArray(r.compose)?r.compose.flatMap(O=>O.repotag||[]):[]].map(O=>O.toLowerCase());return s.value.matchAllRepotags?m.every(O=>R.some(l=>l.includes(O))):m.some(O=>R.some(l=>l.includes(O)))})),s.value.minHdd>0&&(n=n.filter(r=>(Array.isArray(r.compose)?x(2,r.name,r):+r.hdd)>=s.value.minHdd)),s.value.minRam>0&&(n=n.filter(r=>(Array.isArray(r.compose)?x(0,r.name,r):+r.ram)>=s.value.minRam)),s.value.minCpu>0&&(n=n.filter(r=>(Array.isArray(r.compose)?+x(1,r.name,r):+r.cpu)>=s.value.minCpu)),s.value.minInstances>0&&(n=n.filter(r=>(typeof r.instances=="number"?r.instances:3)>=s.value.minInstances)),n}),he=N(()=>Math.ceil(ie.value.length/s.value.perPage)),me=B(!1),d=N(()=>[{key:"data-table-expand",title:"",sortable:!1,class:"col-expand"},{key:"name",title:o("pages.apps.table.headers.name"),sortable:!0,class:"col-name"},...P.showStatus?[{key:"status",title:o("pages.apps.table.headers.status"),sortable:!1,class:"col-status"}]:[],{key:"description",title:o("pages.apps.table.headers.description"),sortable:!1,class:"col-description"},{key:"actions",title:"",sortable:!1,align:"end",class:"col-actions"}]),i=N(()=>[{key:"data-table-expand",title:"",sortable:!1,class:"col-expand"},{key:"name",title:o("pages.apps.table.headers.name"),sortable:!0,class:"col-name-mobile"},{key:"actions",title:"",sortable:!1,align:"end",class:"col-actions"}]),_=N(()=>me.value?i.value:d.value);function A(n){M("openAppManagement",n)}async function b(n){const e=n.raw?.name;e&&(W.value.includes(e)?W.value=[]:(W.value=[e],Ee(()=>F(e)),await T(e)))}function F(n){setTimeout(()=>{const e=Array.from(document.querySelectorAll("tr.v-data-table__tr")).find(m=>m.textContent.includes(n));e&&e.scrollIntoView({behavior:"auto",block:"center"})},100)}async function T(n){if(!J.value[n])try{J.value[n]=[];const e=await de.getAppLocation(n);e.data.status==="success"&&(J.value[n]=e.data.data)}catch(e){console.error(`Error loading locations for ${n}:`,e.message)}}function x(n,e,m){return Array.isArray(m.compose)?S(e,m.compose)[n]:[+m.ram,+m.cpu.toFixed(1),+m.hdd][n]}function S(n,e){let m=0,r=0,L=0;return e.forEach(R=>{m+=R.ram,r+=R.cpu,L+=R.hdd}),[m,r.toFixed(1),L]}function w(n,e){if(!e)return o("pages.apps.table.applicationExpired");if(P.currentBlockHeight===-1)return o("pages.apps.table.cannotCalculateExpiration");const m=202e4,r=e>=m?88e3:22e3,L=n||r,R=e<m?2:.5,O=L*R;let l=0;if(e<m)if(P.currentBlockHeight<=m)l=(P.currentBlockHeight-e)*2;else{const we=m-e,Oe=P.currentBlockHeight-m;l=we*2+Oe*.5}else l=(P.currentBlockHeight-e)*.5;const h=O-l;if(h<=0)return o("pages.apps.table.applicationExpired");const U=Math.floor(h/1440),Y=Math.floor(h%1440/60),ye=Math.floor(h%60),ce=[];return U>0&&ce.push(`${U} day${U!==1?"s":""}`),Y>0&&ce.push(`${Y} hour${Y!==1?"s":""}`),(ye>0||ce.length===0)&&ce.push(`${ye} minute${ye!==1?"s":""}`),ce.slice(0,3).join(", ")}function $(n){return n?n.version>=4?n.compose:[{...n,repoauth:!1}]:[]}const G=B(new Map);async function ge(n=0){setTimeout(async()=>{try{const m=(await de.listRunningApps()).data.data||[],r=new Map;for(const L of ne.value)L?.name&&r.set(L.name,"exited");for(const L of m){const R=L.Names?.[0]||"",O=R.startsWith("/flux")?R.slice(5):R.slice(4),l=O.includes("_")?O.split("_")[1]:O;!O.includes("watchtower")&&l&&r.set(l,L.State)}G.value=r}catch(e){console.error("Failed to load running apps:",e),G.value=new Map}},n)}function re(n){switch(G.value.get(n)){case"running":return"success";case"restarting":return"warning";case"created":case"paused":return"blue-darken-4";case"exited":return"error";case"removing":case"dead":default:return"grey-darken-4"}}Ve(()=>P.apps,()=>{P.showStatus&&ge()}),Ve(()=>P.loggedIn,n=>{n&&k()});function ue(){const n=E.value.trim();if(!n)return;s.value.repotags.some(m=>m.toLowerCase()===n.toLowerCase())||s.value.repotags.push(n),E.value=""}function fe(n){s.value.repotags.splice(n,1)}function ve(){s.value.filter="",s.value.version="all",s.value.minHdd=null,s.value.minRam=null,s.value.minCpu=null,s.value.minInstances=null,s.value.repotags=[],s.value.matchAllRepotags=!1}const be=N(()=>s.value.filter?.trim()||s.value.version&&s.value.version!=="all"||Array.isArray(s.value.repotags)&&s.value.repotags.length>0||(s.value.minRam??0)>0||(s.value.minCpu??0)>0||(s.value.minHdd??0)>0||(s.value.minInstances??0)>0||s.value.matchAllRepotags);function ee(){me.value=window.innerWidth<=960}return ra(()=>{P.showStatus&&ge(),ee(),window.addEventListener("resize",ee)}),ua(()=>{window.removeEventListener("resize",ee)}),(n,e)=>{const m=ba,r=ga,L=Be,R=Fe,O=Re;return g(),z("div",Ta,[a(Le,{class:"pa-4 myapps-table-card"},{default:t(()=>[a(xe,null,{default:t(()=>[a(ke,{cols:"4"},{default:t(()=>[a(_e,{modelValue:s.value.perPage,"onUpdate:modelValue":e[0]||(e[0]=l=>s.value.perPage=l),label:c(o)("pages.apps.table.perPage"),density:"compact",items:s.value.pageOptions},null,8,["modelValue","label","items"])]),_:1}),a(ke,{cols:"8",class:"d-flex align-center justify-start"},{default:t(()=>[a(ae,{modelValue:s.value.filter,"onUpdate:modelValue":e[1]||(e[1]=l=>s.value.filter=l),label:c(o)("pages.apps.table.filter"),density:"compact",variant:"outlined",placeholder:c(o)("pages.apps.table.filterPlaceholder"),clearable:s.value.filter?.length>0,class:"mr-1"},{"append-inner":t(()=>[a(v,{size:"20"},{default:t(()=>[...e[18]||(e[18]=[p(" tabler-search ",-1)])]),_:1})]),_:1},8,["modelValue","label","placeholder","clearable"]),f.privilege!=="none"?(g(),j(Ye,{key:0,"close-on-content-click":!1},{activator:t(({props:l})=>[a(te,{location:"top"},{activator:t(({props:h})=>[a(q,le({icon:"mdi-filter-cog",density:"compact",variant:"text",color:"default"},{...l,...h}),null,16)]),default:t(()=>[u("span",null,y(c(o)("pages.apps.table.advancedFilterTooltip")),1)]),_:2},1024)]),default:t(()=>[a(Ge,{style:{"min-width":"300px"},class:"my-2",onKeydown:e[10]||(e[10]=Te(Ce(()=>{},["stop"]),["enter"]))},{default:t(()=>[a(Q,null,{default:t(()=>[a(_e,{modelValue:Z.value,"onUpdate:modelValue":e[2]||(e[2]=l=>Z.value=l),items:D.value,"item-title":"text","item-value":"value",label:c(o)("pages.apps.table.appType"),density:"compact","hide-details":"",class:"mt-1"},{"prepend-inner":t(()=>[a(v,{class:"mr-1",size:"18"},{default:t(()=>[...e[19]||(e[19]=[p("mdi-filter",-1)])]),_:1})]),_:1},8,["modelValue","items","label"])]),_:1}),a(Q,null,{default:t(()=>[a(_e,{modelValue:s.value.version,"onUpdate:modelValue":e[3]||(e[3]=l=>s.value.version=l),items:oe.value,"item-title":"text","item-value":"value",label:c(o)("pages.apps.table.version"),density:"compact","hide-details":"",class:"mt-1"},{"prepend-inner":t(()=>[a(v,{class:"mr-1",size:"18"},{default:t(()=>[...e[20]||(e[20]=[p("mdi-tag",-1)])]),_:1})]),_:1},8,["modelValue","items","label"])]),_:1}),a(Q,null,{default:t(()=>[a(ae,{modelValue:s.value.minHdd,"onUpdate:modelValue":e[4]||(e[4]=l=>s.value.minHdd=l),modelModifiers:{number:!0},label:c(o)("pages.apps.table.minHdd"),type:"number",min:"1",step:"1",density:"compact","hide-details":"",class:"mt-1"},{"prepend-inner":t(()=>[a(v,{class:"mr-1",size:"18"},{default:t(()=>[...e[21]||(e[21]=[p("mdi-harddisk",-1)])]),_:1})]),_:1},8,["modelValue","label"])]),_:1}),a(Q,null,{default:t(()=>[a(ae,{modelValue:s.value.minRam,"onUpdate:modelValue":e[5]||(e[5]=l=>s.value.minRam=l),modelModifiers:{number:!0},label:c(o)("pages.apps.table.minRam"),type:"number",min:"100",step:"100",density:"compact","hide-details":"",class:"mt-1"},{"prepend-inner":t(()=>[a(v,{class:"mr-1",size:"18"},{default:t(()=>[...e[22]||(e[22]=[p("mdi-memory",-1)])]),_:1})]),_:1},8,["modelValue","label"])]),_:1}),a(Q,null,{default:t(()=>[a(ae,{modelValue:s.value.minCpu,"onUpdate:modelValue":e[6]||(e[6]=l=>s.value.minCpu=l),modelModifiers:{number:!0},label:c(o)("pages.apps.table.minCpu"),type:"number",min:"0.1",step:"0.1",density:"compact","hide-details":"",class:"mt-1"},{"prepend-inner":t(()=>[a(v,{class:"mr-1",size:"18"},{default:t(()=>[...e[23]||(e[23]=[p("mdi-speedometer",-1)])]),_:1})]),_:1},8,["modelValue","label"])]),_:1}),a(Q,null,{default:t(()=>[a(ae,{modelValue:s.value.minInstances,"onUpdate:modelValue":e[7]||(e[7]=l=>s.value.minInstances=l),modelModifiers:{number:!0},label:c(o)("pages.apps.table.minInstances"),type:"number",density:"compact",min:"3",step:"1","hide-details":"",class:"mt-1"},{"prepend-inner":t(()=>[a(v,{class:"mr-1",size:"18"},{default:t(()=>[...e[24]||(e[24]=[p("mdi-map-marker",-1)])]),_:1})]),_:1},8,["modelValue","label"])]),_:1}),a(Q,null,{default:t(()=>[a(ae,{modelValue:E.value,"onUpdate:modelValue":e[8]||(e[8]=l=>E.value=l),label:c(o)("pages.apps.table.repotags"),density:"compact","hide-details":"",clearable:"",placeholder:c(o)("pages.apps.table.repotagsPlaceholder"),class:"mt-1",onKeydown:Te(Ce(ue,["prevent"]),["enter"])},{"prepend-inner":t(()=>[a(v,{class:"mr-1",size:"18"},{default:t(()=>[...e[25]||(e[25]=[p("mdi-tag",-1)])]),_:1})]),_:1},8,["modelValue","label","placeholder","onKeydown"]),s.value.repotags.length>0?(g(),z("div",Ma,[a(Ke,{modelValue:s.value.matchAllRepotags,"onUpdate:modelValue":e[9]||(e[9]=l=>s.value.matchAllRepotags=l),label:c(o)("pages.apps.table.matchAllTags"),density:"compact",class:"pa-0 ml-1","hide-details":""},null,8,["modelValue","label"])])):H("",!0),u("div",Ia,[(g(!0),z(se,null,pe(s.value.repotags,(l,h)=>(g(),j(X,{key:h,closable:"",class:"ma-1",size:"small",color:"success","onClick:close":U=>fe(h)},{default:t(()=>[p(y(l),1)]),_:2},1032,["onClick:close"]))),128))])]),_:1}),be.value?(g(),j(Q,{key:0},{default:t(()=>[a(q,{block:"",variant:"tonal",color:"error",density:"compact",onClick:ve},{default:t(()=>[a(v,{start:""},{default:t(()=>[...e[26]||(e[26]=[p("mdi-filter-off",-1)])]),_:1}),p(" "+y(c(o)("pages.apps.table.clearFilters")),1)]),_:1})]),_:1})):H("",!0)]),_:1})]),_:1})):H("",!0)]),_:1})]),_:1}),a(We,{border:"",rounded:"",class:"mt-4 table-sheet",style:{"max-height":"none"}},{default:t(()=>[a(Qe,{page:s.value.currentPage,"onUpdate:page":e[13]||(e[13]=l=>s.value.currentPage=l),"sort-by":s.value.sortBy,"onUpdate:sortBy":e[14]||(e[14]=l=>s.value.sortBy=l),"sort-desc":s.value.sortDesc,"onUpdate:sortDesc":e[15]||(e[15]=l=>s.value.sortDesc=l),expanded:W.value,"onUpdate:expanded":e[16]||(e[16]=l=>W.value=l),items:ie.value,headers:_.value,"items-per-page":s.value.perPage,"item-value":"name",class:"myapps-table","show-expand":"","hide-default-footer":""},{"no-data":t(()=>[u("div",La,[f.loading?(g(),z("div",Ea,[a(sa,{indeterminate:"",class:"mr-1",size:"25"}),u("div",null,y(c(o)("pages.apps.table.loading")),1)])):!f.loggedIn&&f.manage?(g(),z("div",Da,[a(xe,null,{default:t(()=>[a(ke,{cols:"12",md:"8",lg:"6",class:"mx-auto"},{default:t(()=>[u("div",Oa,[u("div",Ba,[a(la,{size:"120",color:"primary",variant:"tonal",class:"elevation-3 auth-icon-container"},{default:t(()=>[a(v,{size:"60",color:"primary",class:"auth-icon"},{default:t(()=>[...e[27]||(e[27]=[p(" mdi-shield-lock-outline ",-1)])]),_:1})]),_:1})]),u("h1",Fa,y(c(o)("pages.apps.table.signInRequired")),1),u("p",Ra,y(c(o)("pages.apps.table.signInDescription")),1),u("div",Ua,[u("div",Na,[u("div",ja,[u("div",null,[u("div",Ha,[a(v,{color:"success",size:"20",class:"mr-2 flex-shrink-0"},{default:t(()=>[...e[28]||(e[28]=[p("mdi-check-circle",-1)])]),_:1}),u("span",qa,y(c(o)("pages.apps.table.features.viewApps")),1)]),u("div",Ja,[a(v,{color:"success",size:"20",class:"mr-2 flex-shrink-0"},{default:t(()=>[...e[29]||(e[29]=[p("mdi-check-circle",-1)])]),_:1}),u("span",Ya,y(c(o)("pages.apps.table.features.manageResources")),1)])]),u("div",null,[u("div",Ga,[a(v,{color:"success",size:"20",class:"mr-2 flex-shrink-0"},{default:t(()=>[...e[30]||(e[30]=[p("mdi-check-circle",-1)])]),_:1}),u("span",Ka,y(c(o)("pages.apps.table.features.monitorPerformance")),1)]),u("div",Wa,[a(v,{color:"success",size:"20",class:"mr-2 flex-shrink-0"},{default:t(()=>[...e[31]||(e[31]=[p("mdi-check-circle",-1)])]),_:1}),u("span",Qa,y(c(o)("pages.apps.table.features.controlDeployments")),1)])])])])]),u("div",Xa,[a(q,{color:"primary",variant:"flat",onClick:c(V)},{default:t(()=>[a(v,{size:"22",class:"mr-2"},{default:t(()=>[...e[32]||(e[32]=[p("mdi-login-variant",-1)])]),_:1}),p(" "+y(c(o)("pages.apps.table.signIn")),1)]),_:1},8,["onClick"]),a(q,{variant:"flat",href:"https://runonflux.io",target:"_blank",rel:"noopener noreferrer"},{default:t(()=>[a(v,{size:"22",class:"mr-2"},{default:t(()=>[...e[33]||(e[33]=[p("mdi-information-outline",-1)])]),_:1}),p(" "+y(c(o)("pages.apps.table.learnMore")),1)]),_:1})])])]),_:1})]),_:1})])):ne.value.length>0&&ie.value.length===0?(g(),z("div",Za,[a(v,{icon:"mdi-magnify",class:"mr-2"}),u("div",null,y(c(o)("pages.apps.table.noMatchingApps")),1)])):f.apiError?(g(),z("div",et,[a(v,{icon:"tabler-wifi-off",class:"mr-2",size:"24",color:"error"}),u("div",at,y(c(o)("pages.apps.table.connectionError")),1)])):(g(),z("div",tt,[a(v,{icon:"tabler-search-off",class:"mr-2"}),u("div",null,y(c(o)("pages.apps.table.noApps")),1)]))])]),headers:t(({columns:l})=>[u("tr",null,[(g(!0),z(se,null,pe(l,h=>(g(),z("th",{key:h.key,class:"text-start"},y(h.title),1))),128))])]),"item.data-table-expand":t(({internalItem:l,isExpanded:h})=>[a(q,{icon:h(l)?"mdi-chevron-up":"mdi-chevron-down",size:"small",variant:"text",onClick:Ce(U=>b(l),["stop","prevent"])},null,8,["icon","onClick"])]),"item.name":t(({item:l})=>[u("div",st,[a(X,{color:"info",class:"mr-1 mb-1",density:"comfortable",size:"small",rounded:"pill",style:{"margin-top":"5px"}},{default:t(()=>[a(v,{start:"",icon:"mdi-square-rounded-badge-outline",size:"16"}),p(" "+y(l.name),1)]),_:2},1024),a(m,{items:[{icon:"mdi-speedometer",value:x(1,l.name,l),color:"success"},{icon:"mdi-memory",value:x(0,l.name,l),color:"success"},{icon:"mdi-harddisk",value:x(2,l.name,l),color:"success"},{icon:"mdi-map-marker",value:l.instances|3,color:"warning"}].filter(h=>h.value>0)},null,8,["items"]),u("small",lt,[f.activeAppsTab?(g(),j(r,{key:0,"expire-time":w(l.expire,l.height),class:"mb-1"},null,8,["expire-time"])):(g(),z("div",ot))])])]),"item.status":t(({item:l})=>[a(X,{color:re(l.name),size:"small",rounded:"pill"},{default:t(()=>[p(y(G.value.get(l.name)||c(o)("pages.apps.table.checking")),1)]),_:2},1032,["color"])]),"item.description":t(({item:l})=>[u("div",nt,y(l.description),1)]),"expanded-row":t(({columns:l,item:h})=>[u("tr",{class:"expanded-row","data-name":h.name},[u("td",{colspan:l.length},[u("div",ut,[a(L,{app:h,"active-apps-tab":f.activeAppsTab,"expired-apps-tab":!f.activeAppsTab,"is-marketplace":f.isMarketplace,"show-general-section":"","get-new-expire-label":w(h.expire,h.height),class:"mt-4"},null,8,["app","active-apps-tab","expired-apps-tab","is-marketplace","get-new-expire-label"]),$(h).length>0?(g(),z("div",ct,[u("h3",pt,[a(X,{color:"info",variant:"tonal",class:"composition-chip"},{default:t(()=>[a(v,{size:"22",class:"ml-1"},{default:t(()=>[...e[34]||(e[34]=[p(" mdi-hexagon-multiple ",-1)])]),_:1}),u("span",dt,y(c(o)("pages.apps.table.composition")),1)]),_:1})]),a(Xe,{modelValue:I.value,"onUpdate:modelValue":e[11]||(e[11]=U=>I.value=U),"align-tabs":"start","background-color":"transparent",color:"primary",height:"30","hide-slider":"",class:"mb-4 tabs-no-slider"},{default:t(()=>[(g(!0),z(se,null,pe($(h),(U,Y)=>(g(),j(Ze,{key:Y,value:Y,class:"tab-chip",variant:"flat"},{default:t(()=>[a(v,{size:"18",class:"mr-1"},{default:t(()=>[...e[35]||(e[35]=[p(" mdi-cube ",-1)])]),_:1}),p(" "+y(U.name),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["modelValue"]),a(ea,{modelValue:I.value,"onUpdate:modelValue":e[12]||(e[12]=U=>I.value=U),class:"px-4 window-content",touch:!1},{default:t(()=>[(g(!0),z(se,null,pe($(h),(U,Y)=>(g(),j(aa,{key:Y,value:Y},{default:t(()=>[a(ta,{mode:"out-in"},{default:t(()=>[u("div",null,[a(R,{component:U,"app-name":h.name||"",index:Y},null,8,["component","app-name","index"])])]),_:2},1024)]),_:2},1032,["value"]))),128))]),_:2},1032,["modelValue"])])):H("",!0),u("div",mt,[f.activeAppsTab&&J.value[h.name]&&J.value[h.name].length?(g(),z("h3",gt,[a(X,{color:"info",variant:"tonal",class:"composition-chip"},{default:t(()=>[a(v,{size:"22",class:"ml-1"},{default:t(()=>[...e[36]||(e[36]=[p(" mdi-map-marker-radius ",-1)])]),_:1}),u("span",ft,y(c(o)("pages.apps.table.locations")),1)]),_:1})])):H("",!0),f.activeAppsTab&&J.value[h.name]&&J.value[h.name].length?(g(),j(O,{key:1,"app-locations":J.value[h.name]||[],expanded:W.value.includes(h.name),"app-spec":h},null,8,["app-locations","expanded","app-spec"])):H("",!0)])])],8,rt)],8,it)]),"item.actions":t(({item:l})=>[f.activeAppsTab?(g(),j($a,{key:0,row:{item:l},"show-manage":f.manage,"show-install":f.showInstall,"show-control":f.showControl,onOpenAppManagement:A},null,8,["row","show-manage","show-install","show-control"])):(g(),j(Pa,{key:1,row:{item:l}},null,8,["row"]))]),_:1},8,["page","sort-by","sort-desc","expanded","items","headers","items-per-page"])]),_:1}),f.loggedIn||!f.manage?(g(),z("div",vt,[a(xe,{class:"mt-3 mb-1",justify:"center"},{default:t(()=>[a(oa,{modelValue:s.value.currentPage,"onUpdate:modelValue":e[17]||(e[17]=l=>s.value.currentPage=l),length:he.value,rounded:"",size:"small","total-visible":"5"},null,8,["modelValue","length"])]),_:1})])):H("",!0)]),_:1})])}}},zt=ze(bt,[["__scopeId","data-v-9e10d644"]]);export{zt as M,$a as _};
