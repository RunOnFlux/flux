import"./event-utils-DGlX1gEp.js";import{s as X,p as O}from"./crypto-walletconnect-Nsddz84n.js";const Q="0.1.1";function Z(){return Q}class o extends Error{constructor(t,r={}){const n=(()=>{if(r.cause instanceof o){if(r.cause.details)return r.cause.details;if(r.cause.shortMessage)return r.cause.shortMessage}return r.cause?.message?r.cause.message:r.details})(),i=r.cause instanceof o&&r.cause.docsPath||r.docsPath,a=`https://oxlib.sh${i??""}`,f=[t||"An error occurred.",...r.metaMessages?["",...r.metaMessages]:[],...n||i?["",n?`Details: ${n}`:void 0,i?`See: ${a}`:void 0]:[]].filter(u=>typeof u=="string").join(`
`);super(f,r.cause?{cause:r.cause}:void 0),Object.defineProperty(this,"details",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"docs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"docsPath",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"shortMessage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"cause",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"BaseError"}),Object.defineProperty(this,"version",{enumerable:!0,configurable:!0,writable:!0,value:`ox@${Z()}`}),this.cause=r.cause,this.details=n,this.docs=a,this.docsPath=i,this.shortMessage=t}walk(t){return H(this,t)}}function H(e,t){return t?.(e)?e:e&&typeof e=="object"&&"cause"in e&&e.cause?H(e.cause,t):t?null:e}const ee="#__bigint";function w(e,t,r){return JSON.stringify(e,(n,i)=>typeof i=="bigint"?i.toString()+ee:i,r)}function te(e,t){if(h(e)>t)throw new he({givenSize:h(e),maxSize:t})}function re(e,t){if(typeof t=="number"&&t>0&&t>h(e)-1)throw new k({offset:t,position:"start",size:h(e)})}function ne(e,t,r){if(typeof t=="number"&&typeof r=="number"&&h(e)!==r-t)throw new k({offset:r,position:"end",size:h(e)})}const d={zero:48,nine:57,A:65,F:70,a:97,f:102};function z(e){if(e>=d.zero&&e<=d.nine)return e-d.zero;if(e>=d.A&&e<=d.F)return e-(d.A-10);if(e>=d.a&&e<=d.f)return e-(d.a-10)}function P(e,t){if(g(e)>t)throw new be({givenSize:g(e),maxSize:t})}function ie(e,t){if(typeof t=="number"&&t>0&&t>g(e)-1)throw new N({offset:t,position:"start",size:g(e)})}function se(e,t,r){if(typeof t=="number"&&typeof r=="number"&&g(e)!==r-t)throw new N({offset:r,position:"end",size:g(e)})}function C(e,t={}){const{dir:r,size:n=32}=t;if(n===0)return e;const i=e.replace("0x","");if(i.length>n*2)throw new ye({size:Math.ceil(i.length/2),targetSize:n,type:"Hex"});return`0x${i[r==="right"?"padEnd":"padStart"](n*2,"0")}`}const oe=new TextEncoder,ae=Array.from({length:256},(e,t)=>t.toString(16).padStart(2,"0"));function ue(e,t={}){const{strict:r=!1}=t;if(!e)throw new v(e);if(typeof e!="string")throw new v(e);if(r&&!/^0x[0-9a-fA-F]*$/.test(e))throw new I(e);if(!e.startsWith("0x"))throw new I(e)}function $(...e){return`0x${e.reduce((t,r)=>t+r.replace("0x",""),"")}`}function M(e){return e instanceof Uint8Array?p(e):Array.isArray(e)?p(new Uint8Array(e)):e}function p(e,t={}){let r="";for(let i=0;i<e.length;i++)r+=ae[e[i]];const n=`0x${r}`;return typeof t.size=="number"?(P(n,t.size),T(n,t.size)):n}function y(e,t={}){const{signed:r,size:n}=t,i=BigInt(e);let s;n?r?s=(1n<<BigInt(n)*8n-1n)-1n:s=2n**(BigInt(n)*8n)-1n:typeof e=="number"&&(s=BigInt(Number.MAX_SAFE_INTEGER));const a=typeof s=="bigint"&&r?-s-1n:0;if(s&&i>s||i<a){const c=typeof e=="bigint"?"n":"";throw new de({max:s?`${s}${c}`:void 0,min:`${a}${c}`,signed:r,size:n,value:`${e}${c}`})}const u=`0x${(r&&i<0?(1n<<BigInt(n*8))+BigInt(i):i).toString(16)}`;return n?ce(u,n):u}function U(e,t={}){return p(oe.encode(e),t)}function ce(e,t){return C(e,{dir:"left",size:t})}function T(e,t){return C(e,{dir:"right",size:t})}function b(e,t,r,n={}){const{strict:i}=n;ie(e,t);const s=`0x${e.replace("0x","").slice((t??0)*2,(r??e.length)*2)}`;return i&&se(s,t,r),s}function g(e){return Math.ceil((e.length-2)/2)}function fe(e,t={}){const{signed:r}=t;t.size&&P(e,t.size);const n=BigInt(e);if(!r)return n;const i=(e.length-2)/2,s=(1n<<BigInt(i)*8n)-1n,a=s>>1n;return n<=a?n:n-s-1n}function le(e,t={}){const{strict:r=!1}=t;try{return ue(e,{strict:r}),!0}catch{return!1}}class de extends o{constructor({max:t,min:r,signed:n,size:i,value:s}){super(`Number \`${s}\` is not in safe${i?` ${i*8}-bit`:""}${n?" signed":" unsigned"} integer range ${t?`(\`${r}\` to \`${t}\`)`:`(above \`${r}\`)`}`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.IntegerOutOfRangeError"})}}class v extends o{constructor(t){super(`Value \`${typeof t=="object"?w(t):t}\` of type \`${typeof t}\` is an invalid hex type.`,{metaMessages:['Hex types must be represented as `"0x${string}"`.']}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.InvalidHexTypeError"})}}class I extends o{constructor(t){super(`Value \`${t}\` is an invalid hex value.`,{metaMessages:['Hex values must start with `"0x"` and contain only hexadecimal characters (0-9, a-f, A-F).']}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.InvalidHexValueError"})}}let be=class extends o{constructor({givenSize:t,maxSize:r}){super(`Size cannot exceed \`${r}\` bytes. Given size: \`${t}\` bytes.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.SizeOverflowError"})}},N=class extends o{constructor({offset:t,position:r,size:n}){super(`Slice ${r==="start"?"starting":"ending"} at offset \`${t}\` is out-of-bounds (size: \`${n}\`).`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.SliceOffsetOutOfBoundsError"})}};class ye extends o{constructor({size:t,targetSize:r,type:n}){super(`${n.charAt(0).toUpperCase()}${n.slice(1).toLowerCase()} size (\`${t}\`) exceeds padding size (\`${r}\`).`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.SizeExceedsPaddingSizeError"})}}function ge(e){if(!(e instanceof Uint8Array)){if(!e)throw new m(e);if(typeof e!="object")throw new m(e);if(!("BYTES_PER_ELEMENT"in e))throw new m(e);if(e.BYTES_PER_ELEMENT!==1||e.constructor.name!=="Uint8Array")throw new m(e)}}function _(e){return e instanceof Uint8Array?e:typeof e=="string"?D(e):R(e)}function R(e){return e instanceof Uint8Array?e:new Uint8Array(e)}function D(e,t={}){const{size:r}=t;let n=e;r&&(P(e,r),n=T(e,r));let i=n.slice(2);i.length%2&&(i=`0${i}`);const s=i.length/2,a=new Uint8Array(s);for(let f=0,u=0;f<s;f++){const c=z(i.charCodeAt(u++)),l=z(i.charCodeAt(u++));if(c===void 0||l===void 0)throw new o(`Invalid byte sequence ("${i[u-2]}${i[u-1]}" in "${i}").`);a[f]=c*16+l}return a}function h(e){return e.length}function B(e,t,r,n={}){const{strict:i}=n;re(e,t);const s=e.slice(t,r);return i&&ne(s,t,r),s}function A(e,t={}){const{size:r}=t;typeof r<"u"&&te(e,r);const n=p(e,t);return fe(n,t)}function pe(e){try{return ge(e),!0}catch{return!1}}class m extends o{constructor(t){super(`Value \`${typeof t=="object"?w(t):t}\` of type \`${typeof t}\` is an invalid Bytes value.`,{metaMessages:["Bytes values must be of type `Bytes`."]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Bytes.InvalidBytesTypeError"})}}class he extends o{constructor({givenSize:t,maxSize:r}){super(`Size cannot exceed \`${r}\` bytes. Given size: \`${t}\` bytes.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Bytes.SizeOverflowError"})}}class k extends o{constructor({offset:t,position:r,size:n}){super(`Slice ${r==="start"?"starting":"ending"} at offset \`${t}\` is out-of-bounds (size: \`${n}\`).`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Bytes.SliceOffsetOutOfBoundsError"})}}function Y(e,t={}){const{as:r=typeof e=="string"?"Hex":"Bytes"}=t,n=X(_(e));return r==="Bytes"?n:p(n)}function F(e,t={}){const{compressed:r}=t,{prefix:n,x:i,y:s}=e;if(r===!1||typeof i=="bigint"&&typeof s=="bigint"){if(n!==4)throw new j({prefix:n,cause:new Ee});return}if(r===!0||typeof i=="bigint"&&typeof s>"u"){if(n!==3&&n!==2)throw new j({prefix:n,cause:new $e});return}throw new we({publicKey:e})}function me(e){const t=(()=>{if(le(e))return J(e);if(pe(e))return xe(e);const{prefix:r,x:n,y:i}=e;return typeof n=="bigint"&&typeof i=="bigint"?{prefix:r??4,x:n,y:i}:{prefix:r,x:n}})();return F(t),t}function xe(e){return J(p(e))}function J(e){if(e.length!==132&&e.length!==130&&e.length!==68)throw new Pe({publicKey:e});if(e.length===130){const n=BigInt(b(e,0,32)),i=BigInt(b(e,32,64));return{prefix:4,x:n,y:i}}if(e.length===132){const n=Number(b(e,0,1)),i=BigInt(b(e,1,33)),s=BigInt(b(e,33,65));return{prefix:n,x:i,y:s}}const t=Number(b(e,0,1)),r=BigInt(b(e,1,33));return{prefix:t,x:r}}function Re(e,t={}){F(e);const{prefix:r,x:n,y:i}=e,{includePrefix:s=!0}=t;return $(s?y(r,{size:1}):"0x",y(n,{size:32}),typeof i=="bigint"?y(i,{size:32}):"0x")}class we extends o{constructor({publicKey:t}){super(`Value \`${w(t)}\` is not a valid public key.`,{metaMessages:["Public key must contain:","- an `x` and `prefix` value (compressed)","- an `x`, `y`, and `prefix` value (uncompressed)"]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"PublicKey.InvalidError"})}}class j extends o{constructor({prefix:t,cause:r}){super(`Prefix "${t}" is invalid.`,{cause:r}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"PublicKey.InvalidPrefixError"})}}class $e extends o{constructor(){super("Prefix must be 2 or 3 for compressed public keys."),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"PublicKey.InvalidCompressedPrefixError"})}}class Ee extends o{constructor(){super("Prefix must be 4 for uncompressed public keys."),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"PublicKey.InvalidUncompressedPrefixError"})}}let Pe=class extends o{constructor({publicKey:t}){super(`Value \`${t}\` is an invalid public key size.`,{metaMessages:["Expected: 33 bytes (compressed + prefix), 64 bytes (uncompressed) or 65 bytes (uncompressed + prefix).",`Received ${g(M(t))} bytes.`]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"PublicKey.InvalidSerializedSizeError"})}};const V=2n**256n-1n;function Se(e,t={}){const{recovered:r}=t;if(typeof e.r>"u")throw new E({signature:e});if(typeof e.s>"u")throw new E({signature:e});if(r&&typeof e.yParity>"u")throw new E({signature:e});if(e.r<0n||e.r>V)throw new Ie({value:e.r});if(e.s<0n||e.s>V)throw new Be({value:e.s});if(typeof e.yParity=="number"&&e.yParity!==0&&e.yParity!==1)throw new S({value:e.yParity})}function ke(e){if(e.length!==130&&e.length!==132)throw new ve({signature:e});const t=BigInt(b(e,0,32)),r=BigInt(b(e,32,64)),n=(()=>{const i=+`0x${e.slice(130)}`;if(!Number.isNaN(i))try{return Oe(i)}catch{throw new S({value:i})}})();return typeof n>"u"?{r:t,s:r}:{r:t,s:r,yParity:n}}function Ye(e){Se(e);const t=e.r,r=e.s;return $(y(t,{size:32}),y(r,{size:32}),typeof e.yParity=="number"?y(ze(e.yParity),{size:1}):"0x")}function Oe(e){if(e===0||e===27)return 0;if(e===1||e===28)return 1;if(e>=35)return e%2===0?1:0;throw new Ae({value:e})}function ze(e){if(e===0)return 27;if(e===1)return 28;throw new S({value:e})}class ve extends o{constructor({signature:t}){super(`Value \`${t}\` is an invalid signature size.`,{metaMessages:["Expected: 64 bytes or 65 bytes.",`Received ${g(M(t))} bytes.`]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Signature.InvalidSerializedSizeError"})}}class E extends o{constructor({signature:t}){super(`Signature \`${w(t)}\` is missing either an \`r\`, \`s\`, or \`yParity\` property.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Signature.MissingPropertiesError"})}}class Ie extends o{constructor({value:t}){super(`Value \`${t}\` is an invalid r value. r must be a positive integer less than 2^256.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Signature.InvalidRError"})}}class Be extends o{constructor({value:t}){super(`Value \`${t}\` is an invalid s value. s must be a positive integer less than 2^256.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Signature.InvalidSError"})}}class S extends o{constructor({value:t}){super(`Value \`${t}\` is an invalid y-parity value. Y-parity must be 0 or 1.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Signature.InvalidYParityError"})}}class Ae extends o{constructor({value:t}){super(`Value \`${t}\` is an invalid v value. v must be 27, 28 or >=35.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Signature.InvalidVError"})}}const je=new TextDecoder,x=Object.fromEntries(Array.from("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/").map((e,t)=>[t,e.charCodeAt(0)]));({...Object.fromEntries(Array.from("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/").map((e,t)=>[e.charCodeAt(0),t]))});function Ve(e,t={}){const{pad:r=!0,url:n=!1}=t,i=new Uint8Array(Math.ceil(e.length/3)*4);for(let u=0,c=0;c<e.length;u+=4,c+=3){const l=(e[c]<<16)+(e[c+1]<<8)+(e[c+2]|0);i[u]=x[l>>18],i[u+1]=x[l>>12&63],i[u+2]=x[l>>6&63],i[u+3]=x[l&63]}const s=e.length%3,a=Math.floor(e.length/3)*4+(s&&s+1);let f=je.decode(new Uint8Array(i.buffer,0,a));return r&&s===1&&(f+="=="),r&&s===2&&(f+="="),n&&(f=f.replaceAll("+","-").replaceAll("/","_")),f}function He(e,t={}){return Ve(D(e),t)}Uint8Array.from([105,171,180,181,160,222,75,198,42,42,32,31,141,37,186,233]);function Ce(e={}){const{flag:t=5,rpId:r=window.location.hostname,signCount:n=0}=e,i=Y(U(r)),s=y(t,{size:1}),a=y(n,{size:4});return $(i,s,a)}function Me(e){const{challenge:t,crossOrigin:r=!1,extraClientData:n,origin:i=window.location.origin}=e;return JSON.stringify({type:"webauthn.get",challenge:He(t,{url:!0,pad:!1}),origin:i,crossOrigin:r,...n})}function Fe(e){const{challenge:t,crossOrigin:r,extraClientData:n,flag:i,origin:s,rpId:a,signCount:f,userVerification:u="required"}=e,c=Ce({flag:i,rpId:a,signCount:f}),l=Me({challenge:t,crossOrigin:r,extraClientData:n,origin:s}),L=Y(U(l)),q=l.indexOf('"challenge"'),G=l.indexOf('"type"'),K={authenticatorData:c,clientDataJSON:l,challengeIndex:q,typeIndex:G,userVerificationRequired:u==="required"},W=$(c,L);return{metadata:K,payload:W}}async function Je(e={}){const{extractable:t=!1}=e,r=await globalThis.crypto.subtle.generateKey({name:"ECDSA",namedCurve:"P-256"},t,["sign","verify"]),n=await globalThis.crypto.subtle.exportKey("raw",r.publicKey),i=me(new Uint8Array(n));return{privateKey:r.privateKey,publicKey:i}}async function Le(e){const{payload:t,privateKey:r}=e,n=await globalThis.crypto.subtle.sign({name:"ECDSA",hash:"SHA-256"},r,_(t)),i=R(new Uint8Array(n)),s=A(B(i,0,32));let a=A(B(i,32,64));return a>O.CURVE.n/2n&&(a=O.CURVE.n-a),{r:s,s:a}}export{Le as a,Ye as b,Je as c,ke as f,Fe as g,b as s,Re as t};
